<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script id="versionArea" type="text/javascript">
//<![CDATA[
var version = {title: "TiddlyWiki", major: 2, minor: 6, revision: 4, date: new Date("August 18, 2011"), extensions: {}};
//]]>
</script>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="copyright" content="
TiddlyWiki created by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Copyright (c) Jeremy Ruston 2004-2007
Copyright (c) UnaMesa Association 2007-2011

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the UnaMesa Association nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 'AS IS' AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
" />
<!--PRE-HEAD-START-->
<!--{{{-->
<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' />
<!--}}}-->

<!--PRE-HEAD-END-->
<title> Sector Hades Theta - A randomly generated sector for Stars Without Number </title>
<style id="styleArea" type="text/css">
#saveTest {display:none;}
#messageArea {display:none;}
#copyright {display:none;}
#storeArea {display:none;}
#storeArea div {padding:0.5em; margin:1em 0em 0em 0em; border-color:#fff #666 #444 #ddd; border-style:solid; border-width:2px; overflow:auto;}
#shadowArea {display:none;}
#javascriptWarning {width:100%; text-align:center; font-weight:bold; background-color:#dd1100; color:#fff; padding:1em 0em;}
</style>
<!--POST-HEAD-START-->

<!--POST-HEAD-END-->
</head>
<body onload="main();" onunload="if(window.unload) unload();">
<!--PRE-BODY-START-->

<!--PRE-BODY-END-->
<div id="copyright">
Welcome to TiddlyWiki created by Jeremy Ruston; Copyright &copy; 2004-2007 Jeremy Ruston, Copyright &copy; 2007-2011 UnaMesa Association
</div>
<noscript>
<div id="javascriptWarning">
This page requires JavaScript to function properly.<br /><br />If you are using Microsoft Internet Explorer you may need to click on the yellow bar above and select 'Allow Blocked Content'. You must then click 'Yes' on the following security warning.
</div>
</noscript>
<div id="saveTest"></div>
<div id="backstageCloak"></div>
<div id="backstageButton"></div>
<div id="backstageArea"><div id="backstageToolbar"></div></div>
<div id="backstage">
	<div id="backstagePanel"></div>
</div>
<div id="contentWrapper"></div>
<div id="contentStash"></div>
<div id="shadowArea">
<div title="MarkupPreHead">
<pre>&lt;!--{{{--&gt;
&lt;link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' /&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="ColorPalette">
<pre>Background: #fff
Foreground: #000
PrimaryPale: #8cf
PrimaryLight: #18f
PrimaryMid: #04b
PrimaryDark: #014
SecondaryPale: #ffc
SecondaryLight: #fe8
SecondaryMid: #db4
SecondaryDark: #841
TertiaryPale: #eee
TertiaryLight: #ccc
TertiaryMid: #999
TertiaryDark: #666
Error: #f88
</pre>
</div>
<div title="StyleSheetColors">
<pre>/*{{{*/
body {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}

a {color:[[ColorPalette::PrimaryMid]];}
a:hover {background-color:[[ColorPalette::PrimaryMid]]; color:[[ColorPalette::Background]];}
a img {border:0;}

h1,h2,h3,h4,h5,h6 {color:[[ColorPalette::SecondaryDark]]; background:transparent;}
h1 {border-bottom:2px solid [[ColorPalette::TertiaryLight]];}
h2,h3 {border-bottom:1px solid [[ColorPalette::TertiaryLight]];}

.button {color:[[ColorPalette::PrimaryDark]]; border:1px solid [[ColorPalette::Background]];}
.button:hover {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::SecondaryLight]]; border-color:[[ColorPalette::SecondaryMid]];}
.button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::SecondaryDark]];}

.header {background:[[ColorPalette::PrimaryMid]];}
.headerShadow {color:[[ColorPalette::Foreground]];}
.headerShadow a {font-weight:normal; color:[[ColorPalette::Foreground]];}
.headerForeground {color:[[ColorPalette::Background]];}
.headerForeground a {font-weight:normal; color:[[ColorPalette::PrimaryPale]];}

.tabSelected {color:[[ColorPalette::PrimaryDark]];
	background:[[ColorPalette::TertiaryPale]];
	border-left:1px solid [[ColorPalette::TertiaryLight]];
	border-top:1px solid [[ColorPalette::TertiaryLight]];
	border-right:1px solid [[ColorPalette::TertiaryLight]];
}
.tabUnselected {color:[[ColorPalette::Background]]; background:[[ColorPalette::TertiaryMid]];}
.tabContents {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::TertiaryPale]]; border:1px solid [[ColorPalette::TertiaryLight]];}
.tabContents .button {border:0;}

#sidebar {}
#sidebarOptions input {border:1px solid [[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel {background:[[ColorPalette::PrimaryPale]];}
#sidebarOptions .sliderPanel a {border:none;color:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:hover {color:[[ColorPalette::Background]]; background:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:active {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::Background]];}

.wizard {background:[[ColorPalette::PrimaryPale]]; border:1px solid [[ColorPalette::PrimaryMid]];}
.wizard h1 {color:[[ColorPalette::PrimaryDark]]; border:none;}
.wizard h2 {color:[[ColorPalette::Foreground]]; border:none;}
.wizardStep {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];
	border:1px solid [[ColorPalette::PrimaryMid]];}
.wizardStep.wizardStepDone {background:[[ColorPalette::TertiaryLight]];}
.wizardFooter {background:[[ColorPalette::PrimaryPale]];}
.wizardFooter .status {background:[[ColorPalette::PrimaryDark]]; color:[[ColorPalette::Background]];}
.wizard .button {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryLight]]; border: 1px solid;
	border-color:[[ColorPalette::SecondaryPale]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryPale]];}
.wizard .button:hover {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Background]];}
.wizard .button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::Foreground]]; border: 1px solid;
	border-color:[[ColorPalette::PrimaryDark]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryDark]];}

.wizard .notChanged {background:transparent;}
.wizard .changedLocally {background:#80ff80;}
.wizard .changedServer {background:#8080ff;}
.wizard .changedBoth {background:#ff8080;}
.wizard .notFound {background:#ffff80;}
.wizard .putToServer {background:#ff80ff;}
.wizard .gotFromServer {background:#80ffff;}

#messageArea {border:1px solid [[ColorPalette::SecondaryMid]]; background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]];}
#messageArea .button {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::SecondaryPale]]; border:none;}

.popupTiddler {background:[[ColorPalette::TertiaryPale]]; border:2px solid [[ColorPalette::TertiaryMid]];}

.popup {background:[[ColorPalette::TertiaryPale]]; color:[[ColorPalette::TertiaryDark]]; border-left:1px solid [[ColorPalette::TertiaryMid]]; border-top:1px solid [[ColorPalette::TertiaryMid]]; border-right:2px solid [[ColorPalette::TertiaryDark]]; border-bottom:2px solid [[ColorPalette::TertiaryDark]];}
.popup hr {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::PrimaryDark]]; border-bottom:1px;}
.popup li.disabled {color:[[ColorPalette::TertiaryMid]];}
.popup li a, .popup li a:visited {color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:active {background:[[ColorPalette::SecondaryPale]]; color:[[ColorPalette::Foreground]]; border: none;}
.popupHighlight {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
.listBreak div {border-bottom:1px solid [[ColorPalette::TertiaryDark]];}

.tiddler .defaultCommand {font-weight:bold;}

.shadow .title {color:[[ColorPalette::TertiaryDark]];}

.title {color:[[ColorPalette::SecondaryDark]];}
.subtitle {color:[[ColorPalette::TertiaryDark]];}

.toolbar {color:[[ColorPalette::PrimaryMid]];}
.toolbar a {color:[[ColorPalette::TertiaryLight]];}
.selected .toolbar a {color:[[ColorPalette::TertiaryMid]];}
.selected .toolbar a:hover {color:[[ColorPalette::Foreground]];}

.tagging, .tagged {border:1px solid [[ColorPalette::TertiaryPale]]; background-color:[[ColorPalette::TertiaryPale]];}
.selected .tagging, .selected .tagged {background-color:[[ColorPalette::TertiaryLight]]; border:1px solid [[ColorPalette::TertiaryMid]];}
.tagging .listTitle, .tagged .listTitle {color:[[ColorPalette::PrimaryDark]];}
.tagging .button, .tagged .button {border:none;}

.footer {color:[[ColorPalette::TertiaryLight]];}
.selected .footer {color:[[ColorPalette::TertiaryMid]];}

.error, .errorButton {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Error]];}
.warning {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryPale]];}
.lowlight {background:[[ColorPalette::TertiaryLight]];}

.zoomer {background:none; color:[[ColorPalette::TertiaryMid]]; border:3px solid [[ColorPalette::TertiaryMid]];}

.imageLink, #displayArea .imageLink {background:transparent;}

.annotation {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border:2px solid [[ColorPalette::SecondaryMid]];}

.viewer .listTitle {list-style-type:none; margin-left:-2em;}
.viewer .button {border:1px solid [[ColorPalette::SecondaryMid]];}
.viewer blockquote {border-left:3px solid [[ColorPalette::TertiaryDark]];}

.viewer table, table.twtable {border:2px solid [[ColorPalette::TertiaryDark]];}
.viewer th, .viewer thead td, .twtable th, .twtable thead td {background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::Background]];}
.viewer td, .viewer tr, .twtable td, .twtable tr {border:1px solid [[ColorPalette::TertiaryDark]];}

.viewer pre {border:1px solid [[ColorPalette::SecondaryLight]]; background:[[ColorPalette::SecondaryPale]];}
.viewer code {color:[[ColorPalette::SecondaryDark]];}
.viewer hr {border:0; border-top:dashed 1px [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::TertiaryDark]];}

.highlight, .marked {background:[[ColorPalette::SecondaryLight]];}

.editor input {border:1px solid [[ColorPalette::PrimaryMid]];}
.editor textarea {border:1px solid [[ColorPalette::PrimaryMid]]; width:100%;}
.editorFooter {color:[[ColorPalette::TertiaryMid]];}
.readOnly {background:[[ColorPalette::TertiaryPale]];}

#backstageArea {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::TertiaryMid]];}
#backstageArea a {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstageArea a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; }
#backstageArea a.backstageSelTab {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
#backstageButton a {background:none; color:[[ColorPalette::Background]]; border:none;}
#backstageButton a:hover {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstagePanel {background:[[ColorPalette::Background]]; border-color: [[ColorPalette::Background]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]];}
.backstagePanelFooter .button {border:none; color:[[ColorPalette::Background]];}
.backstagePanelFooter .button:hover {color:[[ColorPalette::Foreground]];}
#backstageCloak {background:[[ColorPalette::Foreground]]; opacity:0.6; filter:alpha(opacity=60);}
/*}}}*/</pre>
</div>
<div title="StyleSheetLayout">
<pre>/*{{{*/
* html .tiddler {height:1%;}

body {font-size:.75em; font-family:arial,helvetica; margin:0; padding:0;}

h1,h2,h3,h4,h5,h6 {font-weight:bold; text-decoration:none;}
h1,h2,h3 {padding-bottom:1px; margin-top:1.2em;margin-bottom:0.3em;}
h4,h5,h6 {margin-top:1em;}
h1 {font-size:1.35em;}
h2 {font-size:1.25em;}
h3 {font-size:1.1em;}
h4 {font-size:1em;}
h5 {font-size:.9em;}

hr {height:1px;}

a {text-decoration:none;}

dt {font-weight:bold;}

ol {list-style-type:decimal;}
ol ol {list-style-type:lower-alpha;}
ol ol ol {list-style-type:lower-roman;}
ol ol ol ol {list-style-type:decimal;}
ol ol ol ol ol {list-style-type:lower-alpha;}
ol ol ol ol ol ol {list-style-type:lower-roman;}
ol ol ol ol ol ol ol {list-style-type:decimal;}

.txtOptionInput {width:11em;}

#contentWrapper .chkOptionInput {border:0;}

.externalLink {text-decoration:underline;}

.indent {margin-left:3em;}
.outdent {margin-left:3em; text-indent:-3em;}
code.escaped {white-space:nowrap;}

.tiddlyLinkExisting {font-weight:bold;}
.tiddlyLinkNonExisting {font-style:italic;}

/* the 'a' is required for IE, otherwise it renders the whole tiddler in bold */
a.tiddlyLinkNonExisting.shadow {font-weight:bold;}

#mainMenu .tiddlyLinkExisting,
	#mainMenu .tiddlyLinkNonExisting,
	#sidebarTabs .tiddlyLinkNonExisting {font-weight:normal; font-style:normal;}
#sidebarTabs .tiddlyLinkExisting {font-weight:bold; font-style:normal;}

.header {position:relative;}
.header a:hover {background:transparent;}
.headerShadow {position:relative; padding:4.5em 0 1em 1em; left:-1px; top:-1px;}
.headerForeground {position:absolute; padding:4.5em 0 1em 1em; left:0; top:0;}

.siteTitle {font-size:3em;}
.siteSubtitle {font-size:1.2em;}

#mainMenu {position:absolute; left:0; width:10em; text-align:right; line-height:1.6em; padding:1.5em 0.5em 0.5em 0.5em; font-size:1.1em;}

#sidebar {position:absolute; right:3px; width:16em; font-size:.9em;}
#sidebarOptions {padding-top:0.3em;}
#sidebarOptions a {margin:0 0.2em; padding:0.2em 0.3em; display:block;}
#sidebarOptions input {margin:0.4em 0.5em;}
#sidebarOptions .sliderPanel {margin-left:1em; padding:0.5em; font-size:.85em;}
#sidebarOptions .sliderPanel a {font-weight:bold; display:inline; padding:0;}
#sidebarOptions .sliderPanel input {margin:0 0 0.3em 0;}
#sidebarTabs .tabContents {width:15em; overflow:hidden;}

.wizard {padding:0.1em 1em 0 2em;}
.wizard h1 {font-size:2em; font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em;}
.wizard h2 {font-size:1.2em; font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em;}
.wizardStep {padding:1em 1em 1em 1em;}
.wizard .button {margin:0.5em 0 0; font-size:1.2em;}
.wizardFooter {padding:0.8em 0.4em 0.8em 0;}
.wizardFooter .status {padding:0 0.4em; margin-left:1em;}
.wizard .button {padding:0.1em 0.2em;}

#messageArea {position:fixed; top:2em; right:0; margin:0.5em; padding:0.5em; z-index:2000; _position:absolute;}
.messageToolbar {display:block; text-align:right; padding:0.2em;}
#messageArea a {text-decoration:underline;}

.tiddlerPopupButton {padding:0.2em;}
.popupTiddler {position: absolute; z-index:300; padding:1em; margin:0;}

.popup {position:absolute; z-index:300; font-size:.9em; padding:0; list-style:none; margin:0;}
.popup .popupMessage {padding:0.4em;}
.popup hr {display:block; height:1px; width:auto; padding:0; margin:0.2em 0;}
.popup li.disabled {padding:0.4em;}
.popup li a {display:block; padding:0.4em; font-weight:normal; cursor:pointer;}
.listBreak {font-size:1px; line-height:1px;}
.listBreak div {margin:2px 0;}

.tabset {padding:1em 0 0 0.5em;}
.tab {margin:0 0 0 0.25em; padding:2px;}
.tabContents {padding:0.5em;}
.tabContents ul, .tabContents ol {margin:0; padding:0;}
.txtMainTab .tabContents li {list-style:none;}
.tabContents li.listLink { margin-left:.75em;}

#contentWrapper {display:block;}
#splashScreen {display:none;}

#displayArea {margin:1em 17em 0 14em;}

.toolbar {text-align:right; font-size:.9em;}

.tiddler {padding:1em 1em 0;}

.missing .viewer,.missing .title {font-style:italic;}

.title {font-size:1.6em; font-weight:bold;}

.missing .subtitle {display:none;}
.subtitle {font-size:1.1em;}

.tiddler .button {padding:0.2em 0.4em;}

.tagging {margin:0.5em 0.5em 0.5em 0; float:left; display:none;}
.isTag .tagging {display:block;}
.tagged {margin:0.5em; float:right;}
.tagging, .tagged {font-size:0.9em; padding:0.25em;}
.tagging ul, .tagged ul {list-style:none; margin:0.25em; padding:0;}
.tagClear {clear:both;}

.footer {font-size:.9em;}
.footer li {display:inline;}

.annotation {padding:0.5em; margin:0.5em;}

* html .viewer pre {width:99%; padding:0 0 1em 0;}
.viewer {line-height:1.4em; padding-top:0.5em;}
.viewer .button {margin:0 0.25em; padding:0 0.25em;}
.viewer blockquote {line-height:1.5em; padding-left:0.8em;margin-left:2.5em;}
.viewer ul, .viewer ol {margin-left:0.5em; padding-left:1.5em;}

.viewer table, table.twtable {border-collapse:collapse; margin:0.8em 1.0em;}
.viewer th, .viewer td, .viewer tr,.viewer caption,.twtable th, .twtable td, .twtable tr,.twtable caption {padding:3px;}
table.listView {font-size:0.85em; margin:0.8em 1.0em;}
table.listView th, table.listView td, table.listView tr {padding:0 3px 0 3px;}

.viewer pre {padding:0.5em; margin-left:0.5em; font-size:1.2em; line-height:1.4em; overflow:auto;}
.viewer code {font-size:1.2em; line-height:1.4em;}

.editor {font-size:1.1em;}
.editor input, .editor textarea {display:block; width:100%; font:inherit;}
.editorFooter {padding:0.25em 0; font-size:.9em;}
.editorFooter .button {padding-top:0; padding-bottom:0;}

.fieldsetFix {border:0; padding:0; margin:1px 0px;}

.zoomer {font-size:1.1em; position:absolute; overflow:hidden;}
.zoomer div {padding:1em;}

* html #backstage {width:99%;}
* html #backstageArea {width:99%;}
#backstageArea {display:none; position:relative; overflow: hidden; z-index:150; padding:0.3em 0.5em;}
#backstageToolbar {position:relative;}
#backstageArea a {font-weight:bold; margin-left:0.5em; padding:0.3em 0.5em;}
#backstageButton {display:none; position:absolute; z-index:175; top:0; right:0;}
#backstageButton a {padding:0.1em 0.4em; margin:0.1em;}
#backstage {position:relative; width:100%; z-index:50;}
#backstagePanel {display:none; z-index:100; position:absolute; width:90%; margin-left:3em; padding:1em;}
.backstagePanelFooter {padding-top:0.2em; float:right;}
.backstagePanelFooter a {padding:0.2em 0.4em;}
#backstageCloak {display:none; z-index:20; position:absolute; width:100%; height:100px;}

.whenBackstage {display:none;}
.backstageVisible .whenBackstage {display:block;}
/*}}}*/
</pre>
</div>
<div title="StyleSheetLocale">
<pre>/***
StyleSheet for use when a translation requires any css style changes.
This StyleSheet can be used directly by languages such as Chinese, Japanese and Korean which need larger font sizes.
***/
/*{{{*/
body {font-size:0.8em;}
#sidebarOptions {font-size:1.05em;}
#sidebarOptions a {font-style:normal;}
#sidebarOptions .sliderPanel {font-size:0.95em;}
.subtitle {font-size:0.8em;}
.viewer table.listView {font-size:0.95em;}
/*}}}*/</pre>
</div>
<div title="StyleSheetPrint">
<pre>/*{{{*/
@media print {
#mainMenu, #sidebar, #messageArea, .toolbar, #backstageButton, #backstageArea {display: none !important;}
#displayArea {margin: 1em 1em 0em;}
noscript {display:none;} /* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */
}
/*}}}*/</pre>
</div>
<div title="PageTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='header' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;
&lt;div class='headerShadow'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;div class='headerForeground'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id='mainMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;
&lt;div id='sidebar'&gt;
&lt;div id='sidebarOptions' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;
&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='displayArea'&gt;
&lt;div id='messageArea'&gt;&lt;/div&gt;
&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="ViewTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::ViewToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date'&gt;&lt;/span&gt;)&lt;/div&gt;
&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;
&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;
&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;
&lt;div class='tagClear'&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="EditTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::EditToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit title'&gt;&lt;/div&gt;
&lt;div macro='annotations'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit tags'&gt;&lt;/div&gt;&lt;div class='editorFooter'&gt;&lt;span macro='message views.editor.tagPrompt'&gt;&lt;/span&gt;&lt;span macro='tagChooser excludeLists'&gt;&lt;/span&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="GettingStarted">
<pre>To get started with this blank [[TiddlyWiki]], you'll need to modify the following tiddlers:
* [[SiteTitle]] &amp; [[SiteSubtitle]]: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)
* [[MainMenu]]: The menu (usually on the left)
* [[DefaultTiddlers]]: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened
You'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;</pre>
</div>
<div title="OptionsPanel">
<pre>These [[InterfaceOptions]] for customising [[TiddlyWiki]] are saved in your browser

Your username for signing your edits. Write it as a [[WikiWord]] (eg [[JoeBloggs]])

&lt;&lt;option txtUserName&gt;&gt;
&lt;&lt;option chkSaveBackups&gt;&gt; [[SaveBackups]]
&lt;&lt;option chkAutoSave&gt;&gt; [[AutoSave]]
&lt;&lt;option chkRegExpSearch&gt;&gt; [[RegExpSearch]]
&lt;&lt;option chkCaseSensitiveSearch&gt;&gt; [[CaseSensitiveSearch]]
&lt;&lt;option chkAnimate&gt;&gt; [[EnableAnimations]]

----
Also see [[AdvancedOptions]]</pre>
</div>
<div title="ImportTiddlers">
<pre>&lt;&lt;importTiddlers&gt;&gt;</pre>
</div>
</div>
<!--POST-SHADOWAREA-->
<div id="storeArea">
<div title="AttachFileMIMETypes" modifier="ELSDesignStudios" created="200605131756" modified="200605150121" tags="AttachFilePackage settings" server.type="file" server.host="http://www.tiddlytools.com" server.page.revision="200605150121">
<pre>text/plain
.txt .text .js .vbs .asp .cgi .pl
----
text/html
.htm .html .hta .htx .mht
----
text/comma-separated-values
.csv
----
text/javascript
.js
----
text/css
.css
----
text/xml
.xml .xsl .xslt
----
image/gif
.gif
----
image/jpeg
.jpg .jpe .jpeg
----
image/png
.png
----
image/bmp
.bmp
----
image/tiff
.tif .tiff
----
audio/basic
.au .snd
----
audio/wav
.wav
----
audio/x-pn-realaudio
.ra .rm .ram
----
audio/x-midi
.mid .midi
----
audio/mp3
.mp3
----
audio/m3u
.m3u
----
video/x-ms-asf
.asf
----
video/avi
.avi
----
video/mpeg
.mpg .mpeg
----
video/quicktime
.qt .mov .qtvr
----
application/pdf
.pdf
----
application/rtf
.rtf
----
application/postscript
.ai .eps .ps
----
application/wordperfect
.wpd
----
application/mswrite
.wri
----
application/msexcel
.xls .xls3 .xls4 .xls5 .xlw
----
application/msword
.doc
----
application/mspowerpoint
.ppt .pps
----
application/x-director
.swa
----
application/x-shockwave-flash
.swf
----
application/x-zip-compressed
.zip
----
application/x-gzip
.gz
----
application/x-rar-compressed
.rar
----
application/octet-stream
.com .exe .dll .ocx
----
application/java-archive
.jar</pre>
</div>
<div title="AttachFilePackage" modifier="ELSDesignStudios" created="200707170002" tags="package story AttachFilePackage" server.type="file" server.host="http://www.tiddlytools.com" server.page.revision="200707170002">
<pre>[[AttachFilePlugin]] reads binary data from locally-stored files (e.g., images, PDFs, mp3's, etc.) and converts it to base64-encoded text that is stored in tiddlers tagged with&lt;&lt;tag attachment&gt;&gt;. [[AttachFilePluginFormatters]] allows you to use those tiddlers in place of the external path/file references that are normally part of the image and external links wiki syntax.

[[FileDropPlugin]] and [[FileDropPluginConfig]] allow you to quickly create attachment tiddlers simply by dragging files directly from your system's desktop folder display and dropping it onto an open TiddlyWiki document.  Text files are automatically created as simple tiddlers, while binary files are automatically encoded and attached.</pre>
</div>
<div title="AttachFilePlugin" modifier="ELSDesignStudios" created="200512271908" modified="201102141417" tags="AttachFilePackage IconPackage systemConfig" server.type="file" server.host="http://www.tiddlytools.com" server.page.revision="201102141417">
<pre>/***
|Name|AttachFilePlugin|
|Source|http://www.TiddlyTools.com/#AttachFilePlugin|
|Documentation|http://www.TiddlyTools.com/#AttachFilePluginInfo|
|Version|4.0.1|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|plugin|
|Requires|AttachFilePluginFormatters, AttachFileMIMETypes|
|Description|Store binary files as base64-encoded tiddlers with fallback links for separate local and/or remote file storage|
Store or link binary files (such as jpg, gif, pdf or even mp3) within your TiddlyWiki document and then use them as images or links from within your tiddler content.
&gt; Important note: As of version 3.6.0, in order to //render// images and other binary attachments created with this plugin, you must also install [[AttachFilePluginFormatters]], which extends the behavior of the TiddlyWiki core formatters for embedded images ({{{[img[tooltip|image]]}}}), linked embedded images ({{{[img[tooltip|image][link]]}}}), and external/&quot;pretty&quot; links ({{{[[label|link]]}}}), so that these formatter will process references to attachment tiddlers as if a normal file reference had been provided. |
!!!!!Documentation
&gt;see [[AttachFilePluginInfo]]
!!!!!Inline interface (live)
&gt;see [[AttachFile]] (shadow tiddler)
&gt;&lt;&lt;tiddler AttachFile&gt;&gt;
!!!!!Revisions
&lt;&lt;&lt;
2011.02.14 4.0.1 fix OSX error: use picker.file.path
2009.06.04 4.0.0 changed attachment storage format to use //sections// instead of embedded substring markers.
|please see [[AttachFilePluginInfo]] for additional revision details|
2005.07.20 1.0.0 Initial Release
&lt;&lt;&lt;
!!!!!Code
***/
// // version
//{{{
version.extensions.AttachFilePlugin= {major: 4, minor: 0, revision: 1, date: new Date(2011,2,14)};

// shadow tiddler
config.shadowTiddlers.AttachFile=&quot;&lt;&lt;attach inline&gt;&gt;&quot;;

// add 'attach' backstage task (insert before built-in 'importTask')
if (config.tasks) { // for TW2.2b or above
	config.tasks.attachTask = {
		text: &quot;attach&quot;,
		tooltip: &quot;Attach a binary file as a tiddler&quot;,
		content: &quot;&lt;&lt;attach inline&gt;&gt;&quot;
	}
	config.backstageTasks.splice(config.backstageTasks.indexOf(&quot;importTask&quot;),0,&quot;attachTask&quot;);
}

config.macros.attach = {
// // lingo
//{{{
	label: &quot;attach file&quot;,
	tooltip: &quot;Attach a file to this document&quot;,
	linkTooltip: &quot;Attachment: &quot;,

	typeList: &quot;AttachFileMIMETypes&quot;,

	titlePrompt: &quot; enter tiddler title...&quot;,
	MIMEPrompt: &quot;&lt;option value=''&gt;select MIME type...&lt;/option&gt;&lt;option value='editlist'&gt;[edit list...]&lt;/option&gt;&quot;,
	localPrompt: &quot; enter local path/filename...&quot;,
	URLPrompt: &quot; enter remote URL...&quot;,

	tiddlerErr: &quot;Please enter a tiddler title&quot;,
	sourceErr: &quot;Please enter a source path/filename&quot;,
	storageErr: &quot;Please select a storage method: embedded, local or remote&quot;,
	MIMEErr: &quot;Unrecognized file format.  Please select a MIME type&quot;,
	localErr: &quot;Please enter a local path/filename&quot;,
	URLErr: &quot;Please enter a remote URL&quot;,
	fileErr: &quot;Invalid path/file or file not found&quot;,

	tiddlerFormat: '!usage\n{{{%0}}}\n%0\n!notes\n%1\n!type\n%2\n!file\n%3\n!url\n%4\n!data\n%5\n',

//}}}
// // macro definition
//{{{
	handler:
	function(place,macroName,params) {
		if (params &amp;&amp; !params[0])
			{ createTiddlyButton(place,this.label,this.tooltip,this.toggleAttachPanel); return; }
		var id=params.shift();
		this.createAttachPanel(place,id+&quot;_attachPanel&quot;,params);
		document.getElementById(id+&quot;_attachPanel&quot;).style.position=&quot;static&quot;;
		document.getElementById(id+&quot;_attachPanel&quot;).style.display=&quot;block&quot;;
	},
//}}}
//{{{
	createAttachPanel:
	function(place,panel_id,params) {
		if (!panel_id || !panel_id.length) var panel_id=&quot;_attachPanel&quot;;
		// remove existing panel (if any)
		var panel=document.getElementById(panel_id); if (panel) panel.parentNode.removeChild(panel);
		// set styles for this panel
		setStylesheet(this.css,&quot;attachPanel&quot;);
		// create new panel
		var title=&quot;&quot;; if (params &amp;&amp; params[0]) title=params.shift();
		var types=this.MIMEPrompt+this.formatListOptions(store.getTiddlerText(this.typeList)); // get MIME types
		panel=createTiddlyElement(place,&quot;span&quot;,panel_id,&quot;attachPanel&quot;,null);
		var html=this.html.replace(/%id%/g,panel_id);
		html=html.replace(/%title%/g,title);
		html=html.replace(/%disabled%/g,title.length?&quot;disabled&quot;:&quot;&quot;);
		html=html.replace(/%IEdisabled%/g,config.browser.isIE?&quot;disabled&quot;:&quot;&quot;);
		html=html.replace(/%types%/g,types);
		panel.innerHTML=html;
		if (config.browser.isGecko) { // FF3 FIXUP
			document.getElementById(&quot;attachSource&quot;).style.display=&quot;none&quot;;
			document.getElementById(&quot;attachFixPanel&quot;).style.display=&quot;block&quot;;
		}
		return panel;
	},
//}}}
//{{{
	toggleAttachPanel:
	function (e) {
		if (!e) var e = window.event;
		var parent=resolveTarget(e).parentNode;
		var panel = document.getElementById(&quot;_attachPanel&quot;);
		if (panel==undefined || panel.parentNode!=parent)
			panel=config.macros.attach.createAttachPanel(parent,&quot;_attachPanel&quot;);
		var isOpen = panel.style.display==&quot;block&quot;;
		if(config.options.chkAnimate)
			anim.startAnimating(new Slider(panel,!isOpen,e.shiftKey || e.altKey,&quot;none&quot;));
		else
			panel.style.display = isOpen ? &quot;none&quot; : &quot;block&quot; ;
		e.cancelBubble = true;
		if (e.stopPropagation) e.stopPropagation();
		return(false);
	},
//}}}
//{{{
	formatListOptions:
	function(text) {
		if (!text || !text.trim().length) return &quot;&quot;;
		// get MIME list content from text
		var parts=text.split(&quot;\n----\n&quot;);
		var out=&quot;&quot;;
		for (var p=0; p&lt;parts.length; p++) {
			var lines=parts[p].split(&quot;\n&quot;);
			var label=lines.shift(); // 1st line=display text
			var value=lines.shift(); // 2nd line=item value
			out +='&lt;option value=&quot;%1&quot;&gt;%0&lt;/option&gt;'.format([label,value]);
		}
		return out;
	},
//}}}
// // interface definition
//{{{
	css:
	&quot;.attachPanel { display: none; position:absolute; z-index:10; width:35em; right:105%; top:0em;\
		background-color: #eee; color:#000; font-size: 8pt; line-height:110%;\
		border:1px solid black; border-bottom-width: 3px; border-right-width: 3px;\
		padding: 0.5em; margin:0em; -moz-border-radius:1em;-webkit-border-radius:1em; text-align:left }\
	.attachPanel form { display:inline;border:0;padding:0;margin:0; }\
	.attachPanel select { width:99%;margin:0px;font-size:8pt;line-height:110%;}\
	.attachPanel input  { width:98%;padding:0px;margin:0px;font-size:8pt;line-height:110%}\
	.attachPanel textarea { width:98%;margin:0px;height:2em;font-size:8pt;line-height:110%}\
	.attachPanel table { width:100%;border:0;margin:0;padding:0;color:inherit; }\
	.attachPanel tbody, .attachPanel tr, .attachPanel td { border:0;margin:0;padding:0;color:#000; }\
	.attachPanel .box { border:1px solid black; padding:.3em; margin:.3em 0px; background:#f8f8f8; \
		-moz-border-radius:5px;-webkit-border-radius:5px; }\
	.attachPanel .chk { width:auto;border:0; }\
	.attachPanel .btn { width:auto; }\
	.attachPanel .btn2 { width:49%; }\
	&quot;,
//}}}
//{{{
	html:
	'&lt;form&gt;\
		attach from source file\
		&lt;input type=&quot;file&quot; id=&quot;attachSource&quot; name=&quot;source&quot; size=&quot;56&quot;\
			onChange=&quot;config.macros.attach.onChangeSource(this)&quot;&gt;\
		&lt;div id=&quot;attachFixPanel&quot; style=&quot;display:none&quot;&gt;&lt;!-- FF3 FIXUP --&gt;\
			&lt;input type=&quot;text&quot; id=&quot;attachFixSource&quot; style=&quot;width:90%&quot;\
				title=&quot;Enter a path/file to attach&quot;\
				onChange=&quot;config.macros.attach.onChangeSource(this);&quot;&gt;\
			&lt;input type=&quot;button&quot; style=&quot;width:7%&quot; value=&quot;...&quot;\
				title=&quot;Enter a path/file to attach&quot;\
				onClick=&quot;config.macros.attach.askForFilename(document.getElementById(\'attachFixSource\'));&quot;&gt;\
		&lt;/div&gt;&lt;!--end FF3 FIXUP--&gt;\
		&lt;div class=&quot;box&quot;&gt;\
		&lt;table style=&quot;border:0&quot;&gt;&lt;tr style=&quot;border:0&quot;&gt;&lt;td style=&quot;border:0;text-align:right;width:1%;white-space:nowrap&quot;&gt;\
			embed data &lt;input type=checkbox class=chk name=&quot;useData&quot; %IEdisabled% \
				onclick=&quot;if (!this.form.MIMEType.value.length)\
					this.form.MIMEType.selectedIndex=this.checked?1:0; &quot;&gt;&amp;nbsp;\
		&lt;/td&gt;&lt;td style=&quot;border:0&quot;&gt;\
			&lt;select size=1 name=&quot;MIMEType&quot; \
				onchange=&quot;this.title=this.value; if (this.value==\'editlist\')\
					{ this.selectedIndex=this.form.useData.checked?1:0; story.displayTiddler(null,config.macros.attach.typeList,2); return; }&quot;&gt;\
				&lt;option value=&quot;&quot;&gt;&lt;/option&gt;\
				%types%\
			&lt;/select&gt;\
		&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&quot;border:0&quot;&gt;&lt;td style=&quot;border:0;text-align:right;width:1%;white-space:nowrap&quot;&gt;\
			local link &lt;input type=checkbox class=chk name=&quot;useLocal&quot;\
				onclick=&quot;this.form.local.value=this.form.local.defaultValue=this.checked?config.macros.attach.localPrompt:\'\';&quot;&gt;&amp;nbsp;\
		&lt;/td&gt;&lt;td style=&quot;border:0&quot;&gt;\
			&lt;input type=text name=&quot;local&quot; size=15 autocomplete=off value=&quot;&quot;\
				onchange=&quot;this.form.useLocal.checked=this.value.length&quot; \
				onkeyup=&quot;this.form.useLocal.checked=this.value.length&quot; \
				onfocus=&quot;if (!this.value.length) this.value=config.macros.attach.localPrompt; this.select()&quot;&gt;\
		&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&quot;border:0&quot;&gt;&lt;td style=&quot;border:0;text-align:right;width:1%;white-space:nowrap&quot;&gt;\
			remote link &lt;input type=checkbox class=chk name=&quot;useURL&quot;\
				onclick=&quot;this.form.URL.value=this.form.URL.defaultValue=this.checked?config.macros.attach.URLPrompt:\'\';\&quot;&gt;&amp;nbsp;\
		&lt;/td&gt;&lt;td style=&quot;border:0&quot;&gt;\
			&lt;input type=text name=&quot;URL&quot; size=15 autocomplete=off value=&quot;&quot;\
				onfocus=&quot;if (!this.value.length) this.value=config.macros.attach.URLPrompt; this.select()&quot;\
				onchange=&quot;this.form.useURL.checked=this.value.length;&quot;\
				onkeyup=&quot;this.form.useURL.checked=this.value.length;&quot;&gt;\
		&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;\
		&lt;/div&gt;\
		&lt;table style=&quot;border:0&quot;&gt;&lt;tr style=&quot;border:0&quot;&gt;&lt;td style=&quot;border:0;text-align:right;vertical-align:top;width:1%;white-space:nowrap&quot;&gt;\
			notes&amp;nbsp;\
		&lt;/td&gt;&lt;td style=&quot;border:0&quot; colspan=2&gt;\
			&lt;textarea name=&quot;notes&quot; style=&quot;width:98%;height:3.5em;margin-bottom:2px&quot;&gt;&lt;/textarea&gt;\
		&lt;/td&gt;&lt;tr style=&quot;border:0&quot;&gt;&lt;td style=&quot;border:0;text-align:right;width:1%;white-space:nowrap&quot;&gt;\
			attach as&amp;nbsp;\
		&lt;/td&gt;&lt;td style=&quot;border:0&quot; colspan=2&gt;\
			&lt;input type=text name=&quot;tiddlertitle&quot; size=15 autocomplete=off value=&quot;%title%&quot;\
				onkeyup=&quot;if (!this.value.length) { this.value=config.macros.attach.titlePrompt; this.select(); }&quot;\
				onfocus=&quot;if (!this.value.length) this.value=config.macros.attach.titlePrompt; this.select()&quot; %disabled%&gt;\
		&lt;/td&gt;&lt;/tr&gt;&lt;/tr&gt;&lt;tr style=&quot;border:0&quot;&gt;&lt;td style=&quot;border:0;text-align:right;width:1%;white-space:nowrap&quot;&gt;\
			add tags&amp;nbsp;\
		&lt;/td&gt;&lt;td style=&quot;border:0&quot;&gt;\
			&lt;input type=text name=&quot;tags&quot; size=15 autocomplete=off value=&quot;&quot; onfocus=&quot;this.select()&quot;&gt;\
		&lt;/td&gt;&lt;td style=&quot;width:40%;text-align:right;border:0&quot;&gt;\
			&lt;input type=button class=btn2 value=&quot;attach&quot;\
				onclick=&quot;config.macros.attach.onClickAttach(this)&quot;&gt;&lt;!--\
			--&gt;&lt;input type=button class=btn2 value=&quot;close&quot;\
				onclick=&quot;var panel=document.getElementById(\'%id%\'); if (panel) panel.parentNode.removeChild(panel);&quot;&gt;\
		&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;\
	&lt;/form&gt;',
//}}}
// // control processing
//{{{
	onChangeSource:
	function(here) {
		var form=here.form;
		var list=form.MIMEType;
		var theFilename  = here.value;
		var theExtension = theFilename.substr(theFilename.lastIndexOf('.')).toLowerCase();
		// if theFilename is in current document folder, remove path prefix and use relative reference
		var h=document.location.href; folder=getLocalPath(decodeURIComponent(h.substr(0,h.lastIndexOf(&quot;/&quot;)+1)));
		if (theFilename.substr(0,folder.length)==folder) theFilename='./'+theFilename.substr(folder.length);
		else theFilename='file:///'+theFilename; // otherwise, use absolute reference
		theFilename=theFilename.replace(/\\/g,&quot;/&quot;); // fixup: change \ to /
		form.useLocal.checked = true;
		form.local.value = theFilename;
		form.useData.checked = !form.useData.disabled;
		list.selectedIndex=1;
		for (var i=0; i&lt;list.options.length; i++) // find matching MIME type
			if (list.options[i].value.indexOf(theExtension)!=-1) { list.selectedIndex = i; break; }
		if (!form.tiddlertitle.disabled)
			form.tiddlertitle.value=theFilename.substr(theFilename.lastIndexOf('/')+1); // get tiddlername from filename
	},
//}}}
//{{{
	onClickAttach:
	function (here) {
		clearMessage();
		// get input values
		var form=here.form;
		var src=form.source; if (config.browser.isGecko) src=document.getElementById(&quot;attachFixSource&quot;);
		src=src.value!=src.defaultValue?src.value:&quot;&quot;;
		var when=(new Date()).formatString(config.macros.timeline.dateFormat);
		var title=form.tiddlertitle.value;
		var local = form.local.value!=form.local.defaultValue?form.local.value:&quot;&quot;;
		var url = form.URL.value!=form.URL.defaultValue?form.URL.value:&quot;&quot;;
		var notes = form.notes.value;
		var tags = &quot;attachment excludeMissing &quot;+form.tags.value;
		var useData=form.useData.checked;
		var useLocal=form.useLocal.checked;
		var useURL=form.useURL.checked;
		var mimetype = form.MIMEType.value.length?form.MIMEType.options[form.MIMEType.selectedIndex].text:&quot;&quot;;
		// validate checkboxes and get filename
		if (useData) {
			if (src.length) { if (!theLocation) var theLocation=src; }
			else { alert(this.sourceErr); src.focus(); return false; }
		}
		if (useLocal) {
			if (local.length) { if (!theLocation) var theLocation = local; }
			else { alert(this.localErr); form.local.focus(); return false; }
		}
		if (useURL) {
			if (url.length) { if (!theLocation) var theLocation = url; }
			else { alert(this.URLErr); form.URL.focus(); return false; }
		}
		if (!(useData||useLocal||useURL))
			{ form.useData.focus(); alert(this.storageErr); return false; }
		if (!theLocation)
			{ src.focus(); alert(this.sourceErr); return false; }
		if (!title || !title.trim().length || title==this.titlePrompt)
			{ form.tiddlertitle.focus(); alert(this.tiddlerErr); return false; }
		// if not already selected, determine MIME type based on filename extension (if any)
		if (useData &amp;&amp; !mimetype.length &amp;&amp; theLocation.lastIndexOf('.')!=-1) {
			var theExt = theLocation.substr(theLocation.lastIndexOf('.')).toLowerCase();
			var theList=form.MIMEType;
			for (var i=0; i&lt;theList.options.length; i++)
				if (theList.options[i].value.indexOf(theExt)!=-1)
					{ var mimetype=theList.options[i].text; theList.selectedIndex=i; break; }
		}
		// attach the file
		return this.createAttachmentTiddler(src, when, notes, tags, title,
			useData, useLocal, useURL, local, url, mimetype);
	},
	getMIMEType:
	function(src,def) {
		var ext = src.substr(src.lastIndexOf('.')).toLowerCase();
		var list=store.getTiddlerText(this.typeList);
		if (!list || !list.trim().length) return def;
		// get MIME list content from tiddler
		var parts=list.split(&quot;\n----\n&quot;);
		for (var p=0; p&lt;parts.length; p++) {
			var lines=parts[p].split(&quot;\n&quot;);
			var mime=lines.shift(); // 1st line=MIME type
			var match=lines.shift(); // 2nd line=matching extensions
			if (match.indexOf(ext)!=-1) return mime;
		}
		return def;
	},
	createAttachmentTiddler:
	function (src, when, notes, tags, title, useData, useLocal, useURL, local, url, mimetype, noshow) {
		if (useData) { // encode the data
			if (!mimetype.length) {
				alert(this.MIMEErr);
				form.MIMEType.selectedIndex=1; form.MIMEType.focus();
				return false;
			}
			var d = this.readFile(src); if (!d) { return false; }
			displayMessage('encoding '+src);
			var encoded = this.encodeBase64(d);
			displayMessage('file size='+d.length+' bytes, encoded size='+encoded.length+' bytes');
		}
		var usage=(mimetype.substr(0,5)==&quot;image&quot;?'[img[%0]]':'[[%0|%0]]').format([title]);
		var theText=this.tiddlerFormat.format([
			usage, notes.length?notes:'//none//', mimetype,
			useLocal?local.replace(/\\/g,'/'):'', useURL?url:'',
			useData?('data:'+mimetype+';base64,'+encoded):'' ]);
		store.saveTiddler(title,title,theText,config.options.txtUserName,new Date(),tags);
		var panel=document.getElementById(&quot;attachPanel&quot;); if (panel) panel.style.display=&quot;none&quot;;
		if (!noshow) { story.displayTiddler(null,title); story.refreshTiddler(title,null,true); }
		displayMessage('attached &quot;'+title+'&quot;');
		return true;
	},
//}}}
// // base64 conversion
//{{{
	encodeBase64:
	function (d) {
		if (!d) return null;
		// encode as base64
		var keyStr = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;;
		var out=&quot;&quot;;
		var chr1,chr2,chr3=&quot;&quot;;
		var enc1,enc2,enc3,enc4=&quot;&quot;;
		for (var count=0,i=0; i&lt;d.length; ) {
			chr1=d.charCodeAt(i++);
			chr2=d.charCodeAt(i++);
			chr3=d.charCodeAt(i++);
			enc1=chr1 &gt;&gt; 2;
			enc2=((chr1 &amp; 3) &lt;&lt; 4) | (chr2 &gt;&gt; 4);
			enc3=((chr2 &amp; 15) &lt;&lt; 2) | (chr3 &gt;&gt; 6);
			enc4=chr3 &amp; 63;
			if (isNaN(chr2)) enc3=enc4=64;
			else if (isNaN(chr3)) enc4=64;
			out+=keyStr.charAt(enc1)+keyStr.charAt(enc2)+keyStr.charAt(enc3)+keyStr.charAt(enc4);
			chr1=chr2=chr3=enc1=enc2=enc3=enc4=&quot;&quot;;
		}
		return out;
	},
	decodeBase64: function(input) {
		var out=&quot;&quot;;
		var chr1,chr2,chr3;
		var enc1,enc2,enc3,enc4;
		var i = 0;
		// remove all characters that are not A-Z, a-z, 0-9, +, /, or =
		input=input.replace(/[^A-Za-z0-9\+\/\=]/g, &quot;&quot;);
		do {
			enc1=keyStr.indexOf(input.charAt(i++));
			enc2=keyStr.indexOf(input.charAt(i++));
			enc3=keyStr.indexOf(input.charAt(i++));
			enc4=keyStr.indexOf(input.charAt(i++));
			chr1=(enc1 &lt;&lt; 2) | (enc2 &gt;&gt; 4);
			chr2=((enc2 &amp; 15) &lt;&lt; 4) | (enc3 &gt;&gt; 2);
			chr3=((enc3 &amp; 3) &lt;&lt; 6) | enc4;
			out=out+String.fromCharCode(chr1);
			if (enc3!=64) out=out+String.fromCharCode(chr2);
			if (enc4!=64) out=out+String.fromCharCode(chr3);
		} while (i&lt;input.length);
		return out;
	},
//}}}
// // I/O functions
//{{{
	readFile: // read local BINARY file data
	function(filePath) {
		if(!window.Components) { return null; }
		try { netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalXPConnect&quot;); }
		catch(e) { alert(&quot;access denied: &quot;+filePath); return null; }
		var file = Components.classes[&quot;@mozilla.org/file/local;1&quot;].createInstance(Components.interfaces.nsILocalFile);
		try { file.initWithPath(filePath); } catch(e) { alert(&quot;cannot read file - invalid path: &quot;+filePath); return null; }
		if (!file.exists()) { alert(&quot;cannot read file - not found: &quot;+filePath); return null; }
		var inputStream = Components.classes[&quot;@mozilla.org/network/file-input-stream;1&quot;].createInstance(Components.interfaces.nsIFileInputStream);
		inputStream.init(file, 0x01, 00004, null);
		var bInputStream = Components.classes[&quot;@mozilla.org/binaryinputstream;1&quot;].createInstance(Components.interfaces.nsIBinaryInputStream);
		bInputStream.setInputStream(inputStream);
		return(bInputStream.readBytes(inputStream.available()));
	},
//}}}
//{{{
	writeFile:
	function(filepath,data) {
		// TBD: decode base64 and write BINARY data to specified local path/filename
		return(false);
	},
//}}}
//{{{
	askForFilename: // for FF3 fixup
	function(target) {
		var msg=config.messages.selectFile;
		if (target &amp;&amp; target.title) msg=target.title; // use target field tooltip (if any) as dialog prompt text
		// get local path for current document
		var path=getLocalPath(document.location.href);
		var p=path.lastIndexOf(&quot;/&quot;); if (p==-1) p=path.lastIndexOf(&quot;\\&quot;); // Unix or Windows
		if (p!=-1) path=path.substr(0,p+1); // remove filename, leave trailing slash
		var file=&quot;&quot;
		var result=window.mozAskForFilename(msg,path,file,true); // FF3 FIXUP ONLY
		if (target &amp;&amp; result.length) // set target field and trigger handling
			{ target.value=result; target.onchange(); }
		return result; 
	}
};
//}}}
//{{{
if (window.mozAskForFilename===undefined) { // also defined by CoreTweaks (for ticket #604)
	window.mozAskForFilename=function(msg,path,file,mustExist) {
		if(!window.Components) return false;
		try {
			netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect');
			var nsIFilePicker = window.Components.interfaces.nsIFilePicker;
			var picker = Components.classes['@mozilla.org/filepicker;1'].createInstance(nsIFilePicker);
			picker.init(window, msg, mustExist?nsIFilePicker.modeOpen:nsIFilePicker.modeSave);
			var thispath = Components.classes['@mozilla.org/file/local;1'].createInstance(Components.interfaces.nsILocalFile);
			thispath.initWithPath(path);
			picker.displayDirectory=thispath;
			picker.defaultExtension='';
			picker.defaultString=file;
			picker.appendFilters(nsIFilePicker.filterAll|nsIFilePicker.filterText|nsIFilePicker.filterHTML);
			if (picker.show()!=nsIFilePicker.returnCancel)
				var result=picker.file.path;
		}
		catch(ex) { displayMessage(ex.toString()); }
		return result;
	}
}
//}}}</pre>
</div>
<div title="AttachFilePluginFormatters" modifier="ELSDesignStudios" created="200605150128" modified="200910101044" tags="AttachFilePackage IconPackage ThemePackage systemConfig" server.type="file" server.host="http://www.tiddlytools.com" server.page.revision="200910101044">
<pre>/***
|Name|AttachFilePluginFormatters|
|Source|http://www.TiddlyTools.com/#AttachFilePluginFormatters|
|Version|4.0.1|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1.3|
|Type|plugin|
|Description|run-time library for displaying attachment tiddlers|
Runtime processing for //rendering// attachment tiddlers created by [[AttachFilePlugin]].   Attachment tiddlers are tagged with&lt;&lt;tag attachment&gt;&gt;and contain binary file content (e.g., jpg, gif, pdf, mp3, etc.) that has been stored directly as base64 text-encoded data or can be loaded from external files stored on a local filesystem or remote web server.  Note: after creating new attachment tiddlers, you can remove [[AttachFilePlugin]], as long as you retain //this// tiddler (so that images can be rendered later on).
!!!!!Formatters
&lt;&lt;&lt;
This plugin extends the behavior of the following TiddlyWiki core &quot;wikify()&quot; formatters:
* embedded images: {{{[img[tooltip|image]]}}}
* linked embedded images: {{{[img[tooltip|image][link]]}}}
* external/&quot;pretty&quot; links: {{{[[label|link]]}}}
''Please refer to AttachFilePlugin (source: http://www.TiddlyTools.com/#AttachFilePlugin) for additional information.''
&lt;&lt;&lt;
!!!!!Revisions
&lt;&lt;&lt;
2009.10.10 [4.0.1] in fileExists(), check for IE to avoid hanging Chrome during startup
2009.06.04 [4.0.0] changed attachment storage format to use //sections// instead of embedded substring markers.
2008.01.08 [*.*.*] plugin size reduction: documentation moved to ...Info
2007.12.04 [*.*.*] update for TW2.3.0: replaced deprecated core functions, regexps, and macros
2007.10.29 [3.7.0] more code reduction: removed upload handling from AttachFilePlugin (saves ~7K!)
2007.10.28 [3.6.0] removed duplicate formatter code from AttachFilePlugin (saves ~10K!) and updated documentation accordingly.  This plugin ([[AttachFilePluginFormatters]]) is now //''required''// in order to display attached images/binary files within tiddler content.
2006.05.20 [3.4.0] through 2007.03.01 [3.5.3] sync with AttachFilePlugin
2006.05.13 [3.2.0] created from AttachFilePlugin v3.2.0
&lt;&lt;&lt;
!!!!!Code
***/
// // version
//{{{
version.extensions.AttachFilePluginFormatters= {major: 4, minor: 0, revision: 1, date: new Date(2009,10,10)};
//}}}

//{{{
if (config.macros.attach==undefined) config.macros.attach= { };
//}}}
//{{{
if (config.macros.attach.isAttachment==undefined) config.macros.attach.isAttachment=function (title) {
	var tiddler = store.getTiddler(title);
	if (tiddler==undefined || tiddler.tags==undefined) return false;
	return (tiddler.tags.indexOf(&quot;attachment&quot;)!=-1);
}
//}}}

//{{{
// test for local file existence - returns true/false without visible error display
if (config.macros.attach.fileExists==undefined) config.macros.attach.fileExists=function(f) {
	if(window.Components) { // MOZ
		try { netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalXPConnect&quot;); }
		catch(e) { return false; } // security access denied
		var file = Components.classes[&quot;@mozilla.org/file/local;1&quot;].createInstance(Components.interfaces.nsILocalFile);
		try { file.initWithPath(f); }
		catch(e) { return false; } // invalid directory
		return file.exists();
	}
	else if (config.browser.isIE) { // IE
		var fso = new ActiveXObject(&quot;Scripting.FileSystemObject&quot;);
		return fso.FileExists(f);
	}
	else return true; // other browsers: assume file exists
}
//}}}

//{{{
if (config.macros.attach.getAttachment==undefined) config.macros.attach.getAttachment=function(title) {

	// extract embedded data, local and remote links (if any)
	var text=store.getTiddlerText(title,'');
	var embedded=store.getTiddlerText(title+'##data','').trim();
	var locallink=store.getTiddlerText(title+'##file','').trim();
	var remotelink=store.getTiddlerText(title+'##url','').trim();

	// backward-compatibility for older attachments (pre 4.0.0)
	var startmarker=&quot;---BEGIN_DATA---\n&quot;;
	var endmarker=&quot;\n---END_DATA---&quot;;
	var pos=0; var endpos=0;
	if ((pos=text.indexOf(startmarker))!=-1 &amp;&amp; (endpos=text.indexOf(endmarker))!=-1)
		embedded=&quot;data:&quot;+(text.substring(pos+startmarker.length,endpos)).replace(/\n/g,'');
	if ((pos=text.indexOf(&quot;/%LOCAL_LINK%/&quot;))!=-1)
		locallink=text.substring(text.indexOf(&quot;|&quot;,pos)+1,text.indexOf(&quot;]]&quot;,pos));
	if ((pos=text.indexOf(&quot;/%REMOTE_LINK%/&quot;))!=-1)
		remotelink=text.substring(text.indexOf(&quot;|&quot;,pos)+1,text.indexOf(&quot;]]&quot;,pos));

	// if there is a data: URI defined (not supported by IE)
	if (embedded.length &amp;&amp; !config.browser.isIE) return embedded;

	// document is being served remotely... use remote URL (if any)  (avoids security alert)
	if (remotelink.length &amp;&amp; document.location.protocol!=&quot;file:&quot;)
		return remotelink;  

	// local link only... return link without checking file existence (avoids security alert)
	if (locallink.length &amp;&amp; !remotelink.length) 
		return locallink; 

	// local link, check for file exist... use local link if found
	if (locallink.length) { 
		locallink=locallink.replace(/^\.[\/\\]/,''); // strip leading './' or '.\' (if any)
		if (this.fileExists(getLocalPath(locallink))) return locallink;
		// maybe local link is relative... add path from current document and try again
		var pathPrefix=document.location.href;  // get current document path and trim off filename
		var slashpos=pathPrefix.lastIndexOf(&quot;/&quot;); if (slashpos==-1) slashpos=pathPrefix.lastIndexOf(&quot;\\&quot;); 
		if (slashpos!=-1 &amp;&amp; slashpos!=pathPrefix.length-1) pathPrefix=pathPrefix.substr(0,slashpos+1);
		if (this.fileExists(getLocalPath(pathPrefix+locallink))) return locallink;
	}

	// no embedded data, no local (or not found), fallback to remote URL (if any)
	if (remotelink.length) return remotelink;

	// attachment URL doesn't resolve, just return input as is
	return title;
}
//}}}
//{{{
if (config.macros.attach.init_formatters==undefined) config.macros.attach.init_formatters=function() {
	if (this.initialized) return;

	// find the formatter for &quot;image&quot; and replace the handler
	for (var i=0; i&lt;config.formatters.length &amp;&amp; config.formatters[i].name!=&quot;image&quot;; i++);
	if (i&lt;config.formatters.length)	config.formatters[i].handler=function(w) {
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source)
		if(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart) // Simple bracketted link
			{
			var e = w.output;
			if(lookaheadMatch[5])
				{
				var link = lookaheadMatch[5];
				// ELS -------------
				var external=config.formatterHelpers.isExternalLink(link);
				if (external)
					{
					if (config.macros.attach.isAttachment(link))
						{
						e = createExternalLink(w.output,link);
						e.href=config.macros.attach.getAttachment(link);
						e.title = config.macros.attach.linkTooltip + link;
						}
					else
						e = createExternalLink(w.output,link);
					}
				else 
					e = createTiddlyLink(w.output,link,false,null,w.isStatic);
				// ELS -------------
				addClass(e,&quot;imageLink&quot;);
				}
			var img = createTiddlyElement(e,&quot;img&quot;);
			if(lookaheadMatch[1])
				img.align = &quot;left&quot;;
			else if(lookaheadMatch[2])
				img.align = &quot;right&quot;;
			if(lookaheadMatch[3])
				img.title = lookaheadMatch[3];
			img.src = lookaheadMatch[4];
			// ELS -------------
			if (config.macros.attach.isAttachment(lookaheadMatch[4]))
				img.src=config.macros.attach.getAttachment(lookaheadMatch[4]);
			// ELS -------------
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
//}}}
//{{{
	// find the formatter for &quot;prettyLink&quot; and replace the handler
	for (var i=0; i&lt;config.formatters.length &amp;&amp; config.formatters[i].name!=&quot;prettyLink&quot;; i++);
	if (i&lt;config.formatters.length)	{
		config.formatters[i].handler=function(w) {
			this.lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			if(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart) {
				var e;
				var text = lookaheadMatch[1];
				if(lookaheadMatch[3]) {
					// Pretty bracketted link
					var link = lookaheadMatch[3];
					if (config.macros.attach.isAttachment(link)) {
						e = createExternalLink(w.output,link);
						e.href=config.macros.attach.getAttachment(link);
						e.title=config.macros.attach.linkTooltip+link;
					}
					else e = (!lookaheadMatch[2] &amp;&amp; config.formatterHelpers.isExternalLink(link))
						? createExternalLink(w.output,link)
						: createTiddlyLink(w.output,link,false,null,w.isStatic);
				} else {
					e = createTiddlyLink(w.output,text,false,null,w.isStatic);
				}
				createTiddlyText(e,text);
				w.nextMatch = this.lookaheadRegExp.lastIndex;
			}
		}
	} // if &quot;prettyLink&quot; formatter found
	this.initialized=true;
}
//}}}
//{{{
config.macros.attach.init_formatters(); // load time init
//}}}
//{{{
if (TiddlyWiki.prototype.coreGetRecursiveTiddlerText==undefined) {
	TiddlyWiki.prototype.coreGetRecursiveTiddlerText = TiddlyWiki.prototype.getRecursiveTiddlerText;
	TiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,depth) {
		return config.macros.attach.isAttachment(title)?
			config.macros.attach.getAttachment(title):this.coreGetRecursiveTiddlerText.apply(this,arguments);
	}
}
//}}}</pre>
</div>
<div title="SortableGridPlugin" creator="Harrison" modifier="Harrison" created="201109281720" modified="201109281721" tags="systemConfig" changecount="2">
<pre>/***
|''Name:''|SortableGridPlugin|
|''Description:''|Provide live sorting of tables by column|
|''Date:''|Sep. 29, 2007|
|''Source:''|[[SortableGridPlugin|http://rumkin.com/tools/tiddlywiki/#SortableGridPlugin]]|
|''Author:''|Stuart Langridge, Demian Johnson, Bob Denny|
|''License:''|See Below|
|''Version:''|1.1.3|
|''~CoreVersion:''|2.0.11, 2.1.x and newer|
|''Browser:''|Firefox 1.5/2.0; Internet Explorer 6.0/7.0; Safari|
!!Description
@@Only minor changes by Tyler to make it work with TiddlyWiki 2.2.x and newer@@

This plugin provides live sorting of tables by clicking on a column header. To sort in reverse, click the same column header a second time. An arrow in the sort column shows the direction of sorting. 

It works by trying to automatically detect the type of data in a column, then sorting by the rules for that data type. Note that the data in the first row (before sorting for the first time) is used for type detection, so if other data types exist in the column below the first row, the results will be unpredictable. If it //can// recognize the string as prticular type it //will// sort that column by that type. Moral: keep all of your data in a column the same type. The following data types are checked in the order shown (in other words the table shows the precedence of type detection):

|!Type |!Description|
|Date|Various formats for dates, specifically any string format that can be converted to a date/time by Javascript's Date.Parse() method.|
|Currency|Any string beginning with $, £, or € followed by a numeric string (except no leading sign). Note that it does not do currency conversion, the raw currency values are sorted numerically. {{{/^[$|£|€]{1}\d*\.{0,1}\d+$/}}}|
|Numeric|Data must consist purely of digits, optional leading plus or minus sign, a single period. Javascript cannot handle the Continental virgule (comma decimal point). {{{/^[\+|\-]{0,1}\d*\.{0,1}\d+$/}}}|
|File Size|Numeric string (except no leading sign) with b, Kb, Mb, or Gb at the end. Sorts according to the actual value represented by the notation. {{{/^\d*\.{0,1}\d+[K|M|G]{0,1}b$}}}|
|Text|Anything that does not match the formats listed below. Text is sorted without regard to character case.|
!!Installation
Follow the usual procedure for installing a plugin: Edit this tiddler, copy, paste into a new tiddler in your TW, and tag it systemConfig. Close, Save, and Shift-Reload  your TW's page. The table below (in Example) should have hot column headers and be sortable.
!!Usage
To make a table sortable, append an {{{h}}} to the end of the first row. If the table is thus marked as sortable, the formatter will add a CSS class {{{sortable}}} to the generated {{{&lt;table&gt;}}} element. Thus you can use CSS to alter the appearance of the sortable table and/or its elements.
!!Example
|Name |Salary |Extension |Performance |File Size |Start date |h
|Bloggs, Fred |$12000.00 |1353 |+1.2 |74.2Kb |Aug 19, 2003 21:34:00 |
|Bloggs, Fred |$12000.00 |1353 |1.2 |3350b |09/18/2003 |
|Bloggs, Fred |$12000 |1353 |1.200 |55.2Kb |August 18, 2003 |
|Bloggs, Fred |$12000.00 |1353 |1.2 |2100b |07/18/2003 |
|Bloggs, Fred |$12000.00 |1353 |01.20 |6.156Mb |08/17/2003 05:43 |
|Turvey, Kevin |$191200.00 |2342 |-33 |1b |02/05/1979 |
|Mbogo, Arnold |$32010.12 |2755 |-21.673 |1.2Gb |09/08/1998 |
|Shakespeare, Bill |£122000.00|3211 |6 |33.22Gb |12/11/1961 |
|Shakespeare, Hamlet |£9000 |9005 |-8 |3Gb |01/01/2002 |
|Fitz, Marvin |€3300.30 |5554 |+5 |4Kb |05/22/1995 |
!!Revision History
&lt;&lt;&lt;
''2003.11.?? [?.?.?]'' Stuart Langridge (http://www.kryogenix.org/code/browser/sorttable/) - Core code for DHTML sortable tables. Copyright and license for his code has been carried forward and applies to subsequent additions.
''2006.02.14 [1.0.0]'' Demian Johnson - Initial release, adaptation of Langridge code to TiddlyWiki.
''2006.09.29 [1.1.0]'' Bob Denny - Add standard-format plugin documentation, reformat and tabify code for readability, refactor references to plugin, add new &quot;file size&quot; detection and sorting, add sterling and euro to currency detection, allow any real numbers including optional sign and either period or comma for decimal point for numeric sorting, make RegExp matching strict for currency and numeric, clean up lint warnings, correct spelling of Hamlet's name.
''2006.10.19 [1.1.1]'' Bob Denny - Allow use with TW 2.1.1 and 2.1.2, hijack is identical with 2.1.0.
''2006.11.04 [1.1.2]'' Bob Denny - Oh hell, accept 2.1.x, bit again by 2.1.3 which was OK.
&lt;&lt;&lt;
!!Code
***/
//{{{
//
// Begin SORTABLE.JS
// This Code is:
// Code downloaded from the Browser Experiments section of kryogenix.org is 
// licenced under the so-called MIT licence. The license is below.
// ----------------------------------------
// Copyright (c) 1997-date Stuart Langridge
// ----------------------------------------
// Permission is hereby granted, free of charge, to any person obtaining a copy of this 
// software and associated documentation files (the &quot;Software&quot;), to deal in the Software 
// without restriction, including without limitation the rights to use, copy, modify, merge, 
// publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons 
// to whom the Software is furnished to do so, subject to the following conditions:
//
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
// INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR 
// PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE 
// FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR 
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER 
// DEALINGS IN THE SOFTWARE.
//
// Modified under the same aforementioned terms by Demian Johnston, 2006
// Further modified under the same aforementioned terms by Bob Denny, 2006: 
//	1. Add flexible date/time 
//	2. Use 'this' instead of full dotted names 
//	3. Re-indent and tabify after being munged by TW/IE bu
//	4. Add &quot;file size&quot; sensing and sorting. Validate with Javascript Lint
// Modified under the same aforementioned terms by Tyler Akins, 2007
//	Works work with TiddlyWiki 2.2.x
//
version.extensions.PersistentForm = {
	major: 1, minor: 1, revision: 3,
	date: new Date(2007, 9, 29), 
	type: 'extension',
	source: &quot;http://rumkin.com/tools/tiddlywiki/#SortableGridPlugin&quot;
};
//}}}

//{{{
config.macros.sortableGridPlugin = { SORT_COLUMN_INDEX: 0 };

config.macros.sortableGridPlugin.ts_makeSortable = function(table) 
{
	var firstRow;
	if (table.rows &amp;&amp; table.rows.length &gt; 0) {
		firstRow = table.rows[0];
	}
	if (!firstRow) return;
    
	// We have a first row: assume it's the header, and make its contents clickable links
	for (var i=0;i&lt;firstRow.cells.length;i++) {
		var cell = firstRow.cells[i];
		var txt = config.macros.sortableGridPlugin.ts_getInnerText(cell);
		cell.innerHTML = '&lt;a href=&quot;#&quot; class=&quot;sortheader&quot; onclick=&quot;config.macros.sortableGridPlugin.ts_resortTable(this);return false;&quot;&gt;' +
						txt + '&lt;span class=&quot;sortarrow&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/a&gt;';
	}
};
//}}}

//{{{
config.macros.sortableGridPlugin.ts_getInnerText = function(el) 
{
	if (typeof el == &quot;string&quot;) return el;
	if (typeof el == &quot;undefined&quot;) { return el; }
	if (el.innerText) return el.innerText; //Not needed but it is faster
	var str = &quot;&quot;;
	var cs = el.childNodes;
	var l = cs.length;
	for (var i = 0; i &lt; l; i++) {
		switch (cs[i].nodeType) 
		{
			case 1: 										//ELEMENT_NODE
				str += config.macros.sortableGridPlugin.ts_getInnerText(cs[i]);
				break;
			case 3: 										//TEXT_NODE
				str += cs[i].nodeValue;
				break;
		}
	}
	return str;
};

config.macros.sortableGridPlugin.getParent = function(el, pTagName) 
{
	if (el === null) 
		return null;
	else if (el.nodeType == 1 &amp;&amp; el.tagName.toLowerCase() == pTagName.toLowerCase()) // Gecko bug, supposed to be uppercase
		return el;
	else
		return config.macros.sortableGridPlugin.getParent(el.parentNode, pTagName);
};
//}}}

//{{{
config.macros.sortableGridPlugin.ts_resortTable = function(lnk) 
{
	var M = config.macros.sortableGridPlugin;
	// get the span
	var span;
	for (var ci = 0; ci &lt; lnk.childNodes.length; ci++) {
	if (lnk.childNodes[ci].tagName &amp;&amp; lnk.childNodes[ci].tagName.toLowerCase() == 'span') 
		span = lnk.childNodes[ci];
	}
	var td = lnk.parentNode;
	var column = td.cellIndex;
	var table = M.getParent(td,'TABLE');
    
	// Work out a type for the column
	if (table.rows.length &lt;= 1) return;
	var itm = M.ts_getInnerText(table.rows[1].cells[column]);
	var sortfn = M.ts_sort_caseinsensitive;
	if(!isNaN(Date.parse(itm)))
		sortfn = M.ts_sort_date;
	else if(itm.match(/^[$|£|€]{1}\d*\.{0,1}\d+$/)) 
		sortfn = M.ts_sort_currency;
	else if(itm.match(/^[\+|\-]{0,1}\d*\.{0,1}\d+$/)) 
		sortfn = M.ts_sort_numeric;
	else if(itm.match(/^\d*\.{0,1}\d+[K|M|G]{0,1}b$/))
		sortfn = M.ts_sort_fileSize;
	M.SORT_COLUMN_INDEX = column;
	var firstRow = new Array();
	var newRows = new Array();
	for (var i = 0; i &lt; table.rows[0].length; i++) { firstRow[i] = table.rows[0][i]; }
	for (var j = 1; j &lt; table.rows.length; j++) { newRows[j-1] = table.rows[j]; }
    
	newRows.sort(sortfn);
	var ARROW;
	if (span.getAttribute(&quot;sortdir&quot;) == 'down') {
		ARROW = '&amp;nbsp;&amp;nbsp;&amp;uarr;';
		newRows.reverse();
		span.setAttribute('sortdir','up');
	} else {
		ARROW = '&amp;nbsp;&amp;nbsp;&amp;darr;';
		span.setAttribute('sortdir','down');
	}
    
	// We appendChild rows that already exist to the tbody, so it moves them 
	// rather than creating new ones. Don't do sortbottom rows
	for ( i=0;i&lt;newRows.length;i++) { 
		if (!newRows[i].className || (newRows[i].className &amp;&amp; (newRows[i].className.indexOf('sortbottom') == -1))) 
			table.tBodies[0].appendChild(newRows[i]);
	}
	// do sortbottom rows only
	for ( i=0;i&lt;newRows.length;i++) { 
		if (newRows[i].className &amp;&amp; (newRows[i].className.indexOf('sortbottom') != -1)) 
			table.tBodies[0].appendChild(newRows[i]);
	}
    
	// Delete any other arrows there may be showing
	var allspans = document.getElementsByTagName(&quot;span&quot;);
	for ( ci=0;ci&lt;allspans.length;ci++) {
		if (allspans[ci].className == 'sortarrow') {
			if (M.getParent(allspans[ci],&quot;table&quot;) == M.getParent(lnk,&quot;table&quot;)) { // in the same table as us?
				allspans[ci].innerHTML = '&amp;nbsp;&amp;nbsp;&amp;nbsp;';
			}
		}
	}
    
	span.innerHTML = ARROW;
};
//}}}

//{{{
config.macros.sortableGridPlugin.ts_sort_fileSize = function(a, b) 
{
	var M = config.macros.sortableGridPlugin;
	var convert = function(str)
	{
		var val;
		var i;
		if((i = str.indexOf(&quot;Kb&quot;)) != -1)
			val = 1024.0 * str.substr(0, i);
		else if((i = str.indexOf(&quot;Mb&quot;)) != -1)
			val = 1048576.0 * str.substr(0, i);
		else if((i = str.indexOf(&quot;Gb&quot;)) != -1)
			val = 1073741824.0 * str.substr(0, i);
		else
			val = 1.0 * str.substr(0, str.length - 1);
		return val;
	};
    
	var aa = M.ts_getInnerText(a.cells[M.SORT_COLUMN_INDEX]);
	var bb = M.ts_getInnerText(b.cells[M.SORT_COLUMN_INDEX]);
	var v1 = convert(aa);
	var v2 = convert(bb);
	if(v1 == v2) return 0;
	if(v1 &lt; v2) return -1;
	return 1;
};

config.macros.sortableGridPlugin.ts_sort_date = function(a, b) 
{
	var M = config.macros.sortableGridPlugin;
	// Handles dates per the rules of Date.parse()
	var aa = M.ts_getInnerText(a.cells[M.SORT_COLUMN_INDEX]);
	var bb = M.ts_getInnerText(b.cells[M.SORT_COLUMN_INDEX]);
	var dt1 = Date.parse(aa);
	var dt2 = Date.parse(bb);
	if (dt1 == dt2) return 0;
	if (dt1 &lt; dt2) return -1;
	return 1;
};

config.macros.sortableGridPlugin.ts_sort_currency = function(a, b) 
{ 
	var M = config.macros.sortableGridPlugin;
	var aa = M.ts_getInnerText(a.cells[M.SORT_COLUMN_INDEX]).replace(/[^0-9.]/g,'');
	var bb = M.ts_getInnerText(b.cells[M.SORT_COLUMN_INDEX]).replace(/[^0-9.]/g,'');
	return parseFloat(aa) - parseFloat(bb);
};

config.macros.sortableGridPlugin.ts_sort_numeric = function(a, b) 
{ 
	var M = config.macros.sortableGridPlugin;
	var aa = parseFloat(M.ts_getInnerText(a.cells[M.SORT_COLUMN_INDEX]));
	if (isNaN(aa)) aa = 0;
	var bb = parseFloat(M.ts_getInnerText(b.cells[M.SORT_COLUMN_INDEX])); 
	if (isNaN(bb)) bb = 0;
	return aa-bb;
};

config.macros.sortableGridPlugin.ts_sort_caseinsensitive = function(a, b) 
{
	var M = config.macros.sortableGridPlugin;
	var aa = M.ts_getInnerText(a.cells[M.SORT_COLUMN_INDEX]).toLowerCase();
	var bb = M.ts_getInnerText(b.cells[M.SORT_COLUMN_INDEX]).toLowerCase();
	if (aa == bb) return 0;
	if (aa &lt; bb) return -1;
	return 1;
};

//}}}

//{{{
// end Code downloaded from the Browser Experiments section of kryogenix.org
// end Copyright (c) 1997-date Stuart Langridge//
// END SORTABLE.JS//
//}}}

//{{{
//
//
// CORE HIJACK WARNINGS: 
//	(1) Depends on the table formatter being first in the config.formatters array
//	(2) Version-specifics - test on your version before adding to the logic here!
//
if(version.major == 2 &amp;&amp; version.minor === 0 &amp;&amp; version.revision == 11)
{
	config.formatters[0].handler = function(w)
	{
		var table = createTiddlyElement(w.output,&quot;table&quot;);
		w.nextMatch = w.matchStart;
		var lookaheadRegExp = new RegExp(this.lookahead,&quot;mg&quot;);
		var currRowType = null, nextRowType;
		var rowContainer, rowElement;
		var prevColumns = [];
		var rowCount = 0;
		var want_sortable=0;
		do {
			lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			var matched = lookaheadMatch &amp;&amp; lookaheadMatch.index == w.nextMatch;
			if(matched)
			{
				nextRowType = lookaheadMatch[2];
				if(nextRowType != currRowType)
				rowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);
				currRowType = nextRowType;
				if(currRowType == &quot;c&quot;)
				{
					if(rowCount === 0)
						rowContainer.setAttribute(&quot;align&quot;,&quot;top&quot;);
					else
						rowContainer.setAttribute(&quot;align&quot;,&quot;bottom&quot;);
					w.nextMatch = w.nextMatch + 1;
					w.subWikify(rowContainer,this.rowTerminator);
					table.insertBefore(rowContainer,table.firstChild);
				}
				else
				{
					var rowClass = (rowCount &amp; 1) ? &quot;oddRow&quot; : &quot;evenRow&quot;;
					rowElement = createTiddlyElement(rowContainer,&quot;tr&quot;,null,rowClass);
					this.rowHandler(w,rowElement,prevColumns);
				}
				if(currRowType == &quot;h&quot;) {
					want_sortable=1;
				}
				rowCount++;
			}
		} while(matched);
		if (want_sortable) {
			table.setAttribute(&quot;class&quot;,&quot;sortable&quot;);
			config.macros.sortableGridPlugin.ts_makeSortable(table);
		}
	};
} 
else if(version.major == 2 &amp;&amp; (version.minor &gt; 0))
{
	config.formatters[0].handler = function(w)
	{
		var table = createTiddlyElement(w.output,&quot;table&quot;);
		var prevColumns = [];
		var currRowType = null;
		var rowContainer;
		var rowCount = 0;
		var want_sortable = 0;
	    
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.nextMatch)
		{
			var nextRowType = lookaheadMatch[2];
			if(nextRowType == &quot;k&quot;)
			{
				table.className = lookaheadMatch[1];
				w.nextMatch += lookaheadMatch[0].length+1;
			}
			else
			{
				if(nextRowType != currRowType)
				{
					rowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);
					currRowType = nextRowType;
				}
				if(currRowType == &quot;c&quot;)
				{
					// Caption
					w.nextMatch++;
					if(rowContainer != table.firstChild)
						table.insertBefore(rowContainer,table.firstChild);
					rowContainer.setAttribute(&quot;align&quot;,rowCount === 0?&quot;top&quot;:&quot;bottom&quot;);
					w.subWikifyTerm(rowContainer,this.rowTermRegExp);
				}
				else
				{
					this.rowHandler(w,createTiddlyElement(rowContainer,&quot;tr&quot;,null,(rowCount&amp;1)?&quot;oddRow&quot;:&quot;evenRow&quot;),prevColumns);
					if(currRowType == &quot;h&quot;)	want_sortable = 1;
					rowCount++;
				}
			}
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
		if (want_sortable) {
			table.setAttribute(&quot;class&quot;,&quot;sortable&quot;);
			config.macros.sortableGridPlugin.ts_makeSortable(table);
		}
	};
}
else
	alert(&quot;SortableGridPlugin works only with TiddlyWiki 2.0.11, 2.1.x or newer&quot;);
    
//}}}</pre>
</div>
<div title="DefaultTiddlers" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201109041532" changecount="1">
<pre>[[SWN Sector Generator]]
[[Sector Map]]</pre>
</div>
<div title="FileDropPlugin" modifier="ELSDesignStudios" created="200611080217" modified="201003081928" tags="AttachFilePackage systemConfig" server.type="file" server.host="http://www.tiddlytools.com" server.page.revision="201003081928">
<pre>/***
|Name|FileDropPlugin|
|Source|http://www.TiddlyTools.com/#FileDropPlugin|
|Version|2.1.4|
|Author|BradleyMeck and Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|plugin|
|Description|drag-and-drop files/directories to create tiddlers|
''requires FireFox or another Mozilla-compatible browser.''
!!!!!Usage
&lt;&lt;&lt;
This plugin automatically creates tiddlers from files that are dropped onto an open TiddlyWiki document.  You can drop multiple selected files and/or folders to create many tiddlers at once.  New tiddler titles are created using the filename of each dropped file (i.e., omitting the path).  If a title is already in use, you are prompted to enter a new title for that file.  If you drop a folder, you will be asked if you want to create a simple 'directory list' of files in a single tiddler or create one tiddler for each file in that folder.  

By default, it is assumed that all dropped files contain text.  However, if [[AttachFilePlugin]], [[AttachFilePluginFormatters]] and [[AttachFileMIMETypes]] are installed, then you can drop ''//binary data files//'' as well as text files.  If the MIME type of a dropped file is not &quot;text/plain&quot;, then AttachFilePlugin is used to create an 'attachment' tiddler, rather than creating a simple text tiddler.

When creating text tiddlers, you can embed a //link// to the original external file at the top of the new tiddler, in addition to (or instead of) the text content itself.  The format for this link (see Configuration, below) uses embedded ''//replacement markers//'' that allow you to generate a variety of wiki-formatted output, where:
*%0 = filename (without path)
*%1 = local &quot;&quot;&quot;file://...&quot;&quot;&quot; URL
*%2 = local path and filename (OS-native format)
*%3 = relative path (if subdirectory of current document directory)
*%4 = file size
*%5 = file date
*%6 = current date
*%7 = current ~TiddlyWiki username
*\n = newline
By default, the link format uses the filename (%0) and local URL (%1), enclosed within a //hidden section// syntax, like this:
{{{
/%
!link
[[%0|%1]]
!end
%/
}}}
This permits the link to be embedded along with the text content, without changing the appearance of that content when the tiddler is viewed.  To display the link in your tiddler content, use:
{{{
&lt;&lt;tiddler TiddlerName##link&gt;&gt;
}}}
&lt;&lt;&lt;
!!!!!Configuration
&lt;&lt;&lt;
__FileDropPlugin options:__
&lt;&lt;option chkFileDropContent&gt;&gt;Copy file content into tiddlers if smaller than: &lt;&lt;option txtFileDropDataLimit&gt;&gt; bytes
&amp;nbsp; //(note: excess text content will be truncated, oversized binary files will skipped, 0=no limit)//
&lt;&lt;option chkFileDropLink&gt;&gt;Generate external links to files, using this format:{{editor{&lt;html&gt;&lt;nowiki&gt;&lt;textarea rows=&quot;4&quot; onchange=&quot;
config.macros.option.propagateOption('txtFileDropLinkFormat','value',this.value.escapeLineBreaks(),'input');
&quot;&gt;&lt;/textarea&gt;&lt;/html&gt;&lt;&lt;tiddler {{
	var ta=place.lastChild.getElementsByTagName('textarea')[0];
	var v=config.options.txtFileDropLinkFormat.unescapeLineBreaks();
	ta.value=v;
&quot;&quot;;}}&gt;&gt;}}}&lt;&lt;option chkFileDropTrimFilename&gt;&gt;Omit file extensions from tiddler titles
&lt;&lt;option chkFileDropDisplay&gt;&gt;Automatically display newly created tiddlers
Tag newly created tiddlers with: &lt;&lt;option txtFileDropTags&gt;&gt;

__FileDropPlugin+AttachFilePlugin options:__ //(binary file data as encoded 'base64' text)//
&lt;&lt;option chkFileDropAttachLocalLink&gt;&gt; attachment includes reference to local path/filename
&gt;Note: if the plugin does not seem to work, enter ''about:config'' in the Firefox address bar, and make sure that {{{signed.applets.codebase_principal_support}}} is set to ''true''
&lt;&lt;&lt;
!!!!!Examples (custom handler functions)
&lt;&lt;&lt;
Adds a single file with confirmation and prompting for title:
{{{
config.macros.fileDrop.addEventListener('application/x-moz-file',
	function(nsiFile) {
		var msg='You have dropped the file:\n'
			+nsiFile.path+'\n'
			+'onto the page, it will be imported as a tiddler. Is that ok?'
		if(confirm(msg)) {
			var newDate = new Date();
			var title = prompt('what would you like to name the tiddler?');
			store.saveTiddler(title,title,loadFile(nsiFile.path),config.options.txtUserName,newDate,[]);
		}
		return true;
	});
}}}
Adds a single file without confirmation, using path/filename as tiddler title:
{{{
config.macros.fileDrop.addEventListener('application/x-moz-file',
	function(nsiFile) {
		var newDate = new Date();
		store.saveTiddler(nsiFile.path,nsiFile.path,loadFile(nsiFile.path),config.options.txtUserName,newDate,[]);
		story.displayTiddler(null,nsiFile.path)
		return true;
	});
}}}
&lt;&lt;&lt;
!!!!!Revisions
&lt;&lt;&lt;
2010.03.06 2.1.4 added event listener for 'dragover' (for FireFox 3.6+)
2009.10.10 2.1.3 fixed IE code error
2009.10.08 2.1.2 fixed chkFileDropContent bypass handling for binary attachments
2009.10.07 2.1.0 added chkFileDropContent and chkFileDropLink/txtFileDropLinkFormat
2009.08.19 2.0.0 fixed event listener registration for FireFox 3.5+.  Also, merged with FileDropPluginConfig, with code cleanup/reduction
2008.08.11 1.5.1 added chkFileDropAttachLocalLink option to allow suppression of local path/file link
2007.xx.xx *.*.* add suspend/resume of notifications to improve performance when multiple files are handled
2007.01.01 0.9.9 extensions for AttachFilePlugin
2006.11.04 0.1.1 initial release by Bradley Meck
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.FileDropPlugin={major:2, minor:1, revision:4, date: new Date(2010,3,6)};

config.macros.fileDrop = {
	customDropHandlers: [],
	addEventListener: function(paramflavor,func,inFront) {
		var obj={}; obj.flavor=paramflavor; obj.handler=func;
		if (!inFront) this.customDropHandlers.push(obj);
		else this.customDropHandlers.shift(obj);
	},
	dragDropHandler: function(evt) {
		netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect');
		var dragService = Components.classes['@mozilla.org/widget/dragservice;1'].getService(Components.interfaces.nsIDragService);
		var dragSession = dragService.getCurrentSession();
		var transferObject = Components.classes['@mozilla.org/widget/transferable;1'].createInstance();
		transferObject = transferObject.QueryInterface(Components.interfaces.nsITransferable);
		transferObject.addDataFlavor('application/x-moz-file');
		var numItems = dragSession.numDropItems;
		if (numItems&gt;1) {
			clearMessage();
			displayMessage('Reading '+numItems+' files...');
			store.suspendNotifications();
		}
		for (var i = 0; i &lt; numItems; i++) {
			dragSession.getData(transferObject, i);
			var dataObj = {};
			var dropSizeObj = {};
			for(var ind=0; ind&lt;config.macros.fileDrop.customDropHandlers.length; ind++) {
				var item = config.macros.fileDrop.customDropHandlers[ind];
				if(dragSession.isDataFlavorSupported(item.flavor)) {
					transferObject.getTransferData(item.flavor, dataObj, dropSizeObj);
					var droppedFile = dataObj.value.QueryInterface(Components.interfaces.nsIFile);
					var result = item.handler.call(item,droppedFile);
					evt.stopPropagation();
					evt.preventDefault();
					if (result) break;
				}
			}
		}
		if (numItems&gt;1) {
			store.resumeNotifications();
			store.notifyAll();
			displayMessage(numItems+' files have been processed');
		}
	}
}
//}}}
/***
!!!!!window event handlers
***/
//{{{
if(!window.event) {
	window.addEventListener('dragdrop',	// FireFox3.1-
		config.macros.fileDrop.dragDropHandler, true);
	window.addEventListener('drop',		// FireFox3.5+
		config.macros.fileDrop.dragDropHandler, true);
	window.addEventListener('dragover',	// FireFox3.6+
		function(e){e.stopPropagation();e.preventDefault();}, true); 
}
//}}}
/***
!!!!!handler for files, directories and binary attachments (see [[AttachFilePlugin]])
***/
//{{{
var defaults={
	chkFileDropDisplay:		true,
	chkFileDropTrimFilename:	false,
	chkFileDropContent:		true,
	chkFileDropLink:		true,
	txtFileDropLinkFormat:		'/%\\n!link\\n[[%0|%1]]\\n!end\\n%/',
	txtFileDropDataLimit:		'32768',
	chkFileDropAttachLocalLink:	true,
	txtFileDropTags:		''
};
for (var id in defaults) if (config.options[id]===undefined)
	config.options[id]=defaults[id];

config.macros.fileDrop.addEventListener('application/x-moz-file',function(nsiFile) {
	var co=config.options; // abbrev
	var header='Index of %0\n^^(as of %1)^^\n|!filename| !size | !modified |\n';
	var item='|[[%0|%1]]| %2|%3|\n';
	var footer='Total of %0 bytes in %1 files\n';
	var now=new Date();
	var files=[nsiFile];
	if (nsiFile.isDirectory()) {
		var folder=nsiFile.directoryEntries;
		var files=[];
		while (folder.hasMoreElements()) {
			var f=folder.getNext().QueryInterface(Components.interfaces.nsILocalFile);
			if (f instanceof Components.interfaces.nsILocalFile &amp;&amp; !f.isDirectory()) files.push(f);
		}
		var msg=nsiFile.path.replace(/\\/g,'/')+'\n\n';
		msg+='contains '+files.length+' files... ';
		msg+='select OK to attach all files or CANCEL to create a list...';
		if (!confirm(msg)) { // create a list in a tiddler
			var title=nsiFile.leafName; // tiddler name is last directory name in path
			while (title &amp;&amp; title.length &amp;&amp; store.tiddlerExists(title)) {
				if (confirm(config.messages.overwriteWarning.format([title]))) break;
				title=prompt('Enter a new tiddler title',nsiFile.path.replace(/\\/g,'/'));
			}
			if (!title || !title.length) return true; // cancelled
			var text=header.format([nsiFile.path.replace(/\\/g,'/'),now.toLocaleString()]);
			var total=0;
			for (var i=0; i&lt;files.length; i++) { var f=files[i];
				var name=f.leafName;
				if (co.chkFileDropTrimFilename)
					{ var p=name.split('.'); if (p.length&gt;1) p.pop(); name=p.join('.'); }
				var path='file:///'+f.path.replace(/\\/g,'/');
				var size=f.fileSize; total+=size;
				var when=new Date(f.lastModifiedTime).formatString('YYYY.0MM.0DD 0hh:0mm:0ss');
				text+=item.format([name,path,size,when]);
			}
			text+=footer.format([total,files.length]);
			var newtags=co.txtFileDropTags?co.txtFileDropTags.readBracketedList():[];
			store.saveTiddler(null,title,text,co.txtUserName,now,newtags);
			if (co.chkFileDropDisplay) story.displayTiddler(null,title);
			return true;
		}
	}
	if (files.length&gt;1) store.suspendNotifications();
	for (i=0; i&lt;files.length; i++) {
		var file=files[i];
		if (file.isDirectory()) continue; // skip over nested directories
		var type='text/plain';
		var title=file.leafName; // tiddler name is file name
		if (co.chkFileDropTrimFilename)
			{ var p=title.split('.'); if (p.length&gt;1) p.pop(); title=p.join('.'); }
		var name=file.leafName;
		var path=file.path;
		var url='file:///'+path.replace(/\\/g,'/');
		var size=file.fileSize;
		var when=new Date(file.lastModifiedTime);
		var now=new Date();
		var who=config.options.txtUserName;
		var h=document.location.href;
		var cwd=getLocalPath(decodeURIComponent(h.substr(0,h.lastIndexOf('/')+1)));
		var relpath=path.startsWith(cwd)?'./'+path.substr(cwd.length):path;
		while (title &amp;&amp; title.length &amp;&amp; store.tiddlerExists(title)) {
			if (confirm(config.messages.overwriteWarning.format([title]))) break;
			title=prompt('Enter a new tiddler title',path.replace(/\\/g,'/'));
		}
		if (!title || !title.length) continue; // cancelled
		if (config.macros.attach) {
			type=config.macros.attach.getMIMEType(name,'');
			if (!type.length)
				type=prompt('Unknown file type.  Enter a MIME type','text/plain');
			if (!type||!type.length) continue; // cancelled
		}
		var newtags=co.txtFileDropTags?co.txtFileDropTags.readBracketedList():[];
		if (type=='text/plain' || !co.chkFileDropContent) {
			var txt=''; var fmt=co.txtFileDropLinkFormat.unescapeLineBreaks();
			if (co.chkFileDropLink) txt+=fmt.format([name,url,path,relpath,size,when,now,who]);
			if (co.chkFileDropContent) {
				var out=loadFile(path); var lim=co.txtFileDropDataLimit;
				txt+=co.txtFileDropDataLimit?out.substr(0,lim):out;
				if (size&gt;lim) txt+='\n----\nfilesize ('+size+')'
					+' is larger than FileDrop limit ('+lim+')...\n'
					+'additional content has been omitted';
			}
			store.saveTiddler(null,title,txt,co.txtUserName,now,newtags);
		} else {
			var embed=co.chkFileDropContent
				&amp;&amp; (!co.txtFileDropDataLimit||size&lt;co.txtFileDropDataLimit);
			newtags.push('attachment'); newtags.push('excludeMissing');
			config.macros.attach.createAttachmentTiddler(path,
				now.formatString(config.macros.timeline.dateFormat),
				'attached by FileDropPlugin', newtags, title,
				embed, co.chkFileDropAttachLocalLink, false,
				relpath, '', type,!co.chkFileDropDisplay);
		}
		if (co.chkFileDropDisplay) story.displayTiddler(null,title);
	}
	if (files.length&gt;1) { store.resumeNotifications(); store.notifyAll(); }
	return true;
})
//}}}</pre>
</div>
<div title="ImageMapPlugin" modifier="ELSDesignStudios" created="200905100302" modified="200905270906" tags="systemConfig" server.type="file" server.host="http://www.tiddlytools.com" server.page.revision="200905270906">
<pre>/***
|Name|ImageMapPlugin|
|Source|http://www.TiddlyTools.com/#ImageMapPlugin|
|Documentation|http://www.TiddlyTools.com/#ImageMapPluginInfo|
|Version|1.2.2|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|plugin|
|Description|apply image maps ('hotspots') with links to tiddlers|
!!!!!Documentation
&gt;see [[ImageMapPluginInfo]]
!!!!!Revisions
&lt;&lt;&lt;
2009.05.27 [1.2.2] improved autoscroll for {{{&lt;&lt;mapMaker&gt;&gt;}}} textarea
2009.05.14 [1.2.1] added cursor changes
see [[ImageMapPluginInfo]] for additional revision details
2009.05.09 [1.0.0] initial release
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.ImageMapPlugin= {major: 1, minor: 2, revision: 2, date: new Date(2009,5,27)};
//}}}
//{{{
config.macros.imageMap = {
	handler: function(place,macroName,params,wikifier,paramString,tiddler) {
		// image element must immediately precede macro
		var img=place.lastChild; if (!img||img.nodeName!='IMG') return;
		var map=params[0]; var items=store.getTiddlerText(map,'').split('\n----\n'); if (!items) return;
		var out=['&lt;MAP NAME=&quot;'+map+'&quot;&gt;'];
		var fmt='&lt;AREA SHAPE=&quot;POLY&quot; TIDDLER=&quot;%0&quot; COORDS=&quot;%1&quot; TITLE=&quot;%2&quot; ALT=&quot;%2&quot; ONCLICK=&quot;%3&quot; STYLE=&quot;%4&quot;&gt;';
		var click=&quot;story.displayTiddler(story.findContainingTiddler(this),this.getAttribute('tiddler'));&quot;;
		var style='cursor:pointer';
		for (var i=0; i&lt;items.length; i++) {
			var lines=items[i].split('\n'); var tid=lines.shift(); var coords=lines.join('');
			var tip=store.tiddlerExists(tid)?store.getTiddler(tid).getSubtitle():tid;
			out.push(fmt.format([tid,coords,tip,click,style]));
		}
		out.push('&lt;/MAP&gt;');
		createTiddlyElement(place,'span').innerHTML=out.join('');
		img.setAttribute('isMap',true);
		img.setAttribute('useMap','#'+map);
		img.style.border=0;
	}
}
//}}}
//{{{
config.macros.mapMaker= {
	handler: function(place,macroName,params,wikifier,paramString,tiddler) {
		var img=place.lastChild; // image element must immediately precede macro
		if (!img||img.nodeName!='IMG') return;
		img.onmousemove=function(ev){ ev=ev||window.event;
			var mX=!config.browser.isIE?ev.pageX:(ev.clientX+findScrollX());
			var mY=!config.browser.isIE?ev.pageY:(ev.clientY+findScrollY());
			var ta=this.nextSibling.getElementsByTagName('textarea')[0];
			var lines=ta.value.split('\n'); var last=lines.length?lines.length-1:0;
			var vals=lines[last].split(','); vals.pop(); vals.pop(); lines[last]=vals.join(',');
			lines[last]+=(lines[last].length?',':'')+(mX-findPosX(this))+','+(mY-findPosY(this));
			ta.value=lines.join('\n');
			ta.scrollTop=ta.scrollHeight-ta.offsetHeight+this.emH*2;
			ta.scrollLeft=lines[last].length*this.emW-ta.offsetWidth;
			ta.focus();
		};
		img.onmouseout=function(ev){ ev=ev||window.event;
			var ta=this.nextSibling.getElementsByTagName('textarea')[0];
			var lines=ta.value.split('\n'); var last=lines.length?lines.length-1:0;
			var vals=lines[last].split(','); vals.pop(); vals.pop(); lines[last]=vals.join(',');
			ta.value=lines.join('\n');
			ta.scrollTop=ta.scrollHeight-ta.offsetHeight+this.emH*2;
			ta.scrollLeft=lines[last].length*this.emW-ta.offsetWidth;
		};
		img.onmouseover=img.onclick=function(ev) { ev=ev||window.event;
			var mX=!config.browser.isIE?ev.pageX:(ev.clientX+findScrollX());
			var mY=!config.browser.isIE?ev.pageY:(ev.clientY+findScrollY());
			var ta=this.nextSibling.getElementsByTagName('textarea')[0];
			ta.value+=(ta.value.length?',':'')+(mX-findPosX(this))+','+(mY-findPosY(this));
			var lines=ta.value.split('\n'); var last=lines.length?lines.length-1:0;
			ta.scrollTop=ta.scrollHeight-ta.offsetHeight+this.emH*2;
			ta.scrollLeft=lines[last].length*this.emW-ta.offsetWidth;
			ta.focus();
		}
		img.style.border='1px solid #999';
		img.style.cursor='crosshair';
		var map=params[0]||'';
		var s=createTiddlyElement(place,'div');
		s.style.height=s.style.width='1em';
		img.emW=s.offsetWidth; img.emH=s.offsetHeight; // get font metrics (for auto scrolling)
		s.style.height=s.style.width='';
		s.innerHTML+='&lt;div class=&quot;toolbar&quot;&gt;'
			+'&lt;a href=&quot;javascript:;&quot; '
			+'onclick=&quot;config.macros.mapMaker.load(this.parentNode.nextSibling)&quot;&gt;load map&lt;/a&gt;'
			+'&lt;a href=&quot;javascript:;&quot; '
			+'onclick=&quot;config.macros.mapMaker.save(this.parentNode.nextSibling)&quot;&gt;save map&lt;/a&gt;'
			+'&lt;/div&gt;'
			+'&lt;textarea rows=&quot;8&quot; style=&quot;display:block;clear:both;width:100%;&quot; tiddler=&quot;'+map+'&quot;&gt;'
			+store.getTiddlerText(map,'')
			+'&lt;/textarea&gt;';
	},
	load: function(ta) {
		var tid=prompt('Enter a tiddler title:',ta.getAttribute('tiddler')||'');
		if (!tid||!tid.length) return; // cancelled by user
		ta.value=store.getTiddlerText(tid,''); ta.setAttribute('tiddler',tid);
		return false;
	},
	save: function(ta) {
		var tid=prompt('Enter a tiddler title:',ta.getAttribute('tiddler')||'NewImageMap');
		while (tid &amp;&amp; tid.length &amp;&amp; store.tiddlerExists(tid)) {
			if(confirm(config.messages.overwriteWarning.format([tid]))) break;
			var tid=prompt('Enter a different tiddler title:',tid);
		}
		if (!tid||!tid.length) return; // cancelled by user
		store.saveTiddler(tid,tid,ta.value,config.options.txtUserName,new Date(),['imageMap'],{});
		story.displayTiddler(null,tid);
		displayMessage('image map saved to: '+tid);
		ta.setAttribute('tiddler',tid);
		return false;
	}
}
//}}}</pre>
</div>
<div title="MainMenu" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" modified="201109081852" changecount="3">
<pre>Toggle Sidebar &lt;&lt;tiddler ToggleRightSidebar&gt;&gt;
----
[[Sector Map]]
[[Planetary Directory]]
----
[[Alien Races]]
[[Political Groups]]
[[Corporations|Corporation Listing]]
[[Religions|Sector Religions]]</pre>
</div>
<div title="Planetary Directory" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>|!Hex|!World or Station|!Atmo.|!Temp.|!Biosphere|!Population|!TL|h
|[[0201|System:PRIAM]]|[[Alfdis|Planet:Alfdis]]|Breathable|Warm|Hybrid|1B+|4|
|[[0004|System:ERROSALI]]|[[Amavisca|Planet:Amavisca]]|Breathable|Frozen|None|1M+|3|
|[[0404|System:KARTIK]]|[[Areitio|Planet:Areitio]]|Breathable|Var. Cold|Immiscible|100K+|3|
|[[0106|System:JALA]]|[[Arne|Planet:Arne]]|Invasive|Temp.|Miscible|1M+|4|
|[[0706|System:ASTRID]]|[[Autolye|Planet:Autolye]]|Airless|Cold|Microbial|1M+|4|
|[[0701|System:GHALIYAH]]|[[Castor|Planet:Castor]]|Airless|Warm|Remnants|100K+|3|
|[[0505|System:AINTZANE]]|[[Diogenes|Planet:Diogenes]]|Airless|Temp.|Miscible|Outpost|4+|
|[[0504|System:MADHAVI]]|[[Dynamene|Planet:Dynamene]]|Breathable|Cold|None|100K+|4|
|[[0108|System:THORBJORG]]|[[Elixaeberna|Planet:Elixaeberna]]|Breathable|Var. Cold|Immiscible|10K+|2|
|[[0201|System:PRIAM]]|[[Fatimah|Planet:Fatimah]]|Breathable|Var. Warm|None|1B+|3|
|[[0504|System:MADHAVI]]|[[Huertas|Planet:Huertas]]|Breathable|Temp.|Immiscible|100K+|3|
|[[0401|System:SHAINA]]|[[Ismail|Planet:Ismail]]|Breathable|Warm|Miscible|1M+|3|
|[[0605|System:ONDITZ]]|[[Lamela|Planet:Lamela]]|Inert|Cold|None|100K+|3|
|[[0600|System:PORPUROGENITOS]]|[[Leda|Planet:Leda]]|Inert|Temp.|Miscible|1M+|4|
|[[0404|System:KARTIK]]|[[Lycomedes|Planet:Lycomedes]]|Invasive|Temp.|None|10K+|3|
|[[0406|System:ACTORIS]]|[[Lyssarides|Planet:Lyssarides]]|Breathable|Warm|Remnants|1M+|4|
|[[0306|System:ADONIE]]|[[Mossadegh|Planet:Mossadegh]]|Airless|Temp.|Microbial|100K+|4+|
|[[0101|System:BADRIYYAH]]|[[Mutlaq|Planet:Mutlaq]]|Breathable|Var. Cold|Miscible|100K+|4|
|[[0605|System:ONDITZ]]|[[Nagore|Planet:Nagore]]|Breathable|Cold|Miscible|Failed|4|
|[[0403|System:PELASGON]]|[[Otionia|Planet:Otionia]]|Inert|Temp.|None|10K+|3|
|[[0209|System:SHUBHA]]|[[Pero|Planet:Pero]]|Breathable|Temp.|Immiscible|10K+|4|
|[[0601|System:MAGANAS]]|[[Priyanka|Planet:Priyanka]]|Breathable|Cold|Miscible|10K+|2|
|[[0102|System:DOXIADIS]]|[[Rahimi|Planet:Rahimi]]|Breathable|Warm|Miscible|1M+|4|
|[[0209|System:SHUBHA]]|[[Rana|Planet:Rana]]|Breathable|Temp.|Hybrid|100K+|4|
|[[0509|System:ANITA]]|[[Roshni|Planet:Roshni]]|Breathable|Temp.|Immiscible|100K+|4|
|[[0101|System:BADRIYYAH]]|[[Sana|Planet:Sana]]|Airless|Temp.|Miscible|10K+|5|
|[[0205|System:GAZTAIN]]|[[Sanassis|Planet:Sanassis]]|Breathable|Temp.|Remnants|100K+|1|
|[[0005|System:MADARI]]|[[Sandhya|Planet:Sandhya]]|Breathable|Temp.|None|10K+|4|
|[[0600|System:PORPUROGENITOS]]|[[Sarris|Planet:Sarris]]|Breathable|Warm|Miscible|100K+|3|
|[[0205|System:GAZTAIN]]|[[Shadiyah|Planet:Shadiyah]]|Breathable|Cold|Miscible|1B+|4|
|[[0606|System:ARAITZ]]|[[Thaleia|Planet:Thaleia]]|Breathable|Temp.|Hybrid|100K+|4|
|[[0005|System:MADARI]]|[[Thoe|Planet:Thoe]]|Breathable|Warm|Remnants|100K+|4|
|[[0306|System:ADONIE]]|[[Tournikiotis|Planet:Tournikiotis]]|Breathable|Temp.|Miscible|100K+|5|
|[[0102|System:DOXIADIS]]|[[Villaroel|Planet:Villaroel]]|Invasive|Cold|Miscible|10K+|3|
|[[0101|System:BADRIYYAH]]|[[Warda|Planet:Warda]]|Invasive|Warm|Immiscible|1M+|2|
|[[0200|System:CAXIAS]]|[[Yumn|Planet:Yumn]]|Breathable|Warm|None|100K+|4|
</pre>
</div>
<div title="SWN Sector Generator" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201109041528" changecount="1">
<pre>
''SWN Sector Generator, Copyright © 2011-2015 [[N. Harrison Ripps|mailto:swn_generator@emichron.com]]''
''Based on and written for use with [[Stars Without Number|http://www.sinenomine-pub.com/]] by [[Sine Nomine Publishing|http://www.sinenomine-pub.com/]].''

//Sector Seed ID//: ''METHLAB''
!!!Credits
* [[TiddlyWiki|http://www.tiddlywiki.com/]] and the various ~TiddlyWiki Plugins used in this distribution are copyright to their respective owners. See "Backstage -> Plugins" for more info.
* [[Perl|http://www.perl.org/]] and several freely available Perl Libraries are used to generate the sector and star map:
** [[Archive::Zip|http://search.cpan.org/~adamk/Archive-Zip-1.30/lib/Archive/Zip.pm]]
** [[Cwd|http://search.cpan.org/~smueller/PathTools-3.33/Cwd.pm]]
** [[Data::RandomPerson|http://search.cpan.org/~peterhi/Data-RandomPerson-0.4/lib/Data/RandomPerson.pm]]
** [[DBI|http://search.cpan.org/~timb/DBI-1.616/DBI.pm]]
** [[GD|http://search.cpan.org/~lds/GD-2.46/GD.pm]]
** [[GD::Text|http://search.cpan.org/~mverb/GDTextUtil-0.86/Text.pm]]
** [[MIME::Base64|http://search.cpan.org/~gaas/MIME-Base64-3.13/Base64.pm]]
* [[SQLite|http://www.sqlite.org/]] is used to store and retrieve table data used throughout the wiki entries.
* Extra name generation help came directly from [[Chris Pound|http://www.ruf.rice.edu/~pound/]]'s amazing language generators.
//To remove this panel from the initial view, remove the "SWN Sector Generator" entry from the DefaultTiddlers list.//
</pre>
</div>
<div title="Sector Map" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>|[img[StarMap]]&lt;&lt;imageMap StarMapLinks&gt;&gt;|!Hex|!World or Station|
|~|[[0004|System:ERROSALI]]|[[Amavisca|Planet:Amavisca]]|
|~|[[0005|System:MADARI]]|[[Sandhya|Planet:Sandhya]]|
|~|~|[[Thoe|Planet:Thoe]]|
|~|[[0101|System:BADRIYYAH]]|[[Warda|Planet:Warda]]|
|~|~|[[Sana|Planet:Sana]]|
|~|~|[[Mutlaq|Planet:Mutlaq]]|
|~|[[0102|System:DOXIADIS]]|[[Rahimi|Planet:Rahimi]]|
|~|~|[[Villaroel|Planet:Villaroel]]|
|~|[[0106|System:JALA]]|[[Arne|Planet:Arne]]|
|~|[[0108|System:THORBJORG]]|[[Elixaeberna|Planet:Elixaeberna]]|
|~|[[0200|System:CAXIAS]]|[[Yumn|Planet:Yumn]]|
|~|[[0201|System:PRIAM]]|[[Fatimah|Planet:Fatimah]]|
|~|~|[[Alfdis|Planet:Alfdis]]|
|~|[[0205|System:GAZTAIN]]|[[Shadiyah|Planet:Shadiyah]]|
|~|~|[[Sanassis|Planet:Sanassis]]|
|~|[[0209|System:SHUBHA]]|[[Pero|Planet:Pero]]|
|~|~|[[Rana|Planet:Rana]]|
|~|[[0306|System:ADONIE]]|[[Tournikiotis|Planet:Tournikiotis]]|
|~|~|[[Mossadegh|Planet:Mossadegh]]|
|~|[[0401|System:SHAINA]]|[[Ismail|Planet:Ismail]]|
|~|[[0403|System:PELASGON]]|[[Otionia|Planet:Otionia]]|
|~|[[0404|System:KARTIK]]|[[Areitio|Planet:Areitio]]|
|~|~|[[Lycomedes|Planet:Lycomedes]]|
|~|[[0406|System:ACTORIS]]|[[Lyssarides|Planet:Lyssarides]]|
|~|[[0504|System:MADHAVI]]|[[Huertas|Planet:Huertas]]|
|~|~|[[Dynamene|Planet:Dynamene]]|
|~|[[0505|System:AINTZANE]]|[[Diogenes|Planet:Diogenes]]|
|~|[[0509|System:ANITA]]|[[Roshni|Planet:Roshni]]|
|~|[[0600|System:PORPUROGENITOS]]|[[Leda|Planet:Leda]]|
|~|~|[[Sarris|Planet:Sarris]]|
|~|[[0601|System:MAGANAS]]|[[Priyanka|Planet:Priyanka]]|
|~|[[0605|System:ONDITZ]]|[[Nagore|Planet:Nagore]]|
|~|~|[[Lamela|Planet:Lamela]]|
|~|[[0606|System:ARAITZ]]|[[Thaleia|Planet:Thaleia]]|
|~|[[0701|System:GHALIYAH]]|[[Castor|Planet:Castor]]|
|~|[[0706|System:ASTRID]]|[[Autolye|Planet:Autolye]]|
</pre>
</div>
<div title="SiteSubtitle" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>A randomly generated sector for [[Stars Without Number|http://www.sinenomine-pub.com/]]</pre>
</div>
<div title="SiteTitle" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>Sector Hades Theta</pre>
</div>
<div title="Planet:Alfdis" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:PRIAM Planet:Alfdis Atmosphere:Breathable Temperature:Warm Biosphere:Hybrid Population:1B+ TechLevel:4" changecount="1">
<pre>''//Nav Designation//: [[Priam|System:PRIAM]] X''
|!Atmosphere |Breathable mix|
|!Temperature|Warm|
|!Biosphere  |Hybrid biosphere|
|!Population |Billions of inhabitants|
|!Tech Level |Tech Level 4. Baseline postech.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Amavisca" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:ERROSALI Planet:Amavisca Atmosphere:Breathable Temperature:Frozen Biosphere:None Population:1M+ TechLevel:3" changecount="1">
<pre>''//Nav Designation//: [[Errosali|System:ERROSALI]] V''
|!Atmosphere |Breathable mix|
|!Temperature|Frozen|
|!Biosphere  |No native biosphere|
|!Population |Millions of inhabitants|
|!Tech Level |Tech Level 3. 20th-century technology.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Areitio" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:KARTIK Planet:Areitio Atmosphere:Breathable Temperature:Var.Cold Biosphere:Immiscible Population:100K+ TechLevel:3" changecount="1">
<pre>''//Nav Designation//: [[Kartik|System:KARTIK]] III''
|!Atmosphere |Breathable mix|
|!Temperature|Variable; Cold-to-Temperate|
|!Biosphere  |Immiscible biosphere|
|!Population |Hundreds of thousands of inhabitants|
|!Tech Level |Tech Level 3. 20th-century technology.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Arne" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:JALA Planet:Arne Atmosphere:Invasive Temperature:Temp. Biosphere:Miscible Population:1M+ TechLevel:4" changecount="1">
<pre>''//Nav Designation//: [[Jala|System:JALA]] V''
|!Atmosphere |Invasive, toxic atmospere|
|!Temperature|Temperate|
|!Biosphere  |Human-miscible biosphere|
|!Population |Millions of inhabitants|
|!Tech Level |Tech Level 4. Baseline postech.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Autolye" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:ASTRID Planet:Autolye Atmosphere:Airless Temperature:Cold Biosphere:Microbial Population:1M+ TechLevel:4" changecount="1">
<pre>''//Nav Designation//: [[Astrid|System:ASTRID]] IX''
|!Atmosphere |Airless / thin atmosphere|
|!Temperature|Cold|
|!Biosphere  |Microbial life|
|!Population |Millions of inhabitants|
|!Tech Level |Tech Level 4. Baseline postech.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Castor" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:GHALIYAH Planet:Castor Atmosphere:Airless Temperature:Warm Biosphere:Remnants Population:100K+ TechLevel:3" changecount="1">
<pre>''//Nav Designation//: [[Ghaliyah|System:GHALIYAH]] VI''
|!Atmosphere |Airless / thin atmosphere|
|!Temperature|Warm|
|!Biosphere  |Biosphere remnants|
|!Population |Hundreds of thousands of inhabitants|
|!Tech Level |Tech Level 3. 20th-century technology.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Diogenes" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:AINTZANE Planet:Diogenes Atmosphere:Airless Temperature:Temp. Biosphere:Miscible Population:Outpost TechLevel:4+" changecount="1">
<pre>''//Nav Designation//: [[Aintzane|System:AINTZANE]] III''
|!Atmosphere |Airless / thin atmosphere|
|!Temperature|Temperate|
|!Biosphere  |Human-miscible biosphere|
|!Population |Outpost|
|!Tech Level |Tech Level 4 w/ specialities / pretech.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Dynamene" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:MADHAVI Planet:Dynamene Atmosphere:Breathable Temperature:Cold Biosphere:None Population:100K+ TechLevel:4" changecount="1">
<pre>''//Nav Designation//: [[Madhavi|System:MADHAVI]] X''
|!Atmosphere |Breathable mix|
|!Temperature|Cold|
|!Biosphere  |No native biosphere|
|!Population |Hundreds of thousands of inhabitants|
|!Tech Level |Tech Level 4. Baseline postech.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Elixaeberna" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:THORBJORG Planet:Elixaeberna Atmosphere:Breathable Temperature:Var.Cold Biosphere:Immiscible Population:10K+ TechLevel:2" changecount="1">
<pre>''//Nav Designation//: [[Thorbjorg|System:THORBJORG]] X''
|!Atmosphere |Breathable mix|
|!Temperature|Variable; Cold-to-Temperate|
|!Biosphere  |Immiscible biosphere|
|!Population |Tens of thousands of inhabitants|
|!Tech Level |Tech level 2. 19th-century technology.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Fatimah" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:PRIAM Planet:Fatimah Atmosphere:Breathable Temperature:Var.Warm Biosphere:None Population:1B+ TechLevel:3" changecount="1">
<pre>''//Nav Designation//: [[Priam|System:PRIAM]] V''
|!Atmosphere |Breathable mix|
|!Temperature|Variable; Temperate-to-Warm|
|!Biosphere  |No native biosphere|
|!Population |Billions of inhabitants|
|!Tech Level |Tech Level 3. 20th-century technology.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Huertas" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:MADHAVI Planet:Huertas Atmosphere:Breathable Temperature:Temp. Biosphere:Immiscible Population:100K+ TechLevel:3" changecount="1">
<pre>''//Nav Designation//: [[Madhavi|System:MADHAVI]] III''
|!Atmosphere |Breathable mix|
|!Temperature|Temperate|
|!Biosphere  |Immiscible biosphere|
|!Population |Hundreds of thousands of inhabitants|
|!Tech Level |Tech Level 3. 20th-century technology.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Ismail" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:SHAINA Planet:Ismail Atmosphere:Breathable Temperature:Warm Biosphere:Miscible Population:1M+ TechLevel:3" changecount="1">
<pre>''//Nav Designation//: [[Shaina|System:SHAINA]] IX''
|!Atmosphere |Breathable mix|
|!Temperature|Warm|
|!Biosphere  |Human-miscible biosphere|
|!Population |Millions of inhabitants|
|!Tech Level |Tech Level 3. 20th-century technology.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Lamela" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:ONDITZ Planet:Lamela Atmosphere:Inert Temperature:Cold Biosphere:None Population:100K+ TechLevel:3" changecount="1">
<pre>''//Nav Designation//: [[Onditz|System:ONDITZ]] VIII''
|!Atmosphere |Inert gas|
|!Temperature|Cold|
|!Biosphere  |No native biosphere|
|!Population |Hundreds of thousands of inhabitants|
|!Tech Level |Tech Level 3. 20th-century technology.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Leda" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:PORPUROGENITOS Planet:Leda Atmosphere:Inert Temperature:Temp. Biosphere:Miscible Population:1M+ TechLevel:4" changecount="1">
<pre>''//Nav Designation//: [[Porpurogenitos|System:PORPUROGENITOS]] IV''
|!Atmosphere |Inert gas|
|!Temperature|Temperate|
|!Biosphere  |Human-miscible biosphere|
|!Population |Millions of inhabitants|
|!Tech Level |Tech Level 4. Baseline postech.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Lycomedes" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:KARTIK Planet:Lycomedes Atmosphere:Invasive Temperature:Temp. Biosphere:None Population:10K+ TechLevel:3" changecount="1">
<pre>''//Nav Designation//: [[Kartik|System:KARTIK]] X''
|!Atmosphere |Invasive, toxic atmospere|
|!Temperature|Temperate|
|!Biosphere  |No native biosphere|
|!Population |Tens of thousands of inhabitants|
|!Tech Level |Tech Level 3. 20th-century technology.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Lyssarides" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:ACTORIS Planet:Lyssarides Atmosphere:Breathable Temperature:Warm Biosphere:Remnants Population:1M+ TechLevel:4" changecount="1">
<pre>''//Nav Designation//: [[Actoris|System:ACTORIS]] IX''
|!Atmosphere |Breathable mix|
|!Temperature|Warm|
|!Biosphere  |Biosphere remnants|
|!Population |Millions of inhabitants|
|!Tech Level |Tech Level 4. Baseline postech.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Mossadegh" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:ADONIE Planet:Mossadegh Atmosphere:Airless Temperature:Temp. Biosphere:Microbial Population:100K+ TechLevel:4+" changecount="1">
<pre>''//Nav Designation//: [[Adonie|System:ADONIE]] IX''
|!Atmosphere |Airless / thin atmosphere|
|!Temperature|Temperate|
|!Biosphere  |Microbial life|
|!Population |Hundreds of thousands of inhabitants|
|!Tech Level |Tech Level 4 w/ specialities / pretech.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Mutlaq" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:BADRIYYAH Planet:Mutlaq Atmosphere:Breathable Temperature:Var.Cold Biosphere:Miscible Population:100K+ TechLevel:4" changecount="1">
<pre>''//Nav Designation//: [[Badriyyah|System:BADRIYYAH]] X''
|!Atmosphere |Breathable mix|
|!Temperature|Variable; Cold-to-Temperate|
|!Biosphere  |Human-miscible biosphere|
|!Population |Hundreds of thousands of inhabitants|
|!Tech Level |Tech Level 4. Baseline postech.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Nagore" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:ONDITZ Planet:Nagore Atmosphere:Breathable Temperature:Cold Biosphere:Miscible Population:Failed TechLevel:4" changecount="1">
<pre>''//Nav Designation//: [[Onditz|System:ONDITZ]] III''
|!Atmosphere |Breathable mix|
|!Temperature|Cold|
|!Biosphere  |Human-miscible biosphere|
|!Population |Failed colony|
|!Tech Level |Tech Level 4. Baseline postech.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Otionia" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:PELASGON Planet:Otionia Atmosphere:Inert Temperature:Temp. Biosphere:None Population:10K+ TechLevel:3" changecount="1">
<pre>''//Nav Designation//: [[Pelasgon|System:PELASGON]] X''
|!Atmosphere |Inert gas|
|!Temperature|Temperate|
|!Biosphere  |No native biosphere|
|!Population |Tens of thousands of inhabitants|
|!Tech Level |Tech Level 3. 20th-century technology.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Pero" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:SHUBHA Planet:Pero Atmosphere:Breathable Temperature:Temp. Biosphere:Immiscible Population:10K+ TechLevel:4" changecount="1">
<pre>''//Nav Designation//: [[Shubha|System:SHUBHA]] VIII''
|!Atmosphere |Breathable mix|
|!Temperature|Temperate|
|!Biosphere  |Immiscible biosphere|
|!Population |Tens of thousands of inhabitants|
|!Tech Level |Tech Level 4. Baseline postech.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Priyanka" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:MAGANAS Planet:Priyanka Atmosphere:Breathable Temperature:Cold Biosphere:Miscible Population:10K+ TechLevel:2" changecount="1">
<pre>''//Nav Designation//: [[Maganas|System:MAGANAS]] V''
|!Atmosphere |Breathable mix|
|!Temperature|Cold|
|!Biosphere  |Human-miscible biosphere|
|!Population |Tens of thousands of inhabitants|
|!Tech Level |Tech level 2. 19th-century technology.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Rahimi" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:DOXIADIS Planet:Rahimi Atmosphere:Breathable Temperature:Warm Biosphere:Miscible Population:1M+ TechLevel:4" changecount="1">
<pre>''//Nav Designation//: [[Doxiadis|System:DOXIADIS]] VI''
|!Atmosphere |Breathable mix|
|!Temperature|Warm|
|!Biosphere  |Human-miscible biosphere|
|!Population |Millions of inhabitants|
|!Tech Level |Tech Level 4. Baseline postech.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Rana" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:SHUBHA Planet:Rana Atmosphere:Breathable Temperature:Temp. Biosphere:Hybrid Population:100K+ TechLevel:4" changecount="1">
<pre>''//Nav Designation//: [[Shubha|System:SHUBHA]] IX''
|!Atmosphere |Breathable mix|
|!Temperature|Temperate|
|!Biosphere  |Hybrid biosphere|
|!Population |Hundreds of thousands of inhabitants|
|!Tech Level |Tech Level 4. Baseline postech.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Roshni" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:ANITA Planet:Roshni Atmosphere:Breathable Temperature:Temp. Biosphere:Immiscible Population:100K+ TechLevel:4" changecount="1">
<pre>''//Nav Designation//: [[Anita|System:ANITA]] VIII''
|!Atmosphere |Breathable mix|
|!Temperature|Temperate|
|!Biosphere  |Immiscible biosphere|
|!Population |Hundreds of thousands of inhabitants|
|!Tech Level |Tech Level 4. Baseline postech.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Sana" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:BADRIYYAH Planet:Sana Atmosphere:Airless Temperature:Temp. Biosphere:Miscible Population:10K+ TechLevel:5" changecount="1">
<pre>''//Nav Designation//: [[Badriyyah|System:BADRIYYAH]] IX''
|!Atmosphere |Airless / thin atmosphere|
|!Temperature|Temperate|
|!Biosphere  |Human-miscible biosphere|
|!Population |Tens of thousands of inhabitants|
|!Tech Level |Tech Level 5. Pretech, pre-Silence tech.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Sanassis" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:GAZTAIN Planet:Sanassis Atmosphere:Breathable Temperature:Temp. Biosphere:Remnants Population:100K+ TechLevel:1" changecount="1">
<pre>''//Nav Designation//: [[Gaztain|System:GAZTAIN]] X''
|!Atmosphere |Breathable mix|
|!Temperature|Temperate|
|!Biosphere  |Biosphere remnants|
|!Population |Hundreds of thousands of inhabitants|
|!Tech Level |Tech Level 1. Medieval technology.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Sandhya" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:MADARI Planet:Sandhya Atmosphere:Breathable Temperature:Temp. Biosphere:None Population:10K+ TechLevel:4" changecount="1">
<pre>''//Nav Designation//: [[Madari|System:MADARI]] III''
|!Atmosphere |Breathable mix|
|!Temperature|Temperate|
|!Biosphere  |No native biosphere|
|!Population |Tens of thousands of inhabitants|
|!Tech Level |Tech Level 4. Baseline postech.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Sarris" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:PORPUROGENITOS Planet:Sarris Atmosphere:Breathable Temperature:Warm Biosphere:Miscible Population:100K+ TechLevel:3" changecount="1">
<pre>''//Nav Designation//: [[Porpurogenitos|System:PORPUROGENITOS]] VII''
|!Atmosphere |Breathable mix|
|!Temperature|Warm|
|!Biosphere  |Human-miscible biosphere|
|!Population |Hundreds of thousands of inhabitants|
|!Tech Level |Tech Level 3. 20th-century technology.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Shadiyah" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:GAZTAIN Planet:Shadiyah Atmosphere:Breathable Temperature:Cold Biosphere:Miscible Population:1B+ TechLevel:4" changecount="1">
<pre>''//Nav Designation//: [[Gaztain|System:GAZTAIN]] V''
|!Atmosphere |Breathable mix|
|!Temperature|Cold|
|!Biosphere  |Human-miscible biosphere|
|!Population |Billions of inhabitants|
|!Tech Level |Tech Level 4. Baseline postech.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Thaleia" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:ARAITZ Planet:Thaleia Atmosphere:Breathable Temperature:Temp. Biosphere:Hybrid Population:100K+ TechLevel:4" changecount="1">
<pre>''//Nav Designation//: [[Araitz|System:ARAITZ]] III''
|!Atmosphere |Breathable mix|
|!Temperature|Temperate|
|!Biosphere  |Hybrid biosphere|
|!Population |Hundreds of thousands of inhabitants|
|!Tech Level |Tech Level 4. Baseline postech.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Thoe" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:MADARI Planet:Thoe Atmosphere:Breathable Temperature:Warm Biosphere:Remnants Population:100K+ TechLevel:4" changecount="1">
<pre>''//Nav Designation//: [[Madari|System:MADARI]] V''
|!Atmosphere |Breathable mix|
|!Temperature|Warm|
|!Biosphere  |Biosphere remnants|
|!Population |Hundreds of thousands of inhabitants|
|!Tech Level |Tech Level 4. Baseline postech.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Tournikiotis" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:ADONIE Planet:Tournikiotis Atmosphere:Breathable Temperature:Temp. Biosphere:Miscible Population:100K+ TechLevel:5" changecount="1">
<pre>''//Nav Designation//: [[Adonie|System:ADONIE]] VIII''
|!Atmosphere |Breathable mix|
|!Temperature|Temperate|
|!Biosphere  |Human-miscible biosphere|
|!Population |Hundreds of thousands of inhabitants|
|!Tech Level |Tech Level 5. Pretech, pre-Silence tech.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Villaroel" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:DOXIADIS Planet:Villaroel Atmosphere:Invasive Temperature:Cold Biosphere:Miscible Population:10K+ TechLevel:3" changecount="1">
<pre>''//Nav Designation//: [[Doxiadis|System:DOXIADIS]] X''
|!Atmosphere |Invasive, toxic atmospere|
|!Temperature|Cold|
|!Biosphere  |Human-miscible biosphere|
|!Population |Tens of thousands of inhabitants|
|!Tech Level |Tech Level 3. 20th-century technology.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Warda" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:BADRIYYAH Planet:Warda Atmosphere:Invasive Temperature:Warm Biosphere:Immiscible Population:1M+ TechLevel:2" changecount="1">
<pre>''//Nav Designation//: [[Badriyyah|System:BADRIYYAH]] III''
|!Atmosphere |Invasive, toxic atmospere|
|!Temperature|Warm|
|!Biosphere  |Immiscible biosphere|
|!Population |Millions of inhabitants|
|!Tech Level |Tech level 2. 19th-century technology.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="Planet:Yumn" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:CAXIAS Planet:Yumn Atmosphere:Breathable Temperature:Warm Biosphere:None Population:100K+ TechLevel:4" changecount="1">
<pre>''//Nav Designation//: [[Caxias|System:CAXIAS]] X''
|!Atmosphere |Breathable mix|
|!Temperature|Warm|
|!Biosphere  |No native biosphere|
|!Population |Hundreds of thousands of inhabitants|
|!Tech Level |Tech Level 4. Baseline postech.|
!!!Notes
//Add your own notes here//
</pre>
</div>
<div title="System:ACTORIS" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:ACTORIS Planet:Lyssarides" changecount="1">
<pre>|!Nav Designation|''GRID 0406''|
|!System Planet|[[Lyssarides|Planet:Lyssarides]]|
</pre>
</div>
<div title="System:ADONIE" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:ADONIE Planet:Tournikiotis Planet:Mossadegh" changecount="1">
<pre>|!Nav Designation|''GRID 0306''|
|!System Planets|[[Tournikiotis|Planet:Tournikiotis]]|
|~|[[Mossadegh|Planet:Mossadegh]]|
</pre>
</div>
<div title="System:AINTZANE" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:AINTZANE Planet:Diogenes" changecount="1">
<pre>|!Nav Designation|''GRID 0505''|
|!System Planet|[[Diogenes|Planet:Diogenes]]|
</pre>
</div>
<div title="System:ANITA" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:ANITA Planet:Roshni" changecount="1">
<pre>|!Nav Designation|''GRID 0509''|
|!System Planet|[[Roshni|Planet:Roshni]]|
</pre>
</div>
<div title="System:ARAITZ" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:ARAITZ Planet:Thaleia" changecount="1">
<pre>|!Nav Designation|''GRID 0606''|
|!System Planet|[[Thaleia|Planet:Thaleia]]|
</pre>
</div>
<div title="System:ASTRID" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:ASTRID Planet:Autolye" changecount="1">
<pre>|!Nav Designation|''GRID 0706''|
|!System Planet|[[Autolye|Planet:Autolye]]|
</pre>
</div>
<div title="System:BADRIYYAH" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:BADRIYYAH Planet:Warda Planet:Sana Planet:Mutlaq" changecount="1">
<pre>|!Nav Designation|''GRID 0101''|
|!System Planets|[[Warda|Planet:Warda]]|
|~|[[Sana|Planet:Sana]]|
|~|[[Mutlaq|Planet:Mutlaq]]|
</pre>
</div>
<div title="System:CAXIAS" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:CAXIAS Planet:Yumn" changecount="1">
<pre>|!Nav Designation|''GRID 0200''|
|!System Planet|[[Yumn|Planet:Yumn]]|
</pre>
</div>
<div title="System:DOXIADIS" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:DOXIADIS Planet:Rahimi Planet:Villaroel" changecount="1">
<pre>|!Nav Designation|''GRID 0102''|
|!System Planets|[[Rahimi|Planet:Rahimi]]|
|~|[[Villaroel|Planet:Villaroel]]|
</pre>
</div>
<div title="System:ERROSALI" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:ERROSALI Planet:Amavisca" changecount="1">
<pre>|!Nav Designation|''GRID 0004''|
|!System Planet|[[Amavisca|Planet:Amavisca]]|
</pre>
</div>
<div title="System:GAZTAIN" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:GAZTAIN Planet:Shadiyah Planet:Sanassis" changecount="1">
<pre>|!Nav Designation|''GRID 0205''|
|!System Planets|[[Shadiyah|Planet:Shadiyah]]|
|~|[[Sanassis|Planet:Sanassis]]|
</pre>
</div>
<div title="System:GHALIYAH" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:GHALIYAH Planet:Castor" changecount="1">
<pre>|!Nav Designation|''GRID 0701''|
|!System Planet|[[Castor|Planet:Castor]]|
</pre>
</div>
<div title="System:JALA" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:JALA Planet:Arne" changecount="1">
<pre>|!Nav Designation|''GRID 0106''|
|!System Planet|[[Arne|Planet:Arne]]|
</pre>
</div>
<div title="System:KARTIK" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:KARTIK Planet:Areitio Planet:Lycomedes" changecount="1">
<pre>|!Nav Designation|''GRID 0404''|
|!System Planets|[[Areitio|Planet:Areitio]]|
|~|[[Lycomedes|Planet:Lycomedes]]|
</pre>
</div>
<div title="System:MADARI" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:MADARI Planet:Sandhya Planet:Thoe" changecount="1">
<pre>|!Nav Designation|''GRID 0005''|
|!System Planets|[[Sandhya|Planet:Sandhya]]|
|~|[[Thoe|Planet:Thoe]]|
</pre>
</div>
<div title="System:MADHAVI" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:MADHAVI Planet:Huertas Planet:Dynamene" changecount="1">
<pre>|!Nav Designation|''GRID 0504''|
|!System Planets|[[Huertas|Planet:Huertas]]|
|~|[[Dynamene|Planet:Dynamene]]|
</pre>
</div>
<div title="System:MAGANAS" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:MAGANAS Planet:Priyanka" changecount="1">
<pre>|!Nav Designation|''GRID 0601''|
|!System Planet|[[Priyanka|Planet:Priyanka]]|
</pre>
</div>
<div title="System:ONDITZ" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:ONDITZ Planet:Nagore Planet:Lamela" changecount="1">
<pre>|!Nav Designation|''GRID 0605''|
|!System Planets|[[Nagore|Planet:Nagore]]|
|~|[[Lamela|Planet:Lamela]]|
</pre>
</div>
<div title="System:PELASGON" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:PELASGON Planet:Otionia" changecount="1">
<pre>|!Nav Designation|''GRID 0403''|
|!System Planet|[[Otionia|Planet:Otionia]]|
</pre>
</div>
<div title="System:PORPUROGENITOS" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:PORPUROGENITOS Planet:Leda Planet:Sarris" changecount="1">
<pre>|!Nav Designation|''GRID 0600''|
|!System Planets|[[Leda|Planet:Leda]]|
|~|[[Sarris|Planet:Sarris]]|
</pre>
</div>
<div title="System:PRIAM" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:PRIAM Planet:Fatimah Planet:Alfdis" changecount="1">
<pre>|!Nav Designation|''GRID 0201''|
|!System Planets|[[Fatimah|Planet:Fatimah]]|
|~|[[Alfdis|Planet:Alfdis]]|
</pre>
</div>
<div title="System:SHAINA" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:SHAINA Planet:Ismail" changecount="1">
<pre>|!Nav Designation|''GRID 0401''|
|!System Planet|[[Ismail|Planet:Ismail]]|
</pre>
</div>
<div title="System:SHUBHA" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:SHUBHA Planet:Pero Planet:Rana" changecount="1">
<pre>|!Nav Designation|''GRID 0209''|
|!System Planets|[[Pero|Planet:Pero]]|
|~|[[Rana|Planet:Rana]]|
</pre>
</div>
<div title="System:THORBJORG" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="System:THORBJORG Planet:Elixaeberna" changecount="1">
<pre>|!Nav Designation|''GRID 0108''|
|!System Planet|[[Elixaeberna|Planet:Elixaeberna]]|
</pre>
</div>
<div title="Atmosphere:Breathable" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Breathable mix'' - Breathable mix atmospheres can support human life without additional equipment or gengineered modification. Any world that has a human population in the millions or more almost certainly has a breathable mix atmosphere.
While the air is breathable, almost every world has its own subtle cocktail of inert gases, atmospheric contaminants, and other odiferous ingredients. For spacers accustomed to the filtered air supply of a starship, the “new world stink” of a fresh planetfall can be maddening, as few linger long enough to get used to the smell of the local air. Attempting to explain the source of this discomfort to the locals rarely results in positive results. Some spaceport bars make a point of their air filtration and composition mixers.
</pre>
</div>
<div title="Atmosphere:Inert" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Inert gas'' - Inert gas atmospheres aren’t hostile or poisonous, but they’re unbreathable by humans. If the planet’s climate is otherwise tolerable, the natives might be able to live and work outdoors without anything more than an air tank and face mask. Some degree of technical sophistication is going to be necessary for humanity to survive, and large supplies of oxygen are going to have to be extracted from some local source. "Air mines" might exist to replace the oxygen lost during human use, or local power plants might need to be kept running full blast in order to crack water molecules into hydrogen and oxygen.
On worlds with an unbreathable atmosphere, control of the air supply makes it much harder for locals to rebel against their leaders. Without the equipment and power to generate their own air supplies, would-be rebels are entirely at the mercy of those who control the oxygen. Most rulers pick up on this fact rapidly, and some worlds with unbreathable atmospheres might even make it a crime to own illicit oxygen generation equipment.
</pre>
</div>
<div title="Atmosphere:Airless" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Airless / thin atmosphere'' - Airless or thin atmospheres are appropriate to asteroids, rocky planetoids, ot barren worlds that have had their atmospheres burnt off by weapons or cosmic caprice. Whatever atmosphere exists is too thin to support human life, if it exists at all, and the world is largely naked to the chill of space and the blaze of stellar heat. Exposure to the planet’s surface without a vacc suit or pressurized building is as lethal as exposure to hard vacuum.
Airless worlds are hostile to human life, but they excel at preserving the relics of the past. Provided that the ruins or remains are kept out of the baking heat of the local stellar body and the impact of random meteorites, they can survive for millions of years. Some exceptionally ancient alien ruins might even date back from before the world lost its atmosphere.
</pre>
</div>
<div title="Atmosphere:Invasive" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Invasive, toxic atmospere'' - Invasive toxic atmospheres are composed of a substantial proportion of molecules small enough to infiltrate past the seals of most vacc suits. This infiltration doesn’t harm the suit, but the molecules have to be steadily flushed by the system’s purification sensors before they build up to a debilitating level. This causes a much faster bleed of air as breathable oxygen is jettisoned along with the infiltrating molecules. Most invasive atmospheres cut oxygen supply durations by half, at best.
Invasive atmospheres make oxygen an even more important resource than it is on inert gas worlds. Outdoor work is avoided whenever possible, as any failure of a suit’s toxin sensors or flush system can lead to death before the wearer even realizes something is wrong. Steady exposure to low levels of the toxins can also result in unfortunate effects even with a fully-functional suit. Hallucinations, chronic sickness, or worse can follow.
</pre>
</div>
<div title="Temperature:Frozen" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Frozen'' - Frozen worlds are those with so weak a stellar primary or so great a distance that the average temperature is close to absolute zero. Any atmosphere that once existed has long since frozen into drifts of solidified oxygen or lakes of liquid helium. Exposure to these drifts is very dangerous. Vacc suits maintain a tolerable temperature easily because the stellar void is very empty, and there is little conduction of heat between the suit and empty space. Dunking a suit into a lake of thermally-conductive superchilled liquid can force the heating elements into sudden and drastic overload, draining a power cell in minutes even seconds.
</pre>
</div>
<div title="Temperature:Temp." creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Temperate'' - Temperate worlds were the most popular colony sites, and most of the truly populous worlds of the frontier have a temperate climate. Many temperate worlds have temperature ranges not unlike that of Earth, though most are canted a little further toward cold or heat depending on their angle and proximity to the local star.
Temperate worlds are the most likely to teem with native life as well, and to have alien ruins or remains located somewhere on their surface. Most frontier worlds never accumulated enough population to put a serious strain on a temperate world’s arable land, but this same capaciousness often allow for more complicated social divisions to develop. Natives of other worlds are often forced to cooperate or die, while those of a clement temperate world have the luxury of deep and lasting divisions.
</pre>
</div>
<div title="Temperature:Cold" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Cold'' - Cold worlds are uncomfortable, but a human can survive on them in nothing more than heavy clothing. The worst of the cold worlds are similar in condition to Earth’s Antarctic regions, barren wastes of ice and wind. The more clement ones have brief warmer seasons or equatorial bands that get enough solar radiation to support substantial agriculture.
On cold worlds, agricultural land is at a premium. The population is unlikely to be willing to limit its numbers to what hydroponic farms can provide, and they may lack the technology for wide-scale artificial production methods. Savage wars may have broken out over control of fertile growing regions, and populations have perhaps been driven away from the arable land into the cold zones and a lingering death.
Some worlds retain installations from before the Silence deep within the frozen wastes, ancient bases and laboratories that were planted in an age when good launch sites and orbital windows meant more than trifles of temperature. These lost sites might be remembered in legend and story, and some native leaders might still be in possession of the automatic defense bypass codes handed down by their ancestors.
</pre>
</div>
<div title="Temperature:Var.Cold" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Variable; Cold-to-Temperate'' - Variable temperature worlds tend to show a greater distribution of climates than other worlds, either ranging from cold to temperate levels or temperate to hot levels. This may be a climate that changes world-wide when a long, slow orbit brings the planet into proximity with a stellar primary, or it might be a world that has substantially different climactic zones spread across its surface. The north pole of one world might be a sun-blasted desert that moderates to a cool, wet equator, or an icy world might be warmed here and there by complex channels of geothermally-heated subsurface rivers.
Variable temperature worlds tend to have savage weather. The mixing of hot and cold air can send ferocious cyclones and raging hurricanes across the surface of the world, some large enough to consume most of a hemisphere.
</pre>
</div>
<div title="Temperature:Warm" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Warm'' - Warm worlds come in two main flavors, depending on the prevalence of water. “Desert worlds” are hot enough or arid enough to be deprived of most surface water. Any life on such a planet has to be capable of extracting water from living prey, air currents or moisture supplies deep underground. Humans can survive on warm worlds without more than appropriate clothing, but desert-world humans must learn sophisticated techniques of water prospecting and well- drilling in order to maintain their agricultural systems. Warfare often revolves around these water systems.
The other common variety of warm world is one blessed with an abundance of surface water. These worlds tend to be covered with plant and animal life, teeming with thick jungles and vast mats of sargasso on seas that boil with piscids and other alien life analogs. These worlds can be quite prosperous for humans if the native life is edible, but inhabitants are often forced to deal with large predators and a vividly ingenious native ecology of disease.
</pre>
</div>
<div title="Temperature:Var.Warm" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Variable; Temperate-to-Warm'' - Variable temperature worlds tend to show a greater distribution of climates than other worlds, either ranging from cold to temperate levels or temperate to hot levels. This may be a climate that changes world-wide when a long, slow orbit brings the planet into proximity with a stellar primary, or it might be a world that has substantially different climactic zones spread across its surface. The north pole of one world might be a sun-blasted desert that moderates to a cool, wet equator, or an icy world might be warmed here and there by complex channels of geothermally-heated subsurface rivers.
Variable temperature worlds tend to have savage weather. The mixing of hot and cold air can send ferocious cyclones and raging hurricanes across the surface of the world, some large enough to consume most of a hemisphere.
</pre>
</div>
<div title="Biosphere:Immiscible" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Immiscible biosphere'' - Immiscible biospheres are not friendly to humans. None of the local plants or animals are edible, and anything the colony needs to eat will have to be grown from Terran stock. Worse, it is common for the pollen and other microbial life of these worlds to be highly allergenic to humans, requiring the regular use of tailored antiallergenics to prevent eventual respiratory failure.
These worlds are exceptionally susceptible to the temptation of human gengineering. Despite the persistent drawbacks, genetic flaws, and handicaps that human gengineering usually introduces in a subject, the desperate need to eat can drive worlds to wholesale experimentation on their progeny. The resultant altered humans are often able to digest the local food, but commonly pay for it in shortened life spans, physical disabilities, or an inability to consume Terran foodstuffs.
Immiscible biospheres produce some of the most exotic plants and animals in human space. Unfettered by the limits of familiar evolutionary patterns, creatures of bizarre beauty and strange configurations are found on many of these worlds. Many lack the intelligence to realize that humans are as poisonous to them as they are to humans.
</pre>
</div>
<div title="Biosphere:Hybrid" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Hybrid biosphere'' - Hybrid biospheres are a stable intermixing of Terran flora and fauna with local life forms. Most such worlds have been colonized for centuries before the Silence, giving the local ecology time to shake out into a relatively stable configuration of Earth-born organisms and native life. The native biology may or may not be miscible with human life, but it unlikely to be particularly hostile in any case, or else the interloping life forms would not have been able to get a foothold on the planet.
Hybrid biospheres often show strange examples of symbiosis and adaptation, with plants and animals forming new alliances. Large predators from one world may find themselves subsisting on herds of herbivorous alien life, while Terran vegetation provides sustenance for large populations of small, furred, insect-like grazers. Familiar animals may show seemingly bizarre behavior patterns that have formed in response to local conditions, perhaps becoming larger or more aggressive.
</pre>
</div>
<div title="Biosphere:Microbial" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Microbial life'' - Microbial life is often the only thing that exists on the more inhospitable planets, yet the wide variety of environments that can accommodate life means that these little beasts show up in some of the most unlikely places. Some varieties of slime mold have even managed to evolve on corrosive-atmosphere planets, forming a mucous-like outer shell against the atmosphere and then feeding and growing off the chemical byproducts of its erosion.
Microbial life can also be dangerous. While most alien microbes are unable to infect or harm the radically different biology of humans, some show enough ingenuity to accomplish even that difficult feat. Rumors of terrible “space plagues” that leave behind only drifting ships and garbled warnings remain a steady staple at spacer bars throughout the known universe.
</pre>
</div>
<div title="Biosphere:Miscible" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Human-miscible biosphere'' - Human-miscible biospheres are those in which some substantial portion of the native life is biologically compatible with human nutritional needs. The local plants and animals may not be tasty or terribly nourishing, but they can support life without the serious importation of Terran crop seeds and livestock.
Even the friendlier human-miscible biospheres often lack the wide variety of edibles that evolved on Earth, and the natives often supplement their stocks of local foods with limited Terran agriculture. Exotic foods, spices, and liquors can be worth interstellar importation to feed the hunger for novelty on these worlds.
Unfortunately, the fact that humans can eat some native life means that it is very likely that some native life can eat humans in turn. Large predators and diseases capable of human infection are by no means uncommon on these worlds, and small colonies can be hard- pressed to survive them.
</pre>
</div>
<div title="Biosphere:None" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''No native biosphere'' - No native biosphere is occasionally found on even the most temperate and otherwise habitable worlds. For one reason or another, life simply never evolved on these worlds, leaving them a blank slate for the agricultural and ecological efforts of humans. If the world is otherwise amenable to Terran life, such planets can be enormously fertile and agriculturally rich.
They can also be disasters waiting to happen. Pretech xenobiologists compiled standardized colonization packages of plants, animals, and insect life designed to expand smoothly and evenly to fill the niches of an uninhabited world. Not all colonists implemented these packages correctly, and some worlds had disasters or special circumstances that destabilized their efforts. Some empty worlds are now in a state of constant biological flux as the local ecology strives vainly to find some sort of equilibrium between the myriad imported species.
More subtly, these worlds can be suddenly and drastically destabilized by the import of some offworld plant or animal. With no strong native ecology to fight off interlopers, the wrong beast or bug can lay waste to whole continents. These planets tend to be extremely paranoid about importation of foreign life forms.
</pre>
</div>
<div title="Biosphere:Remnants" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Biosphere remnants'' - Biosphere remnants are the wreckage of a ruined ecology. Petrified trees, drifts of preserved bones, forests of dead plant life; something killed all the life on this planet in the relatively recent past. It may have been the exercise of a maltech planet-buster weapon, or a mutant microbe introduced by human colonists, or some volcanic eruption or asteroid impact that plunged the world into decades of frozen night.
Any local civilization not sophisticated enough to escape the planet likely died when it did. Their ruins and remains might be found throughout the desolate wastes, along with more clues as to the cause of the devastation.
</pre>
</div>
<div title="Population:Outpost" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Outpost'' - Outposts are rarely composed of more than a few hundred or few thousand colonists at the most. Outposts are either very new colonies that have not have the requisite time to grow or they are uncolonized worlds that just happen to have a naval or corporate base on the surface.
Corporate or military outposts aren’t intended to be completely self- sufficient. While large outposts are often forced to raise their own food supplies, replacement personnel, spare parts, and advanced tech must all be brought in from elsewhere. Such temporary outposts are known to find themselves in sudden distress when a vital supply ship fails to make its drop or when some local threat proves more than the staff can handle.
Colonial outposts tend to be better equipped but with less outside backing. Such natives expect to live and die on the world, and are more inclined to build permanent structures and local improvements. Many are exiles, malcontents, or others incapable of tolerating the world that sent them forth, and it can make for a somewhat explosive mix in a young colony. These pioneers tend to be very friendly towards visiting starships, as they are often dependent upon free traders and tramp merchants to bring them vital supplies or news of the sector.
Some “outposts” are really just the stubborn, persistent survivors of a long-failed colonization attempt. These cultures can survive for centuries, perpetually culled by the dangers of the world until the survivors are little more than one more element of the local ecology.
</pre>
</div>
<div title="Population:100K+" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Hundreds of thousands of inhabitants'' - Hundreds of thousands of inhabitants make up the population of most frontier worlds, usually ones with adequate supplies of arable land and surface conditions amenable to a human without a vacc suit or filter mask. This level of population is also usually the most that a world at tech level 4 can support using only artificial hydroponic complexes and sealed agricultural systems, so less hospitable planets rarely have more than this many inhabitants.
At this level of population, city-states and hub settlements start to form, and some political divisions might exist beneath the overall planetary government. Regional variations start to become present as towns and smaller settlements start to assert their own cultural traits. Young colonies rarely have much of a framework for resolving these new tensions, and it’s not uncommon for outsiders to end up as catspaws for varying factions.
This level of population is normally the smallest that can create spike drive-equipped starships. Less populous worlds rarely have the broad range of specialists and workers necessary to build such ships, even if they possess the necessary technical information.
</pre>
</div>
<div title="Population:1B+" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Billions of inhabitants'' - Billions of inhabitants on a world is a freak occurrence in most sectors, a circumstance dependent on almost perfect planetary conditions, a First Wave date of colonization, and a very large initial colonial expedition. These worlds have been colonized for almost a thousand years, and have likely gone through substantial cultural development and change since the original founding.
Planets with this many inhabitants tend to come in two main varieties. The more common is that of regional hegemon, leveraging its enormous reserves of labor and scientific personnel to build hundreds or thousands of starships. Some hegemons might even have the transport weight and personnel available to colonize or conquer their less powerful neighbors outright, though most hegemons prefer the safer route of docile client states rather than outright conquests.
Not all such worlds have the necessary resources to build starships, even when the labor is cheap and abundant. These worlds tend to take a different route, becoming balkanized, conflict-torn planets not unlike a mid-20th-century Earth. Resource wars are common and local politics revolve around Byzantine feuds and ancient slights. Technology on such planets tends to be very uneven; it is limited or nonexistent in fields that depend on unavailable resources, but the natives often show remarkable sophistication in making the most of what they have available.
</pre>
</div>
<div title="Population:1M+" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Millions of inhabitants'' - Millions of inhabitants are found on some of the more populous frontier worlds, those planets with an excellent climate and soil for agriculture. These worlds teem with human life compared to most of their neighbors, and if they have sufficient technological expertise to build spike drives, they probably are one of the more powerful planets in the sector. The sheer amount of labor and expertise they can put into their projects dwarfs the capabilities of most other worlds.
Some worlds of this type fail to coalesce under a unified planetary government, however, and turn most of their attention to intra- planetary quarrels between different nations or city-states. Full-scale planetary wars have been known to break out on such worlds, with some being reduced to burnt-out cinders by some maltech weapon or by nuclear attacks against regions stripped of their nuke snuffers.
</pre>
</div>
<div title="Population:Failed" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Failed colony'' - Failed colonies are occasionally found dotting the worlds of human space. Some date back to the First Wave of human colonization more than a thousand years ago, while others are more recent efforts that guttered out under the strains of a colony’s birth.
Pirate attacks might have wiped out a young colony, as might a hostile biosphere, alien attack, internal dissension, disease outbreaks, failure of vital colonial equipment, or any one of a hundred other disasters. The ruins of the colony might still have valuable pretech artifacts, however, or colonization deeds authorized by neighboring worlds. A few survivors might even have clung to life in the intervening centuries, maintaining some sort of society in the wreckage of their ancestors’ work.
</pre>
</div>
<div title="Population:10K+" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Tens of thousands of inhabitants'' - Tens of thousands of inhabitants are often found on newly-colonized worlds, or those with limited arable land. With such a small population, most settlements tend to be clustered close to one another for mutual support and efficient exploitation of land. The atmosphere can be something like that of a village-dotted countryside, with too few people to support large, specialized cities. The major settlement of the planet is usually built around the spaceport.
Politics on planets with so few people tend to be very personal in nature. Individual leaders can address the entire population of a world at a single meeting, and networks of family, friends, and employees can dominate the local social life. This small population combined with limited outside contact can result in somewhat... unusual societies more strongly influenced by a leader’s personal quirks than a more populous planet might be. Some such worlds can grow decidedly unhealthy in their customs and traditions.
</pre>
</div>
<div title="TechLevel:4" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Tech Level 4. Baseline postech.'' - Tech level 4 worlds are the most common in human space, and their technical expertise is the baseline for modern post-Silence "postech". These worlds can create spike drives rated up to drive-3, fusion power plants, grav vehicles, simple energy weapons, and medicines that extend human life to a hundred years of vigorous good health. They can manage sophisticated gengineering on simple life forms, and some tech level 4 worlds have even attempted to improve the genetic structures of human life itself. These attempts have yet to produce results without severe drawbacks, but some such worlds remain populated by altered humanity designed to cope with local conditions more perfectly than baseline humans.
Most worlds with regular interstellar contact and the necessary raw resources eventually gravitate towards this level of technological expertise. It may take decades, or even centuries in the case of more retrograde worlds, but this tech level is the highest that can readily be achieved by most planets.
</pre>
</div>
<div title="TechLevel:2" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Tech level 2. 19th-century technology.'' - Tech level 2 worlds are blessed with the presence of fossil fuels. Internal combustion engines are crude things compared to the power of a fusion plant, but they can be built with primitive tools and a basic degree of education. The mechanization that results from this resource vastly increases the efficiency of local farming, the speed of travel, and the productivity of factory workers.
Most tech level 2 worlds are “knockdowns”; planets that once had a much higher degree of sophistication but were recently crippled by disease, disaster, or invasion. The natives tend to be keenly aware of the glories of former generations, and work fiercely to redevelop lost techniques and reclaim old knowledge.
Few tech level 2 worlds produce much that’s worth interstellar trade. Most foodstuffs are too bulky and cheap to make it worth a captain’s time. Some worlds have rare ore deposits, but the natives have no reason to dig them until a merchant makes it worth their while to set up a whole new industry for export. Some such worlds barter the relics of their ancestors in exchange for educational materials or rare resources necessary for advancing local industry. Others feel forced to trade native work contracts for dangerous, dirty labor.
</pre>
</div>
<div title="TechLevel:4+" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Tech Level 4 w/ specialities / pretech.'' - Tech level 4 with specialties is an unusual case of a normal tech level 4 world that has retained some pretech industries or has developed their own local technical expertise beyond baseline postech in certain disciplines.
Most such specialties are relatively narrow in scope; grav tech, medicine, hydroponics, force field generation, or some field of roughly similar breadth. These specialties are usually either the product of a few, unreplaceable pretech manufactories or the result of some unique local resource that serves amazingly well for the purpose at hand. In both cases, the world will jealously guard the tech, and much local conflict may relate to control over these resources.
These worlds tend to have substantial amounts of interstellar trade from neighboring worlds interested in their tech. The ruling elite of the world can be ostentatious about display of this wealth.
</pre>
</div>
<div title="TechLevel:3" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Tech Level 3. 20th-century technology.'' - Tech level 3 worlds are those that have developed to a level much like that of the more advanced nations of late twentieth-century Earth. The main difference between tech level 3 worlds and level 4 worlds is the lack of fusion power or spike drive manufacture.
These worlds come in two major varieties. The first is a "knockdown" world that formerly had tech level 4 technologies before some catastrophe or pirate attack destroyed their knowledge and industrial base. Some of the wrecked infrastructure might have been irreplaceable, and the world must struggle to regain its former level of technological production. Worlds in this condition tend to have rather small populations that are susceptible to the loss of a few concentrated groups of experts.
The second major variety is a world that suffered a severe disaster shortly after colonization and has been forced to painstakingly build up their technological base ever since. Some of these worlds date back to the First Wave of colonization a thousand years ago, driven into near-neolithic conditions by some outside pressure before slowly and painfully rebuilding their technological base through purely indigenous efforts. These worlds tend to have very large populations if the world’s climate permits, as they have been colonized for quite some time.
Simply providing a world with the necessary technical data for advancement doesn’t mean that advancement will be quick or even. Even if a tech level 3 world has the necessary resources to build tech level 4 devices, it may take as much as a generation for a world to build the necessary infrastructure and resource extraction enterprises. The time may be longer still if the dominant cultures are uneasy with the new technology.
</pre>
</div>
<div title="TechLevel:5" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Tech Level 5. Pretech, pre-Silence tech.'' - Tech level 5 is the highest tech level that might merit random placement. A world with this level of technological expertise has somehow managed to hold on to the majority of the pre-Scream technology base, and can produce a wide range of goods that are unknown on less sophisticated worlds. Miniaturized fusion plants, drive-6 rated spike drives, exotic grav weaponry, and even the development of psionics-based "psitech" is possible on such a world.
Pretech manufacturing was largely dependent on specially-trained industrial psychics. With the loss of their unique disciplines in the Scream, most worlds that retain this level of tech classification were forced to substitute slower, less precise methods that sharply curtailed their production efficiency. Barring the profoundly unlikely happenstance of this world’s redevelopment of the lost disciplines, their maximum industrial output is sharply limited. Even on worlds such as this, most technology is likely mass-produced postech, with only important goods produced to pretech levels of quality.
A world with this level of technology is almost certainly a regional hegemon, one of the most powerful and influential worlds in the sector. Even those worlds that have no imperial ambitions have enormous influence simply through the vast superiority of their starships and military technology.
</pre>
</div>
<div title="TechLevel:1" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Tech Level 1. Medieval technology.'' - Tech level 1 worlds have managed to find and exploit metal deposits and likely have imported or domesticated beasts of burden. Those worlds with easy access to fossil fuels or a similarly energy-dense substance can advance to greater things, but a culture trapped at tech level 1 is unlikely to have access to such helpful resources. A few worlds have enough plant matter or other combustibles to make steam engines feasible, but those with very much of such a resource usually make the leap to the next tech level eventually.
As a consequence, tech level 1 worlds tend to be caught at much the same general level of development as their tech level 0 cousins. They may have elaborate social structures and cultural development, but they are unable to mechanize without some energy-dense resource to serve as fuel. The scavenged hulks of their ancestors’ fusion plants may stand as mute temples to the achievements of their forebears, but without the tech necessary to repair and rebuild such edifices the world is dependent on purely local fuel sources.
Tech level 1 worlds tend to respond to visitors in much the same way as tech level 0 planets. The ruling class of these worlds is liable to be able to muster larger cities, bigger armies, and all the other perquisites that come from being able to work the available agricultural land with fewer hands.
</pre>
</div>
<div title="Corporation Listing" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>
|!Company Name|!Business|h
|[[Ad Astra Enterprises|Corp:AdAstraEnterprises]]|Gemstones|
|[[Akers Multistellar|Corp:AkersMultistellar]]|Robotics|
|[[Ball Union|Corp:BallUnion]]|Snacks|
|[[Barsalou Circle|Corp:BarsalouCircle]]|Cybernetics|
|[[Batran Combine|Corp:BatranCombine]]|Ideology|
|[[Colonial Band|Corp:ColonialBand]]|Maltech|
|[[Compass Group|Corp:CompassGroup]]|Astrotech|
|[[Couloumbis Alliance|Corp:CouloumbisAlliance]]|Psionics|
|[[Daybreak Circle|Corp:DaybreakCircle]]|Asteroid Mining|
|[[Drowne Company|Corp:DrowneCompany]]|Snacks|
|[[Fazal-mahmood Outift|Corp:Fazal-mahmoodOutift]]|Metallurgy|
|[[Frontier Zaibatsu|Corp:FrontierZaibatsu]]|Assassination|
|[[Guo Yin Company|Corp:GuoYinCompany]]|Robotics|
|[[Hassan Combine|Corp:HassanCombine]]|Heavy Weapons|
|[[Henchoz Combine|Corp:HenchozCombine]]|Gemstones|
|[[Hisserich Outift|Corp:HisserichOutift]]|Plastics|
|[[Hsiang Enterprises|Corp:HsiangEnterprises]]|Gemstones|
|[[Imani Corporation|Corp:ImaniCorporation]]|Plastics|
|[[Kazemi Combine|Corp:KazemiCombine]]|Energy Weapons|
|[[Kehl Association|Corp:KehlAssociation]]|Xenotech|
|[[Konwinski Zaibatsu|Corp:KonwinskiZaibatsu]]|Pharmaceuticals|
|[[Lambrianou Pact|Corp:LambrianouPact]]|Security|
|[[Magnus Circle|Corp:MagnusCircle]]|Mercenary Work|
|[[Messia Company|Corp:MessiaCompany]]|Electronics|
|[[Meteor Clan|Corp:MeteorClan]]|Transport|
|[[Neogen Alliance|Corp:NeogenAlliance]]|Astrotech|
|[[New Dawn Sodality|Corp:NewDawnSodality]]|Transport|
|[[Omnitech Syndicate|Corp:OmnitechSyndicate]]|Illicit Drugs|
|[[Orrego Zaibatsu|Corp:OrregoZaibatsu]]|Psionics|
|[[Overwatch Pact|Corp:OverwatchPact]]|Programming|
|[[Panstellar Multistellar|Corp:PanstellarMultistellar]]|Metallurgy|
|[[Pippenger Band|Corp:PippengerBand]]|Exploration|
|[[Popotas Society|Corp:PopotasSociety]]|Snacks|
|[[Raif Organization|Corp:RaifOrganization]]|Liquor|
|[[Savvides Enterprises|Corp:SavvidesEnterprises]]|Gemstones|
|[[Sbokos Faction|Corp:SbokosFaction]]|Snacks|
|[[Shogun Combine|Corp:ShogunCombine]]|Programming|
|[[Silverlight Faction|Corp:SilverlightFaction]]|Prostitution|
|[[Sine Ring|Corp:SineRing]]|Aeronautics|
|[[Spiker Multistellar|Corp:SpikerMultistellar]]|Planetary Mining|
|[[Standridge Band|Corp:StandridgeBand]]|Agriculture|
|[[Stella Unity|Corp:StellaUnity]]|Espionage|
|[[Sunbeam Alliance|Corp:SunbeamAlliance]]|Energy Weapons|
|[[Tavares Unity|Corp:TavaresUnity]]|Astrotech|
|[[Terra Prime Unity|Corp:TerraPrimeUnity]]|Construction|
|[[Threat Circle|Corp:ThreatCircle]]|Grav Vehicles|
|[[Tsouderos Combine|Corp:TsouderosCombine]]|Gambling|
|[[Vashaw Corporation|Corp:VashawCorporation]]|Metallurgy|
|[[Wayfarer Megacorp|Corp:WayfarerMegacorp]]|Prisons|
|[[Zahedi Combine|Corp:ZahediCombine]]|Prisons|
</pre>
</div>
<div title="Corp:AdAstraEnterprises" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:AdAstraEnterprises Business:Gemstones" changecount="1">
<pre>
|!Name      |Ad Astra Enterprises|
|!Business  |Gemstones|
!!!Notes
</pre>
</div>
<div title="Corp:AkersMultistellar" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:AkersMultistellar Business:Robotics" changecount="1">
<pre>
|!Name      |Akers Multistellar|
|!Business  |Robotics|
!!!Notes
</pre>
</div>
<div title="Corp:BallUnion" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:BallUnion Business:Snacks" changecount="1">
<pre>
|!Name      |Ball Union|
|!Business  |Snacks|
!!!Notes
</pre>
</div>
<div title="Corp:BarsalouCircle" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:BarsalouCircle Business:Cybernetics" changecount="1">
<pre>
|!Name      |Barsalou Circle|
|!Business  |Cybernetics|
!!!Notes
</pre>
</div>
<div title="Corp:BatranCombine" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:BatranCombine Business:Ideology" changecount="1">
<pre>
|!Name      |Batran Combine|
|!Business  |Ideology|
!!!Notes
</pre>
</div>
<div title="Corp:ColonialBand" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:ColonialBand Business:Maltech" changecount="1">
<pre>
|!Name      |Colonial Band|
|!Business  |Maltech|
!!!Notes
</pre>
</div>
<div title="Corp:CompassGroup" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:CompassGroup Business:Astrotech" changecount="1">
<pre>
|!Name      |Compass Group|
|!Business  |Astrotech|
!!!Notes
</pre>
</div>
<div title="Corp:CouloumbisAlliance" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:CouloumbisAlliance Business:Psionics" changecount="1">
<pre>
|!Name      |Couloumbis Alliance|
|!Business  |Psionics|
!!!Notes
</pre>
</div>
<div title="Corp:DaybreakCircle" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:DaybreakCircle Business:AsteroidMining" changecount="1">
<pre>
|!Name      |Daybreak Circle|
|!Business  |Asteroid Mining|
!!!Notes
</pre>
</div>
<div title="Corp:DrowneCompany" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:DrowneCompany Business:Snacks" changecount="1">
<pre>
|!Name      |Drowne Company|
|!Business  |Snacks|
!!!Notes
</pre>
</div>
<div title="Corp:Fazal-mahmoodOutift" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:Fazal-mahmoodOutift Business:Metallurgy" changecount="1">
<pre>
|!Name      |Fazal-mahmood Outift|
|!Business  |Metallurgy|
!!!Notes
</pre>
</div>
<div title="Corp:FrontierZaibatsu" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:FrontierZaibatsu Business:Assassination" changecount="1">
<pre>
|!Name      |Frontier Zaibatsu|
|!Business  |Assassination|
!!!Notes
</pre>
</div>
<div title="Corp:GuoYinCompany" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:GuoYinCompany Business:Robotics" changecount="1">
<pre>
|!Name      |Guo Yin Company|
|!Business  |Robotics|
!!!Notes
</pre>
</div>
<div title="Corp:HassanCombine" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:HassanCombine Business:HeavyWeapons" changecount="1">
<pre>
|!Name      |Hassan Combine|
|!Business  |Heavy Weapons|
!!!Notes
</pre>
</div>
<div title="Corp:HenchozCombine" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:HenchozCombine Business:Gemstones" changecount="1">
<pre>
|!Name      |Henchoz Combine|
|!Business  |Gemstones|
!!!Notes
</pre>
</div>
<div title="Corp:HisserichOutift" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:HisserichOutift Business:Plastics" changecount="1">
<pre>
|!Name      |Hisserich Outift|
|!Business  |Plastics|
!!!Notes
</pre>
</div>
<div title="Corp:HsiangEnterprises" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:HsiangEnterprises Business:Gemstones" changecount="1">
<pre>
|!Name      |Hsiang Enterprises|
|!Business  |Gemstones|
!!!Notes
</pre>
</div>
<div title="Corp:ImaniCorporation" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:ImaniCorporation Business:Plastics" changecount="1">
<pre>
|!Name      |Imani Corporation|
|!Business  |Plastics|
!!!Notes
</pre>
</div>
<div title="Corp:KazemiCombine" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:KazemiCombine Business:EnergyWeapons" changecount="1">
<pre>
|!Name      |Kazemi Combine|
|!Business  |Energy Weapons|
!!!Notes
</pre>
</div>
<div title="Corp:KehlAssociation" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:KehlAssociation Business:Xenotech" changecount="1">
<pre>
|!Name      |Kehl Association|
|!Business  |Xenotech|
!!!Notes
</pre>
</div>
<div title="Corp:KonwinskiZaibatsu" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:KonwinskiZaibatsu Business:Pharmaceuticals" changecount="1">
<pre>
|!Name      |Konwinski Zaibatsu|
|!Business  |Pharmaceuticals|
!!!Notes
</pre>
</div>
<div title="Corp:LambrianouPact" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:LambrianouPact Business:Security" changecount="1">
<pre>
|!Name      |Lambrianou Pact|
|!Business  |Security|
!!!Notes
</pre>
</div>
<div title="Corp:MagnusCircle" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:MagnusCircle Business:MercenaryWork" changecount="1">
<pre>
|!Name      |Magnus Circle|
|!Business  |Mercenary Work|
!!!Notes
</pre>
</div>
<div title="Corp:MessiaCompany" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:MessiaCompany Business:Electronics" changecount="1">
<pre>
|!Name      |Messia Company|
|!Business  |Electronics|
!!!Notes
</pre>
</div>
<div title="Corp:MeteorClan" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:MeteorClan Business:Transport" changecount="1">
<pre>
|!Name      |Meteor Clan|
|!Business  |Transport|
!!!Notes
</pre>
</div>
<div title="Corp:NeogenAlliance" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:NeogenAlliance Business:Astrotech" changecount="1">
<pre>
|!Name      |Neogen Alliance|
|!Business  |Astrotech|
!!!Notes
</pre>
</div>
<div title="Corp:NewDawnSodality" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:NewDawnSodality Business:Transport" changecount="1">
<pre>
|!Name      |New Dawn Sodality|
|!Business  |Transport|
!!!Notes
</pre>
</div>
<div title="Corp:OmnitechSyndicate" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:OmnitechSyndicate Business:IllicitDrugs" changecount="1">
<pre>
|!Name      |Omnitech Syndicate|
|!Business  |Illicit Drugs|
!!!Notes
</pre>
</div>
<div title="Corp:OrregoZaibatsu" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:OrregoZaibatsu Business:Psionics" changecount="1">
<pre>
|!Name      |Orrego Zaibatsu|
|!Business  |Psionics|
!!!Notes
</pre>
</div>
<div title="Corp:OverwatchPact" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:OverwatchPact Business:Programming" changecount="1">
<pre>
|!Name      |Overwatch Pact|
|!Business  |Programming|
!!!Notes
</pre>
</div>
<div title="Corp:PanstellarMultistellar" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:PanstellarMultistellar Business:Metallurgy" changecount="1">
<pre>
|!Name      |Panstellar Multistellar|
|!Business  |Metallurgy|
!!!Notes
</pre>
</div>
<div title="Corp:PippengerBand" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:PippengerBand Business:Exploration" changecount="1">
<pre>
|!Name      |Pippenger Band|
|!Business  |Exploration|
!!!Notes
</pre>
</div>
<div title="Corp:PopotasSociety" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:PopotasSociety Business:Snacks" changecount="1">
<pre>
|!Name      |Popotas Society|
|!Business  |Snacks|
!!!Notes
</pre>
</div>
<div title="Corp:RaifOrganization" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:RaifOrganization Business:Liquor" changecount="1">
<pre>
|!Name      |Raif Organization|
|!Business  |Liquor|
!!!Notes
</pre>
</div>
<div title="Corp:SavvidesEnterprises" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:SavvidesEnterprises Business:Gemstones" changecount="1">
<pre>
|!Name      |Savvides Enterprises|
|!Business  |Gemstones|
!!!Notes
</pre>
</div>
<div title="Corp:SbokosFaction" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:SbokosFaction Business:Snacks" changecount="1">
<pre>
|!Name      |Sbokos Faction|
|!Business  |Snacks|
!!!Notes
</pre>
</div>
<div title="Corp:ShogunCombine" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:ShogunCombine Business:Programming" changecount="1">
<pre>
|!Name      |Shogun Combine|
|!Business  |Programming|
!!!Notes
</pre>
</div>
<div title="Corp:SilverlightFaction" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:SilverlightFaction Business:Prostitution" changecount="1">
<pre>
|!Name      |Silverlight Faction|
|!Business  |Prostitution|
!!!Notes
</pre>
</div>
<div title="Corp:SineRing" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:SineRing Business:Aeronautics" changecount="1">
<pre>
|!Name      |Sine Ring|
|!Business  |Aeronautics|
!!!Notes
</pre>
</div>
<div title="Corp:SpikerMultistellar" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:SpikerMultistellar Business:PlanetaryMining" changecount="1">
<pre>
|!Name      |Spiker Multistellar|
|!Business  |Planetary Mining|
!!!Notes
</pre>
</div>
<div title="Corp:StandridgeBand" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:StandridgeBand Business:Agriculture" changecount="1">
<pre>
|!Name      |Standridge Band|
|!Business  |Agriculture|
!!!Notes
</pre>
</div>
<div title="Corp:StellaUnity" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:StellaUnity Business:Espionage" changecount="1">
<pre>
|!Name      |Stella Unity|
|!Business  |Espionage|
!!!Notes
</pre>
</div>
<div title="Corp:SunbeamAlliance" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:SunbeamAlliance Business:EnergyWeapons" changecount="1">
<pre>
|!Name      |Sunbeam Alliance|
|!Business  |Energy Weapons|
!!!Notes
</pre>
</div>
<div title="Corp:TavaresUnity" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:TavaresUnity Business:Astrotech" changecount="1">
<pre>
|!Name      |Tavares Unity|
|!Business  |Astrotech|
!!!Notes
</pre>
</div>
<div title="Corp:TerraPrimeUnity" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:TerraPrimeUnity Business:Construction" changecount="1">
<pre>
|!Name      |Terra Prime Unity|
|!Business  |Construction|
!!!Notes
</pre>
</div>
<div title="Corp:ThreatCircle" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:ThreatCircle Business:GravVehicles" changecount="1">
<pre>
|!Name      |Threat Circle|
|!Business  |Grav Vehicles|
!!!Notes
</pre>
</div>
<div title="Corp:TsouderosCombine" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:TsouderosCombine Business:Gambling" changecount="1">
<pre>
|!Name      |Tsouderos Combine|
|!Business  |Gambling|
!!!Notes
</pre>
</div>
<div title="Corp:VashawCorporation" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:VashawCorporation Business:Metallurgy" changecount="1">
<pre>
|!Name      |Vashaw Corporation|
|!Business  |Metallurgy|
!!!Notes
</pre>
</div>
<div title="Corp:WayfarerMegacorp" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:WayfarerMegacorp Business:Prisons" changecount="1">
<pre>
|!Name      |Wayfarer Megacorp|
|!Business  |Prisons|
!!!Notes
</pre>
</div>
<div title="Corp:ZahediCombine" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Corp:ZahediCombine Business:Prisons" changecount="1">
<pre>
|!Name      |Zahedi Combine|
|!Business  |Prisons|
!!!Notes
</pre>
</div>
<div title="Business:PlanetaryMining" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:AsteroidMining" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Gambling" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Aeronautics" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Ideology" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Construction" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Espionage" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:GravVehicles" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:EnergyWeapons" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Assassination" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Prisons" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:HeavyWeapons" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Astrotech" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Transport" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Metallurgy" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Cybernetics" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Liquor" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Security" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Snacks" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Electronics" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Programming" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Xenotech" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Plastics" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Exploration" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Gemstones" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:MercenaryWork" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Prostitution" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Pharmaceuticals" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Psionics" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Maltech" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Robotics" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:Agriculture" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Business:IllicitDrugs" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Sector Religions" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>
|!Religion|!Origin|!Leadership|h
|[[Quietist Buddhists|Religion:QuietistBuddhists]]|Buddhism|Council|
|[[Separatist Buddhists|Religion:SeparatistBuddhists]]|Buddhism|Patriarch/Matriarch|
|[[Syncretic Protestant Confucianists|Religion:SyncreticProtestantConfucianists]]|Confucianism|Council|
|[[Quietist Confucianists|Religion:QuietistConfucianists]]|Confucianism|Council|
|[[Separatist Eastern Orthodox Christians|Religion:SeparatistEasternOrthodoxChristians]]|Eastern Orthodox Christianity|Patriarch/Matriarch|
|[[Holy Family Ideologists|Religion:HolyFamilyIdeologists]]|Ideology|No universal leadership|
|[[Separatist Ideologists|Religion:SeparatistIdeologists]]|Ideology|Democracy|
|[[Quietist Ideologists|Religion:QuietistIdeologists]]|Ideology|Patriarch/Matriarch|
|[[Quietist Muslims|Religion:QuietistMuslims]]|Islam|No universal leadership|
|[[New Book Muslims|Religion:NewBookMuslims]]|Islam|No universal leadership|
|[[Neofundamentalist Muslims|Religion:NeofundamentalistMuslims]]|Islam|Patriarch/Matriarch|
|[[Holy Family Muslims|Religion:HolyFamilyMuslims]]|Islam|No universal leadership|
|[[Separatist Judaism|Religion:SeparatistJudaism]]|Judaism|Democracy|
|[[Sacrificial Judaism|Religion:SacrificialJudaism]]|Judaism|Patriarch/Matriarch|
|[[New Book Judaism|Religion:NewBookJudaism]]|Judaism|Democracy|
|[[Neofundamentalist Judaism|Religion:NeofundamentalistJudaism]]|Judaism|Democracy|
|[[Syncretic Protestant Pagans|Religion:SyncreticProtestantPagans]]|Paganism|Patriarch/Matriarch|
|[[New Book Protestant Christians|Religion:NewBookProtestantChristians]]|Protestant Christianity|Council|
|[[New Prophet Protestant Christians|Religion:NewProphetProtestantChristians]]|Protestant Christianity|Patriarch/Matriarch|
|[[Syncretic Jewish Protestant Christians|Religion:SyncreticJewishProtestantChristians]]|Protestant Christianity|Patriarch/Matriarch|
|[[Quietist Protestant Christians|Religion:QuietistProtestantChristians]]|Protestant Christianity|Patriarch/Matriarch|
|[[Neofundamentalist Roman Catholics|Religion:NeofundamentalistRomanCatholics]]|Roman Catholicism|Patriarch/Matriarch|
|[[Holy Family Zoroastrianists|Religion:HolyFamilyZoroastrianists]]|Zoroastrianism|Democracy|
|[[New Prophet Zoroastrianists|Religion:NewProphetZoroastrianists]]|Zoroastrianism|Democracy|
</pre>
</div>
<div title="Religion:QuietistBuddhists" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:QuietistBuddhists Origin:Buddhism" changecount="1">
<pre>
|!Name      |Quietist Buddhists|
|!Origin    |Buddhism|
!!!Leadership
Council. A group of the oldest and most revered clergy determine the course of the faith.
!!!Evolution
Quietism. The faith shuns the outside world and involvement with the affairs of nonbelievers. They prefer to keep to their own kind and avoid positions of wealth and power.!!!Notes
</pre>
</div>
<div title="Religion:SeparatistBuddhists" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:SeparatistBuddhists Origin:Buddhism" changecount="1">
<pre>
|!Name      |Separatist Buddhists|
|!Origin    |Buddhism|
!!!Leadership
Patriarch/Matriarch. A single leader determines doctrine for the entire religion, possibly in consultation with other clerics.
!!!Evolution
Schism. The faith's beliefs are actually almost identical to those of the majority of its origin tradition, save for a few minor points of vital interest to theologians and no practical difference whatsoever to believers. This does not prevent a burning resentment towards the parent faith.!!!Notes
</pre>
</div>
<div title="Religion:SyncreticProtestantConfucianists" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:SyncreticProtestantConfucianists Origin:Confucianism" changecount="1">
<pre>
|!Name      |Syncretic Protestant Confucianists|
|!Origin    |Confucianism|
!!!Leadership
Council. A group of the oldest and most revered clergy determine the course of the faith.
!!!Evolution
Syncretism. This faith has reconciled the major elements of both of its origin beliefs into its tradition.!!!Notes
</pre>
</div>
<div title="Religion:QuietistConfucianists" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:QuietistConfucianists Origin:Confucianism" changecount="1">
<pre>
|!Name      |Quietist Confucianists|
|!Origin    |Confucianism|
!!!Leadership
Council. A group of the oldest and most revered clergy determine the course of the faith.
!!!Evolution
Quietism. The faith shuns the outside world and involvement with the affairs of nonbelievers. They prefer to keep to their own kind and avoid positions of wealth and power.!!!Notes
</pre>
</div>
<div title="Religion:SeparatistEasternOrthodoxChristians" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:SeparatistEasternOrthodoxChristians Origin:EasternOrthodoxChristianity" changecount="1">
<pre>
|!Name      |Separatist Eastern Orthodox Christians|
|!Origin    |Eastern Orthodox Christianity|
!!!Leadership
Patriarch/Matriarch. A single leader determines doctrine for the entire religion, possibly in consultation with other clerics.
!!!Evolution
Schism. The faith's beliefs are actually almost identical to those of the majority of its origin tradition, save for a few minor points of vital interest to theologians and no practical difference whatsoever to believers. This does not prevent a burning resentment towards the parent faith.!!!Notes
</pre>
</div>
<div title="Religion:HolyFamilyIdeologists" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:HolyFamilyIdeologists Origin:Ideology" changecount="1">
<pre>
|!Name      |Holy Family Ideologists|
|!Origin    |Ideology|
!!!Leadership
No universal leadership. Each region governs itself differently.
!!!Evolution
Holy family. God's favor has been shown especially to members of a particular lineage. It may be that only men and women of this bloodline are permitted to become clergy, or they may serve as helpless figureheads for the real leaders of the faith.!!!Notes
</pre>
</div>
<div title="Religion:SeparatistIdeologists" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:SeparatistIdeologists Origin:Ideology" changecount="1">
<pre>
|!Name      |Separatist Ideologists|
|!Origin    |Ideology|
!!!Leadership
Democracy. Every member has an equal voice in matters of faith, with doctrine usually decided at regular church-wide councils.
!!!Evolution
Schism. The faith's beliefs are actually almost identical to those of the majority of its origin tradition, save for a few minor points of vital interest to theologians and no practical difference whatsoever to believers. This does not prevent a burning resentment towards the parent faith.!!!Notes
</pre>
</div>
<div title="Religion:QuietistIdeologists" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:QuietistIdeologists Origin:Ideology" changecount="1">
<pre>
|!Name      |Quietist Ideologists|
|!Origin    |Ideology|
!!!Leadership
Patriarch/Matriarch. A single leader determines doctrine for the entire religion, possibly in consultation with other clerics.
!!!Evolution
Quietism. The faith shuns the outside world and involvement with the affairs of nonbelievers. They prefer to keep to their own kind and avoid positions of wealth and power.!!!Notes
</pre>
</div>
<div title="Religion:QuietistMuslims" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:QuietistMuslims Origin:Islam" changecount="1">
<pre>
|!Name      |Quietist Muslims|
|!Origin    |Islam|
!!!Leadership
No universal leadership. Each region governs itself differently.
!!!Evolution
Quietism. The faith shuns the outside world and involvement with the affairs of nonbelievers. They prefer to keep to their own kind and avoid positions of wealth and power.!!!Notes
</pre>
</div>
<div title="Religion:NewBookMuslims" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:NewBookMuslims Origin:Islam" changecount="1">
<pre>
|!Name      |New Book Muslims|
|!Origin    |Islam|
!!!Leadership
No universal leadership. Each region governs itself differently.
!!!Evolution
New holy book. Someone in the faith's past penned or discovered a text that is now taken to be holy writ and the expressed will of the divine.!!!Notes
</pre>
</div>
<div title="Religion:NeofundamentalistMuslims" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:NeofundamentalistMuslims Origin:Islam" changecount="1">
<pre>
|!Name      |Neofundamentalist Muslims|
|!Origin    |Islam|
!!!Leadership
Patriarch/Matriarch. A single leader determines doctrine for the entire religion, possibly in consultation with other clerics.
!!!Evolution
Neofundamentalism. The faith is fiercely resistant to perceived innovations and deviations from their beliefs. Even extremely onerous traditions and restrictions will be observed to the letter.!!!Notes
</pre>
</div>
<div title="Religion:HolyFamilyMuslims" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:HolyFamilyMuslims Origin:Islam" changecount="1">
<pre>
|!Name      |Holy Family Muslims|
|!Origin    |Islam|
!!!Leadership
No universal leadership. Each region governs itself differently.
!!!Evolution
Holy family. God's favor has been shown especially to members of a particular lineage. It may be that only men and women of this bloodline are permitted to become clergy, or they may serve as helpless figureheads for the real leaders of the faith.!!!Notes
</pre>
</div>
<div title="Religion:SeparatistJudaism" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:SeparatistJudaism Origin:Judaism" changecount="1">
<pre>
|!Name      |Separatist Judaism|
|!Origin    |Judaism|
!!!Leadership
Democracy. Every member has an equal voice in matters of faith, with doctrine usually decided at regular church-wide councils.
!!!Evolution
Schism. The faith's beliefs are actually almost identical to those of the majority of its origin tradition, save for a few minor points of vital interest to theologians and no practical difference whatsoever to believers. This does not prevent a burning resentment towards the parent faith.!!!Notes
</pre>
</div>
<div title="Religion:SacrificialJudaism" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:SacrificialJudaism Origin:Judaism" changecount="1">
<pre>
|!Name      |Sacrificial Judaism|
|!Origin    |Judaism|
!!!Leadership
Patriarch/Matriarch. A single leader determines doctrine for the entire religion, possibly in consultation with other clerics.
!!!Evolution
Sacrifices. The faith finds it necessary to make substantial sacrifices to please God. Some faiths may go so far as to offer human sacrifices, while others insist on huge tithes offered to the building of religious edifices.!!!Notes
</pre>
</div>
<div title="Religion:NewBookJudaism" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:NewBookJudaism Origin:Judaism" changecount="1">
<pre>
|!Name      |New Book Judaism|
|!Origin    |Judaism|
!!!Leadership
Democracy. Every member has an equal voice in matters of faith, with doctrine usually decided at regular church-wide councils.
!!!Evolution
New holy book. Someone in the faith's past penned or discovered a text that is now taken to be holy writ and the expressed will of the divine.!!!Notes
</pre>
</div>
<div title="Religion:NeofundamentalistJudaism" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:NeofundamentalistJudaism Origin:Judaism" changecount="1">
<pre>
|!Name      |Neofundamentalist Judaism|
|!Origin    |Judaism|
!!!Leadership
Democracy. Every member has an equal voice in matters of faith, with doctrine usually decided at regular church-wide councils.
!!!Evolution
Neofundamentalism. The faith is fiercely resistant to perceived innovations and deviations from their beliefs. Even extremely onerous traditions and restrictions will be observed to the letter.!!!Notes
</pre>
</div>
<div title="Religion:SyncreticProtestantPagans" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:SyncreticProtestantPagans Origin:Paganism" changecount="1">
<pre>
|!Name      |Syncretic Protestant Pagans|
|!Origin    |Paganism|
!!!Leadership
Patriarch/Matriarch. A single leader determines doctrine for the entire religion, possibly in consultation with other clerics.
!!!Evolution
Syncretism. This faith has reconciled the major elements of both of its origin beliefs into its tradition.!!!Notes
</pre>
</div>
<div title="Religion:NewBookProtestantChristians" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:NewBookProtestantChristians Origin:ProtestantChristianity" changecount="1">
<pre>
|!Name      |New Book Protestant Christians|
|!Origin    |Protestant Christianity|
!!!Leadership
Council. A group of the oldest and most revered clergy determine the course of the faith.
!!!Evolution
New holy book. Someone in the faith's past penned or discovered a text that is now taken to be holy writ and the expressed will of the divine.!!!Notes
</pre>
</div>
<div title="Religion:NewProphetProtestantChristians" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:NewProphetProtestantChristians Origin:ProtestantChristianity" changecount="1">
<pre>
|!Name      |New Prophet Protestant Christians|
|!Origin    |Protestant Christianity|
!!!Leadership
Patriarch/Matriarch. A single leader determines doctrine for the entire religion, possibly in consultation with other clerics.
!!!Evolution
New prophet. This faith reveres the words and example of a relatively recent prophet, esteeming him or her as the final word on the will of God. The prophet may or may not still be living.!!!Notes
</pre>
</div>
<div title="Religion:SyncreticJewishProtestantChristians" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:SyncreticJewishProtestantChristians Origin:ProtestantChristianity" changecount="1">
<pre>
|!Name      |Syncretic Jewish Protestant Christians|
|!Origin    |Protestant Christianity|
!!!Leadership
Patriarch/Matriarch. A single leader determines doctrine for the entire religion, possibly in consultation with other clerics.
!!!Evolution
Syncretism. This faith has reconciled the major elements of both of its origin beliefs into its tradition.!!!Notes
</pre>
</div>
<div title="Religion:QuietistProtestantChristians" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:QuietistProtestantChristians Origin:ProtestantChristianity" changecount="1">
<pre>
|!Name      |Quietist Protestant Christians|
|!Origin    |Protestant Christianity|
!!!Leadership
Patriarch/Matriarch. A single leader determines doctrine for the entire religion, possibly in consultation with other clerics.
!!!Evolution
Quietism. The faith shuns the outside world and involvement with the affairs of nonbelievers. They prefer to keep to their own kind and avoid positions of wealth and power.!!!Notes
</pre>
</div>
<div title="Religion:NeofundamentalistRomanCatholics" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:NeofundamentalistRomanCatholics Origin:RomanCatholicism" changecount="1">
<pre>
|!Name      |Neofundamentalist Roman Catholics|
|!Origin    |Roman Catholicism|
!!!Leadership
Patriarch/Matriarch. A single leader determines doctrine for the entire religion, possibly in consultation with other clerics.
!!!Evolution
Neofundamentalism. The faith is fiercely resistant to perceived innovations and deviations from their beliefs. Even extremely onerous traditions and restrictions will be observed to the letter.!!!Notes
</pre>
</div>
<div title="Religion:HolyFamilyZoroastrianists" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:HolyFamilyZoroastrianists Origin:Zoroastrianism" changecount="1">
<pre>
|!Name      |Holy Family Zoroastrianists|
|!Origin    |Zoroastrianism|
!!!Leadership
Democracy. Every member has an equal voice in matters of faith, with doctrine usually decided at regular church-wide councils.
!!!Evolution
Holy family. God's favor has been shown especially to members of a particular lineage. It may be that only men and women of this bloodline are permitted to become clergy, or they may serve as helpless figureheads for the real leaders of the faith.!!!Notes
</pre>
</div>
<div title="Religion:NewProphetZoroastrianists" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Religion:NewProphetZoroastrianists Origin:Zoroastrianism" changecount="1">
<pre>
|!Name      |New Prophet Zoroastrianists|
|!Origin    |Zoroastrianism|
!!!Leadership
Democracy. Every member has an equal voice in matters of faith, with doctrine usually decided at regular church-wide councils.
!!!Evolution
New prophet. This faith reveres the words and example of a relatively recent prophet, esteeming him or her as the final word on the will of God. The prophet may or may not still be living.!!!Notes
</pre>
</div>
<div title="Origin:Ideology" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Origin:Confucianism" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Origin:RomanCatholicism" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Origin:Judaism" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Origin:Buddhism" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Origin:Islam" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Origin:EasternOrthodoxChristianity" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Origin:ProtestantChristianity" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Origin:Paganism" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Origin:Zoroastrianism" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre></pre>
</div>
<div title="Political Groups" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>
|!Organization|!Leadership|!Policy|!Outsiders|!Issues|h
|[[Bear Guild|Group:BearGuild]]|Social elite|Laissez-faire|Xenophilia|Industry, Gender Roles|
|[[Carnelian Council|Group:CarnelianCouncil]]|Pious|Socialist|Xenophilia|Foreign Policy, Immigration|
|[[Cerium Group|Group:CeriumGroup]]|Pious|Communist|Xenophobic|Secession, Poverty|
|[[Cerulean Pact|Group:CeruleanPact]]|Rural|Protectionist|Provisional|Reform, Military|
|[[Conservative Combine|Group:ConservativeCombine]]|Social elite|Autarky|Xenophobic|Welfare, Religion|
|[[Democratic Brotherhood|Group:DemocraticBrotherhood]]|Urban|Protectionist|Xenophilia|Military, Welfare|
|[[Freedom Party|Group:FreedomParty]]|Intellectuals|Protectionist|Xenophilia|Secession, Religion|
|[[Homeland Combine|Group:HomelandCombine]]|Urban|Laissez-faire|Xenophilia|Religion, Military|
|[[Iron Combine|Group:IronCombine]]|Bourgeoisie|Laissez-faire|Provisional|Tradition, Bigotry|
|[[Liberal Society|Group:LiberalSociety]]|Proletariat|Autarky|Provisional|Foreign Policy, Tradition|
|[[Liberty Sodality|Group:LibertySodality]]|Proletariat|Autarky|Xenophobic|Military, Tradition|
|[[National Sodality|Group:NationalSodality]]|Intellectuals|Autarky|Provisional|Secession, Immigration|
|[[Neodymium Commune|Group:NeodymiumCommune]]|Social elite|Laissez-faire|Xenophilia|Welfare, Poverty|
|[[Northwest Faction|Group:NorthwestFaction]]|Proletariat|Protectionist|Xenophobic|Poverty, Reform|
|[[People's Banner|Group:People'sBanner]]|Intellectuals|State industry|Provisional|Welfare, Industry|
|[[Popular Element|Group:PopularElement]]|Urban|Laissez-faire|Provisional|Religion, Gender Roles|
|[[Progressive Element|Group:ProgressiveElement]]|Proletariat|Socialist|Provisional|Bigotry, Welfare|
|[[Republican Guild|Group:RepublicanGuild]]|Bourgeoisie|Laissez-faire|Provisional|Industry, Foreign Policy|
|[[Royal Brotherhood|Group:RoyalBrotherhood]]|Intellectuals|State industry|Provisional|Industry, Tradition|
|[[Social Group|Group:SocialGroup]]|Bourgeoisie|State industry|Xenophilia|Secession, Foreign Policy|
|[[Unified Union|Group:UnifiedUnion]]|Social elite|Laissez-faire|Provisional|Religion, Bigotry|
|[[Vermilion Council|Group:VermilionCouncil]]|Proletariat|State industry|Xenophobic|Gender Roles, Welfare|
|[[Victory Union|Group:VictoryUnion]]|Bourgeoisie|Autarky|Xenophobic|Gender Roles, Immigration|
|[[West Sodality|Group:WestSodality]]|Rural|Socialist|Xenophobic|Gender Roles, Bigotry|
</pre>
</div>
<div title="Group:BearGuild" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:BearGuild Ideology:Laissez-faire Issue:Industry Issue:GenderRoles" changecount="1">
<pre>
|!Name      |Bear Guild|
!!!Ideology
Laissez-faire: minimal or no government intervention in the market.
!!!Leadership
Social elite: the group is led by members of the planet's ruling class.
!!!Key Issues
* The memberships' important industries.
* Gender roles and sexual mores.

!!!Relationship toward Outsiders
Xenophilia: the more immigrants the better, as they provide valuable labor and skills.
!!!Notes
</pre>
</div>
<div title="Group:CarnelianCouncil" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:CarnelianCouncil Ideology:Socialist Issue:ForeignPolicy Issue:Immigration" changecount="1">
<pre>
|!Name      |Carnelian Council|
!!!Ideology
Socialist: the market should be harnessed to ensure a state-determined minimal standard of living for all.
!!!Leadership
Pious: clergy and devout laymen of a religion form the leadership.
!!!Key Issues
* Foreign relations.
* Immigration and immigrants.

!!!Relationship toward Outsiders
Xenophilia: the more immigrants the better, as they provide valuable labor and skills.
!!!Notes
</pre>
</div>
<div title="Group:CeriumGroup" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:CeriumGroup Ideology:Communist Issue:Secession Issue:Poverty" changecount="1">
<pre>
|!Name      |Cerium Group|
!!!Ideology
Communist: the state should control the economy, disbursing its products according to need and determined efficiency.
!!!Leadership
Pious: clergy and devout laymen of a religion form the leadership.
!!!Key Issues
* Secession.
* Poverty among the group's membership.

!!!Relationship toward Outsiders
Xenophobic: immigration is to be restricted to protect native jobs and culture.
!!!Notes
</pre>
</div>
<div title="Group:CeruleanPact" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:CeruleanPact Ideology:Protectionist Issue:Reform Issue:Military" changecount="1">
<pre>
|!Name      |Cerulean Pact|
!!!Ideology
Protectionist: the government should tax imports that threaten to displace the products of local manufacturers.
!!!Leadership
Rural: farmers, herdsmen, small-town artisans, and other residents of the rural zones of a planet make up the leadership of the group.
!!!Key Issues
* Governmental reform.
* Military preparedness.

!!!Relationship toward Outsiders
Provisional: some immigrants are to be encouraged, others to be forbidden. Which is which depends on the interests of the group.
!!!Notes
</pre>
</div>
<div title="Group:ConservativeCombine" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:ConservativeCombine Ideology:Autarky Issue:Welfare Issue:Religion" changecount="1">
<pre>
|!Name      |Conservative Combine|
!!!Ideology
Autarky: the government should ensure that the world can provide all of its own goods and services and forbid the import of foreign goods.
!!!Leadership
Social elite: the group is led by members of the planet's ruling class.
!!!Key Issues
* Wealth redistribution.
* Religion in public life.

!!!Relationship toward Outsiders
Xenophobic: immigration is to be restricted to protect native jobs and culture.
!!!Notes
</pre>
</div>
<div title="Group:DemocraticBrotherhood" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:DemocraticBrotherhood Ideology:Protectionist Issue:Military Issue:Welfare" changecount="1">
<pre>
|!Name      |Democratic Brotherhood|
!!!Ideology
Protectionist: the government should tax imports that threaten to displace the products of local manufacturers.
!!!Leadership
Urban: city-dwellers compose the leadership of the group.
!!!Key Issues
* Military preparedness.
* Wealth redistribution.

!!!Relationship toward Outsiders
Xenophilia: the more immigrants the better, as they provide valuable labor and skills.
!!!Notes
</pre>
</div>
<div title="Group:FreedomParty" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:FreedomParty Ideology:Protectionist Issue:Secession Issue:Religion" changecount="1">
<pre>
|!Name      |Freedom Party|
!!!Ideology
Protectionist: the government should tax imports that threaten to displace the products of local manufacturers.
!!!Leadership
Intellectuals: the movement is led by intellectuals.
!!!Key Issues
* Secession.
* Religion in public life.

!!!Relationship toward Outsiders
Xenophilia: the more immigrants the better, as they provide valuable labor and skills.
!!!Notes
</pre>
</div>
<div title="Group:HomelandCombine" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:HomelandCombine Ideology:Laissez-faire Issue:Religion Issue:Military" changecount="1">
<pre>
|!Name      |Homeland Combine|
!!!Ideology
Laissez-faire: minimal or no government intervention in the market.
!!!Leadership
Urban: city-dwellers compose the leadership of the group.
!!!Key Issues
* Religion in public life.
* Military preparedness.

!!!Relationship toward Outsiders
Xenophilia: the more immigrants the better, as they provide valuable labor and skills.
!!!Notes
</pre>
</div>
<div title="Group:IronCombine" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:IronCombine Ideology:Laissez-faire Issue:Tradition Issue:Bigotry" changecount="1">
<pre>
|!Name      |Iron Combine|
!!!Ideology
Laissez-faire: minimal or no government intervention in the market.
!!!Leadership
Bourgeoisie: the group is driven by a leadership drawn from the middle class and those aspiring to join the elite.
!!!Key Issues
* Culture of the group membership.
* Social hostility to the group's membership.

!!!Relationship toward Outsiders
Provisional: some immigrants are to be encouraged, others to be forbidden. Which is which depends on the interests of the group.
!!!Notes
</pre>
</div>
<div title="Group:LiberalSociety" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:LiberalSociety Ideology:Autarky Issue:ForeignPolicy Issue:Tradition" changecount="1">
<pre>
|!Name      |Liberal Society|
!!!Ideology
Autarky: the government should ensure that the world can provide all of its own goods and services and forbid the import of foreign goods.
!!!Leadership
Proletariat: the working class, both agricultural and industrial, provides the leadership for this group.
!!!Key Issues
* Foreign relations.
* Culture of the group membership.

!!!Relationship toward Outsiders
Provisional: some immigrants are to be encouraged, others to be forbidden. Which is which depends on the interests of the group.
!!!Notes
</pre>
</div>
<div title="Group:LibertySodality" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:LibertySodality Ideology:Autarky Issue:Military Issue:Tradition" changecount="1">
<pre>
|!Name      |Liberty Sodality|
!!!Ideology
Autarky: the government should ensure that the world can provide all of its own goods and services and forbid the import of foreign goods.
!!!Leadership
Proletariat: the working class, both agricultural and industrial, provides the leadership for this group.
!!!Key Issues
* Military preparedness.
* Culture of the group membership.

!!!Relationship toward Outsiders
Xenophobic: immigration is to be restricted to protect native jobs and culture.
!!!Notes
</pre>
</div>
<div title="Group:NationalSodality" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:NationalSodality Ideology:Autarky Issue:Secession Issue:Immigration" changecount="1">
<pre>
|!Name      |National Sodality|
!!!Ideology
Autarky: the government should ensure that the world can provide all of its own goods and services and forbid the import of foreign goods.
!!!Leadership
Intellectuals: the movement is led by intellectuals.
!!!Key Issues
* Secession.
* Immigration and immigrants.

!!!Relationship toward Outsiders
Provisional: some immigrants are to be encouraged, others to be forbidden. Which is which depends on the interests of the group.
!!!Notes
</pre>
</div>
<div title="Group:NeodymiumCommune" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:NeodymiumCommune Ideology:Laissez-faire Issue:Welfare Issue:Poverty" changecount="1">
<pre>
|!Name      |Neodymium Commune|
!!!Ideology
Laissez-faire: minimal or no government intervention in the market.
!!!Leadership
Social elite: the group is led by members of the planet's ruling class.
!!!Key Issues
* Wealth redistribution.
* Poverty among the group's membership.

!!!Relationship toward Outsiders
Xenophilia: the more immigrants the better, as they provide valuable labor and skills.
!!!Notes
</pre>
</div>
<div title="Group:NorthwestFaction" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:NorthwestFaction Ideology:Protectionist Issue:Poverty Issue:Reform" changecount="1">
<pre>
|!Name      |Northwest Faction|
!!!Ideology
Protectionist: the government should tax imports that threaten to displace the products of local manufacturers.
!!!Leadership
Proletariat: the working class, both agricultural and industrial, provides the leadership for this group.
!!!Key Issues
* Poverty among the group's membership.
* Governmental reform.

!!!Relationship toward Outsiders
Xenophobic: immigration is to be restricted to protect native jobs and culture.
!!!Notes
</pre>
</div>
<div title="Group:People'sBanner" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:People'sBanner Ideology:StateIndustry Issue:Welfare Issue:Industry" changecount="1">
<pre>
|!Name      |People's Banner|
!!!Ideology
State industry: the government should own or support specific industries important to the group.
!!!Leadership
Intellectuals: the movement is led by intellectuals.
!!!Key Issues
* Wealth redistribution.
* The memberships' important industries.

!!!Relationship toward Outsiders
Provisional: some immigrants are to be encouraged, others to be forbidden. Which is which depends on the interests of the group.
!!!Notes
</pre>
</div>
<div title="Group:PopularElement" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:PopularElement Ideology:Laissez-faire Issue:Religion Issue:GenderRoles" changecount="1">
<pre>
|!Name      |Popular Element|
!!!Ideology
Laissez-faire: minimal or no government intervention in the market.
!!!Leadership
Urban: city-dwellers compose the leadership of the group.
!!!Key Issues
* Religion in public life.
* Gender roles and sexual mores.

!!!Relationship toward Outsiders
Provisional: some immigrants are to be encouraged, others to be forbidden. Which is which depends on the interests of the group.
!!!Notes
</pre>
</div>
<div title="Group:ProgressiveElement" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:ProgressiveElement Ideology:Socialist Issue:Bigotry Issue:Welfare" changecount="1">
<pre>
|!Name      |Progressive Element|
!!!Ideology
Socialist: the market should be harnessed to ensure a state-determined minimal standard of living for all.
!!!Leadership
Proletariat: the working class, both agricultural and industrial, provides the leadership for this group.
!!!Key Issues
* Social hostility to the group's membership.
* Wealth redistribution.

!!!Relationship toward Outsiders
Provisional: some immigrants are to be encouraged, others to be forbidden. Which is which depends on the interests of the group.
!!!Notes
</pre>
</div>
<div title="Group:RepublicanGuild" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:RepublicanGuild Ideology:Laissez-faire Issue:Industry Issue:ForeignPolicy" changecount="1">
<pre>
|!Name      |Republican Guild|
!!!Ideology
Laissez-faire: minimal or no government intervention in the market.
!!!Leadership
Bourgeoisie: the group is driven by a leadership drawn from the middle class and those aspiring to join the elite.
!!!Key Issues
* The memberships' important industries.
* Foreign relations.

!!!Relationship toward Outsiders
Provisional: some immigrants are to be encouraged, others to be forbidden. Which is which depends on the interests of the group.
!!!Notes
</pre>
</div>
<div title="Group:RoyalBrotherhood" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:RoyalBrotherhood Ideology:StateIndustry Issue:Industry Issue:Tradition" changecount="1">
<pre>
|!Name      |Royal Brotherhood|
!!!Ideology
State industry: the government should own or support specific industries important to the group.
!!!Leadership
Intellectuals: the movement is led by intellectuals.
!!!Key Issues
* The memberships' important industries.
* Culture of the group membership.

!!!Relationship toward Outsiders
Provisional: some immigrants are to be encouraged, others to be forbidden. Which is which depends on the interests of the group.
!!!Notes
</pre>
</div>
<div title="Group:SocialGroup" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:SocialGroup Ideology:StateIndustry Issue:Secession Issue:ForeignPolicy" changecount="1">
<pre>
|!Name      |Social Group|
!!!Ideology
State industry: the government should own or support specific industries important to the group.
!!!Leadership
Bourgeoisie: the group is driven by a leadership drawn from the middle class and those aspiring to join the elite.
!!!Key Issues
* Secession.
* Foreign relations.

!!!Relationship toward Outsiders
Xenophilia: the more immigrants the better, as they provide valuable labor and skills.
!!!Notes
</pre>
</div>
<div title="Group:UnifiedUnion" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:UnifiedUnion Ideology:Laissez-faire Issue:Religion Issue:Bigotry" changecount="1">
<pre>
|!Name      |Unified Union|
!!!Ideology
Laissez-faire: minimal or no government intervention in the market.
!!!Leadership
Social elite: the group is led by members of the planet's ruling class.
!!!Key Issues
* Religion in public life.
* Social hostility to the group's membership.

!!!Relationship toward Outsiders
Provisional: some immigrants are to be encouraged, others to be forbidden. Which is which depends on the interests of the group.
!!!Notes
</pre>
</div>
<div title="Group:VermilionCouncil" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:VermilionCouncil Ideology:StateIndustry Issue:GenderRoles Issue:Welfare" changecount="1">
<pre>
|!Name      |Vermilion Council|
!!!Ideology
State industry: the government should own or support specific industries important to the group.
!!!Leadership
Proletariat: the working class, both agricultural and industrial, provides the leadership for this group.
!!!Key Issues
* Gender roles and sexual mores.
* Wealth redistribution.

!!!Relationship toward Outsiders
Xenophobic: immigration is to be restricted to protect native jobs and culture.
!!!Notes
</pre>
</div>
<div title="Group:VictoryUnion" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:VictoryUnion Ideology:Autarky Issue:GenderRoles Issue:Immigration" changecount="1">
<pre>
|!Name      |Victory Union|
!!!Ideology
Autarky: the government should ensure that the world can provide all of its own goods and services and forbid the import of foreign goods.
!!!Leadership
Bourgeoisie: the group is driven by a leadership drawn from the middle class and those aspiring to join the elite.
!!!Key Issues
* Gender roles and sexual mores.
* Immigration and immigrants.

!!!Relationship toward Outsiders
Xenophobic: immigration is to be restricted to protect native jobs and culture.
!!!Notes
</pre>
</div>
<div title="Group:WestSodality" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Group:WestSodality Ideology:Socialist Issue:GenderRoles Issue:Bigotry" changecount="1">
<pre>
|!Name      |West Sodality|
!!!Ideology
Socialist: the market should be harnessed to ensure a state-determined minimal standard of living for all.
!!!Leadership
Rural: farmers, herdsmen, small-town artisans, and other residents of the rural zones of a planet make up the leadership of the group.
!!!Key Issues
* Gender roles and sexual mores.
* Social hostility to the group's membership.

!!!Relationship toward Outsiders
Xenophobic: immigration is to be restricted to protect native jobs and culture.
!!!Notes
</pre>
</div>
<div title="Ideology:Autarky" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Autarky'':  the government should ensure that the world can provide all of its own goods and services and forbid the import of foreign goods.</pre>
</div>
<div title="Ideology:Laissez-faire" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Laissez-faire'':  minimal or no government intervention in the market.</pre>
</div>
<div title="Ideology:Protectionist" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Protectionist'':  the government should tax imports that threaten to displace the products of local manufacturers.</pre>
</div>
<div title="Ideology:Socialist" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Socialist'':  the market should be harnessed to ensure a state-determined minimal standard of living for all.</pre>
</div>
<div title="Ideology:StateIndustry" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''State industry'':  the government should own or support specific industries important to the group.</pre>
</div>
<div title="Ideology:Communist" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Communist'':  the state should control the economy, disbursing its products according to need and determined efficiency.</pre>
</div>
<div title="Issue:Reform" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>Governmental reform.</pre>
</div>
<div title="Issue:Industry" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>The memberships' important industries.</pre>
</div>
<div title="Issue:Religion" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>Religion in public life.</pre>
</div>
<div title="Issue:Poverty" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>Poverty among the group's membership.</pre>
</div>
<div title="Issue:GenderRoles" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>Gender roles and sexual mores.</pre>
</div>
<div title="Issue:Welfare" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>Wealth redistribution.</pre>
</div>
<div title="Issue:ForeignPolicy" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>Foreign relations.</pre>
</div>
<div title="Issue:Bigotry" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>Social hostility to the group's membership.</pre>
</div>
<div title="Issue:Military" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>Military preparedness.</pre>
</div>
<div title="Issue:Secession" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>Secession.</pre>
</div>
<div title="Issue:Tradition" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>Culture of the group membership.</pre>
</div>
<div title="Issue:Immigration" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>Immigration and immigrants.</pre>
</div>
<div title="Alien Races" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>
|!Name|!Body Type|h
|[[Bel |Alien:Bel]]|Reptilian|
|[[Dhay |Alien:Dhay]]|Hybrid: Avian and Exotic|
|[[Dhog |Alien:Dhog]]|Humanlike|
|[[Kaun |Alien:Kaun]]|Reptilian|
|[[Leb |Alien:Leb]]|Exotic|
|[[LoDDaj |Alien:Loddaj]]|Reptilian|
|[[Omelang|Alien:Omelang]]|Insectile|
|[[Sandus |Alien:Sandus]]|Avian|
|[[Tea |Alien:Tea]]|Exotic|
|[[Thak |Alien:Thak]]|Hybrid: Humanlike and Reptilian|
</pre>
</div>
<div title="Alien:Bel" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Alien:Bel Body:Reptilian" changecount="1">
<pre>
|!Name      |Bel |
|!Body Type |Reptilian|
!!!Distinguishing Features
* Warm-blooded
* Horns or body spikes
!!!Notes
</pre>
</div>
<div title="Alien:Dhay" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Alien:Dhay Body:Hybrid" changecount="1">
<pre>
|!Name      |Dhay |
|!Body Type |Hybrid: Avian and Exotic|
!!!Distinguishing Features
* Scales instead of feathers
* Uses sonic attacks to stun prey
!!!Notes
</pre>
</div>
<div title="Alien:Dhog" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Alien:Dhog Body:Humanlike" changecount="1">
<pre>
|!Name      |Dhog |
|!Body Type |Humanlike|
!!!Distinguishing Features
* Stench glands
* Expands or inflates when threatened
!!!Notes
</pre>
</div>
<div title="Alien:Kaun" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Alien:Kaun Body:Reptilian" changecount="1">
<pre>
|!Name      |Kaun |
|!Body Type |Reptilian|
!!!Distinguishing Features
* Furred
* 2 pairs of eyes
!!!Notes
</pre>
</div>
<div title="Alien:Leb" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Alien:Leb Body:Exotic" changecount="1">
<pre>
|!Name      |Leb |
|!Body Type |Exotic|
!!!Distinguishing Features
* Gelatinous liquid body
* Double damage from a particular type of injury
!!!Notes
</pre>
</div>
<div title="Alien:Loddaj" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Alien:Loddaj Body:Reptilian" changecount="1">
<pre>
|!Name      |LoDDaj |
|!Body Type |Reptilian|
!!!Distinguishing Features
* Burrowing foreclaws
* Glowing body parts
!!!Notes
</pre>
</div>
<div title="Alien:Omelang" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Alien:Omelang Body:Insectile" changecount="1">
<pre>
|!Name      |Omelang|
|!Body Type |Insectile|
!!!Distinguishing Features
* Emits powerful pheromones
* Has "silk" spinnerets
!!!Notes
</pre>
</div>
<div title="Alien:Sandus" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Alien:Sandus Body:Avian" changecount="1">
<pre>
|!Name      |Sandus |
|!Body Type |Avian|
!!!Distinguishing Features
* Toothed beak
* Flies by means of lighter-than-air gas
!!!Notes
</pre>
</div>
<div title="Alien:Tea" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Alien:Tea Body:Exotic" changecount="1">
<pre>
|!Name      |Tea |
|!Body Type |Exotic|
!!!Distinguishing Features
* Gas-sack body
* 16 tentacles
!!!Notes
</pre>
</div>
<div title="Alien:Thak" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" tags="Alien:Thak Body:Hybrid" changecount="1">
<pre>
|!Name      |Thak |
|!Body Type |Hybrid: Humanlike and Reptilian|
!!!Distinguishing Features
* Stench glands
* Burrowing foreclaws
!!!Notes
</pre>
</div>
<div title="Body:Insectile" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Insectile'': Insectile aliens are usually possessed of chitinous "skin" and one or more pairs of compound eyes. Membranous wings aren’t unknown, but are probably vestigial and useless on all but the smallest or lightest aliens. Insectile aliens might have sucking mouthparts if their primary food source is plant sap- or blood- or might use chewing mandibles instead for a more solid diet. Insectile aliens that function as a hive collective are something of a classic trope, but there’s no reason that a species can’t instead take after more solitary hunting insects such as beetles or spiders.</pre>
</div>
<div title="Body:Reptilian" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Reptilian'': Reptilian aliens can range from the classic "lizard man" look to a more subtle combination of pebble-scaled skin, membrane frills, broad bodies, cold-bloodedness, nictitating membranes, an exceptional sense of smell, thick claws, powerful builds, sharp teeth, and fine scales. Bodies may be broad and thick like that of a lizard, or perhaps sinuous like that of a snake. Reptilian aliens might be found especially on damp, watery worlds, and might be outright amphibious over all or part of their life spans.</pre>
</div>
<div title="Body:Humanlike" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Humanlike'': Humanlike aliens are just that; extremely close to humans in outward appearance. They might have unusual skin or hair coloration, different hair growth distributions, an odd number of fingers, cranial ridges, a novel skin texture, variant ear shapes, or different average body builds or sizes, but they largely appear like humans. Xenobiologists postulate that the human shape is simply a very successful evolutionary route on Earth-like planets, and other worlds with similar conditions are likely to produce similar sapients. Crank scientists tend to favor theories of pan-galactic Creators that spread humanlike shapes throughout space; these theories conspicuously fail to take into account the dramatically different DNA and internal organ makeup of many humanlike aliens.</pre>
</div>
<div title="Body:Hybrid" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Hybrid''</pre>
</div>
<div title="Body:Exotic" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Exotic'': Exotic aliens are built out of parts and materials that aren't normally found in Terran life forms. A humanoid might be composed out of a kind of organic plastic that makes up much of their home planet's biochemistry, or be composed of an intricate array of interlocking crystals and woody organic elements. You should pick one or more materials that aren't normally part of an animal's body and have them play a major role in the alien's biology. As a consequence, this kind of alien is probably highly dependent upon their home world for food and other biological necessities. If not, they likely spend a lot of effort synthesizing vital materials out of local supplies.</pre>
</div>
<div title="Body:Avian" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>''Avian'': Avian aliens favor birdlike features. Feathered tails, wings, beaks, drastic coloring differences between males and females, skin either partially or fully covered in feathers, hollow bones, and clawed feet and hands are all traits that might be present in an avian-flavored alien. Such avians might have remarkably good vision or show unusual talent as pilots thanks to an evolutionary predilection for thinking in three dimensions.</pre>
</div>

<div title="StarMap" modifier="SWN Sector Generator" created="201705170934" tags="attachment excludeMissing" changecount="1">
<pre>!usage
{{{[img[StarMap]]}}}
[img[StarMap]]
!notes
Star map for sector Hades Theta
!type
image/png
!file

!url

!data
data:image/png;base64,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
</pre>
</div>
<div title="StarMapLinks" creator="SWN Sector Generator" modifier="SWN Sector Generator" created="201705170934" changecount="1">
<pre>System:CAXIAS
174,47,174,32,189,32,189,47,200,50,200,60,161,60,161,50,174,47
----
System:PORPUROGENITOS
444,47,444,32,459,32,459,47,494,50,494,60,407,60,407,50,444,47
----
System:BADRIYYAH
106,163,106,148,121,148,121,163,141,166,141,176,84,176,84,166,106,163
----
System:PRIAM
174,125,174,110,189,110,189,125,196,128,196,138,164,138,164,128,174,125
----
System:SHAINA
309,125,309,110,324,110,324,125,335,128,335,138,296,138,296,128,309,125
----
System:MAGANAS
444,125,444,110,459,110,459,125,473,128,473,138,428,138,428,128,444,125
----
System:GHALIYAH
511,163,511,148,526,148,526,163,543,166,543,176,492,176,492,166,511,163
----
System:DOXIADIS
106,241,106,226,121,226,121,241,138,244,138,254,87,254,87,244,106,241
----
System:PELASGON
309,281,309,266,324,266,324,281,341,284,341,294,290,294,290,284,309,281
----
System:ERROSALI
39,359,39,344,54,344,54,359,71,362,71,372,20,372,20,362,39,359
----
System:KARTIK
309,359,309,344,324,344,324,359,335,362,335,372,296,372,296,362,309,359
----
System:MADHAVI
376,397,376,382,391,382,391,397,405,400,405,410,360,410,360,400,376,397
----
System:MADARI
39,437,39,422,54,422,54,437,65,440,65,450,26,450,26,440,39,437
----
System:GAZTAIN
174,437,174,422,189,422,189,437,203,440,203,450,158,450,158,440,174,437
----
System:AINTZANE
376,475,376,460,391,460,391,475,408,478,408,488,357,488,357,478,376,475
----
System:ONDITZ
444,437,444,422,459,422,459,437,470,440,470,450,431,450,431,440,444,437
----
System:JALA
106,553,106,538,121,538,121,553,125,556,125,566,99,566,99,556,106,553
----
System:ADONIE
241,553,241,538,256,538,256,553,267,556,267,566,228,566,228,556,241,553
----
System:ACTORIS
309,515,309,500,324,500,324,515,338,518,338,528,293,528,293,518,309,515
----
System:ARAITZ
444,515,444,500,459,500,459,515,470,518,470,528,431,528,431,518,444,515
----
System:ASTRID
511,553,511,538,526,538,526,553,537,556,537,566,498,566,498,556,511,553
----
System:THORBJORG
106,709,106,694,121,694,121,709,141,712,141,722,84,722,84,712,106,709
----
System:SHUBHA
174,749,174,734,189,734,189,749,200,752,200,762,161,762,161,752,174,749
----
System:ANITA
376,787,376,772,391,772,391,787,398,790,398,800,366,800,366,790,376,787
</pre>
</div>
<div title="ToggleRightSidebar" modifier="ELSDesignStudios" created="200607182328" modified="200909262139" tags="transclusion bookmarklet" server.type="file" server.host="http://www.tiddlytools.com" server.page.revision="200909262139">
<pre>/%
!info
|Name|ToggleRightSidebar|
|Source|http://www.TiddlyTools.com/#ToggleRightSidebar|
|Version|2.0.0|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|transclusion|
|Description|show/hide right sidebar (SideBarOptions)|
Usage
&lt;&lt;&lt;
{{{
&lt;&lt;tiddler ToggleRightSidebar&gt;&gt;
&lt;&lt;tiddler ToggleRightSidebar with: label tooltip&gt;&gt;
}}}
Try it: &lt;&lt;tiddler ToggleRightSidebar##show
	with: {{config.options.chkShowRightSidebar?'►':'◄'}}&gt;&gt;
&lt;&lt;&lt;
Configuration:
&lt;&lt;&lt;
copy/paste the following settings into a tiddler tagged with &lt;&lt;tag systemConfig&gt;&gt; and then modify the values to suit your preferences:
{{{
config.options.chkShowRightSidebar=true;
config.options.txtToggleRightSideBarLabelShow=&quot;◄&quot;;
config.options.txtToggleRightSideBarLabelHide=&quot;►&quot;;
}}}
&lt;&lt;&lt;
!end
!show
&lt;&lt;tiddler {{
	var co=config.options;
	if (co.chkShowRightSidebar===undefined) co.chkShowRightSidebar=true;
	var sb=document.getElementById('sidebar');
	var da=document.getElementById('displayArea');
	if (sb) {
		sb.style.display=co.chkShowRightSidebar?'block':'none';
		da.style.marginRight=co.chkShowRightSidebar?'':'1em';
	}
'';}}&gt;&gt;&lt;html&gt;&lt;nowiki&gt;&lt;a href='javascript:;' title=&quot;$2&quot;
onmouseover=&quot;
	this.href='javascript:void(eval(decodeURIComponent(%22(function(){try{('
	+encodeURIComponent(encodeURIComponent(this.onclick))
	+')()}catch(e){alert(e.description?e.description:e.toString())}})()%22)))';&quot;
onclick=&quot;
	var co=config.options;
	var opt='chkShowRightSidebar';
	var show=co[opt]=!co[opt];
	var sb=document.getElementById('sidebar');
	var da=document.getElementById('displayArea');
	if (sb) {
		sb.style.display=show?'block':'none';
		da.style.marginRight=show?'':'1em';
	}
	saveOptionCookie(opt);
	var labelShow=co.txtToggleRightSideBarLabelShow||'&amp;#x25C4;';
	var labelHide=co.txtToggleRightSideBarLabelHide||'&amp;#x25BA;';
	if (this.innerHTML==labelShow||this.innerHTML==labelHide) 
		this.innerHTML=show?labelHide:labelShow;
	this.title=(show?'hide':'show')+' right sidebar';
	var sm=document.getElementById('storyMenu');
	if (sm) config.refreshers.content(sm);
	return false;
&quot;&gt;$1&lt;/a&gt;&lt;/html&gt;
!end
%/&lt;&lt;tiddler {{
	var src='ToggleRightSidebar';
	src+(tiddler&amp;&amp;tiddler.title==src?'##info':'##show');
}} with: {{
	var co=config.options;
	var labelShow=co.txtToggleRightSideBarLabelShow||'&amp;#x25C4;';
	var labelHide=co.txtToggleRightSideBarLabelHide||'&amp;#x25BA;';
	'$1'!='$'+'1'?'$1':(co.chkShowRightSidebar?labelHide:labelShow);
}} {{
	var tip=(config.options.chkShowRightSidebar?'hide':'show')+' right sidebar';
	'$2'!='$'+'2'?'$2':tip;
}}&gt;&gt;</pre>
</div>
<div title="ToggleSidebarSettings" creator="SaqImtiaz" modifier="SaqImtiaz" created="201109081849" modified="201109081853" tags="systemConfig" changecount="4">
<pre>config.options.chkShowRightSidebar=false;
config.options.txtToggleRightSideBarLabelShow=&quot;◄&quot;;
config.options.txtToggleRightSideBarLabelHide=&quot;►&quot;;</pre>
</div>
</div>
<!--POST-STOREAREA-->
<!--POST-BODY-START-->
<!--POST-BODY-END-->
<script id="jsArea" type="text/javascript">
//<![CDATA[
//
// Please note:
//
// * This code is designed to be readable but for compactness it only includes brief comments. You can see fuller comments
//   in the project repository at https://github.com/TiddlyWiki/tiddlywiki
//
// * You should never need to modify this source code directly. TiddlyWiki is carefully designed to allow deep customisation
//   without changing the core code. Please consult the development group at http://groups.google.com/group/TiddlyWikiDev
//
// JSLint directives
/*global jQuery:false, version:false */
/*jslint bitwise:true, browser:true, confusion:true, eqeq:true, evil:true, forin:true, maxerr:100, plusplus:true, regexp:true, sloppy:true, sub:true, undef:true, unparam:true, vars:true, white:true */
//--
//-- Configuration repository
//--

// Miscellaneous options
var config = {
	numRssItems: 20, // Number of items in the RSS feed
	animDuration: 400, // Duration of UI animations in milliseconds
	cascadeFast: 20, // Speed for cascade animations (higher == slower)
	cascadeSlow: 60, // Speed for EasterEgg cascade animations
	cascadeDepth: 5, // Depth of cascade animation
	locale: "en" // W3C language tag
};

// Hashmap of alternative parsers for the wikifier
config.parsers = {};

// Adaptors
config.adaptors = {};
config.defaultAdaptor = null;

// Backstage tasks
config.tasks = {};

// Annotations
config.annotations = {};

// Custom fields to be automatically added to new tiddlers
config.defaultCustomFields = {};

// Messages
config.messages = {
	messageClose: {},
	dates: {},
	tiddlerPopup: {}
};

// Options that can be set in the options panel and/or cookies
config.options = {
	chkRegExpSearch: false,
	chkCaseSensitiveSearch: false,
	chkIncrementalSearch: true,
	chkAnimate: true,
	chkSaveBackups: true,
	chkAutoSave: false,
	chkGenerateAnRssFeed: false,
	chkSaveEmptyTemplate: false,
	chkOpenInNewWindow: true,
	chkToggleLinks: false,
	chkHttpReadOnly: true,
	chkForceMinorUpdate: false,
	chkConfirmDelete: true,
	chkInsertTabs: false,
	chkUsePreForStorage: true, // Whether to use <pre> format for storage
	chkDisplayInstrumentation: false,
	txtBackupFolder: "",
	txtEditorFocus: "text",
	txtMainTab: "tabTimeline",
	txtMoreTab: "moreTabAll",
	txtMaxEditRows: "30",
	txtFileSystemCharSet: "UTF-8",
	txtTheme: ""
	};
config.optionsDesc = {};

config.optionsSource = {};

// Default tiddler templates
var DEFAULT_VIEW_TEMPLATE = 1;
var DEFAULT_EDIT_TEMPLATE = 2;
config.tiddlerTemplates = {
	1: "ViewTemplate",
	2: "EditTemplate"
};

// More messages (rather a legacy layout that should not really be like this)
config.views = {
	wikified: {
		tag: {}
	},
	editor: {
		tagChooser: {}
	}
};

// Backstage tasks
config.backstageTasks = ["save","sync","importTask","tweak","upgrade","plugins"];

// Extensions
config.extensions = {};

// Macros; each has a 'handler' member that is inserted later
config.macros = {
	today: {},
	version: {},
	search: {sizeTextbox: 15},
	tiddler: {},
	tag: {},
	tags: {},
	tagging: {},
	timeline: {},
	allTags: {},
	list: {
		all: {},
		missing: {},
		orphans: {},
		shadowed: {},
		touched: {},
		filter: {}
	},
	closeAll: {},
	permaview: {},
	saveChanges: {},
	slider: {},
	option: {},
	options: {},
	newTiddler: {},
	newJournal: {},
	tabs: {},
	gradient: {},
	message: {},
	view: {defaultView: "text"},
	edit: {},
	tagChooser: {},
	toolbar: {},
	plugins: {},
	refreshDisplay: {},
	importTiddlers: {},
	upgrade: {
		source: "http://tiddlywiki-releases.tiddlyspace.com/upgrade",
		backupExtension: "pre.core.upgrade"
	},
	sync: {},
	annotations: {}
};

// Commands supported by the toolbar macro
config.commands = {
	closeTiddler: {},
	closeOthers: {},
	editTiddler: {},
	saveTiddler: {hideReadOnly: true},
	cancelTiddler: {},
	deleteTiddler: {hideReadOnly: true},
	permalink: {},
	references: {type: "popup"},
	jump: {type: "popup"},
	syncing: {type: "popup"},
	fields: {type: "popup"}
};

// Control of macro parameter evaluation
config.evaluateMacroParameters = "all";

// Basic regular expressions
config.textPrimitives = {
	upperLetter: "[A-Z\u00c0-\u00de\u0150\u0170]",
	lowerLetter: "[a-z0-9_\\-\u00df-\u00ff\u0151\u0171]",
	anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]",
	anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]"
};
if(!((new RegExp("[\u0150\u0170]","g")).test("\u0150"))) {
	config.textPrimitives = {
		upperLetter: "[A-Z\u00c0-\u00de]",
		lowerLetter: "[a-z0-9_\\-\u00df-\u00ff]",
		anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff]",
		anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff]"
	};
}
config.textPrimitives.sliceSeparator = "::";
config.textPrimitives.sectionSeparator = "##";
config.textPrimitives.urlPattern = "(?:file|http|https|mailto|ftp|irc|news|data):[^\\s'\"]+(?:/|\\b)";
config.textPrimitives.unWikiLink = "~";
config.textPrimitives.wikiLink = "(?:(?:" + config.textPrimitives.upperLetter + "+" +
	config.textPrimitives.lowerLetter + "+" +
	config.textPrimitives.upperLetter +
	config.textPrimitives.anyLetter + "*)|(?:" +
	config.textPrimitives.upperLetter + "{2,}" +
	config.textPrimitives.lowerLetter + "+))";

config.textPrimitives.cssLookahead = "(?:(" + config.textPrimitives.anyLetter + "+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:(" + config.textPrimitives.anyLetter + "+):([^;\\|\\n]+);)";
config.textPrimitives.cssLookaheadRegExp = new RegExp(config.textPrimitives.cssLookahead,"mg");

config.textPrimitives.brackettedLink = "\\[\\[([^\\]]+)\\]\\]";
config.textPrimitives.titledBrackettedLink = "\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]";
config.textPrimitives.tiddlerForcedLinkRegExp = new RegExp("(?:" + config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");
config.textPrimitives.tiddlerAnyLinkRegExp = new RegExp("("+ config.textPrimitives.wikiLink + ")|(?:" +
	config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");

config.glyphs = {
	currBrowser: null,
	browsers: [],
	codes: {}
};

//--
//-- Shadow tiddlers
//--

config.shadowTiddlers = {
	StyleSheet: "",
	MarkupPreHead: "",
	MarkupPostHead: "",
	MarkupPreBody: "",
	MarkupPostBody: "",
	TabTimeline: '<<timeline>>',
	TabAll: '<<list all>>',
	TabTags: '<<allTags excludeLists>>',
	TabMoreMissing: '<<list missing>>',
	TabMoreOrphans: '<<list orphans>>',
	TabMoreShadowed: '<<list shadowed>>',
	AdvancedOptions: '<<options>>',
	PluginManager: '<<plugins>>',
	SystemSettings: '',
	ToolbarCommands: '|~ViewToolbar|closeTiddler closeOthers +editTiddler > fields syncing permalink references jump|\n|~EditToolbar|+saveTiddler -cancelTiddler deleteTiddler|',
	WindowTitle: '<<tiddler SiteTitle>> - <<tiddler SiteSubtitle>>'
};

// Browser detection... In a very few places, there's nothing else for it but to know what browser we're using.
config.userAgent = navigator.userAgent.toLowerCase();
config.browser = {
	isIE: config.userAgent.indexOf("msie") != -1 && config.userAgent.indexOf("opera") == -1,
	isGecko: navigator.product == "Gecko" && config.userAgent.indexOf("WebKit") == -1,
	ieVersion: /MSIE (\d.\d)/i.exec(config.userAgent), // config.browser.ieVersion[1], if it exists, will be the IE version string, eg "6.0"
	isSafari: config.userAgent.indexOf("applewebkit") != -1,
	isBadSafari: !((new RegExp("[\u0150\u0170]","g")).test("\u0150")),
	firefoxDate: /gecko\/(\d{8})/i.exec(config.userAgent), // config.browser.firefoxDate[1], if it exists, will be Firefox release date as "YYYYMMDD"
	isOpera: config.userAgent.indexOf("opera") != -1,
	isLinux: config.userAgent.indexOf("linux") != -1,
	isUnix: config.userAgent.indexOf("x11") != -1,
	isMac: config.userAgent.indexOf("mac") != -1,
	isWindows: config.userAgent.indexOf("win") != -1
};

merge(config.glyphs,{
	browsers: [
		function() {return config.browser.isIE;},
		function() {return true;}
		],
	codes: {
		downTriangle: ["\u25BC","\u25BE"],
		downArrow: ["\u2193","\u2193"],
		bentArrowLeft: ["\u2190","\u21A9"],
		bentArrowRight: ["\u2192","\u21AA"]
	}
});

//--
//-- Translateable strings
//--

// Strings in "double quotes" should be translated; strings in 'single quotes' should be left alone

merge(config.options,{
	txtUserName: "YourName"});

merge(config.tasks,{
	save: {text: "save", tooltip: "Save your changes to this TiddlyWiki"},
	sync: {text: "sync", tooltip: "Synchronise changes with other TiddlyWiki files and servers", content: '<<sync>>'},
	importTask: {text: "import", tooltip: "Import tiddlers and plugins from other TiddlyWiki files and servers", content: '<<importTiddlers>>'},
	tweak: {text: "tweak", tooltip: "Tweak the appearance and behaviour of TiddlyWiki", content: '<<options>>'},
	upgrade: {text: "upgrade", tooltip: "Upgrade TiddlyWiki core code", content: '<<upgrade>>'},
	plugins: {text: "plugins", tooltip: "Manage installed plugins", content: '<<plugins>>'}
});

// Options that can be set in the options panel and/or cookies
merge(config.optionsDesc,{
	txtUserName: "Username for signing your edits",
	chkRegExpSearch: "Enable regular expressions for searches",
	chkCaseSensitiveSearch: "Case-sensitive searching",
	chkIncrementalSearch: "Incremental key-by-key searching",
	chkAnimate: "Enable animations",
	chkSaveBackups: "Keep backup file when saving changes",
	chkAutoSave: "Automatically save changes",
	chkGenerateAnRssFeed: "Generate an RSS feed when saving changes",
	chkSaveEmptyTemplate: "Generate an empty template when saving changes",
	chkOpenInNewWindow: "Open external links in a new window",
	chkToggleLinks: "Clicking on links to open tiddlers causes them to close",
	chkHttpReadOnly: "Hide editing features when viewed over HTTP",
	chkForceMinorUpdate: "Don't update modifier username and date when editing tiddlers",
	chkConfirmDelete: "Require confirmation before deleting tiddlers",
	chkInsertTabs: "Use the tab key to insert tab characters instead of moving between fields",
	txtBackupFolder: "Name of folder to use for backups",
	txtMaxEditRows: "Maximum number of rows in edit boxes",
	txtTheme: "Name of the theme to use",
	txtFileSystemCharSet: "Default character set for saving changes (Firefox/Mozilla only)"});

merge(config.messages,{
	customConfigError: "Problems were encountered loading plugins. See PluginManager for details",
	pluginError: "Error: %0",
	pluginDisabled: "Not executed because disabled via 'systemConfigDisable' tag",
	pluginForced: "Executed because forced via 'systemConfigForce' tag",
	pluginVersionError: "Not executed because this plugin needs a newer version of TiddlyWiki",
	nothingSelected: "Nothing is selected. You must select one or more items first",
	savedSnapshotError: "It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#Download for details",
	subtitleUnknown: "(unknown)",
	undefinedTiddlerToolTip: "The tiddler '%0' doesn't yet exist",
	shadowedTiddlerToolTip: "The tiddler '%0' doesn't yet exist, but has a pre-defined shadow value",
	tiddlerLinkTooltip: "%0 - %1, %2",
	externalLinkTooltip: "External link to %0",
	noTags: "There are no tagged tiddlers",
	notFileUrlError: "You need to save this TiddlyWiki to a file before you can save changes",
	cantSaveError: "It's not possible to save changes. Possible reasons include:\n- your browser doesn't support saving (Firefox, Internet Explorer, Safari and Opera all work if properly configured)\n- the pathname to your TiddlyWiki file contains illegal characters\n- the TiddlyWiki HTML file has been moved or renamed",
	invalidFileError: "The original file '%0' does not appear to be a valid TiddlyWiki",
	backupSaved: "Backup saved",
	backupFailed: "Failed to save backup file",
	rssSaved: "RSS feed saved",
	rssFailed: "Failed to save RSS feed file",
	emptySaved: "Empty template saved",
	emptyFailed: "Failed to save empty template file",
	mainSaved: "Main TiddlyWiki file saved",
	mainFailed: "Failed to save main TiddlyWiki file. Your changes have not been saved",
	macroError: "Error in macro <<%0>>",
	macroErrorDetails: "Error while executing macro <<%0>>:\n%1",
	missingMacro: "No such macro",
	overwriteWarning: "A tiddler named '%0' already exists. Choose OK to overwrite it",
	unsavedChangesWarning: "WARNING! There are unsaved changes in TiddlyWiki\n\nChoose OK to save\nChoose CANCEL to discard",
	confirmExit: "--------------------------------\n\nThere are unsaved changes in TiddlyWiki. If you continue you will lose those changes\n\n--------------------------------",
	saveInstructions: "SaveChanges",
	unsupportedTWFormat: "Unsupported TiddlyWiki format '%0'",
	tiddlerSaveError: "Error when saving tiddler '%0'",
	tiddlerLoadError: "Error when loading tiddler '%0'",
	wrongSaveFormat: "Cannot save with storage format '%0'. Using standard format for save.",
	invalidFieldName: "Invalid field name %0",
	fieldCannotBeChanged: "Field '%0' cannot be changed",
	loadingMissingTiddler: "Attempting to retrieve the tiddler '%0' from the '%1' server at:\n\n'%2' in the workspace '%3'",
	upgradeDone: "The upgrade to version %0 is now complete\n\nClick 'OK' to reload the newly upgraded TiddlyWiki",
	invalidCookie: "Invalid cookie '%0'"});

merge(config.messages.messageClose,{
	text: "close",
	tooltip: "close this message area"});

config.messages.backstage = {
	open: {text: "backstage", tooltip: "Open the backstage area to perform authoring and editing tasks"},
	close: {text: "close", tooltip: "Close the backstage area"},
	prompt: "backstage: ",
	decal: {
		edit: {text: "edit", tooltip: "Edit the tiddler '%0'"}
	}
};

config.messages.listView = {
	tiddlerTooltip: "Click for the full text of this tiddler",
	previewUnavailable: "(preview not available)"
};

config.messages.dates.months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November","December"];
config.messages.dates.days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
config.messages.dates.shortMonths = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
config.messages.dates.shortDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
// suffixes for dates, eg "1st","2nd","3rd"..."30th","31st"
config.messages.dates.daySuffixes = ["st","nd","rd","th","th","th","th","th","th","th",
		"th","th","th","th","th","th","th","th","th","th",
		"st","nd","rd","th","th","th","th","th","th","th",
		"st"];
config.messages.dates.am = "am";
config.messages.dates.pm = "pm";

merge(config.messages.tiddlerPopup,{
	});

merge(config.views.wikified.tag,{
	labelNoTags: "no tags",
	labelTags: "tags: ",
	openTag: "Open tag '%0'",
	tooltip: "Show tiddlers tagged with '%0'",
	openAllText: "Open all",
	openAllTooltip: "Open all of these tiddlers",
	popupNone: "No other tiddlers tagged with '%0'"});

merge(config.views.wikified,{
	defaultText: "The tiddler '%0' doesn't yet exist. Double-click to create it",
	defaultModifier: "(missing)",
	shadowModifier: "(built-in shadow tiddler)",
	dateFormat: "DD MMM YYYY",
	createdPrompt: "created"});

merge(config.views.editor,{
	tagPrompt: "Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing",
	defaultText: "Type the text for '%0'"});

merge(config.views.editor.tagChooser,{
	text: "tags",
	tooltip: "Choose existing tags to add to this tiddler",
	popupNone: "There are no tags defined",
	tagTooltip: "Add the tag '%0'"});

merge(config.messages,{
	sizeTemplates:
		[
		{unit: 1024*1024*1024, template: "%0\u00a0GB"},
		{unit: 1024*1024, template: "%0\u00a0MB"},
		{unit: 1024, template: "%0\u00a0KB"},
		{unit: 1, template: "%0\u00a0B"}
		]});

merge(config.macros.search,{
	label: "search",
	prompt: "Search this TiddlyWiki",
	placeholder: "",
	accessKey: "F",
	successMsg: "%0 tiddlers found matching %1",
	failureMsg: "No tiddlers found matching %0"});

merge(config.macros.tagging,{
	label: "tagging: ",
	labelNotTag: "not tagging",
	tooltip: "List of tiddlers tagged with '%0'"});

merge(config.macros.timeline,{
	dateFormat: "DD MMM YYYY"});

merge(config.macros.allTags,{
	tooltip: "Show tiddlers tagged with '%0'",
	noTags: "There are no tagged tiddlers"});

config.macros.list.all.prompt = "All tiddlers in alphabetical order";
config.macros.list.missing.prompt = "Tiddlers that have links to them but are not defined";
config.macros.list.orphans.prompt = "Tiddlers that are not linked to from any other tiddlers";
config.macros.list.shadowed.prompt = "Tiddlers shadowed with default contents";
config.macros.list.touched.prompt = "Tiddlers that have been modified locally";

merge(config.macros.closeAll,{
	label: "close all",
	prompt: "Close all displayed tiddlers (except any that are being edited)"});

merge(config.macros.permaview,{
	label: "permaview",
	prompt: "Link to an URL that retrieves all the currently displayed tiddlers"});

merge(config.macros.saveChanges,{
	label: "save changes",
	prompt: "Save all tiddlers to create a new TiddlyWiki",
	accessKey: "S"});

merge(config.macros.newTiddler,{
	label: "new tiddler",
	prompt: "Create a new tiddler",
	title: "New Tiddler",
	accessKey: "N"});

merge(config.macros.newJournal,{
	label: "new journal",
	prompt: "Create a new tiddler from the current date and time",
	accessKey: "J"});

merge(config.macros.options,{
	wizardTitle: "Tweak advanced options",
	step1Title: "These options are saved in cookies in your browser",
	step1Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='false' name='chkUnknown'>Show unknown options</input>",
	unknownDescription: "//(unknown)//",
	listViewTemplate: {
		columns: [
			{name: 'Option', field: 'option', title: "Option", type: 'String'},
			{name: 'Description', field: 'description', title: "Description", type: 'WikiText'},
			{name: 'Name', field: 'name', title: "Name", type: 'String'}
			],
		rowClasses: [
			{className: 'lowlight', field: 'lowlight'}
			]}
	});

merge(config.macros.plugins,{
	wizardTitle: "Manage plugins",
	step1Title: "Currently loaded plugins",
	step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
	skippedText: "(This plugin has not been executed because it was added since startup)",
	noPluginText: "There are no plugins installed",
	confirmDeleteText: "Are you sure you want to delete these plugins:\n\n%0",
	removeLabel: "remove systemConfig tag",
	removePrompt: "Remove systemConfig tag",
	deleteLabel: "delete",
	deletePrompt: "Delete these tiddlers forever",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Description', field: 'Description', title: "Description", type: 'String'},
			{name: 'Version', field: 'Version', title: "Version", type: 'String'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Forced', field: 'forced', title: "Forced", tag: 'systemConfigForce', type: 'TagCheckbox'},
			{name: 'Disabled', field: 'disabled', title: "Disabled", tag: 'systemConfigDisable', type: 'TagCheckbox'},
			{name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No"},
			{name: 'Startup Time', field: 'startupTime', title: "Startup Time", type: 'String'},
			{name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK"},
			{name: 'Log', field: 'log', title: "Log", type: 'StringList'}
			],
		rowClasses: [
			{className: 'error', field: 'error'},
			{className: 'warning', field: 'warning'}
			]},
	listViewTemplateReadOnly: {
		columns: [
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Description', field: 'Description', title: "Description", type: 'String'},
			{name: 'Version', field: 'Version', title: "Version", type: 'String'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No"},
			{name: 'Startup Time', field: 'startupTime', title: "Startup Time", type: 'String'},
			{name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK"},
			{name: 'Log', field: 'log', title: "Log", type: 'StringList'}
			],
		rowClasses: [
			{className: 'error', field: 'error'},
			{className: 'warning', field: 'warning'}
			]}
	});

merge(config.macros.toolbar,{
	moreLabel: "more",
	morePrompt: "Show additional commands",
	lessLabel: "less",
	lessPrompt: "Hide additional commands",
	separator: "|"
	});

merge(config.macros.refreshDisplay,{
	label: "refresh",
	prompt: "Redraw the entire TiddlyWiki display"
	});

merge(config.macros.importTiddlers,{
	readOnlyWarning: "You cannot import into a read-only TiddlyWiki file. Try opening it from a file:// URL",
	wizardTitle: "Import tiddlers from another file or server",
	step1Title: "Step 1: Locate the server or TiddlyWiki file",
	step1Html: "Specify the type of the server: <select name='selTypes'><option value=''>Choose...</option></select><br>Enter the URL or pathname here: <input type='text' size=50 name='txtPath'><br>...or browse for a file: <input type='file' size=50 name='txtBrowse'><br><hr>...or select a pre-defined feed: <select name='selFeeds'><option value=''>Choose...</option></select>",
	openLabel: "open",
	openPrompt: "Open the connection to this file or server",
	statusOpenHost: "Opening the host",
	statusGetWorkspaceList: "Getting the list of available workspaces",
	step2Title: "Step 2: Choose the workspace",
	step2Html: "Enter a workspace name: <input type='text' size=50 name='txtWorkspace'><br>...or select a workspace: <select name='selWorkspace'><option value=''>Choose...</option></select>",
	cancelLabel: "cancel",
	cancelPrompt: "Cancel this import",
	statusOpenWorkspace: "Opening the workspace",
	statusGetTiddlerList: "Getting the list of available tiddlers",
	errorGettingTiddlerList: "Error getting list of tiddlers, click Cancel to try again",
	step3Title: "Step 3: Choose the tiddlers to import",
	step3Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='true' name='chkSync'>Keep these tiddlers linked to this server so that you can synchronise subsequent changes</input><br><input type='checkbox' name='chkSave'>Save the details of this server in a 'systemServer' tiddler called:</input> <input type='text' size=25 name='txtSaveTiddler'>",
	importLabel: "import",
	importPrompt: "Import these tiddlers",
	confirmOverwriteText: "Are you sure you want to overwrite these tiddlers:\n\n%0",
	step4Title: "Step 4: Importing %0 tiddler(s)",
	step4Html: "<input type='hidden' name='markReport'></input>", // DO NOT TRANSLATE
	doneLabel: "done",
	donePrompt: "Close this wizard",
	statusDoingImport: "Importing tiddlers",
	statusDoneImport: "All tiddlers imported",
	systemServerNamePattern: "%2 on %1",
	systemServerNamePatternNoWorkspace: "%1",
	confirmOverwriteSaveTiddler: "The tiddler '%0' already exists. Click 'OK' to overwrite it with the details of this server, or 'Cancel' to leave it unchanged",
	serverSaveTemplate: "|''Type:''|%0|\n|''URL:''|%1|\n|''Workspace:''|%2|\n\nThis tiddler was automatically created to record the details of this server",
	serverSaveModifier: "(System)",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Tags', field: 'tags', title: "Tags", type: 'Tags'}
			],
		rowClasses: [
			]}
	});

merge(config.macros.upgrade,{
	wizardTitle: "Upgrade TiddlyWiki core code",
	step1Title: "Update or repair this TiddlyWiki to the latest release",
	step1Html: "You are about to upgrade to the latest release of the TiddlyWiki core code (from <a href='%0' class='externalLink' target='_blank'>%1</a>). Your content will be preserved across the upgrade.<br><br>Note that core upgrades have been known to interfere with older plugins. If you run into problems with the upgraded file, see <a href='http://www.tiddlywiki.org/wiki/CoreUpgrades' class='externalLink' target='_blank'>http://www.tiddlywiki.org/wiki/CoreUpgrades</a>",
	errorCantUpgrade: "Unable to upgrade this TiddlyWiki. You can only perform upgrades on TiddlyWiki files stored locally",
	errorNotSaved: "You must save changes before you can perform an upgrade",
	step2Title: "Confirm the upgrade details",
	step2Html_downgrade: "You are about to downgrade to TiddlyWiki version %0 from %1.<br><br>Downgrading to an earlier version of the core code is not recommended",
	step2Html_restore: "This TiddlyWiki appears to be already using the latest version of the core code (%0).<br><br>You can continue to upgrade anyway to ensure that the core code hasn't been corrupted or damaged",
	step2Html_upgrade: "You are about to upgrade to TiddlyWiki version %0 from %1",
	upgradeLabel: "upgrade",
	upgradePrompt: "Prepare for the upgrade process",
	statusPreparingBackup: "Preparing backup",
	statusSavingBackup: "Saving backup file",
	errorSavingBackup: "There was a problem saving the backup file",
	statusLoadingCore: "Loading core code",
	errorLoadingCore: "Error loading the core code",
	errorCoreFormat: "Error with the new core code",
	statusSavingCore: "Saving the new core code",
	statusReloadingCore: "Reloading the new core code",
	startLabel: "start",
	startPrompt: "Start the upgrade process",
	cancelLabel: "cancel",
	cancelPrompt: "Cancel the upgrade process",
	step3Title: "Upgrade cancelled",
	step3Html: "You have cancelled the upgrade process"
	});

merge(config.macros.sync,{
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Server Type', field: 'serverType', title: "Server type", type: 'String'},
			{name: 'Server Host', field: 'serverHost', title: "Server host", type: 'String'},
			{name: 'Server Workspace', field: 'serverWorkspace', title: "Server workspace", type: 'String'},
			{name: 'Status', field: 'status', title: "Synchronisation status", type: 'String'},
			{name: 'Server URL', field: 'serverUrl', title: "Server URL", text: "View", type: 'Link'}
			],
		rowClasses: [
			],
		buttons: [
			{caption: "Sync these tiddlers", name: 'sync'}
			]},
	wizardTitle: "Synchronize with external servers and files",
	step1Title: "Choose the tiddlers you want to synchronize",
	step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
	syncLabel: "sync",
	syncPrompt: "Sync these tiddlers",
	hasChanged: "Changed while unplugged",
	hasNotChanged: "Unchanged while unplugged",
	syncStatusList: {
		none: {text: "...", display:'none', className:'notChanged'},
		changedServer: {text: "Changed on server", display:null, className:'changedServer'},
		changedLocally: {text: "Changed while unplugged", display:null, className:'changedLocally'},
		changedBoth: {text: "Changed while unplugged and on server", display:null, className:'changedBoth'},
		notFound: {text: "Not found on server", display:null, className:'notFound'},
		putToServer: {text: "Saved update on server", display:null, className:'putToServer'},
		gotFromServer: {text: "Retrieved update from server", display:null, className:'gotFromServer'}
		}
	});

merge(config.macros.annotations,{
	});

merge(config.commands.closeTiddler,{
	text: "close",
	tooltip: "Close this tiddler"});

merge(config.commands.closeOthers,{
	text: "close others",
	tooltip: "Close all other tiddlers"});

merge(config.commands.editTiddler,{
	text: "edit",
	tooltip: "Edit this tiddler",
	readOnlyText: "view",
	readOnlyTooltip: "View the source of this tiddler"});

merge(config.commands.saveTiddler,{
	text: "done",
	tooltip: "Save changes to this tiddler"});

merge(config.commands.cancelTiddler,{
	text: "cancel",
	tooltip: "Undo changes to this tiddler",
	warning: "Are you sure you want to abandon your changes to '%0'?",
	readOnlyText: "done",
	readOnlyTooltip: "View this tiddler normally"});

merge(config.commands.deleteTiddler,{
	text: "delete",
	tooltip: "Delete this tiddler",
	warning: "Are you sure you want to delete '%0'?"});

merge(config.commands.permalink,{
	text: "permalink",
	tooltip: "Permalink for this tiddler"});

merge(config.commands.references,{
	text: "references",
	tooltip: "Show tiddlers that link to this one",
	popupNone: "No references"});

merge(config.commands.jump,{
	text: "jump",
	tooltip: "Jump to another open tiddler"});

merge(config.commands.syncing,{
	text: "syncing",
	tooltip: "Control synchronisation of this tiddler with a server or external file",
	currentlySyncing: "<div>Currently syncing via <span class='popupHighlight'>'%0'</span> to:</"+"div><div>host: <span class='popupHighlight'>%1</span></"+"div><div>workspace: <span class='popupHighlight'>%2</span></"+"div>", // Note escaping of closing <div> tag
	notCurrentlySyncing: "Not currently syncing",
	captionUnSync: "Stop synchronising this tiddler",
	chooseServer: "Synchronise this tiddler with another server:",
	currServerMarker: "\u25cf ",
	notCurrServerMarker: "  "});

merge(config.commands.fields,{
	text: "fields",
	tooltip: "Show the extended fields of this tiddler",
	emptyText: "There are no extended fields for this tiddler",
	listViewTemplate: {
		columns: [
			{name: 'Field', field: 'field', title: "Field", type: 'String'},
			{name: 'Value', field: 'value', title: "Value", type: 'String'}
			],
		rowClasses: [
			],
		buttons: [
			]}});

merge(config.shadowTiddlers,{
	DefaultTiddlers: "[[GettingStarted]]",
	MainMenu: "[[GettingStarted]]",
	SiteTitle: "My TiddlyWiki",
	SiteSubtitle: "a reusable non-linear personal web notebook",
	SiteUrl: "",
	SideBarOptions: '<<search>><<closeAll>><<permaview>><<newTiddler>><<newJournal "DD MMM YYYY" "journal">><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel "options \u00bb" "Change TiddlyWiki advanced options">>',
	SideBarTabs: '<<tabs txtMainTab "Timeline" "Timeline" TabTimeline "All" "All tiddlers" TabAll "Tags" "All tags" TabTags "More" "More lists" TabMore>>',
	TabMore: '<<tabs txtMoreTab "Missing" "Missing tiddlers" TabMoreMissing "Orphans" "Orphaned tiddlers" TabMoreOrphans "Shadowed" "Shadowed tiddlers" TabMoreShadowed>>'
	});

merge(config.annotations,{
	AdvancedOptions: "This shadow tiddler provides access to several advanced options",
	ColorPalette: "These values in this shadow tiddler determine the colour scheme of the ~TiddlyWiki user interface",
	DefaultTiddlers: "The tiddlers listed in this shadow tiddler will be automatically displayed when ~TiddlyWiki starts up",
	EditTemplate: "The HTML template in this shadow tiddler determines how tiddlers look while they are being edited",
	GettingStarted: "This shadow tiddler provides basic usage instructions",
	ImportTiddlers: "This shadow tiddler provides access to importing tiddlers",
	MainMenu: "This shadow tiddler is used as the contents of the main menu in the left-hand column of the screen",
	MarkupPreHead: "This tiddler is inserted at the top of the <head> section of the TiddlyWiki HTML file",
	MarkupPostHead: "This tiddler is inserted at the bottom of the <head> section of the TiddlyWiki HTML file",
	MarkupPreBody: "This tiddler is inserted at the top of the <body> section of the TiddlyWiki HTML file",
	MarkupPostBody: "This tiddler is inserted at the end of the <body> section of the TiddlyWiki HTML file immediately after the script block",
	OptionsPanel: "This shadow tiddler is used as the contents of the options panel slider in the right-hand sidebar",
	PageTemplate: "The HTML template in this shadow tiddler determines the overall ~TiddlyWiki layout",
	PluginManager: "This shadow tiddler provides access to the plugin manager",
	SideBarOptions: "This shadow tiddler is used as the contents of the option panel in the right-hand sidebar",
	SideBarTabs: "This shadow tiddler is used as the contents of the tabs panel in the right-hand sidebar",
	SiteSubtitle: "This shadow tiddler is used as the second part of the page title",
	SiteTitle: "This shadow tiddler is used as the first part of the page title",
	SiteUrl: "This shadow tiddler should be set to the full target URL for publication",
	StyleSheetColors: "This shadow tiddler contains CSS definitions related to the color of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
	StyleSheet: "This tiddler can contain custom CSS definitions",
	StyleSheetLayout: "This shadow tiddler contains CSS definitions related to the layout of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
	StyleSheetLocale: "This shadow tiddler contains CSS definitions related to the translation locale",
	StyleSheetPrint: "This shadow tiddler contains CSS definitions for printing",
	SystemSettings: "This tiddler is used to store configuration options for this TiddlyWiki document",
	TabAll: "This shadow tiddler contains the contents of the 'All' tab in the right-hand sidebar",
	TabMore: "This shadow tiddler contains the contents of the 'More' tab in the right-hand sidebar",
	TabMoreMissing: "This shadow tiddler contains the contents of the 'Missing' tab in the right-hand sidebar",
	TabMoreOrphans: "This shadow tiddler contains the contents of the 'Orphans' tab in the right-hand sidebar",
	TabMoreShadowed: "This shadow tiddler contains the contents of the 'Shadowed' tab in the right-hand sidebar",
	TabTags: "This shadow tiddler contains the contents of the 'Tags' tab in the right-hand sidebar",
	TabTimeline: "This shadow tiddler contains the contents of the 'Timeline' tab in the right-hand sidebar",
	ToolbarCommands: "This shadow tiddler determines which commands are shown in tiddler toolbars",
	ViewTemplate: "The HTML template in this shadow tiddler determines how tiddlers look"
	});
//--
//-- Main
//--

var params = null; // Command line parameters
var store = null; // TiddlyWiki storage
var story = null; // Main story
var formatter = null; // Default formatters for the wikifier
var anim = typeof Animator == "function" ? new Animator() : null; // Animation engine
var readOnly = false; // Whether we're in readonly mode
var highlightHack = null; // Embarrassing hack department...
var hadConfirmExit = false; // Don't warn more than once
var safeMode = false; // Disable all plugins and cookies
var showBackstage; // Whether to include the backstage area
var installedPlugins = []; // Information filled in when plugins are executed
var startingUp = false; // Whether we're in the process of starting up
var pluginInfo,tiddler; // Used to pass information to plugins in loadPlugins()

// Whether to use the JavaSaver applet
var useJavaSaver = (config.browser.isSafari || config.browser.isOpera) && (document.location.toString().substr(0,4) != "http");

if(!window || !window.console) {
	console = {tiddlywiki:true,log:function(message) {displayMessage(message);}};
}

// Starting up
function main()
{
	var t10,t9,t8,t7,t6,t5,t4,t3,t2,t1,t0 = new Date();
	startingUp = true;
	var doc = jQuery(document);
	jQuery.noConflict();
	window.onbeforeunload = function(e) {if(window.confirmExit) return confirmExit();};
	params = getParameters();
	if(params)
		params = params.parseParams("open",null,false);
	store = new TiddlyWiki();
	invokeParamifier(params,"oninit");
	story = new Story("tiddlerDisplay","tiddler");
	addEvent(document,"click",Popup.onDocumentClick);
	saveTest();
	var s;
	for(s=0; s<config.notifyTiddlers.length; s++)
		store.addNotification(config.notifyTiddlers[s].name,config.notifyTiddlers[s].notify);
	t1 = new Date();
	loadShadowTiddlers();
	doc.trigger("loadShadows");
	t2 = new Date();
	store.loadFromDiv("storeArea","store",true);
	doc.trigger("loadTiddlers");
	loadOptions();
	t3 = new Date();
	invokeParamifier(params,"onload");
	t4 = new Date();
	readOnly = (window.location.protocol == "file:") ? false : config.options.chkHttpReadOnly;
	var pluginProblem = loadPlugins("systemConfig");
	doc.trigger("loadPlugins");
	t5 = new Date();
	formatter = new Formatter(config.formatters);
	invokeParamifier(params,"onconfig");
	story.switchTheme(config.options.txtTheme);
	showBackstage = showBackstage !== undefined ? showBackstage : !readOnly;
	t6 = new Date();
	var m;
	for(m in config.macros) {
		if(config.macros[m].init)
			config.macros[m].init();
	}
	t7 = new Date();
	store.notifyAll();
	t8 = new Date();
	restart();
	refreshDisplay();
	t9 = new Date();
	if(pluginProblem) {
		story.displayTiddler(null,"PluginManager");
		displayMessage(config.messages.customConfigError);
	}
	if(showBackstage)
		backstage.init();
	t10 = new Date();
	if(config.options.chkDisplayInstrumentation) {
		displayMessage("LoadShadows " + (t2-t1) + " ms");
		displayMessage("LoadFromDiv " + (t3-t2) + " ms");
		displayMessage("LoadPlugins " + (t5-t4) + " ms");
		displayMessage("Macro init " + (t7-t6) + " ms");
		displayMessage("Notify " + (t8-t7) + " ms");
		displayMessage("Restart " + (t9-t8) + " ms");
		displayMessage("Total: " + (t10-t0) + " ms");
	}
	startingUp = false;
	doc.trigger("startup");
}

// Called on unload. All functions called conditionally since they themselves may have been unloaded.
function unload()
{
	if(window.checkUnsavedChanges)
		checkUnsavedChanges();
	if(window.scrubNodes)
		scrubNodes(document.body);
}

// Restarting
function restart()
{
	invokeParamifier(params,"onstart");
	if(story.isEmpty()) {
		story.displayDefaultTiddlers();
	}
	window.scrollTo(0,0);
}

function saveTest()
{
	var s = document.getElementById("saveTest");
	if(s.hasChildNodes())
		alert(config.messages.savedSnapshotError);
	s.appendChild(document.createTextNode("savetest"));
}

function loadShadowTiddlers()
{
	var shadows = new TiddlyWiki();
	shadows.loadFromDiv("shadowArea","shadows",true);
	shadows.forEachTiddler(function(title,tiddler){config.shadowTiddlers[title] = tiddler.text;});
}

function loadPlugins(tag)
{
	if(safeMode)
		return false;
	var tiddlers = store.getTaggedTiddlers(tag);
	tiddlers.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : 1);});
	var toLoad = [];
	var nLoaded = 0;
	var map = {};
	var nPlugins = tiddlers.length;
	installedPlugins = [];
	var i;
	for(i=0; i<nPlugins; i++) {
		var p = getPluginInfo(tiddlers[i]);
		installedPlugins[i] = p;
		var n = p.Name || p.title;
		if(n)
			map[n] = p;
		n = p.Source;
		if(n)
			map[n] = p;
	}
	var visit = function(p) {
		if(!p || p.done)
			return;
		p.done = 1;
		var reqs = p.Requires;
		if(reqs) {
			reqs = reqs.readBracketedList();
			var i;
			for(i=0; i<reqs.length; i++)
				visit(map[reqs[i]]);
		}
		toLoad.push(p);
	};
	for(i=0; i<nPlugins; i++)
		visit(installedPlugins[i]);
	for(i=0; i<toLoad.length; i++) {
		p = toLoad[i];
		pluginInfo = p;
		tiddler = p.tiddler;
		if(isPluginExecutable(p)) {
			if(isPluginEnabled(p)) {
				p.executed = true;
				var startTime = new Date();
				try {
					if(tiddler.text)
						window.eval(tiddler.text);
					nLoaded++;
				} catch(ex) {
					p.log.push(config.messages.pluginError.format([exceptionText(ex)]));
					p.error = true;
					if(!console.tiddlywiki) {
						console.log("error evaluating " + tiddler.title, ex);
					}
				}
				pluginInfo.startupTime = String((new Date()) - startTime) + "ms";
			} else {
				nPlugins--;
			}
		} else {
			p.warning = true;
		}
	}
	return nLoaded != nPlugins;
}

function getPluginInfo(tiddler)
{
	var p = store.getTiddlerSlices(tiddler.title,["Name","Description","Version","Requires","CoreVersion","Date","Source","Author","License","Browsers"]);
	p.tiddler = tiddler;
	p.title = tiddler.title;
	p.log = [];
	return p;
}

// Check that a particular plugin is valid for execution
function isPluginExecutable(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigForce")) {
		plugin.log.push(config.messages.pluginForced);
		return true;
	}
	if(plugin["CoreVersion"]) {
		var coreVersion = plugin["CoreVersion"].split(".");
		var w = parseInt(coreVersion[0],10) - version.major;
		if(w == 0 && coreVersion[1])
			w = parseInt(coreVersion[1],10) - version.minor;
		if(w == 0 && coreVersion[2])
			w = parseInt(coreVersion[2],10) - version.revision;
		if(w > 0) {
			plugin.log.push(config.messages.pluginVersionError);
			return false;
		}
	}
	return true;
}

function isPluginEnabled(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigDisable")) {
		plugin.log.push(config.messages.pluginDisabled);
		return false;
	}
	return true;
}

//--
//-- Paramifiers
//--

function getParameters()
{
	var p = null;
	if(window.location.hash) {
		p = decodeURIComponent(window.location.hash.substr(1));
		if(config.browser.firefoxDate != null && config.browser.firefoxDate[1] < "20051111")
			p = convertUTF8ToUnicode(p);
	}
	return p;
}

function invokeParamifier(params,handler)
{
	if(!params || params.length == undefined || params.length <= 1)
		return;
	var i;
	for(i=1; i<params.length; i++) {
		var p = config.paramifiers[params[i].name];
		if(p && p[handler] instanceof Function)
			p[handler](params[i].value);
		else {
			var h = config.optionHandlers[params[i].name.substr(0,3)];
			if(h && h.set instanceof Function)
				h.set(params[i].name,params[i].value);
		}
	}
}

config.paramifiers = {};

config.paramifiers.start = {
	oninit: function(v) {
		safeMode = v.toLowerCase() == "safe";
	}
};

config.paramifiers.open = {
	onstart: function(v) {
		if(!readOnly || store.tiddlerExists(v) || store.isShadowTiddler(v))
			story.displayTiddler("bottom",v,null,false,null);
	}
};

config.paramifiers.story = {
	onstart: function(v) {
		var list = store.getTiddlerText(v,"").parseParams("open",null,false);
		invokeParamifier(list,"onstart");
	}
};

config.paramifiers.search = {
	onstart: function(v) {
		story.search(v,false,false);
	}
};

config.paramifiers.searchRegExp = {
	onstart: function(v) {
		story.prototype.search(v,false,true);
	}
};

config.paramifiers.tag = {
	onstart: function(v) {
		story.displayTiddlers(null,store.filterTiddlers("[tag["+v+"]]"),null,false,null);
	}
};

config.paramifiers.newTiddler = {
	onstart: function(v) {
		var args = v.parseParams("anon", null, null)[0];
		var title = args.title ? args.title[0] : v;
		var customFields = args.fields ? args.fields[0] : null;
		if(!readOnly) {
			story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE,false,null,customFields);
			story.focusTiddler(title,"text");
			var i,tags = args.tag || [];
			for(i=0;i<tags.length;i++) {
				story.setTiddlerTag(title,tags[i],+1);
			}
		}
	}
};

config.paramifiers.newJournal = {
	onstart: function(v) {
		if(!readOnly) {
			var now = new Date();
			var title = now.formatString(v.trim());
			story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(title,"text");
		}
	}
};

config.paramifiers.readOnly = {
	onconfig: function(v) {
		var p = v.toLowerCase();
		readOnly = p == "yes" ? true : (p == "no" ? false : readOnly);
	}
};

config.paramifiers.theme = {
	onconfig: function(v) {
		story.switchTheme(v);
	}
};

config.paramifiers.upgrade = {
	onstart: function(v) {
		upgradeFrom(v);
	}
};

config.paramifiers.recent= {
	onstart: function(v) {
		var titles=[];
		var i,tiddlers=store.getTiddlers("modified","excludeLists").reverse();
		for(i=0; i<v && i<tiddlers.length; i++)
			titles.push(tiddlers[i].title);
		story.displayTiddlers(null,titles);
	}
};

config.paramifiers.filter = {
	onstart: function(v) {
		story.displayTiddlers(null,store.filterTiddlers(v),null,false);
	}
};

//--
//-- Formatter helpers
//--

function Formatter(formatters)
{
	var n;
	this.formatters = [];
	var pattern = [];
	for(n=0; n<formatters.length; n++) {
		pattern.push("(" + formatters[n].match + ")");
		this.formatters.push(formatters[n]);
	}
	this.formatterRegExp = new RegExp(pattern.join("|"),"mg");
}

config.formatterHelpers = {

	createElementAndWikify: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,this.element),this.termRegExp);
	},

	inlineCssHelper: function(w)
	{
		var styles = [];
		config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var s,v;
			if(lookaheadMatch[1]) {
				s = lookaheadMatch[1].unDash();
				v = lookaheadMatch[2];
			} else {
				s = lookaheadMatch[3].unDash();
				v = lookaheadMatch[4];
			}
			if(s=="bgcolor")
				s = "backgroundColor";
			if(s=="float")
				s = "cssFloat";
			styles.push({style: s, value: v});
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		}
		return styles;
	},

	applyCssHelper: function(e,styles)
	{
		var t;
		for(t=0; t< styles.length; t++) {
			try {
				e.style[styles[t].style] = styles[t].value;
			} catch (ex) {
			}
		}
	},

	enclosedTextHelper: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var text = lookaheadMatch[1];
			if(config.browser.isIE)
				text = text.replace(/\n/g,"\r");
			createTiddlyElement(w.output,this.element,null,null,text);
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
		}
	},

	isExternalLink: function(link)
	{
		if(store.tiddlerExists(link) || store.isShadowTiddler(link)) {
			return false;
		}
		var urlRegExp = new RegExp(config.textPrimitives.urlPattern,"mg");
		if(urlRegExp.exec(link)) {
			return true;
		}
		if(link.indexOf(".")!=-1 || link.indexOf("\\")!=-1 || link.indexOf("/")!=-1 || link.indexOf("#")!=-1) {
			return true;
		}
		return false;
	}

};

//--
//-- Standard formatters
//--

config.formatters = [
{
	name: "table",
	match: "^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",
	lookaheadRegExp: /^\|([^\n]*)\|([fhck]?)$/mg,
	rowTermRegExp: /(\|(?:[fhck]?)$\n?)/mg,
	cellRegExp: /(?:\|([^\n\|]*)\|)|(\|[fhck]?$\n?)/mg,
	cellTermRegExp: /((?:\x20*)\|)/mg,
	rowTypes: {"c":"caption", "h":"thead", "":"tbody", "f":"tfoot"},
	handler: function(w)
	{
		var table = createTiddlyElement(w.output,"table",null,"twtable");
		var prevColumns = [];
		var currRowType = null;
		var rowContainer;
		var rowCount = 0;
		var onmouseover = function() {jQuery(this).addClass("hoverRow");};
		var onmouseout = function() {jQuery(this).removeClass("hoverRow");};
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var nextRowType = lookaheadMatch[2];
			if(nextRowType == "k") {
				table.className = lookaheadMatch[1];
				w.nextMatch += lookaheadMatch[0].length+1;
			} else {
				if(nextRowType != currRowType) {
					rowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);
					currRowType = nextRowType;
				}
				if(currRowType == "c") {
					// Caption
					w.nextMatch++;
					if(rowContainer != table.firstChild)
						table.insertBefore(rowContainer,table.firstChild);
					rowContainer.setAttribute("align",rowCount == 0?"top":"bottom");
					w.subWikifyTerm(rowContainer,this.rowTermRegExp);
				} else {
					var theRow = createTiddlyElement(rowContainer,"tr",null,rowCount%2?"oddRow":"evenRow");
					theRow.onmouseover = onmouseover;
					theRow.onmouseout = onmouseout;
					this.rowHandler(w,theRow,prevColumns);
					rowCount++;
				}
			}
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	},
	rowHandler: function(w,e,prevColumns)
	{
		var col = 0;
		var colSpanCount = 1;
		var prevCell = null;
		this.cellRegExp.lastIndex = w.nextMatch;
		var cellMatch = this.cellRegExp.exec(w.source);
		while(cellMatch && cellMatch.index == w.nextMatch) {
			if(cellMatch[1] == "~") {
				// Rowspan
				var last = prevColumns[col];
				if(last) {
					last.rowSpanCount++;
					last.element.setAttribute("rowspan",last.rowSpanCount);
					last.element.setAttribute("rowSpan",last.rowSpanCount); // Needed for IE
					last.element.valign = "center";
					if(colSpanCount > 1) {
						last.element.setAttribute("colspan",colSpanCount);
						last.element.setAttribute("colSpan",colSpanCount); // Needed for IE
						colSpanCount = 1;
					}
				}
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[1] == ">") {
				// Colspan
				colSpanCount++;
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[2]) {
				// End of row
				if(prevCell && colSpanCount > 1) {
					prevCell.setAttribute("colspan",colSpanCount);
					prevCell.setAttribute("colSpan",colSpanCount); // Needed for IE
				}
				w.nextMatch = this.cellRegExp.lastIndex;
				break;
			} else {
				// Cell
				w.nextMatch++;
				var styles = config.formatterHelpers.inlineCssHelper(w);
				var spaceLeft = false;
				var chr = w.source.substr(w.nextMatch,1);
				while(chr == " ") {
					spaceLeft = true;
					w.nextMatch++;
					chr = w.source.substr(w.nextMatch,1);
				}
				var cell;
				if(chr == "!") {
					cell = createTiddlyElement(e,"th");
					w.nextMatch++;
				} else {
					cell = createTiddlyElement(e,"td");
				}
				prevCell = cell;
				prevColumns[col] = {rowSpanCount:1,element:cell};
				if(colSpanCount > 1) {
					cell.setAttribute("colspan",colSpanCount);
					cell.setAttribute("colSpan",colSpanCount); // Needed for IE
					colSpanCount = 1;
				}
				config.formatterHelpers.applyCssHelper(cell,styles);
				w.subWikifyTerm(cell,this.cellTermRegExp);
				if(w.matchText.substr(w.matchText.length-2,1) == " ") // spaceRight
					cell.align = spaceLeft ? "center" : "left";
				else if(spaceLeft)
					cell.align = "right";
				w.nextMatch--;
			}
			col++;
			this.cellRegExp.lastIndex = w.nextMatch;
			cellMatch = this.cellRegExp.exec(w.source);
		}
	}
},

{
	name: "heading",
	match: "^!{1,6}",
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,"h" + w.matchLength),this.termRegExp);
	}
},

{
	name: "list",
	match: "^(?:[\\*#;:]+)",
	lookaheadRegExp: /^(?:(?:(\*)|(#)|(;)|(:))+)/mg,
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0, currType = null;
		var listLevel, listType, itemType, baseType;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			if(lookaheadMatch[1]) {
				listType = "ul";
				itemType = "li";
			} else if(lookaheadMatch[2]) {
				listType = "ol";
				itemType = "li";
			} else if(lookaheadMatch[3]) {
				listType = "dl";
				itemType = "dt";
			} else if(lookaheadMatch[4]) {
				listType = "dl";
				itemType = "dd";
			}
			if(!baseType)
				baseType = listType;
			listLevel = lookaheadMatch[0].length;
			w.nextMatch += lookaheadMatch[0].length;
			var t;
			if(listLevel > currLevel) {
				for(t=currLevel; t<listLevel; t++) {
					var target = (currLevel == 0) ? stack[stack.length-1] : stack[stack.length-1].lastChild;
					stack.push(createTiddlyElement(target,listType));
				}
			} else if(listType!=baseType && listLevel==1) {
				w.nextMatch -= lookaheadMatch[0].length;
				return;
			} else if(listLevel < currLevel) {
				for(t=currLevel; t>listLevel; t--)
					stack.pop();
			} else if(listLevel == currLevel && listType != currType) {
				stack.pop();
				stack.push(createTiddlyElement(stack[stack.length-1].lastChild,listType));
			}
			currLevel = listLevel;
			currType = listType;
			var e = createTiddlyElement(stack[stack.length-1],itemType);
			w.subWikifyTerm(e,this.termRegExp);
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	}
},

{
	name: "quoteByBlock",
	match: "^<<<\\n",
	termRegExp: /(^<<<(\n|$))/mg,
	element: "blockquote",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "quoteByLine",
	match: "^>+",
	lookaheadRegExp: /^>+/mg,
	termRegExp: /(\n)/mg,
	element: "blockquote",
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0;
		var newLevel = w.matchLength;
		var t,matched;
		do {
			if(newLevel > currLevel) {
				for(t=currLevel; t<newLevel; t++)
					stack.push(createTiddlyElement(stack[stack.length-1],this.element));
			} else if(newLevel < currLevel) {
				for(t=currLevel; t>newLevel; t--)
					stack.pop();
			}
			currLevel = newLevel;
			w.subWikifyTerm(stack[stack.length-1],this.termRegExp);
			createTiddlyElement(stack[stack.length-1],"br");
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if(matched) {
				newLevel = lookaheadMatch[0].length;
				w.nextMatch += lookaheadMatch[0].length;
			}
		} while(matched);
	}
},

{
	name: "rule",
	match: "^----+$\\n?|<hr ?/?>\\n?",
	handler: function(w)
	{
		createTiddlyElement(w.output,"hr");
	}
},

{
	name: "monospacedByLine",
	match: "^(?:/\\*\\{\\{\\{\\*/|\\{\\{\\{|//\\{\\{\\{|<!--\\{\\{\\{-->)\\n",
	element: "pre",
	handler: function(w)
	{
		switch(w.matchText) {
		case "/*{{{*/\n": // CSS
			this.lookaheadRegExp = /\/\*\{\{\{\*\/\n*((?:^[^\n]*\n)+?)(\n*^\f*\/\*\}\}\}\*\/$\n?)/mg;
			break;
		case "{{{\n": // monospaced block
			this.lookaheadRegExp = /^\{\{\{\n((?:^[^\n]*\n)+?)(^\f*\}\}\}$\n?)/mg;
			break;
		case "//{{{\n": // plugin
			this.lookaheadRegExp = /^\/\/\{\{\{\n\n*((?:^[^\n]*\n)+?)(\n*^\f*\/\/\}\}\}$\n?)/mg;
			break;
		case "<!--{{{-->\n": //template
			this.lookaheadRegExp = /<!--\{\{\{-->\n*((?:^[^\n]*\n)+?)(\n*^\f*<!--\}\}\}-->$\n?)/mg;
			break;
		default:
			break;
		}
		config.formatterHelpers.enclosedTextHelper.call(this,w);
	}
},

{
	name: "wikifyComment",
	match: "^(?:/\\*\\*\\*|<!---)\\n",
	handler: function(w)
	{
		var termRegExp = (w.matchText == "/***\n") ? (/(^\*\*\*\/\n)/mg) : (/(^--->\n)/mg);
		w.subWikifyTerm(w.output,termRegExp);
	}
},

{
	name: "macro",
	match: "<<",
	lookaheadRegExp: /<<([^>\s]+)(?:\s*)((?:[^>]|(?:>(?!>)))*)>>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[1]) {
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			invokeMacro(w.output,lookaheadMatch[1],lookaheadMatch[2],w,w.tiddler);
		}
	}
},

{
	name: "prettyLink",
	match: "\\[\\[",
	lookaheadRegExp: /\[\[(.*?)(?:\|(~)?(.*?))?\]\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e;
			var text = lookaheadMatch[1];
			if(lookaheadMatch[3]) {
				// Pretty bracketted link
				var link = lookaheadMatch[3];
				e = (!lookaheadMatch[2] && config.formatterHelpers.isExternalLink(link)) ?
						createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
			} else {
				// Simple bracketted link
				e = createTiddlyLink(w.output,text,false,null,w.isStatic,w.tiddler);
			}
			createTiddlyText(e,text);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "wikiLink",
	match: config.textPrimitives.unWikiLink+"?"+config.textPrimitives.wikiLink,
	handler: function(w)
	{
		if(w.matchText.substr(0,1) == config.textPrimitives.unWikiLink) {
			w.outputText(w.output,w.matchStart+1,w.nextMatch);
			return;
		}
		if(w.matchStart > 0) {
			var preRegExp = new RegExp(config.textPrimitives.anyLetterStrict,"mg");
			preRegExp.lastIndex = w.matchStart-1;
			var preMatch = preRegExp.exec(w.source);
			if(preMatch.index == w.matchStart-1) {
				w.outputText(w.output,w.matchStart,w.nextMatch);
				return;
			}
		}
		if(w.autoLinkWikiWords || store.isShadowTiddler(w.matchText)) {
			var link = createTiddlyLink(w.output,w.matchText,false,null,w.isStatic,w.tiddler);
			w.outputText(link,w.matchStart,w.nextMatch);
		} else {
			w.outputText(w.output,w.matchStart,w.nextMatch);
		}
	}
},

{
	name: "urlLink",
	match: config.textPrimitives.urlPattern,
	handler: function(w)
	{
		w.outputText(createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch);
	}
},

{
	name: "image",
	match: "\\[[<>]?[Ii][Mm][Gg]\\[",
	lookaheadRegExp: /\[([<]?)(>?)[Ii][Mm][Gg]\[(?:([^\|\]]+)\|)?([^\[\]\|]+)\](?:\[([^\]]*)\])?\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e = w.output;
			if(lookaheadMatch[5]) {
				var link = lookaheadMatch[5];
				e = config.formatterHelpers.isExternalLink(link) ? createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
				jQuery(e).addClass("imageLink");
			}
			var img = createTiddlyElement(e,"img");
			if(lookaheadMatch[1])
				img.align = "left";
			else if(lookaheadMatch[2])
				img.align = "right";
			if(lookaheadMatch[3]) {
				img.title = lookaheadMatch[3];
				img.setAttribute("alt",lookaheadMatch[3]);
			}
			img.src = lookaheadMatch[4];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "html",
	match: "<[Hh][Tt][Mm][Ll]>",
	lookaheadRegExp: /<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span").innerHTML = lookaheadMatch[1];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "commentByBlock",
	match: "/%",
	lookaheadRegExp: /\/%((?:.|\n)*?)%\//mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			w.nextMatch = this.lookaheadRegExp.lastIndex;
	}
},

{
	name: "characterFormat",
	match: "''|//|__|\\^\\^|~~|--(?!\\s|$)|\\{\\{\\{",
	handler: function(w)
	{
		switch(w.matchText) {
		case "''":
			w.subWikifyTerm(w.output.appendChild(document.createElement("strong")),/('')/mg);
			break;
		case "//":
			w.subWikifyTerm(createTiddlyElement(w.output,"em"),/(\/\/)/mg);
			break;
		case "__":
			w.subWikifyTerm(createTiddlyElement(w.output,"u"),/(__)/mg);
			break;
		case "^^":
			w.subWikifyTerm(createTiddlyElement(w.output,"sup"),/(\^\^)/mg);
			break;
		case "~~":
			w.subWikifyTerm(createTiddlyElement(w.output,"sub"),/(~~)/mg);
			break;
		case "--":
			w.subWikifyTerm(createTiddlyElement(w.output,"strike"),/(--)/mg);
			break;
		case "{{{":
			var lookaheadRegExp = /\{\{\{((?:.|\n)*?)\}\}\}/mg;
			lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
				createTiddlyElement(w.output,"code",null,null,lookaheadMatch[1]);
				w.nextMatch = lookaheadRegExp.lastIndex;
			}
			break;
		}
	}
},

{
	name: "customFormat",
	match: "@@|\\{\\{",
	handler: function(w)
	{
		switch(w.matchText) {
		case "@@":
			var e = createTiddlyElement(w.output,"span");
			var styles = config.formatterHelpers.inlineCssHelper(w);
			if(styles.length == 0)
				e.className = "marked";
			else
				config.formatterHelpers.applyCssHelper(e,styles);
			w.subWikifyTerm(e,/(@@)/mg);
			break;
		case "{{":
			var lookaheadRegExp = /\{\{[\s]*([\w]+[\s\w]*)[\s]*\{(\n?)/mg;
			lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			if(lookaheadMatch) {
				w.nextMatch = lookaheadRegExp.lastIndex;
				e = createTiddlyElement(w.output,lookaheadMatch[2] == "\n" ? "div" : "span",null,lookaheadMatch[1]);
				w.subWikifyTerm(e,/(\}\}\})/mg);
			}
			break;
		}
	}
},

{
	name: "mdash",
	match: "--",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = "&mdash;";
	}
},

{
	name: "lineBreak",
	match: "\\n|<br ?/?>",
	handler: function(w)
	{
		createTiddlyElement(w.output,"br");
	}
},

{
	name: "rawText",
	match: "\"{3}|<nowiki>",
	lookaheadRegExp: /(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span",null,null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "htmlEntitiesEncoding",
	match: "(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = w.matchText;
	}
}

];

//--
//-- Wikifier
//--

function getParser(tiddler,format)
{
	if(tiddler) {
		if(!format)
			format = tiddler.fields["wikiformat"];
		var i;
		if(format) {
			for(i in config.parsers) {
				if(format == config.parsers[i].format)
					return config.parsers[i];
			}
		} else {
			for(i in config.parsers) {
				if(tiddler.isTagged(config.parsers[i].formatTag))
					return config.parsers[i];
			}
		}
	}
	return formatter;
}

function Wikifier(source,formatter,highlightRegExp,tiddler)
{
	this.source = source;
	this.output = null;
	this.formatter = formatter;
	this.nextMatch = 0;
	this.autoLinkWikiWords = tiddler && tiddler.autoLinkWikiWords() == false ? false : true;
	this.highlightRegExp = highlightRegExp;
	this.highlightMatch = null;
	this.isStatic = false;
	if(highlightRegExp) {
		highlightRegExp.lastIndex = 0;
		this.highlightMatch = highlightRegExp.exec(source);
	}
	this.tiddler = tiddler;
}

Wikifier.prototype.wikifyPlain = function()
{
	var e = createTiddlyElement(document.body,"div");
	e.style.display = "none";
	this.subWikify(e);
	var text = jQuery(e).text();
	jQuery(e).remove();
	return text;
};

Wikifier.prototype.subWikify = function(output,terminator)
{
	try {
		if(terminator)
			this.subWikifyTerm(output,new RegExp("(" + terminator + ")","mg"));
		else
			this.subWikifyUnterm(output);
	} catch(ex) {
		showException(ex);
	}
};

Wikifier.prototype.subWikifyUnterm = function(output)
{
	var oldOutput = this.output;
	this.output = output;
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	while(formatterMatch) {
		// Output any text before the match
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		// Set the match parameters for the handler
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		var t;
		for(t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.subWikifyTerm = function(output,terminatorRegExp)
{
	var oldOutput = this.output;
	this.output = output;
	terminatorRegExp.lastIndex = this.nextMatch;
	var terminatorMatch = terminatorRegExp.exec(this.source);
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	while(terminatorMatch || formatterMatch) {
		if(terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index)) {
			if(terminatorMatch.index > this.nextMatch)
				this.outputText(this.output,this.nextMatch,terminatorMatch.index);
			this.matchText = terminatorMatch[1];
			this.matchLength = terminatorMatch[1].length;
			this.matchStart = terminatorMatch.index;
			this.nextMatch = this.matchStart + this.matchLength;
			this.output = oldOutput;
			return;
		}
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		var t;
		for(t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		terminatorRegExp.lastIndex = this.nextMatch;
		terminatorMatch = terminatorRegExp.exec(this.source);
		formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.outputText = function(place,startPos,endPos)
{
	while(this.highlightMatch && (this.highlightRegExp.lastIndex > startPos) && (this.highlightMatch.index < endPos) && (startPos < endPos)) {
		if(this.highlightMatch.index > startPos) {
			createTiddlyText(place,this.source.substring(startPos,this.highlightMatch.index));
			startPos = this.highlightMatch.index;
		}
		var highlightEnd = Math.min(this.highlightRegExp.lastIndex,endPos);
		createTiddlyElement(place,"span",null,"highlight",this.source.substring(startPos,highlightEnd));
		startPos = highlightEnd;
		if(startPos >= this.highlightRegExp.lastIndex)
			this.highlightMatch = this.highlightRegExp.exec(this.source);
	}
	if(startPos < endPos) {
		createTiddlyText(place,this.source.substring(startPos,endPos));
	}
};

function wikify(source,output,highlightRegExp,tiddler)
{
	if(source) {
		var wikifier = new Wikifier(source,getParser(tiddler),highlightRegExp,tiddler);
		var t0 = new Date();
		wikifier.subWikify(output);
		if(tiddler && config.options.chkDisplayInstrumentation)
			displayMessage("wikify:" +tiddler.title+ " in " + (new Date()-t0) + " ms");
	}
}

function wikifyStatic(source,highlightRegExp,tiddler,format)
{
	var e = createTiddlyElement(document.body,"pre");
	e.style.display = "none";
	var html = "";
	if(source && source != "") {
		if(!tiddler)
			tiddler = new Tiddler("temp");
		var wikifier = new Wikifier(source,getParser(tiddler,format),highlightRegExp,tiddler);
		wikifier.isStatic = true;
		wikifier.subWikify(e);
		html = e.innerHTML;
		jQuery(e).remove();
	}
	return html;
}

function wikifyPlainText(text,limit,tiddler)
{
	if(limit > 0)
		text = text.substr(0,limit);
	var wikifier = new Wikifier(text,formatter,null,tiddler);
	return wikifier.wikifyPlain();
}

function highlightify(source,output,highlightRegExp,tiddler)
{
	if(source) {
		var wikifier = new Wikifier(source,formatter,highlightRegExp,tiddler);
		wikifier.outputText(output,0,source.length);
	}
}

//--
//-- Macro definitions
//--

function invokeMacro(place,macro,params,wikifier,tiddler)
{
	try {
		var m = config.macros[macro];
		if(m && m.handler) {
			var tiddlerElem = story.findContainingTiddler(place);
			window.tiddler = tiddlerElem ? store.getTiddler(tiddlerElem.getAttribute("tiddler")) : null;
			window.place = place;
			var allowEval = true;
			if(config.evaluateMacroParameters=="system") {
				if(!tiddler || tiddler.tags.indexOf("systemAllowEval") == -1) {
					allowEval = false;
				}
			}
			m.handler(place,macro,m.noPreParse?null:params.readMacroParams(!allowEval),wikifier,params,tiddler);
		} else {
			createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,config.messages.missingMacro]));
		}
	} catch(ex) {
		createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,ex.toString()]));
	}
}

config.macros.version.handler = function(place)
{
	jQuery("<span/>").text(formatVersion()).appendTo(place);
};

config.macros.today.handler = function(place,macroName,params)
{
	var now = new Date();
	var text = params[0] ? now.formatString(params[0].trim()) : now.toLocaleString();
	jQuery("<span/>").text(text).appendTo(place);
};

config.macros.list.template = "<<view title link>>";
config.macros.list.handler = function(place,macroName,params,wikifier,paramString)
{
	var list = document.createElement("ul");
	jQuery(list).attr({ refresh: "macro", macroName: macroName }).data("params", paramString);
	place.appendChild(list);
	this.refresh(list);
};

config.macros.list.refresh = function(list) {
	var paramString = jQuery(list).data("params");
	var params = paramString.readMacroParams();
	var args = paramString.parseParams("anon", null, null)[0];
	var type = args.anon ? args.anon[0] : "all";
	jQuery(list).empty().addClass("list list-" + type);
	var template = args.template ? store.getTiddlerText(args.template[0]) : false;
	if(!template) {
		template = config.macros.list.template;
	}
	if(this[type].prompt)
		createTiddlyElement(list,"li",null,"listTitle",this[type].prompt);
	var results;
	if(this[type].handler)
		results = this[type].handler(params);
	var t;
	for(t = 0; t < results.length; t++) {
		var li = document.createElement("li");
		list.appendChild(li);
		var tiddler = results[t];
		if(typeof(tiddler) == 'string') { // deal with missing etc..
				tiddler = store.getTiddler(tiddler) || new Tiddler(tiddler);
		}
		wikify(template, li, null, tiddler);
	}
	if(results.length === 0 && args.emptyMessage) {
		jQuery(list).addClass("emptyList");
		jQuery("<li />").text(args.emptyMessage[0]).appendTo(list);
	}
};

config.macros.list.all.handler = function(params)
{
	return store.reverseLookup("tags","excludeLists",false,"title");
};

config.macros.list.missing.handler = function(params)
{
	return store.getMissingLinks();
};

config.macros.list.orphans.handler = function(params)
{
	return store.getOrphans();
};

config.macros.list.shadowed.handler = function(params)
{
	return store.getShadowed();
};

config.macros.list.touched.handler = function(params)
{
	return store.getTouched();
};

config.macros.list.filter.handler = function(params)
{
	var filter = params[1];
	var results = [];
	if(filter) {
		var tiddlers = store.filterTiddlers(filter);
		var t;
		for(t=0; t<tiddlers.length; t++)
			results.push(tiddlers[t].title);
	}
	return results;
};

config.macros.allTags.handler = function(place,macroName,params)
{
	var tags = store.getTags(params[0]);
	var ul = createTiddlyElement(place,"ul");
	if(tags.length == 0)
		createTiddlyElement(ul,"li",null,"listTitle",this.noTags);
	var t;
	for(t=0; t<tags.length; t++) {
		var title = tags[t][0];
		var info = getTiddlyLinkInfo(title);
		var li = createTiddlyElement(ul,"li");
		var btn = createTiddlyButton(li,title + " (" + tags[t][1] + ")",this.tooltip.format([title]),onClickTag,info.classes);
		btn.setAttribute("tag",title);
		btn.setAttribute("refresh","link");
		btn.setAttribute("tiddlyLink",title);
		if(params[1]) {
			btn.setAttribute("sortby",params[1]);
		}
	}
};

var macro = config.macros.timeline;
merge(macro, {
	handler: function(place,macroName,params, wikifier, paramString, tiddler) {
		var container = jQuery("<div />").attr("params", paramString).
			attr("macroName", macroName).appendTo(place)[0];
		macro.refresh(container);
	},
	refresh: function(container) {
		jQuery(container).attr("refresh", "macro").empty();
		var paramString = jQuery(container).attr("params");
		var args = paramString.parseParams("anon", null, null)[0];
		var params = args.anon || [];

		var field = params[0] || "modified";
		var dateFormat = params[2] || this.dateFormat;
		var groupTemplate = macro.groupTemplate.format(field, dateFormat);
		groupTemplate = args.groupTemplate ? store.getTiddlerText(args.groupTemplate[0]) || groupTemplate :
			groupTemplate;

		var itemTemplate = macro.itemTemplate;
		itemTemplate = args.template ? store.getTiddlerText(args.template[0]) || itemTemplate :
			itemTemplate;

		var tiddlers = args.filter ? store.sortTiddlers(store.filterTiddlers(args.filter[0]), field) :
			store.reverseLookup("tags", "excludeLists", false, field);
		var lastGroup = "", ul;
		var last = params[1] ? tiddlers.length-Math.min(tiddlers.length,parseInt(params[1],10)) : 0;
		var t;
		for(t=tiddlers.length-1; t>=last; t--) {
			var tiddler = tiddlers[t];
			var theGroup = wikifyPlainText(groupTemplate,0,tiddler);
			if(typeof(ul) == "undefined" || theGroup != lastGroup) {
				ul = document.createElement("ul");
				jQuery(ul).addClass("timeline");
				container.appendChild(ul);
				createTiddlyElement(ul,"li",null,"listTitle",theGroup);
				lastGroup = theGroup;
			}
			var item = createTiddlyElement(ul,"li",null,"listLink");
			wikify(itemTemplate,item,null,tiddler);
		}
	},
	groupTemplate: "<<view %0 date '%1'>>", 
	itemTemplate: "<<view title link>>"
});

config.macros.tiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var allowEval = true;
	var stack = config.macros.tiddler.tiddlerStack;
	if(stack.length > 0 && config.evaluateMacroParameters == "system") {
		// included tiddler and "system" evaluation required, so check tiddler tagged appropriately
		var title = stack[stack.length-1];
		var pos = title.indexOf(config.textPrimitives.sectionSeparator);
		if(pos != -1) {
			title = title.substr(0,pos); // get the base tiddler title
		}
		var t = store.getTiddler(title);
		if(!t || t.tags.indexOf("systemAllowEval") == -1) {
			allowEval = false;
		}
	}
	params = paramString.parseParams("name",null,allowEval,false,true);
	var names = params[0]["name"];
	var tiddlerName = names[0];
	var className = names[1] || null;
	var args = params[0]["with"];
	var wrapper = createTiddlyElement(place,"span",null,className,null,{
		refresh: "content", tiddler: tiddlerName
	});
	if(args!==undefined)
		wrapper.setAttribute("args","[["+args.join("]] [[")+"]]");
	this.transclude(wrapper,tiddlerName,args);
};

config.macros.tiddler.transclude = function(wrapper,tiddlerName,args)
{
	var text = store.getTiddlerText(tiddlerName);
	if(!text)
		return;
	var stack = config.macros.tiddler.tiddlerStack;
	if(stack.indexOf(tiddlerName) !== -1)
		return;
	stack.push(tiddlerName);
	try {
		if(typeof args == "string")
			args = args.readBracketedList();
		var n = args ? Math.min(args.length,9) : 0;
		var i;
		for(i=0; i<n; i++) {
			var placeholderRE = new RegExp("\\$" + (i + 1),"mg");
			text = text.replace(placeholderRE,args[i]);
		}
		config.macros.tiddler.renderText(wrapper,text,tiddlerName);
	} finally {
		stack.pop();
	}
};

config.macros.tiddler.renderText = function(place,text,tiddlerName)
{
	wikify(text,place,null,store.getTiddler(tiddlerName));
};

config.macros.tiddler.tiddlerStack = [];

config.macros.tag.handler = function(place,macroName,params)
{
	var btn = createTagButton(place,params[0],null,params[1],params[2]);
	if(params[3]) {
		btn.setAttribute('sortby',params[3]);
	}
};

config.macros.tags.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var ul = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title && store.tiddlerExists(title))
		tiddler = store.getTiddler(title);
	var sep = getParam(params,"sep"," ");
	var lingo = config.views.wikified.tag;
	var label = null;
	var t;
	for(t=0; t<tiddler.tags.length; t++) {
		var tag = store.getTiddler(tiddler.tags[t]);
		if(!tag || !tag.tags.contains("excludeLists")) {
			if(!label)
				label = createTiddlyElement(ul,"li",null,"listTitle",lingo.labelTags.format([tiddler.title]));
			createTagButton(createTiddlyElement(ul,"li"),tiddler.tags[t],tiddler.title);
			if(t<tiddler.tags.length-1)
				createTiddlyText(ul,sep);
		}
	}
	if(!label)
		createTiddlyElement(ul,"li",null,"listTitle",lingo.labelNoTags.format([tiddler.title]));
};

config.macros.tagging.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var ul = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title == "" && tiddler instanceof Tiddler)
		title = tiddler.title;
	var sep = getParam(params,"sep"," ");
	ul.setAttribute("title",this.tooltip.format([title]));
	var tagged = store.getTaggedTiddlers(title);
	var prompt = tagged.length == 0 ? this.labelNotTag : this.label;
	createTiddlyElement(ul,"li",null,"listTitle",prompt.format([title,tagged.length]));
	var t;
	for(t=0; t<tagged.length; t++) {
		createTiddlyLink(createTiddlyElement(ul,"li"),tagged[t].title,true);
		if(t<tagged.length-1)
			createTiddlyText(ul,sep);
	}
};

config.macros.closeAll.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.closeAll.onClick = function(e)
{
	story.closeAllTiddlers();
	return false;
};

config.macros.permaview.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.permaview.onClick = function(e)
{
	story.permaView();
	return false;
};

config.macros.saveChanges.handler = function(place,macroName,params)
{
	if(!readOnly)
		createTiddlyButton(place,params[0] || this.label,params[1] || this.prompt,this.onClick,null,null,this.accessKey);
};

config.macros.saveChanges.onClick = function(e)
{
	saveChanges();
	return false;
};

config.macros.slider.onClickSlider = function(ev)
{
	var n = this.nextSibling;
	var cookie = n.getAttribute("cookie");
	var isOpen = n.style.display != "none";
	if(config.options.chkAnimate && anim && typeof Slider == "function")
		anim.startAnimating(new Slider(n,!isOpen,null,"none"));
	else
		n.style.display = isOpen ? "none" : "block";
	config.options[cookie] = !isOpen;
	saveOption(cookie);
	return false;
};

config.macros.slider.createSlider = function(place,cookie,title,tooltip)
{
	var c = cookie || "";
	createTiddlyButton(place,title,tooltip,this.onClickSlider);
	var panel = createTiddlyElement(null,"div",null,"sliderPanel");
	panel.setAttribute("cookie",c);
	panel.style.display = config.options[c] ? "block" : "none";
	place.appendChild(panel);
	return panel;
};

config.macros.slider.handler = function(place,macroName,params)
{
	var panel = this.createSlider(place,params[0],params[2],params[3]);
	var text = store.getTiddlerText(params[1]);
	panel.setAttribute("refresh","content");
	panel.setAttribute("tiddler",params[1]);
	if(text)
		wikify(text,panel,null,store.getTiddler(params[1]));
};

// <<gradient [[tiddler name]] vert|horiz rgb rgb rgb rgb... >>
config.macros.gradient.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var panel = wikifier ? createTiddlyElement(place,"div",null,"gradient") : place;
	panel.style.position = "relative";
	panel.style.overflow = "hidden";
	panel.style.zIndex = "0";
	if(wikifier) {
		var styles = config.formatterHelpers.inlineCssHelper(wikifier);
		config.formatterHelpers.applyCssHelper(panel,styles);
	}
	params = paramString.parseParams("color");
	var locolors = [], hicolors = [];
	var t;
	for(t=2; t<params.length; t++) {
		var c = params[t].value;
		if(params[t].name == "snap") {
			hicolors[hicolors.length-1] = c;
		} else {
			locolors.push(c);
			hicolors.push(c);
		}
	}
	drawGradient(panel,params[1].value != "vert",locolors,hicolors);
	if(wikifier)
		wikifier.subWikify(panel,">>");
	if(document.all) {
		panel.style.height = "100%";
		panel.style.width = "100%";
	}
};

config.macros.message.handler = function(place,macroName,params)
{
	if(params[0]) {
		var names = params[0].split(".");
		var lookupMessage = function(root,nameIndex) {
				if(root[names[nameIndex]]) {
					if(nameIndex < names.length-1)
						return (lookupMessage(root[names[nameIndex]],nameIndex+1));
					else
						return root[names[nameIndex]];
				} else
					return null;
			};
		var m = lookupMessage(config,0);
		if(m == null)
			m = lookupMessage(window,0);
		createTiddlyText(place,m.toString().format(params.splice(1)));
	}
};


config.macros.view.depth = 0;
config.macros.view.values = [];
config.macros.view.views = {
	text: function(value,place,params,wikifier,paramString,tiddler) {
		highlightify(value,place,highlightHack,tiddler);
	},
	link: function(value,place,params,wikifier,paramString,tiddler) {
		createTiddlyLink(place,value,true);
	},
	wikified: function(value,place,params,wikifier,paramString,tiddler) {
		if(config.macros.view.depth>50)
			return;
		if(config.macros.view.depth>0) {
			if (value==config.macros.view.values[config.macros.view.depth-1]) {
				return;
			}
		}
		config.macros.view.values[config.macros.view.depth] = value;
		config.macros.view.depth++;
		if(params[2])
			value=params[2].unescapeLineBreaks().format([value]);
		wikify(value,place,highlightHack,tiddler);
		config.macros.view.depth--;
		config.macros.view.values[config.macros.view.depth] = null;
	},
	date: function(value,place,params,wikifier,paramString,tiddler) {
		value = Date.convertFromYYYYMMDDHHMM(value);
		createTiddlyText(place,value.formatString(params[2] || config.views.wikified.dateFormat));
	}
};

config.macros.view.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if((tiddler instanceof Tiddler) && params[0]) {
		var value = store.getValue(tiddler,params[0]);
		if(value) {
			var type = params[1] || config.macros.view.defaultView;
			var handler = config.macros.view.views[type];
			if(handler)
				handler(value,place,params,wikifier,paramString,tiddler);
		}
	}
};

config.macros.edit.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var field = params[0];
	var rows = params[1] || 0;
	var defVal = params[2] || '';
	if((tiddler instanceof Tiddler) && field) {
		story.setDirty(tiddler.title,true);
		var e,v;
		if(field != "text" && !rows) {
			e = createTiddlyElement(null,"input",null,null,null,{
				type: "text", edit: field, size: "40", autocomplete: "off"
			});
			e.value = store.getValue(tiddler,field) || defVal;
			place.appendChild(e);
		} else {
			var wrapper1 = createTiddlyElement(null,"fieldset",null,"fieldsetFix");
			var wrapper2 = createTiddlyElement(wrapper1,"div");
			e = createTiddlyElement(wrapper2,"textarea");
			e.value = v = store.getValue(tiddler,field) || defVal;
			rows = rows || 10;
			var lines = v.match(/\n/mg);
			var maxLines = Math.max(parseInt(config.options.txtMaxEditRows,10),5);
			if(lines != null && lines.length > rows)
				rows = lines.length + 5;
			rows = Math.min(rows,maxLines);
			e.setAttribute("rows",rows);
			e.setAttribute("edit",field);
			place.appendChild(wrapper1);
		}
		if(tiddler.isReadOnly()) {
			e.setAttribute("readOnly","readOnly");
			jQuery(e).addClass("readOnly");
		}
		return e;
	}
};

config.macros.tagChooser.onClick = function(ev)
{
	var e = ev || window.event;
	var lingo = config.views.editor.tagChooser;
	var popup = Popup.create(this);
	var tags = store.getTags(this.getAttribute("tags"));
	if(tags.length == 0)
		jQuery("<li/>").text(lingo.popupNone).appendTo(popup);
	var t;
	for(t=0; t<tags.length; t++) {
		var tag = createTiddlyButton(createTiddlyElement(popup,"li"),tags[t][0],lingo.tagTooltip.format([tags[t][0]]),config.macros.tagChooser.onTagClick);
		tag.setAttribute("tag",tags[t][0]);
		tag.setAttribute("tiddler",this.getAttribute("tiddler"));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
};

config.macros.tagChooser.onTagClick = function(ev)
{
	var e = ev || window.event;
	if(e.metaKey || e.ctrlKey) stopEvent(e); //# keep popup open on CTRL-click
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(!readOnly)
		story.setTiddlerTag(title,tag,0);
	return false;
};

config.macros.tagChooser.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(tiddler instanceof Tiddler) {
		var lingo = config.views.editor.tagChooser;
		var btn = createTiddlyButton(place,lingo.text,lingo.tooltip,this.onClick);
		btn.setAttribute("tiddler",tiddler.title);
		btn.setAttribute("tags",params[0]);
	}
};

config.macros.refreshDisplay.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.refreshDisplay.onClick = function(e)
{
	refreshAll();
	return false;
};

config.macros.annotations.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var title = tiddler ? tiddler.title : null;
	var a = title ? config.annotations[title] : null;
	if(!tiddler || !title || !a)
		return;
	var text = a.format([title]);
	wikify(text,createTiddlyElement(place,"div",null,"annotation"),null,tiddler);
};
//--
//-- NewTiddler and NewJournal macros
//--

config.macros.newTiddler.createNewTiddlerButton = function(place,title,params,label,prompt,accessKey,newFocus,isJournal)
{
	var tags = [];
	var t;
	for(t=1; t<params.length; t++) {
		if((params[t].name == "anon" && t != 1) || (params[t].name == "tag"))
			tags.push(params[t].value);
	}
	label = getParam(params,"label",label);
	prompt = getParam(params,"prompt",prompt);
	accessKey = getParam(params,"accessKey",accessKey);
	newFocus = getParam(params,"focus",newFocus);
	var customFields = getParam(params,"fields","");
	if(!customFields && !store.isShadowTiddler(title))
		customFields = String.encodeHashMap(config.defaultCustomFields);
	var btn = createTiddlyButton(place,label,prompt,this.onClickNewTiddler,null,null,accessKey);
	btn.setAttribute("newTitle",title);
	btn.setAttribute("isJournal",isJournal ? "true" : "false");
	if(tags.length > 0)
		btn.setAttribute("params",tags.join("|"));
	btn.setAttribute("newFocus",newFocus);
	btn.setAttribute("newTemplate",getParam(params,"template",DEFAULT_EDIT_TEMPLATE));
	if(customFields !== "")
		btn.setAttribute("customFields",customFields);
	var text = getParam(params,"text");
	if(text !== undefined)
		btn.setAttribute("newText",text);
	return btn;
};

config.macros.newTiddler.onClickNewTiddler = function()
{
	var title = this.getAttribute("newTitle");
	if(this.getAttribute("isJournal") == "true") {
		title = new Date().formatString(title.trim());
	}
	var params = this.getAttribute("params");
	var tags = params ? params.split("|") : [];
	var focus = this.getAttribute("newFocus");
	var template = this.getAttribute("newTemplate");
	var customFields = this.getAttribute("customFields");
	if(!customFields && !store.isShadowTiddler(title))
		customFields = String.encodeHashMap(config.defaultCustomFields);
	story.displayTiddler(null,title,template,false,null,null);
	var tiddlerElem = story.getTiddler(title);
	if(customFields)
		story.addCustomFields(tiddlerElem,customFields);
	var text = this.getAttribute("newText");
	if(typeof text == "string" && story.getTiddlerField(title,"text"))
		story.getTiddlerField(title,"text").value = text.format([title]);
	var t;
	for(t=0;t<tags.length;t++)
		story.setTiddlerTag(title,tags[t],+1);
	story.focusTiddler(title,focus);
	return false;
};

config.macros.newTiddler.handler = function(place,macroName,params,wikifier,paramString)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : this.title;
		title = getParam(params,"title",title);
		this.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"title",false);
	}
};

config.macros.newJournal.handler = function(place,macroName,params,wikifier,paramString)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : config.macros.timeline.dateFormat;
		title = getParam(params,"title",title);
		config.macros.newTiddler.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"text",true);
	}
};

//--
//-- Search macro
//--

config.macros.search.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,false,false,false);
	createTiddlyButton(place,this.label,this.prompt,this.onClick,"searchButton");
	var txt = createTiddlyElement(null,"input",null,"txtOptionInput searchField");
	txt.value = getParam(params,"anon","");
	if(config.browser.isSafari) {
		txt.setAttribute("type","search");
		txt.setAttribute("results","5");
	} else {
		txt.setAttribute("type","text");
	}
	place.appendChild(txt);
	txt.onkeyup = this.onKeyPress;
	txt.onfocus = this.onFocus;
	txt.setAttribute("size",this.sizeTextbox);
	txt.setAttribute("accessKey",getParam(params,"accesskey",this.accessKey));
	txt.setAttribute("autocomplete","off");
	txt.setAttribute("lastSearchText","");
	txt.setAttribute("placeholder",getParam(params,"placeholder",this.placeholder));
};

// Global because there's only ever one outstanding incremental search timer
config.macros.search.timeout = null;

config.macros.search.doSearch = function(txt)
{
	if(txt.value.length > 0) {
		story.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);
		txt.setAttribute("lastSearchText",txt.value);
	}
};

config.macros.search.onClick = function(e)
{
	config.macros.search.doSearch(this.nextSibling);
	return false;
};

config.macros.search.onKeyPress = function(ev)
{
	var me = config.macros.search;
	var e = ev || window.event;
	switch(e.keyCode) {
		case 9: // Tab
			return;
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
			me.doSearch(this);
			break;
		case 27: // Escape
			this.value = "";
			clearMessage();
			break;
	}
	if(config.options.chkIncrementalSearch) {
		if(this.value.length > 2) {
			if(this.value != this.getAttribute("lastSearchText")) {
				if(me.timeout) {
					clearTimeout(me.timeout);
				}
				var txt = this;
				me.timeout = setTimeout(function() {me.doSearch(txt);},500);
			}
		} else {
			if(me.timeout) {
				clearTimeout(me.timeout);
			}
		}
	}
};

config.macros.search.onFocus = function(e)
{
	this.select();
};

//--
//-- Tabs macro
//--

config.macros.tabs.handler = function(place,macroName,params)
{
	var cookie = params[0];
	var numTabs = (params.length-1)/3;
	var wrapper = createTiddlyElement(null,"div",null,"tabsetWrapper " + cookie);
	var tabset = createTiddlyElement(wrapper,"div",null,"tabset");
	tabset.setAttribute("cookie",cookie);
	var validTab = false;
	var t;
	for(t=0; t<numTabs; t++) {
		var label = params[t*3+1];
		var prompt = params[t*3+2];
		var content = params[t*3+3];
		var tab = createTiddlyButton(tabset,label,prompt,this.onClickTab,"tab tabUnselected");
		createTiddlyElement(tab,"span",null,null," ",{style:"font-size:0pt;line-height:0px"});
		tab.setAttribute("tab",label);
		tab.setAttribute("content",content);
		tab.title = prompt;
		if(config.options[cookie] == label)
			validTab = true;
	}
	if(!validTab)
		config.options[cookie] = params[1];
	place.appendChild(wrapper);
	this.switchTab(tabset,config.options[cookie]);
};

config.macros.tabs.onClickTab = function(e)
{
	config.macros.tabs.switchTab(this.parentNode,this.getAttribute("tab"));
	return false;
};

config.macros.tabs.switchTab = function(tabset,tab)
{
	var cookie = tabset.getAttribute("cookie");
	var theTab = null;
	var nodes = tabset.childNodes;
	var t;
	for(t=0; t<nodes.length; t++) {
		if(nodes[t].getAttribute && nodes[t].getAttribute("tab") == tab) {
			theTab = nodes[t];
			theTab.className = "tab tabSelected";
		} else {
			nodes[t].className = "tab tabUnselected";
		}
	}
	if(theTab) {
		if(tabset.nextSibling && tabset.nextSibling.className == "tabContents")
			jQuery(tabset.nextSibling).remove();
		var tabContent = createTiddlyElement(null,"div",null,"tabContents");
		tabset.parentNode.insertBefore(tabContent,tabset.nextSibling);
		var contentTitle = theTab.getAttribute("content");
		wikify(store.getTiddlerText(contentTitle),tabContent,null,store.getTiddler(contentTitle));
		if(cookie) {
			config.options[cookie] = tab;
			saveOption(cookie);
		}
	}
};

//--
//-- Tiddler toolbar
//--

// Create a toolbar command button
config.macros.toolbar.createCommand = function(place,commandName,tiddler,className)
{
	if(typeof commandName != "string") {
		var c = null;
		var t;
		for(t in config.commands) {
			if(config.commands[t] == commandName)
				c = t;
		}
		commandName = c;
	}
	if((tiddler instanceof Tiddler) && (typeof commandName == "string")) {
		var command = config.commands[commandName];
		if(command.isEnabled ? command.isEnabled(tiddler) : this.isCommandEnabled(command,tiddler)) {
			var text = command.getText ? command.getText(tiddler) : this.getCommandText(command,tiddler);
			var tooltip = command.getTooltip ? command.getTooltip(tiddler) : this.getCommandTooltip(command,tiddler);
			var cmd = command.type == "popup" ? this.onClickPopup : this.onClickCommand;
			var btn = createTiddlyButton(null,text,tooltip,cmd);
			btn.setAttribute("commandName",commandName);
			btn.setAttribute("tiddler",tiddler.title);
			jQuery(btn).addClass("command_" + commandName);
			if(className)
				jQuery(btn).addClass(className);
			place.appendChild(btn);
		}
	}
};

config.macros.toolbar.isCommandEnabled = function(command,tiddler)
{
	var title = tiddler.title;
	var ro = tiddler.isReadOnly();
	var shadow = store.isShadowTiddler(title) && !store.tiddlerExists(title);
	return (!ro || (ro && !command.hideReadOnly)) && !(shadow && command.hideShadow);
};

config.macros.toolbar.getCommandText = function(command,tiddler)
{
	return (tiddler.isReadOnly() && command.readOnlyText) || command.text;
};

config.macros.toolbar.getCommandTooltip = function(command,tiddler)
{
	return (tiddler.isReadOnly() && command.readOnlyTooltip) || command.tooltip;
};

config.macros.toolbar.onClickCommand = function(ev)
{
	var e = ev || window.event;
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	var command = config.commands[this.getAttribute("commandName")];
	return command.handler(e,this,this.getAttribute("tiddler"));
};

config.macros.toolbar.onClickPopup = function(ev)
{
	var e = ev || window.event;
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	var popup = Popup.create(this);
	var command = config.commands[this.getAttribute("commandName")];
	var title = this.getAttribute("tiddler");
	popup.setAttribute("tiddler",title);
	command.handlePopup(popup,title);
	Popup.show();
	return false;
};

// Invoke the first command encountered from a given place that is tagged with a specified class
config.macros.toolbar.invokeCommand = function(place,className,event)
{
	var children = place.getElementsByTagName("a");
	var t;
	for(t=0; t<children.length; t++) {
		var c = children[t];
		if(jQuery(c).hasClass(className) && c.getAttribute && c.getAttribute("commandName")) {
			if(c.onclick instanceof Function)
				c.onclick.call(c,event);
			break;
		}
	}
};

config.macros.toolbar.onClickMore = function(ev)
{
	var e = this.nextSibling;
	e.style.display = "inline";
	this.style.display = "none";
	return false;
};

config.macros.toolbar.onClickLess = function(ev)
{
	var e = this.parentNode;
	var m = e.previousSibling;
	e.style.display = "none";
	m.style.display = "inline";
	return false;
};

config.macros.toolbar.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var t;
	for(t=0; t<params.length; t++) {
		var btn;
		var c = params[t];
		switch(c) {
		case "!":
			createTiddlyText(place,this.separator);
			break;
		case "*":
			createTiddlyElement(place,"br");
			break;
		case "<":
			btn = createTiddlyButton(place,this.lessLabel,this.lessPrompt,config.macros.toolbar.onClickLess);
			jQuery(btn).addClass("lessCommand");
			break;
		case ">":
			btn = createTiddlyButton(place,this.moreLabel,this.morePrompt,config.macros.toolbar.onClickMore);
			jQuery(btn).addClass("moreCommand");
			var e = createTiddlyElement(place,"span",null,"moreCommand");
			e.style.display = "none";
			place = e;
			break;
		default:
			var className = "";
			switch(c.substr(0,1)) {
			case "+":
				className = "defaultCommand";
				c = c.substr(1);
				break;
			case "-":
				className = "cancelCommand";
				c = c.substr(1);
				break;
			}
			if(config.commands[c]) {
				this.createCommand(place,c,tiddler,className);
			} else {
				this.customCommand(place,c,wikifier,tiddler);
			}
			break;
		}
	}
};

// Overrideable function to extend toolbar handler
config.macros.toolbar.customCommand = function(place,command,wikifier,tiddler)
{
};

//--
//-- Menu and toolbar commands
//--

config.commands.closeTiddler.handler = function(event,src,title)
{
	if(story.isDirty(title) && !readOnly) {
		if(!confirm(config.commands.cancelTiddler.warning.format([title])))
			return false;
	}
	story.setDirty(title,false);
	story.closeTiddler(title,true);
	return false;
};

config.commands.closeOthers.handler = function(event,src,title)
{
	story.closeAllTiddlers(title);
	return false;
};

config.commands.editTiddler.handler = function(event,src,title)
{
	clearMessage();
	var tiddlerElem = story.getTiddler(title);
	var fields = tiddlerElem.getAttribute("tiddlyFields");
	story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE,false,null,fields);
	var e = story.getTiddlerField(title,config.options.txtEditorFocus||"text");
	if(e) {
		setCaretPosition(e,0);
	}
	return false;
};

config.commands.saveTiddler.handler = function(event,src,title)
{
	var newTitle = story.saveTiddler(title,event.shiftKey);
	if(newTitle)
		story.displayTiddler(null,newTitle);
	return false;
};

config.commands.cancelTiddler.handler = function(event,src,title)
{
	if(story.hasChanges(title) && !readOnly) {
		if(!confirm(this.warning.format([title])))
			return false;
	}
	story.setDirty(title,false);
	story.displayTiddler(null,title);
	return false;
};

config.commands.deleteTiddler.handler = function(event,src,title)
{
	var deleteIt = true;
	if(config.options.chkConfirmDelete)
		deleteIt = confirm(this.warning.format([title]));
	if(deleteIt) {
		store.removeTiddler(title);
		story.closeTiddler(title,true);
		autoSaveChanges();
	}
	return false;
};

config.commands.permalink.handler = function(event,src,title)
{
	var t = encodeURIComponent(String.encodeTiddlyLink(title));
	if(window.location.hash != t)
		window.location.hash = t;
	return false;
};

config.commands.references.handlePopup = function(popup,title)
{
	var references = store.getReferringTiddlers(title);
	var c = false;
	var r;
	for(r=0; r<references.length; r++) {
		if(references[r].title != title && !references[r].isTagged("excludeLists")) {
			createTiddlyLink(createTiddlyElement(popup,"li"),references[r].title,true);
			c = true;
		}
	}
	if(!c)
		createTiddlyElement(popup,"li",null,"disabled",this.popupNone);
};

config.commands.jump.handlePopup = function(popup,title)
{
	story.forEachTiddler(function(title,element) {
		createTiddlyLink(createTiddlyElement(popup,"li"),title,true,null,false,null,true);
		});
};

config.commands.syncing.handlePopup = function(popup,title)
{
	var me = config.commands.syncing;
	var tiddler = store.fetchTiddler(title);
	if(!tiddler)
		return;
	var serverType = tiddler.getServerType();
	var serverHost = tiddler.fields["server.host"];
	var serverWorkspace = tiddler.fields["server.workspace"];
	if(!serverWorkspace)
		serverWorkspace = "";
	if(serverType) {
		var e = createTiddlyElement(popup,"li",null,"popupMessage");
		e.innerHTML = me.currentlySyncing.format([serverType,serverHost,serverWorkspace]);
	} else {
		createTiddlyElement(popup,"li",null,"popupMessage",me.notCurrentlySyncing);
	}
	if(serverType) {
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var btn = createTiddlyButton(createTiddlyElement(popup,"li"),this.captionUnSync,null,me.onChooseServer);
		btn.setAttribute("tiddler",title);
		btn.setAttribute("server.type","");
	}
	createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
	createTiddlyElement(popup,"li",null,"popupMessage",me.chooseServer);
	var feeds = store.getTaggedTiddlers("systemServer","title");
	var t;
	for(t=0; t<feeds.length; t++) {
		var f = feeds[t];
		var feedServerType = store.getTiddlerSlice(f.title,"Type");
		if(!feedServerType)
			feedServerType = "file";
		var feedServerHost = store.getTiddlerSlice(f.title,"URL");
		if(!feedServerHost)
			feedServerHost = "";
		var feedServerWorkspace = store.getTiddlerSlice(f.title,"Workspace");
		if(!feedServerWorkspace)
			feedServerWorkspace = "";
		var caption = f.title;
		if(serverType == feedServerType && serverHost == feedServerHost && serverWorkspace == feedServerWorkspace) {
			caption = me.currServerMarker + caption;
		} else {
			caption = me.notCurrServerMarker + caption;
		}
		btn = createTiddlyButton(createTiddlyElement(popup,"li"),caption,null,me.onChooseServer);
		btn.setAttribute("tiddler",title);
		btn.setAttribute("server.type",feedServerType);
		btn.setAttribute("server.host",feedServerHost);
		btn.setAttribute("server.workspace",feedServerWorkspace);
	}
};

config.commands.syncing.onChooseServer = function(e)
{
	var tiddler = this.getAttribute("tiddler");
	var serverType = this.getAttribute("server.type");
	if(serverType) {
		store.addTiddlerFields(tiddler,{
			"server.type": serverType,
			"server.host": this.getAttribute("server.host"),
			"server.workspace": this.getAttribute("server.workspace")
			});
	} else {
		store.setValue(tiddler,"server",null);
	}
	return false;
};

config.commands.fields.handlePopup = function(popup,title)
{
	var tiddler = store.fetchTiddler(title);
	if(!tiddler)
		return;
	var items = [];
	store.forEachField(tiddler,function(tiddler,fieldName,value){items.push({field:fieldName,value:value});},true);
	items.sort(function(a,b) {return a.field < b.field ? -1 : (a.field == b.field ? 0 : +1);});
	if(items.length > 0)
		ListView.create(popup,items,this.listViewTemplate);
	else
		createTiddlyElement(popup,"div",null,null,this.emptyText);
};

//--
//-- Tiddler() object
//--

function Tiddler(title)
{
	this.title = title;
	this.text = "";
	this.creator = null;
	this.modifier = null;
	this.created = new Date();
	this.modified = this.created;
	this.links = [];
	this.linksUpdated = false;
	this.tags = [];
	this.fields = {};
	return this;
}

Tiddler.prototype.getLinks = function()
{
	if(this.linksUpdated==false)
		this.changed();
	return this.links;
};

// Returns the fields that are inherited in string field:"value" field2:"value2" format
Tiddler.prototype.getInheritedFields = function()
{
	var f = {};
	var i;
	for(i in this.fields) {
		if(i=="server.host" || i=="server.workspace" || i=="wikiformat"|| i=="server.type") {
			f[i] = this.fields[i];
		}
	}
	return String.encodeHashMap(f);
};

// Increment the changeCount of a tiddler
Tiddler.prototype.incChangeCount = function()
{
	var c = this.fields['changecount'];
	c = c ? parseInt(c,10) : 0;
	this.fields['changecount'] = String(c+1);
};

// Clear the changeCount of a tiddler
Tiddler.prototype.clearChangeCount = function()
{
	if(this.fields['changecount']) {
		delete this.fields['changecount'];
	}
};

Tiddler.prototype.doNotSave = function()
{
	return this.fields['doNotSave'];
};

// Returns true if the tiddler has been updated since the tiddler was created or downloaded
Tiddler.prototype.isTouched = function()
{
	var changecount = this.fields.changecount || 0;
	return changecount > 0;
};

// Change the text and other attributes of a tiddler
Tiddler.prototype.set = function(title,text,modifier,modified,tags,created,fields,creator)
{
	this.assign(title,text,modifier,modified,tags,created,fields,creator);
	this.changed();
	return this;
};

// Change the text and other attributes of a tiddler without triggered a tiddler.changed() call
Tiddler.prototype.assign = function(title,text,modifier,modified,tags,created,fields,creator)
{
	if(title != undefined)
		this.title = title;
	if(text != undefined)
		this.text = text;
	if(modifier != undefined)
		this.modifier = modifier;
	if(modified != undefined)
		this.modified = modified;
	if(creator != undefined)
		this.creator = creator;
	if(created != undefined)
		this.created = created;
	if(fields != undefined)
		this.fields = fields;
	if(tags != undefined)
		this.tags = (typeof tags == "string") ? tags.readBracketedList() : tags;
	else if(this.tags == undefined)
		this.tags = [];
	return this;
};

// Get the tags for a tiddler as a string (space delimited, using [[brackets]] for tags containing spaces)
Tiddler.prototype.getTags = function()
{
	return String.encodeTiddlyLinkList(this.tags);
};

// Test if a tiddler carries a tag
Tiddler.prototype.isTagged = function(tag)
{
	return this.tags.indexOf(tag) != -1;
};

// Static method to convert "\n" to newlines, "\s" to "\"
Tiddler.unescapeLineBreaks = function(text)
{
	return text ? text.unescapeLineBreaks() : "";
};

// Convert newlines to "\n", "\" to "\s"
Tiddler.prototype.escapeLineBreaks = function()
{
	return this.text.escapeLineBreaks();
};

// Updates the secondary information (like links[] array) after a change to a tiddler
Tiddler.prototype.changed = function()
{
	this.links = [];
	var text = this.text;
	// remove 'quoted' text before scanning tiddler source
	text = text.replace(/\/%((?:.|\n)*?)%\//g,"").
		replace(/\{{3}((?:.|\n)*?)\}{3}/g,"").
		replace(/"""((?:.|\n)*?)"""/g,"").
		replace(/<nowiki\>((?:.|\n)*?)<\/nowiki\>/g,"").
		replace(/<html\>((?:.|\n)*?)<\/html\>/g,"").
		replace(/<script((?:.|\n)*?)<\/script\>/g,"");
	var t = this.autoLinkWikiWords() ? 0 : 1;
	var tiddlerLinkRegExp = t==0 ? config.textPrimitives.tiddlerAnyLinkRegExp : config.textPrimitives.tiddlerForcedLinkRegExp;
	tiddlerLinkRegExp.lastIndex = 0;
	var formatMatch = tiddlerLinkRegExp.exec(text);
	while(formatMatch) {
		var lastIndex = tiddlerLinkRegExp.lastIndex;
		if(t==0 && formatMatch[1] && formatMatch[1] != this.title) {
			// wikiWordLink
			if(formatMatch.index > 0) {
				var preRegExp = new RegExp(config.textPrimitives.unWikiLink+"|"+config.textPrimitives.anyLetter,"mg");
				preRegExp.lastIndex = formatMatch.index-1;
				var preMatch = preRegExp.exec(text);
				if(preMatch.index != formatMatch.index-1)
					this.links.pushUnique(formatMatch[1]);
			} else {
				this.links.pushUnique(formatMatch[1]);
			}
		}
		else if(formatMatch[2-t] && !config.formatterHelpers.isExternalLink(formatMatch[3-t])) // titledBrackettedLink
			this.links.pushUnique(formatMatch[3-t]);
		else if(formatMatch[4-t] && formatMatch[4-t] != this.title) // brackettedLink
			this.links.pushUnique(formatMatch[4-t]);
		tiddlerLinkRegExp.lastIndex = lastIndex;
		formatMatch = tiddlerLinkRegExp.exec(text);
	}
	this.linksUpdated = true;
};

Tiddler.prototype.getSubtitle = function()
{
	var modifier = this.modifier;
	if(!modifier)
		modifier = config.messages.subtitleUnknown || "";
	var modified = this.modified;
	if(modified)
		modified = modified.toLocaleString();
	else
		modified = config.messages.subtitleUnknown || "";
	var f = config.messages.tiddlerLinkTooltip || "%0 - %1, %2";
	return f.format([this.title,modifier,modified]);
};

Tiddler.prototype.isReadOnly = function()
{
	return readOnly;
};

Tiddler.prototype.autoLinkWikiWords = function()
{
	return !(this.isTagged("systemConfig") || this.isTagged("excludeMissing"));
};

Tiddler.prototype.getServerType = function()
{
	var serverType = null;
	if(this.fields['server.type'])
		serverType = this.fields['server.type'];
	if(!serverType)
		serverType = this.fields['wikiformat'];
	if(serverType && !config.adaptors[serverType])
		serverType = null;
	return serverType;
};

Tiddler.prototype.getAdaptor = function()
{
	var serverType = this.getServerType();
	return serverType ? new config.adaptors[serverType]() : null;
};

//--
//-- TiddlyWiki instance contains TiddlerS
//--

function TiddlyWiki()
{
	var tiddlers = {}; // Hashmap by name of tiddlers
	this.tiddlersUpdated = false;
	this.namedNotifications = []; // Array of {name:,notify:} of notification functions
	this.notificationLevel = 0;
	this.slices = {}; // map tiddlerName->(map sliceName->sliceValue). Lazy.
	this.clear = function() {
		tiddlers = {};
		this.setDirty(false);
	};
	this.fetchTiddler = function(title) {
		var t = tiddlers[title];
		return t instanceof Tiddler ? t : null;
	};
	this.deleteTiddler = function(title) {
		delete this.slices[title];
		delete tiddlers[title];
	};
	this.addTiddler = function(tiddler) {
		delete this.slices[tiddler.title];
		tiddlers[tiddler.title] = tiddler;
	};
	this.forEachTiddler = function(callback) {
		var t;
		for(t in tiddlers) {
			var tiddler = tiddlers[t];
			if(tiddler instanceof Tiddler)
				callback.call(this,t,tiddler);
		}
	};
}

TiddlyWiki.prototype.setDirty = function(dirty)
{
	this.dirty = dirty;
};

TiddlyWiki.prototype.isDirty = function()
{
	return this.dirty;
};

TiddlyWiki.prototype.tiddlerExists = function(title)
{
	var t = this.fetchTiddler(title);
	return t != undefined;
};

TiddlyWiki.prototype.isShadowTiddler = function(title)
{
	return config.shadowTiddlers[title] === undefined ? false : true;
};

TiddlyWiki.prototype.createTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler) {
		tiddler = new Tiddler(title);
		this.addTiddler(tiddler);
		this.setDirty(true);
	}
	return tiddler;
};

TiddlyWiki.prototype.getTiddler = function(title)
{
	var t = this.fetchTiddler(title);
	if(t != undefined)
		return t;
	else
		return null;
};

TiddlyWiki.prototype.getShadowTiddlerText = function(title)
{
	if(typeof config.shadowTiddlers[title] == "string")
		return config.shadowTiddlers[title];
	else
		return "";
};

// Retrieve tiddler contents
TiddlyWiki.prototype.getTiddlerText = function(title,defaultText)
{
	if(!title)
		return defaultText;
	var pos = title.indexOf(config.textPrimitives.sectionSeparator);
	var section = null;
	if(pos != -1) {
		section = title.substr(pos + config.textPrimitives.sectionSeparator.length);
		title = title.substr(0,pos);
	}
	pos = title.indexOf(config.textPrimitives.sliceSeparator);
	if(pos != -1) {
		var slice = this.getTiddlerSlice(title.substr(0,pos),title.substr(pos + config.textPrimitives.sliceSeparator.length));
		if(slice)
			return slice;
	}
	var tiddler = this.fetchTiddler(title);
	var text = tiddler ? tiddler.text : null;
	if(!tiddler && this.isShadowTiddler(title)) {
		text = this.getShadowTiddlerText(title);
	}
	if(text) {
		if(!section)
			return text;
		var re = new RegExp("(^!{1,6}[ \t]*" + section.escapeRegExp() + "[ \t]*\n)","mg");
		re.lastIndex = 0;
		var match = re.exec(text);
		if(match) {
			var t = text.substr(match.index+match[1].length);
			var re2 = /^!/mg;
			re2.lastIndex = 0;
			match = re2.exec(t); //# search for the next heading
			if(match)
				t = t.substr(0,match.index-1);//# don't include final \n
			return t;
		}
		return defaultText;
	}
	if(defaultText != undefined)
		return defaultText;
	return null;
};

TiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,depth)
{
	var bracketRegExp = new RegExp("(?:\\[\\[([^\\]]+)\\]\\])","mg");
	var text = this.getTiddlerText(title,null);
	if(text == null)
		return defaultText;
	var textOut = [];
	var match,lastPos = 0;
	do {
		match = bracketRegExp.exec(text);
		if(match) {
			textOut.push(text.substr(lastPos,match.index-lastPos));
			if(match[1]) {
				if(depth <= 0)
					textOut.push(match[1]);
				else
					textOut.push(this.getRecursiveTiddlerText(match[1],"",depth-1));
			}
			lastPos = match.index + match[0].length;
		} else {
			textOut.push(text.substr(lastPos));
		}
	} while(match);
	return textOut.join("");
};

//TiddlyWiki.prototype.slicesRE = /(?:^([\'\/]{0,2})~?([\.\w]+)\:\1[\t\x20]*([^\n]+)[\t\x20]*$)|(?:^\|([\'\/]{0,2})~?([\.\w]+)\:?\4\|[\t\x20]*([^\n]+)[\t\x20]*\|$)/gm;
TiddlyWiki.prototype.slicesRE = /(?:^([\'\/]{0,2})~?([\.\w]+)\:\1[\t\x20]*([^\n]*)[\t\x20]*$)|(?:^\|([\'\/]{0,2})~?([\.\w]+)\:?\4\|[\t\x20]*([^\|\n]*)[\t\x20]*\|$)/gm;
// @internal
TiddlyWiki.prototype.calcAllSlices = function(title)
{
	var slices = {};
	var text = this.getTiddlerText(title,"");
	this.slicesRE.lastIndex = 0;
	var m = this.slicesRE.exec(text);
	while(m) {
		if(m[2])
			slices[m[2]] = m[3];
		else
			slices[m[5]] = m[6];
		m = this.slicesRE.exec(text);
	}
	return slices;
};

// Returns the slice of text of the given name
TiddlyWiki.prototype.getTiddlerSlice = function(title,sliceName)
{
	var slices = this.slices[title];
	if(!slices) {
		slices = this.calcAllSlices(title);
		this.slices[title] = slices;
	}
	return slices[sliceName];
};

// Build an hashmap of the specified named slices of a tiddler
TiddlyWiki.prototype.getTiddlerSlices = function(title,sliceNames)
{
	var t,r = {};
	for(t=0; t<sliceNames.length; t++) {
		var slice = this.getTiddlerSlice(title,sliceNames[t]);
		if(slice)
			r[sliceNames[t]] = slice;
	}
	return r;
};

TiddlyWiki.prototype.suspendNotifications = function()
{
	this.notificationLevel--;
};

TiddlyWiki.prototype.resumeNotifications = function()
{
	this.notificationLevel++;
};

// Invoke the notification handlers for a particular tiddler
TiddlyWiki.prototype.notify = function(title,doBlanket)
{
	if(!this.notificationLevel) {
	    var t;
		for(t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if((n.name == null && doBlanket) || (n.name == title))
				n.notify(title);
		}
	}
};

// Invoke the notification handlers for all tiddlers
TiddlyWiki.prototype.notifyAll = function()
{
	if(!this.notificationLevel) {
	    var t;
		for(t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if(n.name)
				n.notify(n.name);
		}
	}
};

// Add a notification handler to a tiddler
TiddlyWiki.prototype.addNotification = function(title,fn)
{
	var i;
	for(i=0; i<this.namedNotifications.length; i++) {
		if((this.namedNotifications[i].name == title) && (this.namedNotifications[i].notify == fn))
			return this;
	}
	this.namedNotifications.push({name: title, notify: fn});
	return this;
};

TiddlyWiki.prototype.removeTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		this.deleteTiddler(title);
		this.notify(title,true);
		this.setDirty(true);
	}
};

// Reset the sync status of a freshly synced tiddler
TiddlyWiki.prototype.resetTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		tiddler.clearChangeCount();
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.setTiddlerTag = function(title,status,tag)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		var t = tiddler.tags.indexOf(tag);
		if(t != -1)
			tiddler.tags.splice(t,1);
		if(status)
			tiddler.tags.push(tag);
		tiddler.changed();
		tiddler.incChangeCount();
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.addTiddlerFields = function(title,fields)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler)
		return;
	merge(tiddler.fields,fields);
	tiddler.changed();
	tiddler.incChangeCount();
	this.notify(title,true);
	this.setDirty(true);
};

// Store tiddler in TiddlyWiki instance
TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags,fields,clearChangeCount,created,creator)
{
	var tiddler;
	if(title instanceof Tiddler) {
		tiddler = title;
		title = tiddler.title;
		newTitle = title;
	} else {
		tiddler = this.fetchTiddler(title);
		if(tiddler) {
			created = created || tiddler.created; // Preserve created date
			creator = creator || tiddler.creator;
			this.deleteTiddler(title);
		} else {
			created = created || modified;
			tiddler = new Tiddler();
		}
		fields = merge({},fields);
		tiddler.set(newTitle,newBody,modifier,modified,tags,created,fields,creator);
	}
	this.addTiddler(tiddler);
	if(clearChangeCount)
		tiddler.clearChangeCount();
	else
		tiddler.incChangeCount();
	if(title != newTitle)
		this.notify(title,true);
	this.notify(newTitle,true);
	if(window.location.protocol == "file:")
		this.setDirty(true);
	return tiddler;
};

TiddlyWiki.prototype.incChangeCount = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		tiddler.incChangeCount();
};

TiddlyWiki.prototype.getLoader = function()
{
	if(!this.loader)
		this.loader = new TW21Loader();
	return this.loader;
};

TiddlyWiki.prototype.getSaver = function()
{
	if(!this.saver)
		this.saver = new TW21Saver();
	return this.saver;
};

// Return all tiddlers formatted as an HTML string
TiddlyWiki.prototype.allTiddlersAsHtml = function()
{
	return this.getSaver().externalize(store);
};

// Load contents of a TiddlyWiki from an HTML DIV
TiddlyWiki.prototype.loadFromDiv = function(src,idPrefix,noUpdate)
{
	this.idPrefix = idPrefix;
	var storeElem = (typeof src == "string") ? document.getElementById(src) : src;
	if(!storeElem)
		return;
	var tiddlers = this.getLoader().loadTiddlers(this,storeElem.childNodes);
	this.setDirty(false);
	if(!noUpdate) {
		var i;
		for(i = 0;i<tiddlers.length; i++)
			tiddlers[i].changed();
	}
	jQuery(document).trigger("loadTiddlers");
};

// Load contents of a TiddlyWiki from a string
// Returns null if there's an error
TiddlyWiki.prototype.importTiddlyWiki = function(text)
{
	var posDiv = locateStoreArea(text);
	if(!posDiv)
		return null;
	var content = "<" + "html><" + "body>" + text.substring(posDiv[0],posDiv[1] + endSaveArea.length) + "<" + "/body><" + "/html>";
	// Create the iframe
	var iframe = document.createElement("iframe");
	iframe.style.display = "none";
	document.body.appendChild(iframe);
	var doc = iframe.document;
	if(iframe.contentDocument)
		doc = iframe.contentDocument; // For NS6
	else if(iframe.contentWindow)
		doc = iframe.contentWindow.document; // For IE5.5 and IE6
	// Put the content in the iframe
	doc.open();
	doc.writeln(content);
	doc.close();
	// Load the content into a TiddlyWiki() object
	var storeArea = doc.getElementById("storeArea");
	this.loadFromDiv(storeArea,"store");
	// Get rid of the iframe
	iframe.parentNode.removeChild(iframe);
	return this;
};

TiddlyWiki.prototype.updateTiddlers = function()
{
	this.tiddlersUpdated = true;
	this.forEachTiddler(function(title,tiddler) {
		tiddler.changed();
	});
};

// Return an array of tiddlers matching a search regular expression
TiddlyWiki.prototype.search = function(searchRegExp,sortField,excludeTag,match)
{
	var candidates = this.reverseLookup("tags",excludeTag,!!match);
	var t,results = [];
	for(t=0; t<candidates.length; t++) {
		if((candidates[t].title.search(searchRegExp) != -1) || (candidates[t].text.search(searchRegExp) != -1))
			results.push(candidates[t]);
	}
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
};

// Returns a list of all tags in use
//   excludeTag - if present, excludes tags that are themselves tagged with excludeTag
// Returns an array of arrays where [tag][0] is the name of the tag and [tag][1] is the number of occurances
TiddlyWiki.prototype.getTags = function(excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
	    var g,c;
		for(g=0; g<tiddler.tags.length; g++) {
			var tag = tiddler.tags[g];
			var n = true;
			for(c=0; c<results.length; c++) {
				if(results[c][0] == tag) {
					n = false;
					results[c][1]++;
				}
			}
			if(n && excludeTag) {
				var t = this.fetchTiddler(tag);
				if(t && t.isTagged(excludeTag))
					n = false;
			}
			if(n)
				results.push([tag,1]);
		}
	});
	results.sort(function(a,b) {return a[0].toLowerCase() < b[0].toLowerCase() ? -1 : (a[0].toLowerCase() == b[0].toLowerCase() ? 0 : +1);});
	return results;
};

// Return an array of the tiddlers that are tagged with a given tag
TiddlyWiki.prototype.getTaggedTiddlers = function(tag,sortField)
{
	return this.reverseLookup("tags",tag,true,sortField);
};

TiddlyWiki.prototype.getValueTiddlers = function(field,value,sortField)
{
	return this.reverseLookup(field,value,true,sortField);
};

// Return an array of the tiddlers that link to a given tiddler
TiddlyWiki.prototype.getReferringTiddlers = function(title,unusedParameter,sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	return this.reverseLookup("links",title,true,sortField);
};

// Return an array of the tiddlers that do or do not have a specified entry in the specified storage array (ie, "links" or "tags")
// lookupMatch == true to match tiddlers, false to exclude tiddlers
TiddlyWiki.prototype.reverseLookup = function(lookupField,lookupValue,lookupMatch,sortField)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		var f = !lookupMatch;
		var values;
		if(["links", "tags"].contains(lookupField)) {
			values = tiddler[lookupField];
		} else {
			var accessor = TiddlyWiki.standardFieldAccess[lookupField];
			if(accessor) {
				values = [ accessor.get(tiddler) ];
			} else {
				values = tiddler.fields[lookupField] ? [tiddler.fields[lookupField]] : [];
			}
		}
		var lookup;
		for(lookup=0; lookup<values.length; lookup++) {
			if(values[lookup] == lookupValue)
				f = lookupMatch;
		}
		if(f)
			results.push(tiddler);
	});
	if(!sortField)
		sortField = "title";
	return this.sortTiddlers(results,sortField);
};

// Return the tiddlers as a sorted array
TiddlyWiki.prototype.getTiddlers = function(field,excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(excludeTag == undefined || !tiddler.isTagged(excludeTag))
			results.push(tiddler);
	});
	if(field)
		results.sort(function(a,b) {return a[field] < b[field] ? -1 : (a[field] == b[field] ? 0 : +1);});
	return results;
};

// Return array of names of tiddlers that are referred to but not defined
TiddlyWiki.prototype.getMissingLinks = function()
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(tiddler.isTagged("excludeMissing") || tiddler.isTagged("systemConfig"))
			return;
		var n;
		for(n=0; n<tiddler.links.length;n++) {
			var link = tiddler.links[n];
			if(this.getTiddlerText(link,null) == null && !this.isShadowTiddler(link) && !config.macros[link])
				results.pushUnique(link);
		}
	});
	results.sort();
	return results;
};

// Return an array of names of tiddlers that are defined but not referred to
TiddlyWiki.prototype.getOrphans = function()
{
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(this.getReferringTiddlers(title).length == 0 && !tiddler.isTagged("excludeLists"))
			results.push(title);
	});
	results.sort();
	return results;
};

// Return an array of names of all the shadow tiddlers
TiddlyWiki.prototype.getShadowed = function()
{
	var t,results = [];
	for(t in config.shadowTiddlers) {
		if(this.isShadowTiddler(t))
			results.push(t);
	}
	results.sort();
	return results;
};

// Return an array of tiddlers that have been touched since they were downloaded or created
TiddlyWiki.prototype.getTouched = function()
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(tiddler.isTouched())
			results.push(tiddler);
		});
	results.sort();
	return results;
};

// Resolves a Tiddler reference or tiddler title into a Tiddler object, or null if it doesn't exist
TiddlyWiki.prototype.resolveTiddler = function(tiddler)
{
	var t = (typeof tiddler == "string") ? this.getTiddler(tiddler) : tiddler;
	return t instanceof Tiddler ? t : null;
};

// Sort a list of tiddlers
TiddlyWiki.prototype.sortTiddlers = function(tiddlers,field)
{
	var asc = +1;
	switch(field.substr(0,1)) {
	case "-":
		asc = -1;
		field = field.substr(1);
		break;
	case "+":
		field = field.substr(1);
		break;
	}
	if(TiddlyWiki.standardFieldAccess[field]) {
		if(field=="title") {
			tiddlers.sort(function(a,b) {return a[field].toLowerCase() < b[field].toLowerCase() ? -asc : (a[field].toLowerCase() == b[field].toLowerCase() ? 0 : asc);});
		} else {
			tiddlers.sort(function(a,b) {return a[field] < b[field] ? -asc : (a[field] == b[field] ? 0 : asc);});
		}
	} else {
		tiddlers.sort(function(a,b) {return a.fields[field] < b.fields[field] ? -asc : (a.fields[field] == b.fields[field] ? 0 : +asc);});
	}
	return tiddlers;
};

//--
//-- Filter a list of tiddlers
//--

config.filters = {
	tiddler: function(results,match) {
		var title = match[1]||match[4];
		var tiddler = this.fetchTiddler(title);
		if(tiddler) {
			results.pushUnique(tiddler);
		} else if(this.isShadowTiddler(title)) {
			tiddler = new Tiddler();
			tiddler.set(title,this.getTiddlerText(title));
			results.pushUnique(tiddler);
		} else {
			results.pushUnique(new Tiddler(title));
		}
		return results;
	},
	tag: function(results,match) {
		var m,matched = this.getTaggedTiddlers(match[3]);
		for(m=0; m<matched.length; m++) {
			results.pushUnique(matched[m]);
		}
		return results;
	},
	sort: function(results,match) {
		return this.sortTiddlers(results,match[3]);
	},
	limit: function(results,match) {
		return results.slice(0,parseInt(match[3],10));
	},
	field: function(results,match) {
		var m,matched = this.getValueTiddlers(match[2],match[3]);
		for (m = 0; m < matched.length; m++) {
			results.pushUnique(matched[m]);
		}
		return results;
	}
};

// Filter a list of tiddlers
TiddlyWiki.prototype.filterTiddlers = function(filter)
{
	var re = /([^\s\[\]]+)|(?:\[([ \w\.\-]+)\[([^\]]+)\]\])|(?:\[\[([^\]]+)\]\])/mg;

	var results = [];
	if(filter) {
		var match = re.exec(filter);
		while(match) {
			var handler = (match[1]||match[4])?'tiddler':config.filters[match[2]]?match[2]:'field';
			results = config.filters[handler].call(this,results,match);
			match = re.exec(filter);
		}
	}
	return results;
};
// Returns true if path is a valid field name (path),
// i.e. a sequence of identifiers, separated by "."
TiddlyWiki.isValidFieldName = function(name)
{
	var match = /[a-zA-Z_]\w*(\.[a-zA-Z_]\w*)*/.exec(name);
	return match && (match[0] == name);
};

// Throws an exception when name is not a valid field name.
TiddlyWiki.checkFieldName = function(name)
{
	if(!TiddlyWiki.isValidFieldName(name))
		throw config.messages.invalidFieldName.format([name]);
};

function StringFieldAccess(n,readOnly)
{
	this.set = readOnly ?
			function(t,v) {if(v != t[n]) throw config.messages.fieldCannotBeChanged.format([n]);} :
			function(t,v) {if(v != t[n]) {t[n] = v; return true;}};
	this.get = function(t) {return t[n];};
}

function DateFieldAccess(n)
{
	this.set = function(t,v) {
		var d = v instanceof Date ? v : Date.convertFromYYYYMMDDHHMM(v);
		if(d != t[n]) {
			t[n] = d; return true;
		}
	};
	this.get = function(t) {return t[n].convertToYYYYMMDDHHMM();};
}

function LinksFieldAccess(n)
{
	this.set = function(t,v) {
		var s = (typeof v == "string") ? v.readBracketedList() : v;
		if(s.toString() != t[n].toString()) {
			t[n] = s; return true;
		}
	};
	this.get = function(t) {return String.encodeTiddlyLinkList(t[n]);};
}

TiddlyWiki.standardFieldAccess = {
	// The set functions return true when setting the data has changed the value.
	"title":    new StringFieldAccess("title",true),
	// Handle the "tiddler" field name as the title
	"tiddler":  new StringFieldAccess("title",true),
	"text":     new StringFieldAccess("text"),
	"modifier": new StringFieldAccess("modifier"),
	"modified": new DateFieldAccess("modified"),
	"creator":  new StringFieldAccess("creator"),
	"created":  new DateFieldAccess("created"),
	"tags":     new LinksFieldAccess("tags")
};

TiddlyWiki.isStandardField = function(name)
{
	return TiddlyWiki.standardFieldAccess[name] != undefined;
};

// Sets the value of the given field of the tiddler to the value.
// Setting an ExtendedField's value to null or undefined removes the field.
// Setting a namespace to undefined removes all fields of that namespace.
// The fieldName is case-insensitive.
// All values will be converted to a string value.
TiddlyWiki.prototype.setValue = function(tiddler,fieldName,value)
{
	TiddlyWiki.checkFieldName(fieldName);
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return;
	fieldName = fieldName.toLowerCase();
	var isRemove = (value === undefined) || (value === null);
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if(accessor) {
		if(isRemove)
			// don't remove StandardFields
			return;
		var h = TiddlyWiki.standardFieldAccess[fieldName];
		if(!h.set(t,value))
			return;
	} else {
		var oldValue = t.fields[fieldName];
		if(isRemove) {
			if(oldValue !== undefined) {
				// deletes a single field
				delete t.fields[fieldName];
			} else {
				// no concrete value is defined for the fieldName
				// so we guess this is a namespace path.
				// delete all fields in a namespace
				var re = new RegExp("^"+fieldName+"\\.");
				var dirty = false;
				var n;
				for(n in t.fields) {
					if(n.match(re)) {
						delete t.fields[n];
						dirty = true;
					}
				}
				if(!dirty)
					return;
			}
		} else {
			// the "normal" set case. value is defined (not null/undefined)
			// For convenience provide a nicer conversion Date->String
			value = value instanceof Date ? value.convertToYYYYMMDDHHMMSSMMM() : String(value);
			if(oldValue == value)
				return;
			t.fields[fieldName] = value;
		}
	}
	// When we are here the tiddler/store really was changed.
	this.notify(t.title,true);
	if(!fieldName.match(/^temp\./))
		this.setDirty(true);
};

// Returns the value of the given field of the tiddler.
// The fieldName is case-insensitive.
// Will only return String values (or undefined).
TiddlyWiki.prototype.getValue = function(tiddler,fieldName)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	if(fieldName.indexOf(config.textPrimitives.sectionSeparator) === 0 || fieldName.indexOf(config.textPrimitives.sliceSeparator) === 0) {
		var sliceType = fieldName.substr(0, 2);
		var sliceName = fieldName.substring(2);
		return store.getTiddlerText("%0%1%2".format(t.title,sliceType,sliceName));
	} else {
		fieldName = fieldName.toLowerCase();
		var accessor = TiddlyWiki.standardFieldAccess[fieldName];
		if(accessor) {
			return accessor.get(t);
		}
	}
	return t.fields[fieldName];
};

// Calls the callback function for every field in the tiddler.
// When callback function returns a non-false value the iteration stops
// and that value is returned.
// The order of the fields is not defined.
// @param callback a function(tiddler,fieldName,value).
TiddlyWiki.prototype.forEachField = function(tiddler,callback,onlyExtendedFields)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	var n,result;
	for(n in t.fields) {
		result = callback(t,n,t.fields[n]);
		if(result)
			return result;
		}
	if(onlyExtendedFields)
		return undefined;
	for(n in TiddlyWiki.standardFieldAccess) {
		if(n != "tiddler") {
			// even though the "title" field can also be referenced through the name "tiddler"
			// we only visit this field once.
			result = callback(t,n,TiddlyWiki.standardFieldAccess[n].get(t));
			if(result)
				return result;
		}
	}
	return undefined;
};

//--
//-- Story functions
//--

function Story(containerId,idPrefix)
{
	this.container = containerId;
	this.idPrefix = idPrefix;
	this.highlightRegExp = null;
	this.tiddlerId = function(title) {
		title = title.replace(/_/g, "__").replace(/ /g, "_");
		var id = this.idPrefix + title;
		return id==this.container ? this.idPrefix + "_" + title : id;
	};
	this.containerId = function() {
		return this.container;
	};
}

Story.prototype.getTiddler = function(title)
{
	return document.getElementById(this.tiddlerId(title));
};

Story.prototype.getContainer = function()
{
	return document.getElementById(this.containerId());
};

Story.prototype.forEachTiddler = function(fn)
{
	var place = this.getContainer();
	if(!place)
		return;
	var e = place.firstChild;
	while(e) {
		var n = e.nextSibling;
		var title = e.getAttribute("tiddler");
		fn.call(this,title,e);
		e = n;
	}
};

Story.prototype.displayDefaultTiddlers = function()
{
	this.displayTiddlers(null,store.filterTiddlers(store.getTiddlerText("DefaultTiddlers")));
};

Story.prototype.displayTiddlers = function(srcElement,titles,template,animate,unused,customFields,toggle)
{
	var t;
	for(t = titles.length-1;t>=0;t--)
		this.displayTiddler(srcElement,titles[t],template,animate,unused,customFields);
};

Story.prototype.displayTiddler = function(srcElement,tiddler,template,animate,unused,customFields,toggle,animationSrc)
{
	var title = (tiddler instanceof Tiddler) ? tiddler.title : tiddler;
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		if(toggle) {
			if(tiddlerElem.getAttribute("dirty") != "true")
				this.closeTiddler(title,true);
		} else {
			this.refreshTiddler(title,template,false,customFields);
		}
	} else {
		var place = this.getContainer();
		var before = this.positionTiddler(srcElement);
		tiddlerElem = this.createTiddler(place,before,title,template,customFields);
	}
	if(animationSrc && typeof animationSrc !== "string") {
		srcElement = animationSrc;
	}
	if(srcElement && typeof srcElement !== "string") {
		if(config.options.chkAnimate && (animate == undefined || animate == true) && anim && typeof Zoomer == "function" && typeof Scroller == "function")
			anim.startAnimating(new Zoomer(title,srcElement,tiddlerElem),new Scroller(tiddlerElem));
		else
			window.scrollTo(0,ensureVisible(tiddlerElem));
	}
	return tiddlerElem;
};

Story.prototype.positionTiddler = function(srcElement)
{
	var place = this.getContainer();
	var before = null;
	if(typeof srcElement == "string") {
		switch(srcElement) {
		case "top":
			before = place.firstChild;
			break;
		case "bottom":
			before = null;
			break;
		}
	} else {
		var after = this.findContainingTiddler(srcElement);
		if(after == null) {
			before = place.firstChild;
		} else if(after.nextSibling) {
			before = after.nextSibling;
			if(before.nodeType != 1)
				before = null;
		}
	}
	return before;
};

Story.prototype.createTiddler = function(place,before,title,template,customFields)
{
	var tiddlerElem = createTiddlyElement(null,"div",this.tiddlerId(title),"tiddler");
	tiddlerElem.setAttribute("refresh","tiddler");
	if(customFields)
		tiddlerElem.setAttribute("tiddlyFields",customFields);
	place.insertBefore(tiddlerElem,before);
	var defaultText = null;
	if(!store.tiddlerExists(title) && !store.isShadowTiddler(title))
		defaultText = this.loadMissingTiddler(title,customFields);
	this.refreshTiddler(title,template,false,customFields,defaultText);
	return tiddlerElem;
};

Story.prototype.loadMissingTiddler = function(title,fields,callback)
{
	var getTiddlerCallback = function(context)
	{
		if(context.status) {
			var t = context.tiddler;
			if(!t.created)
				t.created = new Date();
			if(!t.modified)
				t.modified = t.created;
			context.tiddler = store.saveTiddler(t.title,t.title,t.text,t.modifier,t.modified,t.tags,t.fields,true,t.created,t.creator);
			autoSaveChanges();
		} else {
			story.refreshTiddler(context.title,null,true);
		}
		context.adaptor.close();
		if(callback) {
			callback(context);
		}
	};
	var tiddler = new Tiddler(title);
	tiddler.fields = typeof fields == "string" ? fields.decodeHashMap() : fields||{};
	var context = {serverType:tiddler.getServerType()};
	if(!context.serverType)
		return "";
	context.host = tiddler.fields['server.host'];
	context.workspace = tiddler.fields['server.workspace'];
	var adaptor = new config.adaptors[context.serverType]();
	adaptor.getTiddler(title,context,null,getTiddlerCallback);
	return config.messages.loadingMissingTiddler.format([title,context.serverType,context.host,context.workspace]);
};

Story.prototype.chooseTemplateForTiddler = function(title,template)
{
	if(!template)
		template = DEFAULT_VIEW_TEMPLATE;
	if(template == DEFAULT_VIEW_TEMPLATE || template == DEFAULT_EDIT_TEMPLATE)
		template = config.tiddlerTemplates[template];
	return template;
};

Story.prototype.getTemplateForTiddler = function(title,template,tiddler)
{
	return store.getRecursiveTiddlerText(template,null,10);
};

Story.prototype.refreshTiddler = function(title,template,force,customFields,defaultText)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		if(tiddlerElem.getAttribute("dirty") == "true" && !force)
			return tiddlerElem;
		template = this.chooseTemplateForTiddler(title,template);
		var currTemplate = tiddlerElem.getAttribute("template");
		if((template != currTemplate) || force) {
			var tiddler = store.getTiddler(title);
			if(!tiddler) {
				tiddler = new Tiddler();
				if(store.isShadowTiddler(title)) {
					var tags = [];
					tiddler.set(title,store.getTiddlerText(title),config.views.wikified.shadowModifier,version.date,tags,version.date);
				} else {
					var text = template=="EditTemplate" ?
								config.views.editor.defaultText.format([title]) :
								config.views.wikified.defaultText.format([title]);
					text = defaultText || text;
					var fields = customFields ? customFields.decodeHashMap() : null;
					tiddler.set(title,text,config.views.wikified.defaultModifier,version.date,[],version.date,fields);
				}
			}
			tiddlerElem.setAttribute("tags",tiddler.tags.join(" "));
			tiddlerElem.setAttribute("tiddler",title);
			tiddlerElem.setAttribute("template",template);
			tiddlerElem.onmouseover = this.onTiddlerMouseOver;
			tiddlerElem.onmouseout = this.onTiddlerMouseOut;
			tiddlerElem.ondblclick = this.onTiddlerDblClick;
			tiddlerElem[window.event?"onkeydown":"onkeypress"] = this.onTiddlerKeyPress;
			tiddlerElem.innerHTML = this.getTemplateForTiddler(title,template,tiddler);
			applyHtmlMacros(tiddlerElem,tiddler);
			if(store.getTaggedTiddlers(title).length > 0)
				jQuery(tiddlerElem).addClass("isTag");
			else
				jQuery(tiddlerElem).removeClass("isTag");
			if(store.tiddlerExists(title)) {
				jQuery(tiddlerElem).removeClass("shadow");
				jQuery(tiddlerElem).removeClass("missing");
			} else {
				jQuery(tiddlerElem).addClass(store.isShadowTiddler(title) ? "shadow" : "missing");
			}
			if(customFields)
				this.addCustomFields(tiddlerElem,customFields);
		}
	}
	return tiddlerElem;
};

Story.prototype.addCustomFields = function(place,customFields)
{
	var fields = customFields.decodeHashMap();
	var w = createTiddlyElement(place,"div",null,"customFields");
	w.style.display = "none";
	var t;
	for(t in fields) {
		var e = document.createElement("input");
		e.setAttribute("type","text");
		e.setAttribute("value",fields[t]);
		w.appendChild(e);
		e.setAttribute("edit",t);
	}
};

Story.prototype.refreshAllTiddlers = function(force)
{
	var e = this.getContainer().firstChild;
	while(e) {
		var template = e.getAttribute("template");
		if(template && e.getAttribute("dirty") != "true") {
			this.refreshTiddler(e.getAttribute("tiddler"),force ? null : template,true);
		}
		e = e.nextSibling;
	}
};

Story.prototype.onTiddlerMouseOver = function(e)
{
	jQuery(this).addClass("selected");
};

Story.prototype.onTiddlerMouseOut = function(e)
{
	jQuery(this).removeClass("selected");
};

Story.prototype.onTiddlerDblClick = function(ev)
{
	var e = ev || window.event;
	var target = resolveTarget(e);
	if(target && target.nodeName.toLowerCase() != "input" && target.nodeName.toLowerCase() != "textarea") {
		if(document.selection && document.selection.empty)
			document.selection.empty();
		config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
		e.cancelBubble = true;
		if(e.stopPropagation) e.stopPropagation();
		return true;
	}
	return false;
};

Story.prototype.onTiddlerKeyPress = function(ev)
{
	var e = ev || window.event;
	clearMessage();
	var consume = false;
	var title = this.getAttribute("tiddler");
	var target = resolveTarget(e);
	switch(e.keyCode) {
	case 9: // Tab
		var ed = story.getTiddlerField(title,"text");
		if(target.tagName.toLowerCase() == "input" && ed.value==config.views.editor.defaultText.format([title])) {
			// moving from input field and editor still contains default text, so select it
			ed.focus();
			ed.select();
			consume = true;
		}
		if(config.options.chkInsertTabs && target.tagName.toLowerCase() == "textarea") {
			replaceSelection(target,String.fromCharCode(9));
			consume = true;
		}
		if(config.isOpera) {
			target.onblur = function() {
				this.focus();
				this.onblur = null;
			};
		}
		break;
	case 13: // Ctrl-Enter
	case 10: // Ctrl-Enter on IE PC
	case 77: // Ctrl-Enter is "M" on some platforms
		if(e.ctrlKey) {
			blurElement(this);
			config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
			consume = true;
		}
		break;
	case 27: // Escape
		blurElement(this);
		config.macros.toolbar.invokeCommand(this,"cancelCommand",e);
		consume = true;
		break;
	}
	e.cancelBubble = consume;
	if(consume) {
		if(e.stopPropagation) e.stopPropagation(); // Stop Propagation
		e.returnValue = true; // Cancel The Event in IE
		if(e.preventDefault ) e.preventDefault(); // Cancel The Event in Moz
	}
	return !consume;
};

Story.prototype.getTiddlerField = function(title,field)
{
	var tiddlerElem = this.getTiddler(title);
	var e = null;
	if(tiddlerElem) {
		var t,children = tiddlerElem.getElementsByTagName("*");
		for(t=0; t<children.length; t++) {
			var c = children[t];
			if(c.tagName.toLowerCase() == "input" || c.tagName.toLowerCase() == "textarea") {
				if(!e)
					e = c;
				if(c.getAttribute("edit") == field)
					e = c;
			}
		}
	}
	return e;
};

Story.prototype.focusTiddler = function(title,field)
{
	var e = this.getTiddlerField(title,field);
	if(e) {
		e.focus();
		e.select();
	}
};

Story.prototype.blurTiddler = function(title)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem && tiddlerElem.focus && tiddlerElem.blur) {
		tiddlerElem.focus();
		tiddlerElem.blur();
	}
};

Story.prototype.setTiddlerField = function(title,tag,mode,field)
{
	var c = this.getTiddlerField(title,field);
	var tags = c.value.readBracketedList();
	tags.setItem(tag,mode);
	c.value = String.encodeTiddlyLinkList(tags);
};

Story.prototype.setTiddlerTag = function(title,tag,mode)
{
	this.setTiddlerField(title,tag,mode,"tags");
};

Story.prototype.closeTiddler = function(title,animate,unused)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		clearMessage();
		this.scrubTiddler(tiddlerElem);
		if(config.options.chkAnimate && animate && anim && typeof Slider == "function")
			anim.startAnimating(new Slider(tiddlerElem,false,null,"all"));
		else {
			jQuery(tiddlerElem).remove();
		}
	}
};

Story.prototype.scrubTiddler = function(tiddlerElem)
{
	tiddlerElem.id = null;
};

Story.prototype.setDirty = function(title,dirty)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem)
		tiddlerElem.setAttribute("dirty",dirty ? "true" : "false");
};

Story.prototype.isDirty = function(title)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem)
		return tiddlerElem.getAttribute("dirty") == "true";
	return null;
};

Story.prototype.areAnyDirty = function()
{
	var r = false;
	this.forEachTiddler(function(title,element) {
		if(this.isDirty(title))
			r = true;
	});
	return r;
};

Story.prototype.closeAllTiddlers = function(exclude)
{
	clearMessage();
	this.forEachTiddler(function(title,element) {
		if((title != exclude) && element.getAttribute("dirty") != "true")
			this.closeTiddler(title);
	});
	window.scrollTo(0,ensureVisible(this.container));
};

Story.prototype.isEmpty = function()
{
	var place = this.getContainer();
	return place && place.firstChild == null;
};

Story.prototype.search = function(text,useCaseSensitive,useRegExp)
{
	this.closeAllTiddlers();
	highlightHack = new RegExp(useRegExp ? text : text.escapeRegExp(),useCaseSensitive ? "mg" : "img");
	var matches = store.search(highlightHack,"title","excludeSearch");
	this.displayTiddlers(null,matches);
	highlightHack = null;
	var q = useRegExp ? "/" : "'";
	if(matches.length > 0)
		displayMessage(config.macros.search.successMsg.format([matches.length.toString(),q + text + q]));
	else
		displayMessage(config.macros.search.failureMsg.format([q + text + q]));
};

Story.prototype.findContainingTiddler = function(e)
{
	while(e && !jQuery(e).hasClass("tiddler")) {
		e = jQuery(e).hasClass("popup") && Popup.stack[0] ? Popup.stack[0].root : e.parentNode;
	}
	return e;
};

Story.prototype.gatherSaveFields = function(e,fields)
{
	if(e && e.getAttribute) {
		var f = e.getAttribute("edit");
		if(f)
			fields[f] = e.value.replace(/\r/mg,"");
		if(e.hasChildNodes()) {
			var t,c = e.childNodes;
			for(t=0; t<c.length; t++)
				this.gatherSaveFields(c[t],fields);
		}
	}
};

Story.prototype.hasChanges = function(title)
{
	var e = this.getTiddler(title);
	if(e) {
		var fields = {};
		this.gatherSaveFields(e,fields);
		if(store.fetchTiddler(title)) {
		    var n;
			for(n in fields) {
				if(store.getValue(title,n) != fields[n]) //# tiddler changed
					return true;
			}
		} else {
			if(store.isShadowTiddler(title) && store.getShadowTiddlerText(title) == fields.text) { //# not checking for title or tags
				return false;
			} else { //# changed shadow or new tiddler
				return true;
			}
		}
	}
	return false;
};

Story.prototype.saveTiddler = function(title,minorUpdate)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		var fields = {};
		this.gatherSaveFields(tiddlerElem,fields);
		var newTitle = fields.title || title;
		if(!store.tiddlerExists(newTitle)) {
			newTitle = newTitle.trim();
			var creator = config.options.txtUserName;
		}
		if(store.tiddlerExists(newTitle) && newTitle != title) {
			if(!confirm(config.messages.overwriteWarning.format([newTitle.toString()])))
				return null;
				title = newTitle;
		}
		if(newTitle != title)
			this.closeTiddler(newTitle,false);
		tiddlerElem.id = this.tiddlerId(newTitle);
		tiddlerElem.setAttribute("tiddler",newTitle);
		tiddlerElem.setAttribute("template",DEFAULT_VIEW_TEMPLATE);
		tiddlerElem.setAttribute("dirty","false");
		if(config.options.chkForceMinorUpdate)
			minorUpdate = !minorUpdate;
		if(!store.tiddlerExists(newTitle))
			minorUpdate = false;
		var newDate = new Date();
		if(store.tiddlerExists(title)) {
			var t = store.fetchTiddler(title);
			var extendedFields = t.fields;
			creator = t.creator;
		} else {
			extendedFields = merge({},config.defaultCustomFields);
		}
		var n;
		for(n in fields) {
			if(!TiddlyWiki.isStandardField(n))
				extendedFields[n] = fields[n];
		}
		var tiddler = store.saveTiddler(title,newTitle,fields.text,minorUpdate ? undefined : config.options.txtUserName,minorUpdate ? undefined : newDate,fields.tags,extendedFields,null,null,creator);
		autoSaveChanges(null,[tiddler]);
		return newTitle;
	}
	return null;
};

Story.prototype.permaView = function()
{
	var links = [];
	this.forEachTiddler(function(title,element) {
		links.push(String.encodeTiddlyLink(title));
	});
	var t = encodeURIComponent(links.join(" "));
	if(t == "")
		t = "#";
	if(window.location.hash != t)
		window.location.hash = t;
};

Story.prototype.switchTheme = function(theme)
{
	if(safeMode)
		return;

	var isAvailable = function(title) {
		var s = title ? title.indexOf(config.textPrimitives.sectionSeparator) : -1;
		if(s!=-1)
			title = title.substr(0,s);
		return store.tiddlerExists(title) || store.isShadowTiddler(title);
	};

	var getSlice = function(theme,slice) {
		var r;
		if(readOnly)
			r = store.getTiddlerSlice(theme,slice+"ReadOnly") || store.getTiddlerSlice(theme,"Web"+slice);
		r = r || store.getTiddlerSlice(theme,slice);
		if(r && r.indexOf(config.textPrimitives.sectionSeparator)==0)
			r = theme + r;
		return isAvailable(r) ? r : slice;
	};

	var replaceNotification = function(i,name,theme,slice) {
		var newName = getSlice(theme,slice);
		if(name!=newName && store.namedNotifications[i].name==name) {
			store.namedNotifications[i].name = newName;
			return newName;
		}
		return name;
	};

	var pt = config.refresherData.pageTemplate;
	var vi = DEFAULT_VIEW_TEMPLATE;
	var vt = config.tiddlerTemplates[vi];
	var ei = DEFAULT_EDIT_TEMPLATE;
	var et = config.tiddlerTemplates[ei];

	var i;
	for(i=0; i<config.notifyTiddlers.length; i++) {
		var name = config.notifyTiddlers[i].name;
		switch(name) {
		case "PageTemplate":
			config.refresherData.pageTemplate = replaceNotification(i,config.refresherData.pageTemplate,theme,name);
			break;
		case "StyleSheet":
			removeStyleSheet(config.refresherData.styleSheet);
			config.refresherData.styleSheet = replaceNotification(i,config.refresherData.styleSheet,theme,name);
			break;
		case "ColorPalette":
			config.refresherData.colorPalette = replaceNotification(i,config.refresherData.colorPalette,theme,name);
			break;
		default:
			break;
		}
	}
	config.tiddlerTemplates[vi] = getSlice(theme,"ViewTemplate");
	config.tiddlerTemplates[ei] = getSlice(theme,"EditTemplate");
	if(!startingUp) {
		if(config.refresherData.pageTemplate!=pt || config.tiddlerTemplates[vi]!=vt || config.tiddlerTemplates[ei]!=et) {
			refreshAll();
			this.refreshAllTiddlers(true);
		} else {
			setStylesheet(store.getRecursiveTiddlerText(config.refresherData.styleSheet,"",10),config.refreshers.styleSheet);
		}
		config.options.txtTheme = theme;
		saveOption("txtTheme");
	}
};

//--
//-- Backstage
//--
// Backstage tasks
config.tasks.save.action = saveChanges;

var backstage = {
	area: null,
	toolbar: null,
	button: null,
	showButton: null,
	hideButton: null,
	cloak: null,
	panel: null,
	panelBody: null,
	panelFooter: null,
	currTabName: null,
	currTabElem: null,
	content: null,

	init: function() {
		var cmb = config.messages.backstage;
		this.area = document.getElementById("backstageArea");
		this.toolbar = jQuery("#backstageToolbar").empty()[0];
		this.button = jQuery("#backstageButton").empty()[0];
		this.button.style.display = "block";
		var t = cmb.open.text + " " + glyph("bentArrowLeft");
		this.showButton = createTiddlyButton(this.button,t,cmb.open.tooltip,
						function(e) {backstage.show(); return false;},null,"backstageShow");
		t = glyph("bentArrowRight") + " " + cmb.close.text;
		this.hideButton = createTiddlyButton(this.button,t,cmb.close.tooltip,
						function(e) {backstage.hide(); return false;},null,"backstageHide");
		this.cloak = document.getElementById("backstageCloak");
		this.panel = document.getElementById("backstagePanel");
		this.panelFooter = createTiddlyElement(this.panel,"div",null,"backstagePanelFooter");
		this.panelBody = createTiddlyElement(this.panel,"div",null,"backstagePanelBody");
		this.cloak.onmousedown = function(e) {backstage.switchTab(null);};
		createTiddlyText(this.toolbar,cmb.prompt);
		for(t=0; t<config.backstageTasks.length; t++) {
			var taskName = config.backstageTasks[t];
			var task = config.tasks[taskName];
			var handler = task.action ? this.onClickCommand : this.onClickTab;
			var text = task.text + (task.action ? "" : glyph("downTriangle"));
			var btn = createTiddlyButton(this.toolbar,text,task.tooltip,handler,"backstageTab");
			jQuery(btn).addClass(task.action ? "backstageAction" : "backstageTask");
			btn.setAttribute("task", taskName);
			}
		this.content = document.getElementById("contentWrapper");
		if(config.options.chkBackstage)
			this.show();
		else
			this.hide();
	},

	isVisible: function() {
		return this.area ? this.area.style.display == "block" : false;
	},

	show: function() {
		this.area.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.toolbar.style.left = findWindowWidth() + "px";
			var p = [{style: "left", start: findWindowWidth(), end: 0, template: "%0px"}];
			anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p));
		} else {
			backstage.area.style.left = "0px";
		}
		jQuery(this.showButton).hide();
		jQuery(this.hideButton).show();
		config.options.chkBackstage = true;
		saveOption("chkBackstage");
		jQuery(this.content).addClass("backstageVisible");
	},

	hide: function() {
		if(this.currTabElem) {
			this.switchTab(null);
		} else {
			backstage.toolbar.style.left = "0px";
			if(anim && config.options.chkAnimate) {
				var p = [{style: "left", start: 0, end: findWindowWidth(), template: "%0px"}];
				var c = function(element,properties) {backstage.area.style.display = "none";};
				anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p,c));
			} else {
				this.area.style.display = "none";
			}
			this.showButton.style.display = "block";
			this.hideButton.style.display = "none";
			config.options.chkBackstage = false;
			saveOption("chkBackstage");
			jQuery(this.content).removeClass("backstageVisible");
		}
	},

	onClickCommand: function(e) {
		var task = config.tasks[this.getAttribute("task")];
		if(task.action) {
			backstage.switchTab(null);
			task.action();
		}
		return false;
	},

	onClickTab: function(e) {
		backstage.switchTab(this.getAttribute("task"));
		return false;
	},

	// Switch to a given tab, or none if null is passed
	switchTab: function(tabName) {
		var tabElem = null;
		var e = this.toolbar.firstChild;
		while(e) {
			if(e.getAttribute && e.getAttribute("task") == tabName)
				tabElem = e;
			e = e.nextSibling;
		}
		if(tabName == backstage.currTabName) {
			backstage.hidePanel();
			return;
		}
		if(backstage.currTabElem) {
			jQuery(this.currTabElem).removeClass("backstageSelTab");
		}
		if(tabElem && tabName) {
			backstage.preparePanel();
			jQuery(tabElem).addClass("backstageSelTab");
			var task = config.tasks[tabName];
			wikify(task.content,backstage.panelBody,null,null);
			backstage.showPanel();
		} else if(backstage.currTabElem) {
			backstage.hidePanel();
		}
		backstage.currTabName = tabName;
		backstage.currTabElem = tabElem;
	},

	isPanelVisible: function() {
		return backstage.panel ? backstage.panel.style.display == "block" : false;
	},

	preparePanel: function() {
		backstage.cloak.style.height = findWindowHeight() + "px";
		backstage.cloak.style.display = "block";
		jQuery(backstage.panelBody).empty();
		return backstage.panelBody;
	},

	showPanel: function() {
		backstage.panel.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.panel.style.top = (-backstage.panel.offsetHeight) + "px";
			var p = [{style: "top", start: -backstage.panel.offsetHeight, end: 0, template: "%0px"}];
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p),new Scroller(backstage.panel,false));
		} else {
			backstage.panel.style.top = "0px";
		}
		return backstage.panelBody;
	},

	hidePanel: function() {
		if(backstage.currTabElem)
			jQuery(backstage.currTabElem).removeClass("backstageSelTab");
		backstage.currTabElem = null;
		backstage.currTabName = null;
		if(anim && config.options.chkAnimate) {
			var p = [
				{style: "top", start: 0, end: -(backstage.panel.offsetHeight), template: "%0px"},
				{style: "display", atEnd: "none"}
			];
			var c = function(element,properties) {backstage.cloak.style.display = "none";};
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p,c));
		} else {
			jQuery([backstage.panel,backstage.cloak]).hide();
		}
	}
};

config.macros.backstage = {};

config.macros.backstage.handler = function(place,macroName,params)
{
	var backstageTask = config.tasks[params[0]];
	if(backstageTask)
		createTiddlyButton(place,backstageTask.text,backstageTask.tooltip,function(e) {backstage.switchTab(params[0]); return false;});
};

//--
//-- ImportTiddlers macro
//--

config.macros.importTiddlers.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(readOnly) {
		createTiddlyElement(place,"div",null,"marked",this.readOnlyWarning);
		return;
	}
	var w = new Wizard();
	w.createWizard(place,this.wizardTitle);
	this.restart(w);
};

config.macros.importTiddlers.onCancel = function(e)
{
	var wizard = new Wizard(this);
	wizard.clear();
	config.macros.importTiddlers.restart(wizard);
	return false;
};

config.macros.importTiddlers.onClose = function(e)
{
	backstage.hidePanel();
	return false;
};

config.macros.importTiddlers.restart = function(wizard)
{
	var me = config.macros.importTiddlers;
	wizard.addStep(this.step1Title,this.step1Html);
	var t,s = wizard.getElement("selTypes");
	for(t in config.adaptors) {
		var e = createTiddlyElement(s,"option",null,null,config.adaptors[t].serverLabel || t);
		e.value = t;
	}
	if(config.defaultAdaptor)
		s.value = config.defaultAdaptor;
	s = wizard.getElement("selFeeds");
	var feeds = this.getFeeds();
	for(t in feeds) {
		e = createTiddlyElement(s,"option",null,null,t);
		e.value = t;
	}
	wizard.setValue("feeds",feeds);
	s.onchange = me.onFeedChange;
	var fileInput = wizard.getElement("txtBrowse");
	fileInput.onchange = me.onBrowseChange;
	fileInput.onkeyup = me.onBrowseChange;
	wizard.setButtons([{caption: this.openLabel, tooltip: this.openPrompt, onClick: me.onOpen}]);
	wizard.formElem.action = "javascript:;";
	wizard.formElem.onsubmit = function() {
		if(!this.txtPath || this.txtPath.value.length) //# check for manually entered path in first step
			this.lastChild.firstChild.onclick();
	};
};

config.macros.importTiddlers.getFeeds = function()
{
	var feeds = {};
	var t,tagged = store.getTaggedTiddlers("systemServer","title");
	for(t=0; t<tagged.length; t++) {
		var title = tagged[t].title;
		var serverType = store.getTiddlerSlice(title,"Type");
		if(!serverType)
			serverType = "file";
		feeds[title] = {title: title,
						url: store.getTiddlerSlice(title,"URL"),
						workspace: store.getTiddlerSlice(title,"Workspace"),
						workspaceList: store.getTiddlerSlice(title,"WorkspaceList"),
						tiddlerFilter: store.getTiddlerSlice(title,"TiddlerFilter"),
						serverType: serverType,
						description: store.getTiddlerSlice(title,"Description")};
	}
	return feeds;
};

config.macros.importTiddlers.onFeedChange = function(e)
{
	var wizard = new Wizard(this);
	var selTypes = wizard.getElement("selTypes");
	var fileInput = wizard.getElement("txtPath");
	var feeds = wizard.getValue("feeds");
	var f = feeds[this.value];
	if(f) {
		selTypes.value = f.serverType;
		fileInput.value = f.url;
		wizard.setValue("feedName",f.serverType);
		wizard.setValue("feedHost",f.url);
		wizard.setValue("feedWorkspace",f.workspace);
		wizard.setValue("feedWorkspaceList",f.workspaceList);
		wizard.setValue("feedTiddlerFilter",f.tiddlerFilter);
	}
	return false;
};

config.macros.importTiddlers.onBrowseChange = function(e)
{
	var wizard = new Wizard(this);
	if(this.files && this.files[0]) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalFileRead");
		} catch (ex) {
			showException(ex);
		}
	}
	var fileInput = wizard.getElement("txtPath");
	fileInput.value = config.macros.importTiddlers.getURLFromLocalPath(this.value);
	var serverType = wizard.getElement("selTypes");
	serverType.value = "file";
	return true;
};

config.macros.importTiddlers.getURLFromLocalPath = function(v)
{
	if(!v || !v.length)
		return v;
	v = v.replace(/\\/g,"/"); // use "/" for cross-platform consistency
	var u;
	var t = v.split(":");
	var p = t[1] || t[0]; // remove drive letter (if any)
	if(t[1] && (t[0] == "http" || t[0] == "https" || t[0] == "file")) {
		u = v;
	} else if(p.substr(0,1)=="/") {
		u = document.location.protocol + "//" + document.location.hostname + (t[1] ? "/" : "") + v;
	} else {
		var c = document.location.href.replace(/\\/g,"/");
		var pos = c.lastIndexOf("/");
		if(pos!=-1)
			c = c.substr(0,pos); // remove filename
		u = c + "/" + p;
	}
	return u;
};

config.macros.importTiddlers.onOpen = function(e)
{
	var me = config.macros.importTiddlers;
	var wizard = new Wizard(this);
	var fileInput = wizard.getElement("txtPath");
	var url = fileInput.value;
	var serverType = wizard.getElement("selTypes").value || config.defaultAdaptor;
	var adaptor = new config.adaptors[serverType]();
	wizard.setValue("adaptor",adaptor);
	wizard.setValue("serverType",serverType);
	wizard.setValue("host",url);
	adaptor.openHost(url,null,wizard,me.onOpenHost);
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenHost);
	return false;
};

config.macros.importTiddlers.onOpenHost = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	var adaptor = wizard.getValue("adaptor");
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenHost: " + context.statusText);
	adaptor.getWorkspaceList(context,wizard,me.onGetWorkspaceList);
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusGetWorkspaceList);
};

config.macros.importTiddlers.onGetWorkspaceList = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onGetWorkspaceList: " + context.statusText);
	wizard.setValue("context",context);
	var workspace = wizard.getValue("feedWorkspace");
	if(!workspace && context.workspaces.length==1)
		workspace = context.workspaces[0].title;
	if(workspace) {
		context.adaptor.openWorkspace(workspace,context,wizard,me.onOpenWorkspace);
		wizard.setValue("workspace",workspace);
		wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenWorkspace);
		return;
	}
	wizard.addStep(me.step2Title,me.step2Html);
	var t,s = wizard.getElement("selWorkspace");
	s.onchange = me.onWorkspaceChange;
	for(t=0; t<context.workspaces.length; t++) {
		var e = createTiddlyElement(s,"option",null,null,context.workspaces[t].title);
		e.value = context.workspaces[t].title;
	}
	var workspaceList = wizard.getValue("feedWorkspaceList");
	if(workspaceList) {
		var n,list = workspaceList.parseParams("workspace",null,false,true);
		for(n=1; n<list.length; n++) {
			if(context.workspaces.findByField("title",list[n].value) == null) {
				e = createTiddlyElement(s,"option",null,null,list[n].value);
				e.value = list[n].value;
			}
		}
	}
	if(workspace) {
		t = wizard.getElement("txtWorkspace");
		t.value = workspace;
	}
	wizard.setButtons([{caption: me.openLabel, tooltip: me.openPrompt, onClick: me.onChooseWorkspace}]);
};

config.macros.importTiddlers.onWorkspaceChange = function(e)
{
	var wizard = new Wizard(this);
	var t = wizard.getElement("txtWorkspace");
	t.value = this.value;
	this.selectedIndex = 0;
	return false;
};

config.macros.importTiddlers.onChooseWorkspace = function(e)
{
	var me = config.macros.importTiddlers;
	var wizard = new Wizard(this);
	var adaptor = wizard.getValue("adaptor");
	var workspace = wizard.getElement("txtWorkspace").value;
	wizard.setValue("workspace",workspace);
	var context = wizard.getValue("context");
	adaptor.openWorkspace(workspace,context,wizard,me.onOpenWorkspace);
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenWorkspace);
	return false;
};

config.macros.importTiddlers.onOpenWorkspace = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenWorkspace: " + context.statusText);
	var adaptor = wizard.getValue("adaptor");
	adaptor.getTiddlerList(context,wizard,me.onGetTiddlerList,wizard.getValue("feedTiddlerFilter"));
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusGetTiddlerList);
};

config.macros.importTiddlers.onGetTiddlerList = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(context.status !== true) {
		wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],context.statusText||me.errorGettingTiddlerList);
		return;
	}
	// Extract data for the listview
	var listedTiddlers = [];
	if(context.tiddlers) {
		var n;
		for(n=0; n<context.tiddlers.length; n++) {
			var tiddler = context.tiddlers[n];
			listedTiddlers.push({
				title: tiddler.title,
				modified: tiddler.modified,
				modifier: tiddler.modifier,
				text: tiddler.text ? wikifyPlainText(tiddler.text,100) : "",
				tags: tiddler.tags,
				size: tiddler.text ? tiddler.text.length : 0,
				tiddler: tiddler
			});
		}
	}
	listedTiddlers.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
	// Display the listview
	wizard.addStep(me.step3Title,me.step3Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	var listView = ListView.create(listWrapper,listedTiddlers,me.listViewTemplate);
	wizard.setValue("listView",listView);
	wizard.setValue("context",context);
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler");
	txtSaveTiddler.value = me.generateSystemServerName(wizard);
	wizard.setButtons([
			{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel},
			{caption: me.importLabel, tooltip: me.importPrompt, onClick: me.doImport}
		]);
};

config.macros.importTiddlers.generateSystemServerName = function(wizard)
{
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var pattern = config.macros.importTiddlers[workspace ? "systemServerNamePattern" : "systemServerNamePatternNoWorkspace"];
	return pattern.format([serverType,host,workspace]);
};

config.macros.importTiddlers.saveServerTiddler = function(wizard)
{
	var me = config.macros.importTiddlers;
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler").value;
	if(store.tiddlerExists(txtSaveTiddler)) {
		if(!confirm(me.confirmOverwriteSaveTiddler.format([txtSaveTiddler])))
			return;
		store.suspendNotifications();
		store.removeTiddler(txtSaveTiddler);
		store.resumeNotifications();
	}
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var text = me.serverSaveTemplate.format([serverType,host,workspace]);
	store.saveTiddler(txtSaveTiddler,txtSaveTiddler,text,me.serverSaveModifier,new Date(),["systemServer"]);
};

config.macros.importTiddlers.doImport = function(e)
{
	var me = config.macros.importTiddlers;
	var wizard = new Wizard(this);
	if(wizard.getElement("chkSave").checked)
		me.saveServerTiddler(wizard);
	var chkSync = wizard.getElement("chkSync").checked;
	wizard.setValue("sync",chkSync);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	var adaptor = wizard.getValue("adaptor");
	var overwrite = [];
	var t;
	for(t=0; t<rowNames.length; t++) {
		if(store.tiddlerExists(rowNames[t]))
			overwrite.push(rowNames[t]);
	}
	if(overwrite.length > 0) {
		if(!confirm(me.confirmOverwriteText.format([overwrite.join(", ")])))
			return false;
	}
	wizard.addStep(me.step4Title.format([rowNames.length]),me.step4Html);
	for(t=0; t<rowNames.length; t++) {
		var link = document.createElement("div");
		createTiddlyLink(link,rowNames[t],true);
		var place = wizard.getElement("markReport");
		place.parentNode.insertBefore(link,place);
	}
	wizard.setValue("remainingImports",rowNames.length);
	wizard.setButtons([
			{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}
		],me.statusDoingImport);
	var wizardContext = wizard.getValue("context");
	var tiddlers = wizardContext ? wizardContext.tiddlers : [];
	for(t=0; t<rowNames.length; t++) {
		var context = {
			allowSynchronous:true,
			tiddler:tiddlers[tiddlers.findByField("title",rowNames[t])]
		};
		adaptor.getTiddler(rowNames[t],context,wizard,me.onGetTiddler);
	}
	return false;
};

config.macros.importTiddlers.onGetTiddler = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(!context.status)
		displayMessage("Error in importTiddlers.onGetTiddler: " + context.statusText);
	var tiddler = context.tiddler;
	store.suspendNotifications();
	store.saveTiddler(tiddler.title, tiddler.title, tiddler.text, tiddler.modifier, tiddler.modified, tiddler.tags, tiddler.fields, true, tiddler.created);
	if(!wizard.getValue("sync")) {
		store.setValue(tiddler.title,'server',null);
	}
	store.resumeNotifications();
	if(!context.isSynchronous)
		store.notify(tiddler.title,true);
	var remainingImports = wizard.getValue("remainingImports")-1;
	wizard.setValue("remainingImports",remainingImports);
	if(remainingImports == 0) {
		if(context.isSynchronous) {
			store.notifyAll();
			refreshDisplay();
		}
		wizard.setButtons([
				{caption: me.doneLabel, tooltip: me.donePrompt, onClick: me.onClose}
			],me.statusDoneImport);
		autoSaveChanges();
	}
};

//--
//-- Upgrade macro
//--

config.macros.upgrade.handler = function(place)
{
	var w = new Wizard();
	w.createWizard(place,this.wizardTitle);
	w.addStep(this.step1Title,this.step1Html.format([this.source,this.source]));
	w.setButtons([{caption: this.upgradeLabel, tooltip: this.upgradePrompt, onClick: this.onClickUpgrade}]);
};

config.macros.upgrade.onClickUpgrade = function(e)
{
	var me = config.macros.upgrade;
	var w = new Wizard(this);
	if(window.location.protocol != "file:") {
		alert(me.errorCantUpgrade);
		return false;
	}
	if(story.areAnyDirty() || store.isDirty()) {
		alert(me.errorNotSaved);
		return false;
	}
	var localPath = getLocalPath(document.location.toString());
	var backupPath = getBackupPath(localPath,me.backupExtension);
	w.setValue("backupPath",backupPath);
	w.setButtons([],me.statusPreparingBackup);
	var original = loadOriginal(localPath);
	w.setButtons([],me.statusSavingBackup);
	var backup = copyFile(backupPath,localPath);
	if(!backup)
		backup = saveFile(backupPath,original);
	if(!backup) {
		w.setButtons([],me.errorSavingBackup);
		alert(me.errorSavingBackup);
		return false;
	}
	w.setButtons([],me.statusLoadingCore);
	var options = {
		type:"GET",
		url:me.source,
		processData:false,
		success:function(data,textStatus,jqXHR) {
			me.onLoadCore(true,w,jqXHR.responseText,me.source,jqXHR);
		},
		error:function(jqXHR,textStatus,errorThrown) {
			me.onLoadCore(false,w,null,me.source,jqXHR);
		}
	};
	ajaxReq(options);
	return false;
};

config.macros.upgrade.onLoadCore = function(status,params,responseText,url,xhr)
{
	var me = config.macros.upgrade;
	var w = params;
	var errMsg;
	if(!status)
		errMsg = me.errorLoadingCore;
	var newVer = me.extractVersion(responseText);
	if(!newVer)
		errMsg = me.errorCoreFormat;
	if(errMsg) {
		w.setButtons([],errMsg);
		alert(errMsg);
		return;
	}
	var onStartUpgrade = function(e) {
		w.setButtons([],me.statusSavingCore);
		var localPath = getLocalPath(document.location.toString());
		saveFile(localPath,responseText);
		w.setButtons([],me.statusReloadingCore);
		var backupPath = w.getValue("backupPath");
		var newLoc = document.location.toString() + "?time=" + new Date().convertToYYYYMMDDHHMM() + "#upgrade:[[" + encodeURI(backupPath) + "]]";
		window.setTimeout(function () {window.location = newLoc;},10);
	};
	var step2 = [me.step2Html_downgrade,me.step2Html_restore,me.step2Html_upgrade][compareVersions(version,newVer) + 1];
	w.addStep(me.step2Title,step2.format([formatVersion(newVer),formatVersion(version)]));
	w.setButtons([{caption: me.startLabel, tooltip: me.startPrompt, onClick: onStartUpgrade},{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}]);
};

config.macros.upgrade.onCancel = function(e)
{
	var me = config.macros.upgrade;
	var w = new Wizard(this);
	w.addStep(me.step3Title,me.step3Html);
	w.setButtons([]);
	return false;
};

config.macros.upgrade.extractVersion = function(upgradeFile)
{
	var re = /^var version = \{title: "([^"]+)", major: (\d+), minor: (\d+), revision: (\d+)(, beta: (\d+)){0,1}, date: new Date\("([^"]+)"\)/mg;
	var m = re.exec(upgradeFile);
	return m ? {title: m[1], major: m[2], minor: m[3], revision: m[4], beta: m[6], date: new Date(m[7])} : null;
};

function upgradeFrom(path)
{
	var importStore = new TiddlyWiki();
	var tw = loadFile(path);
	if(window.netscape !== undefined)
		tw = convertUTF8ToUnicode(tw);
	importStore.importTiddlyWiki(tw);
	importStore.forEachTiddler(function(title,tiddler) {
		if(!store.getTiddler(title)) {
			store.addTiddler(tiddler);
		}
	});
	refreshDisplay();
	saveChanges(); //# To create appropriate Markup* sections
	alert(config.messages.upgradeDone.format([formatVersion()]));
	window.location = window.location.toString().substr(0,window.location.toString().lastIndexOf("?"));
}

//--
//-- Sync macro
//--

// Synchronisation handlers
config.syncers = {};

// Sync state.
var currSync = null;

// sync macro
config.macros.sync.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(!wikifier.isStatic)
		this.startSync(place);
};

config.macros.sync.cancelSync = function()
{
	currSync = null;
};

config.macros.sync.startSync = function(place)
{
	if(currSync)
		config.macros.sync.cancelSync();
	currSync = {};
	currSync.syncList = this.getSyncableTiddlers();
	currSync.syncTasks = this.createSyncTasks(currSync.syncList);
	this.preProcessSyncableTiddlers(currSync.syncList);
	var wizard = new Wizard();
	currSync.wizard = wizard;
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	currSync.listView = ListView.create(listWrapper,currSync.syncList,this.listViewTemplate);
	this.processSyncableTiddlers(currSync.syncList);
	wizard.setButtons([{caption: this.syncLabel, tooltip: this.syncPrompt, onClick: this.doSync}]);
};

config.macros.sync.getSyncableTiddlers = function()
{
	var list = [];
	store.forEachTiddler(function(title,tiddler) {
		var syncItem = {};
		syncItem.serverType = tiddler.getServerType();
		syncItem.serverHost = tiddler.fields['server.host'];
		if(syncItem.serverType && syncItem.serverHost) {
			syncItem.adaptor = new config.adaptors[syncItem.serverType]();
			syncItem.serverHost = syncItem.adaptor.fullHostName(syncItem.serverHost);
			syncItem.serverWorkspace = tiddler.fields['server.workspace'];
			syncItem.tiddler = tiddler;
			syncItem.title = tiddler.title;
			syncItem.isTouched = tiddler.isTouched();
			syncItem.selected = syncItem.isTouched;
			syncItem.syncStatus = config.macros.sync.syncStatusList[syncItem.isTouched ? "changedLocally" : "none"];
			syncItem.status = syncItem.syncStatus.text;
			list.push(syncItem);
		}
		});
	list.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
	return list;
};

config.macros.sync.preProcessSyncableTiddlers = function(syncList)
{
	var i;
	for(i=0; i<syncList.length; i++) {
		var si = syncList[i];
		si.serverUrl = si.adaptor.generateTiddlerInfo(si.tiddler).uri;
	}
};

config.macros.sync.processSyncableTiddlers = function(syncList)
{
	var i;
	for(i=0; i<syncList.length; i++) {
		var si = syncList[i];
		if(si.syncStatus.display)
			si.rowElement.style.display = si.syncStatus.display;
		if(si.syncStatus.className)
			si.rowElement.className = si.syncStatus.className;
	}
};

config.macros.sync.createSyncTasks = function(syncList)
{
	var i,syncTasks = [];
	for(i=0; i<syncList.length; i++) {
		var si = syncList[i];
		var j,r = null;
		for(j=0; j<syncTasks.length; j++) {
			var cst = syncTasks[j];
			if(si.serverType == cst.serverType && si.serverHost == cst.serverHost && si.serverWorkspace == cst.serverWorkspace)
				r = cst;
		}
		if(r) {
			si.syncTask = r;
			r.syncItems.push(si);
		} else {
			si.syncTask = this.createSyncTask(si);
			syncTasks.push(si.syncTask);
		}
	}
	return syncTasks;
};

config.macros.sync.createSyncTask = function(syncItem)
{
	var st = {};
	st.serverType = syncItem.serverType;
	st.serverHost = syncItem.serverHost;
	st.serverWorkspace = syncItem.serverWorkspace;
	st.syncItems = [syncItem];

	var getTiddlerListCallback = function(context,sycnItems) {
		var me = config.macros.sync;
		if(!context.status) {
			displayMessage(context.statusText);
			return false;
		}
		syncItems = context.userParams;
		var i,tiddlers = context.tiddlers;
		for(i=0; i<syncItems.length; i++) {
			var si = syncItems[i];
			var f = tiddlers.findByField("title",si.title);
			if(f !== null) {
				if(tiddlers[f].fields['server.page.revision'] > si.tiddler.fields['server.page.revision']) {
					si.syncStatus = me.syncStatusList[si.isTouched ? 'changedBoth' : 'changedServer'];
				}
			} else {
				si.syncStatus = me.syncStatusList.notFound;
			}
			me.updateSyncStatus(si);
		}
		return true;
	};

	var openWorkspaceCallback = function(context,syncItems) {
		if(context.status) {
			context.adaptor.getTiddlerList(context,syncItems,getTiddlerListCallback);
			return true;
		}
		displayMessage(context.statusText);
		return false;
	};

	var context = {host:st.serverHost,workspace:st.serverWorkspace};
	syncItem.adaptor.openHost(st.serverHost);
	syncItem.adaptor.openWorkspace(st.serverWorkspace,context,st.syncItems,openWorkspaceCallback);
	return st;
};

config.macros.sync.updateSyncStatus = function(syncItem)
{
	var e = syncItem.colElements["status"];
	jQuery(e).empty();
	createTiddlyText(e,syncItem.syncStatus.text);
	syncItem.rowElement.style.display = syncItem.syncStatus.display;
	if(syncItem.syncStatus.className)
		syncItem.rowElement.className = syncItem.syncStatus.className;
};

config.macros.sync.doSync = function(e)
{
	var me = config.macros.sync;
	var getTiddlerCallback = function(context,syncItem) {
		if(syncItem) {
			var tiddler = context.tiddler;
			store.saveTiddler(tiddler.title,tiddler.title,tiddler.text,tiddler.modifier,tiddler.modified,tiddler.tags,tiddler.fields,true,tiddler.created);
			syncItem.syncStatus = me.syncStatusList.gotFromServer;
			me.updateSyncStatus(syncItem);
		}
	};
	var putTiddlerCallback = function(context,syncItem) {
		if(syncItem) {
			store.resetTiddler(context.title);
			syncItem.syncStatus = me.syncStatusList.putToServer;
			me.updateSyncStatus(syncItem);
		}
	};

	var rowNames = ListView.getSelectedRows(currSync.listView);
	var i,sl = me.syncStatusList;
	for(i=0; i<currSync.syncList.length; i++) {
		var si = currSync.syncList[i];
		if(rowNames.indexOf(si.title) != -1) {
			var errorMsg = "Error in doSync: ";
			try {
				var r = true;
				switch(si.syncStatus) {
				case sl.changedServer:
					var context = {"workspace": si.serverWorkspace};
					r = si.adaptor.getTiddler(si.title,context,si,getTiddlerCallback);
					break;
				case sl.notFound:
				case sl.changedLocally:
				case sl.changedBoth:
					r = si.adaptor.putTiddler(si.tiddler,null,si,putTiddlerCallback);
					break;
				default:
					break;
				}
				if(!r)
					displayMessage(errorMsg + r);
			} catch(ex) {
				if(ex.name == "TypeError")
					displayMessage("sync operation unsupported: " + ex.message);
				else
					displayMessage(errorMsg + ex.message);
			}
		}
	}
	return false;
};

//--
//-- Manager UI for groups of tiddlers
//--

config.macros.plugins.handler = function(place,macroName,params,wikifier,paramString)
{
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	listWrapper.setAttribute("refresh","macro");
	listWrapper.setAttribute("macroName","plugins");
	listWrapper.setAttribute("params",paramString);
	this.refresh(listWrapper,paramString);
};

config.macros.plugins.refresh = function(listWrapper,params)
{
	var me = config.macros.plugins;
	var wizard = new Wizard(listWrapper);
	var selectedRows = [];
	ListView.forEachSelector(listWrapper,function(e,rowName) {
			if(e.checked)
				selectedRows.push(e.getAttribute("rowName"));
		});
	jQuery(listWrapper).empty();
	params = params.parseParams("anon");
	var plugins = installedPlugins.slice(0);
	var t,tiddler,p;
	var configTiddlers = store.getTaggedTiddlers("systemConfig");
	for(t=0; t<configTiddlers.length; t++) {
		tiddler = configTiddlers[t];
		if(plugins.findByField("title",tiddler.title) == null) {
			p = getPluginInfo(tiddler);
			p.executed = false;
			p.log.splice(0,0,this.skippedText);
			plugins.push(p);
		}
	}
	for(t=0; t<plugins.length; t++) {
		p = plugins[t];
		p.size = p.tiddler.text ? p.tiddler.text.length : 0;
		p.forced = p.tiddler.isTagged("systemConfigForce");
		p.disabled = p.tiddler.isTagged("systemConfigDisable");
		p.Selected = selectedRows.indexOf(plugins[t].title) != -1;
	}
	if(plugins.length == 0) {
		createTiddlyElement(listWrapper,"em",null,null,this.noPluginText);
		wizard.setButtons([]);
	} else {
		var template = readOnly ? this.listViewTemplateReadOnly : this.listViewTemplate;
		var listView = ListView.create(listWrapper,plugins,template,this.onSelectCommand);
		wizard.setValue("listView",listView);
		if(!readOnly) {
			wizard.setButtons([
				{caption: me.removeLabel, tooltip: me.removePrompt, onClick: me.doRemoveTag},
				{caption: me.deleteLabel, tooltip: me.deletePrompt, onClick: me.doDelete}
			]);
		}
	}
};

config.macros.plugins.doRemoveTag = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		var t;
		for(t=0; t<rowNames.length; t++) {
			store.setTiddlerTag(rowNames[t],false,"systemConfig");
		}
		autoSaveChanges();
	}
};

config.macros.plugins.doDelete = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		if(confirm(config.macros.plugins.confirmDeleteText.format([rowNames.join(", ")]))) {
			var t;
			for(t=0; t<rowNames.length; t++) {
				store.removeTiddler(rowNames[t]);
				story.closeTiddler(rowNames[t],true);
			}
		}
		autoSaveChanges();
	}
};

//--
//-- Message area
//--

function getMessageDiv()
{
	var msgArea = document.getElementById("messageArea");
	if(!msgArea)
		return null;
	if(!msgArea.hasChildNodes())
		createTiddlyButton(createTiddlyElement(msgArea,"div",null,"messageToolbar"),
			config.messages.messageClose.text,
			config.messages.messageClose.tooltip,
			clearMessage);
	msgArea.style.display = "block";
	return createTiddlyElement(msgArea,"div");
}

function displayMessage(text,linkText)
{
	var e = getMessageDiv();
	if(!e) {
		alert(text);
		return;
	}
	if(linkText) {
		var link = createTiddlyElement(e,"a",null,null,text);
		link.href = linkText;
		link.target = "_blank";
	} else {
		e.appendChild(document.createTextNode(text));
	}
}

function clearMessage()
{
	var msgArea = document.getElementById("messageArea");
	if(msgArea) {
		jQuery(msgArea).empty();
		msgArea.style.display = "none";
	}
	return false;
}

//--
//-- Refresh mechanism
//--

config.notifyTiddlers = [
	{name: "SystemSettings", notify: onSystemSettingsChange},
	{name: "StyleSheetLayout", notify: refreshStyles},
	{name: "StyleSheetColors", notify: refreshStyles},
	{name: "StyleSheet", notify: refreshStyles},
	{name: "StyleSheetPrint", notify: refreshStyles},
	{name: "PageTemplate", notify: refreshPageTemplate},
	{name: "SiteTitle", notify: refreshPageTitle},
	{name: "SiteSubtitle", notify: refreshPageTitle},
	{name: "WindowTitle", notify: refreshPageTitle},
	{name: "ColorPalette", notify: refreshColorPalette},
	{name: null, notify: refreshDisplay}
];

config.refreshers = {
	link: function(e,changeList)
		{
		var title = e.getAttribute("tiddlyLink");
		refreshTiddlyLink(e,title);
		return true;
		},

	tiddler: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var template = e.getAttribute("template");
		if(changeList && (changeList.indexOf && changeList.indexOf(title) != -1) && !story.isDirty(title))
			story.refreshTiddler(title,template,true);
		else
			refreshElements(e,changeList);
		return true;
		},

	content: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var force = e.getAttribute("force");
		var args = e.getAttribute("args");
		if(force != null || changeList == null || (changeList.indexOf && changeList.indexOf(title) != -1)) {
			jQuery(e).empty();
			config.macros.tiddler.transclude(e,title,args);
			return true;
		} else
			return false;
		},

	macro: function(e,changeList)
		{
		var macro = e.getAttribute("macroName");
		var params = e.getAttribute("params");
		if(macro)
			macro = config.macros[macro];
		if(macro && macro.refresh)
			macro.refresh(e,params);
		return true;
		}
};

config.refresherData = {
	styleSheet: "StyleSheet",
	defaultStyleSheet: "StyleSheet",
	pageTemplate: "PageTemplate",
	defaultPageTemplate: "PageTemplate",
	colorPalette: "ColorPalette",
	defaultColorPalette: "ColorPalette"
};

function refreshElements(root,changeList)
{
	var c,nodes = root.childNodes;
	for(c=0; c<nodes.length; c++) {
		var e = nodes[c], type = null;
		if(e.getAttribute && (e.tagName ? e.tagName != "IFRAME" : true))
			type = e.getAttribute("refresh");
		var refresher = config.refreshers[type];
		var refreshed = false;
		if(refresher != undefined)
			refreshed = refresher(e,changeList);
		if(e.hasChildNodes() && !refreshed)
			refreshElements(e,changeList);
	}
}

function applyHtmlMacros(root,tiddler)
{
	var e = root.firstChild;
	while(e) {
		var nextChild = e.nextSibling;
		if(e.getAttribute) {
			var macro = e.getAttribute("macro");
			if(macro) {
				e.removeAttribute("macro");
				var params = "";
				var p = macro.indexOf(" ");
				if(p != -1) {
					params = macro.substr(p+1);
					macro = macro.substr(0,p);
				}
				invokeMacro(e,macro,params,null,tiddler);
			}
		}
		if(e.hasChildNodes())
			applyHtmlMacros(e,tiddler);
		e = nextChild;
	}
}

function refreshPageTemplate(title)
{
	var stash = jQuery("<div/>").appendTo("body").hide()[0];
	var display = story.getContainer();
	var nodes,t;
	if(display) {
		nodes = display.childNodes;
		for(t=nodes.length-1; t>=0; t--)
			stash.appendChild(nodes[t]);
	}
	var wrapper = document.getElementById("contentWrapper");

	var isAvailable = function(title) {
		var s = title ? title.indexOf(config.textPrimitives.sectionSeparator) : -1;
		if(s!=-1)
			title = title.substr(0,s);
		return store.tiddlerExists(title) || store.isShadowTiddler(title);
	};
	if(!title || !isAvailable(title))
		title = config.refresherData.pageTemplate;
	if(!isAvailable(title))
		title = config.refresherData.defaultPageTemplate; //# this one is always avaialable
	wrapper.innerHTML = store.getRecursiveTiddlerText(title,null,10);
	applyHtmlMacros(wrapper);
	refreshElements(wrapper);
	display = story.getContainer();
	jQuery(display).empty();
	if(!display)
		display = createTiddlyElement(wrapper,"div",story.containerId());
	nodes = stash.childNodes;
	for(t=nodes.length-1; t>=0; t--)
		display.appendChild(nodes[t]);
	jQuery(stash).remove();
}

function refreshDisplay(hint)
{
	if(typeof hint == "string")
		hint = [hint];
	var e = document.getElementById("contentWrapper");
	refreshElements(e,hint);
	if(backstage.isPanelVisible()) {
		e = document.getElementById("backstage");
		refreshElements(e,hint);
	}
}

function refreshPageTitle()
{
	document.title = getPageTitle();
}

function getPageTitle()
{
	return wikifyPlainText(store.getTiddlerText("WindowTitle",""),null,tiddler);
}

function refreshStyles(title,doc)
{
	setStylesheet(title == null ? "" : store.getRecursiveTiddlerText(title,"",10),title,doc || document);
}

function refreshColorPalette(title)
{
	if(!startingUp)
		refreshAll();
}

function refreshAll()
{
	refreshPageTemplate();
	refreshDisplay();
	refreshStyles("StyleSheetLayout");
	refreshStyles("StyleSheetColors");
	refreshStyles(config.refresherData.styleSheet);
	refreshStyles("StyleSheetPrint");
}

//--
//-- Option handling
//--

config.optionHandlers = {
	'txt': {
		get: function(name) {return encodeCookie(config.options[name].toString());},
		set: function(name,value) {config.options[name] = decodeCookie(value);}
	},
	'chk': {
		get: function(name) {return config.options[name] ? 'true' : 'false';},
		set: function(name,value) {config.options[name] = value == 'true';}
	}
};

function setOption(name,value)
{
	var optType = name.substr(0,3);
	if(config.optionHandlers[optType] && config.optionHandlers[optType].set)
		config.optionHandlers[optType].set(name,value);
}

// Gets the value of an option as a string. Most code should just read from config.options.* directly
function getOption(name)
{
	var optType = name.substr(0,3);
	return config.optionHandlers[optType] && config.optionHandlers[optType].get ? config.optionHandlers[optType].get(name) : null;
}

function loadOptions()
{
	if(safeMode)
		return;
	loadCookies();
	loadSystemSettings();
}
// @Deprecated; retained for backwards compatibility
var loadOptionsCookie = loadOptions;

function getCookies()
{
	var cookieList = document.cookie.split(';');
	var i,cookies = {};
	for(i=0; i<cookieList.length; i++) {
		var p = cookieList[i].indexOf('=');
		if(p != -1) {
			var name = cookieList[i].substr(0,p).trim();
			var value = cookieList[i].substr(p+1).trim();
			cookies[name] = value;
		}
	}
	return cookies;
}

function loadCookies()
{
	var i,cookies = getCookies();
	if(cookies['TiddlyWiki']) {
		cookies = cookies['TiddlyWiki'].decodeHashMap();
	}
	for(i in cookies) {
		if(config.optionsSource[i] != 'setting') {
			setOption(i,cookies[i]);
		}
	}
}

function loadSystemSettings()
{
	var key,settings = store.calcAllSlices('SystemSettings');
	config.optionsSource = {};
	for(key in settings) {
		setOption(key,settings[key]);
		config.optionsSource[key] = 'setting';
	}
}

function onSystemSettingsChange()
{
	if(!startingUp) {
		loadSystemSettings();
	}
}

function saveOption(name)
{
	if(safeMode)
		return;
	if(name.match(/[()\s]/g, '_')) {
		alert(config.messages.invalidCookie.format([name]));
		return;
	}
	saveCookie(name);
	if(config.optionsSource[name] == 'setting') {
		saveSystemSetting(name,true);
	}
}
// @Deprecated; retained for backwards compatibility
var saveOptionCookie = saveOption;

function removeCookie(name)
{
	document.cookie = name + '=; expires=Thu, 01-Jan-1970 00:00:01 UTC; path=/;';
}

function saveCookie(name)
{
	var key,cookies = {};
	for(key in config.options) {
		var value = getOption(key);
		value = value == null ? 'false' : value;
		cookies[key] = value;
	}
	document.cookie = 'TiddlyWiki=' + String.encodeHashMap(cookies) + '; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/';
	cookies = getCookies();
	var c;
	for(c in cookies) {
		var optType = c.substr(0,3);
		if(config.optionHandlers[optType])
			removeCookie(c);
	}
}

var systemSettingSave;
function commitSystemSettings(storeWasDirty)
{
	if(systemSettingSave) {
		window.clearTimeout(systemSettingSave);
	}
	systemSettingSave = window.setTimeout(function() {
		var tiddler = store.getTiddler('SystemSettings');
		if(storeWasDirty == false && story.areAnyDirty() == false) {
			saveChanges(null,[tiddler]);
		} else {
			autoSaveChanges(null,[tiddler]);
		}
	}, 1000);
}

function saveSystemSetting(name,saveFile)
{
	var title = 'SystemSettings';
	var slice = store.getTiddlerSlice(title,name);
	if(readOnly || slice === getOption(name)) {
		return; //# don't save if read-only or the option hasn't changed
	}
	var slices = store.calcAllSlices(title);
	var key;
	for(key in config.optionsSource) {
		var value = getOption(key) || '';
		if(slices[key] !== value) {
			slices[key] = value;
		}
	}
	var text = [];
	for(key in slices) {
		text.push('%0: %1'.format([key,slices[key]]));
	}
	text = text.sort().join('\n');
	var storeWasDirty = store.isDirty();
	var tiddler = store.getTiddler(title);
	if(tiddler) {
		tiddler.text = text;
		tiddler = store.saveTiddler(tiddler);
	} else {
		tiddler = store.saveTiddler(title,title,text,'System',new Date(),['excludeLists'],config.defaultCustomFields);
	}
	if(saveFile) {
		commitSystemSettings(storeWasDirty);
	}
}

function encodeCookie(s)
{
	return escape(convertUnicodeToHtmlEntities(s));
}

function decodeCookie(s)
{
	s = unescape(s);
	var re = /&#[0-9]{1,5};/g;
	return s.replace(re,function($0) {return String.fromCharCode(eval($0.replace(/[&#;]/g,'')));});
}

config.macros.option.genericCreate = function(place,type,opt,className,desc)
{
	var typeInfo = config.macros.option.types[type];
	var c = document.createElement(typeInfo.elementType);
	if(typeInfo.typeValue)
		c.setAttribute('type',typeInfo.typeValue);
	c[typeInfo.eventName] = typeInfo.onChange;
	c.setAttribute('option',opt);
	c.className = className || typeInfo.className;
	if(config.optionsDesc[opt])
		c.setAttribute('title',config.optionsDesc[opt]);
	place.appendChild(c);
	if(desc != 'no')
		createTiddlyText(place,config.optionsDesc[opt] || opt);
	c[typeInfo.valueField] = config.options[opt];
	return c;
};

config.macros.option.genericOnChange = function(e)
{
	var opt = this.getAttribute('option');
	if(opt) {
		var optType = opt.substr(0,3);
		var handler = config.macros.option.types[optType];
		if(handler.elementType && handler.valueField)
			config.macros.option.propagateOption(opt,handler.valueField,this[handler.valueField],handler.elementType,this);
	}
	return true;
};

config.macros.option.types = {
	'txt': {
		elementType: 'input',
		valueField: 'value',
		eventName: 'onchange',
		className: 'txtOptionInput',
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	},
	'chk': {
		elementType: 'input',
		valueField: 'checked',
		eventName: 'onclick',
		className: 'chkOptionInput',
		typeValue: 'checkbox',
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	}
};

config.macros.option.propagateOption = function(opt,valueField,value,elementType,elem)
{
	config.options[opt] = value;
	saveOption(opt);
	var t,nodes = document.getElementsByTagName(elementType);
	for(t=0; t<nodes.length; t++) {
		var optNode = nodes[t].getAttribute('option');
		if(opt == optNode && nodes[t]!=elem)
			nodes[t][valueField] = value;
	}
};

config.macros.option.handler = function(place,macroName,params,wikifier,paramString)
{
	params = paramString.parseParams('anon',null,true,false,false);
	var opt = (params[1] && params[1].name == 'anon') ? params[1].value : getParam(params,'name',null);
	var className = (params[2] && params[2].name == 'anon') ? params[2].value : getParam(params,'class',null);
	var desc = getParam(params,'desc','no');
	var type = opt.substr(0,3);
	var h = config.macros.option.types[type];
	if(h && h.create)
		h.create(place,type,opt,className,desc);
};

config.macros.options.handler = function(place,macroName,params,wikifier,paramString)
{
	params = paramString.parseParams('anon',null,true,false,false);
	var showUnknown = getParam(params,'showUnknown','no');
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement('markList');
	var chkUnknown = wizard.getElement('chkUnknown');
	chkUnknown.checked = showUnknown == 'yes';
	chkUnknown.onchange = this.onChangeUnknown;
	var listWrapper = document.createElement('div');
	markList.parentNode.insertBefore(listWrapper,markList);
	wizard.setValue('listWrapper',listWrapper);
	this.refreshOptions(listWrapper,showUnknown == 'yes');
};

config.macros.options.refreshOptions = function(listWrapper,showUnknown)
{
	var n,opts = [];
	for(n in config.options) {
		var opt = {};
		opt.option = '';
		opt.name = n;
		opt.lowlight = !config.optionsDesc[n];
		opt.description = opt.lowlight ? this.unknownDescription : config.optionsDesc[n];
		if(!opt.lowlight || showUnknown)
			opts.push(opt);
	}
	opts.sort(function(a,b) {return a.name.substr(3) < b.name.substr(3) ? -1 : (a.name.substr(3) == b.name.substr(3) ? 0 : +1);});
	ListView.create(listWrapper,opts,this.listViewTemplate);
	for(n=0; n<opts.length; n++) {
		var type = opts[n].name.substr(0,3);
		var h = config.macros.option.types[type];
		if(h && h.create) {
			h.create(opts[n].colElements['option'],type,opts[n].name,null,'no');
		}
	}
};

config.macros.options.onChangeUnknown = function(e)
{
	var wizard = new Wizard(this);
	var listWrapper = wizard.getValue('listWrapper');
	jQuery(listWrapper).empty();
	config.macros.options.refreshOptions(listWrapper,this.checked);
	return false;
};

//--
//-- Saving
//--

var saveUsingSafari = false;

var startSaveArea = '<div id="' + 'storeArea">'; // Split up into two so that indexOf() of this source doesn't find it
var startSaveAreaRE = /<((div)|(DIV)) ((id)|(ID))=["']?storeArea['"]?>/; // Used for IE6
var endSaveArea = '</d' + 'iv>';
var endSaveAreaCaps = '</D' + 'IV>';

// If there are unsaved changes, force the user to confirm before exitting
function confirmExit()
{
	hadConfirmExit = true;
	if((store && store.isDirty && store.isDirty()) || (story && story.areAnyDirty && story.areAnyDirty()))
		return config.messages.confirmExit;
}

// Give the user a chance to save changes before exitting
function checkUnsavedChanges()
{
	if(store && store.isDirty && store.isDirty() && window.hadConfirmExit === false) {
		if(confirm(config.messages.unsavedChangesWarning))
			saveChanges();
	}
}

function updateLanguageAttribute(s)
{
	if(config.locale) {
		var mRE = /(<html(?:.*?)?)(?: xml:lang\="([a-z]+)")?(?: lang\="([a-z]+)")?>/;
		var m = mRE.exec(s);
		if(m) {
			var t = m[1];
			if(m[2])
				t += ' xml:lang="' + config.locale + '"';
			if(m[3])
				t += ' lang="' + config.locale + '"';
			t += ">";
			s = s.substr(0,m.index) + t + s.substr(m.index+m[0].length);
		}
	}
	return s;
}

function updateMarkupBlock(s,blockName,tiddlerName)
{
	return s.replaceChunk(
			"<!--%0-START-->".format([blockName]),
			"<!--%0-END-->".format([blockName]),
			"\n" + convertUnicodeToFileFormat(store.getRecursiveTiddlerText(tiddlerName,"")) + "\n");
}

function updateOriginal(original,posDiv,localPath)
{
	if(!posDiv)
		posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(config.messages.invalidFileError.format([localPath]));
		return null;
	}
	var revised = original.substr(0,posDiv[0] + startSaveArea.length) + "\n" +
				convertUnicodeToFileFormat(store.allTiddlersAsHtml()) + "\n" +
				original.substr(posDiv[1]);
	var newSiteTitle = convertUnicodeToFileFormat(getPageTitle()).htmlEncode();
	revised = revised.replaceChunk("<title"+">","</title"+">"," " + newSiteTitle + " ");
	revised = updateLanguageAttribute(revised);
	revised = updateMarkupBlock(revised,"PRE-HEAD","MarkupPreHead");
	revised = updateMarkupBlock(revised,"POST-HEAD","MarkupPostHead");
	revised = updateMarkupBlock(revised,"PRE-BODY","MarkupPreBody");
	revised = updateMarkupBlock(revised,"POST-SCRIPT","MarkupPostBody");
	return revised;
}

function locateStoreArea(original)
{
	// Locate the storeArea divs
	if(!original)
		return null;
	var posOpeningDiv = original.search(startSaveAreaRE);
	var limitClosingDiv = original.indexOf("<"+"!--POST-STOREAREA--"+">");
	if(limitClosingDiv == -1)
		limitClosingDiv = original.indexOf("<"+"!--POST-BODY-START--"+">");
	var start = limitClosingDiv == -1 ? original.length : limitClosingDiv;
	var posClosingDiv = original.lastIndexOf(endSaveArea,start);
	if(posClosingDiv == -1)
		posClosingDiv = original.lastIndexOf(endSaveAreaCaps,start);
	return (posOpeningDiv != -1 && posClosingDiv != -1) ? [posOpeningDiv,posClosingDiv] : null;
}

function autoSaveChanges(onlyIfDirty,tiddlers)
{
	if(config.options.chkAutoSave)
		saveChanges(onlyIfDirty,tiddlers);
}

function loadOriginal(localPath)
{
	return loadFile(localPath);
}

// Save this tiddlywiki with the pending changes
function saveChanges(onlyIfDirty,tiddlers)
{
	if(onlyIfDirty && !store.isDirty())
		return;
	clearMessage();
	var t0 = new Date();
	var msg = config.messages;
	var originalPath = document.location.toString();
	if(originalPath.substr(0,5) != "file:") {
		alert(msg.notFileUrlError);
		if(store.tiddlerExists(msg.saveInstructions))
			story.displayTiddler(null,msg.saveInstructions);
		return;
	}
	var localPath = getLocalPath(originalPath);
	var original = loadOriginal(localPath);
	if(original == null) {
		alert(msg.cantSaveError);
		if(store.tiddlerExists(msg.saveInstructions))
			story.displayTiddler(null,msg.saveInstructions);
		return;
	}
	var posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(msg.invalidFileError.format([localPath]));
		return;
	}
	saveMain(localPath,original,posDiv);
	if(config.options.chkSaveBackups)
		saveBackup(localPath,original);
	if(config.options.chkSaveEmptyTemplate)
		saveEmpty(localPath,original,posDiv);
	if(config.options.chkGenerateAnRssFeed && saveRss instanceof Function)
		saveRss(localPath);
	if(config.options.chkDisplayInstrumentation)
		displayMessage("saveChanges " + (new Date()-t0) + " ms");
}

function saveMain(localPath,original,posDiv)
{
	var save;
	try {
		var revised = updateOriginal(original,posDiv,localPath);
		save = saveFile(localPath,revised);
	} catch (ex) {
		showException(ex);
	}
	if(save) {
		displayMessage(config.messages.mainSaved,"file://" + localPath);
		store.setDirty(false);
	} else {
		alert(config.messages.mainFailed);
	}
}

function saveBackup(localPath,original)
{
	var backupPath = getBackupPath(localPath);
	var backup = copyFile(backupPath,localPath);
	if(!backup)
		backup = saveFile(backupPath,original);
	if(backup)
		displayMessage(config.messages.backupSaved,"file://" + backupPath);
	else
		alert(config.messages.backupFailed);
}

function saveEmpty(localPath,original,posDiv)
{
	var emptyPath,p;
	if((p = localPath.lastIndexOf("/")) != -1)
		emptyPath = localPath.substr(0,p) + "/";
	else if((p = localPath.lastIndexOf("\\")) != -1)
		emptyPath = localPath.substr(0,p) + "\\";
	else
		emptyPath = localPath + ".";
	emptyPath += "empty.html";
	var empty = original.substr(0,posDiv[0] + startSaveArea.length) + original.substr(posDiv[1]);
	var emptySave = saveFile(emptyPath,empty);
	if(emptySave)
		displayMessage(config.messages.emptySaved,"file://" + emptyPath);
	else
		alert(config.messages.emptyFailed);
}

function getLocalPath(origPath)
{
	var originalPath = convertUriToUTF8(origPath,config.options.txtFileSystemCharSet);
	// Remove any location or query part of the URL
	var argPos = originalPath.indexOf("?");
	if(argPos != -1)
		originalPath = originalPath.substr(0,argPos);
	var hashPos = originalPath.indexOf("#");
	if(hashPos != -1)
		originalPath = originalPath.substr(0,hashPos);
	// Convert file://localhost/ to file:///
	if(originalPath.indexOf("file://localhost/") == 0)
		originalPath = "file://" + originalPath.substr(16);
	// Convert to a native file format
	var localPath;
	if(originalPath.charAt(9) == ":") // pc local file
		localPath = unescape(originalPath.substr(8)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file://///") == 0) // FireFox pc network file
		localPath = "\\\\" + unescape(originalPath.substr(10)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file:///") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(7));
	else if(originalPath.indexOf("file:/") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(5));
	else // pc network file
		localPath = "\\\\" + unescape(originalPath.substr(7)).replace(new RegExp("/","g"),"\\");
	return localPath;
}

function getBackupPath(localPath,title,extension)
{
	var slash = "\\";
	var dirPathPos = localPath.lastIndexOf("\\");
	if(dirPathPos == -1) {
		dirPathPos = localPath.lastIndexOf("/");
		slash = "/";
	}
	var backupFolder = config.options.txtBackupFolder;
	if(!backupFolder || backupFolder == "")
		backupFolder = ".";
	var backupPath = localPath.substr(0,dirPathPos) + slash + backupFolder + localPath.substr(dirPathPos);
	backupPath = backupPath.substr(0,backupPath.lastIndexOf(".")) + ".";
	if(title)
		backupPath += title.replace(/[\\\/\*\?\":<> ]/g,"_") + ".";
	backupPath += (new Date()).convertToYYYYMMDDHHMMSSMMM() + "." + (extension || "html");
	return backupPath;
}

//--
//-- RSS Saving
//--

function saveRss(localPath)
{
	var rssPath = localPath.substr(0,localPath.lastIndexOf(".")) + ".xml";
	if(saveFile(rssPath,convertUnicodeToFileFormat(generateRss())))
		displayMessage(config.messages.rssSaved,"file://" + rssPath);
	else
		alert(config.messages.rssFailed);
}

tiddlerToRssItem = function(tiddler,uri)
{
	var s = "<title" + ">" + tiddler.title.htmlEncode() + "</title" + ">\n";
	s += "<description>" + wikifyStatic(tiddler.text,null,tiddler).htmlEncode() + "</description>\n";
	var i;
	for(i=0; i<tiddler.tags.length; i++)
		s += "<category>" + tiddler.tags[i] + "</category>\n";
	s += "<link>" + uri + "#" + encodeURIComponent(String.encodeTiddlyLink(tiddler.title)) + "</link>\n";
	s +="<pubDate>" + tiddler.modified.toGMTString() + "</pubDate>\n";
	return s;
};

function generateRss()
{
	var s = [];
	var d = new Date();
	var u = store.getTiddlerText("SiteUrl");
	// Assemble the header
	s.push("<" + "?xml version=\"1.0\"?" + ">");
	s.push("<rss version=\"2.0\">");
	s.push("<channel>");
	s.push("<title" + ">" + wikifyPlainText(store.getTiddlerText("SiteTitle",""),null,tiddler).htmlEncode() + "</title" + ">");
	if(u)
		s.push("<link>" + u.htmlEncode() + "</link>");
	s.push("<description>" + wikifyPlainText(store.getTiddlerText("SiteSubtitle",""),null,tiddler).htmlEncode() + "</description>");
	s.push("<language>" + config.locale + "</language>");
	s.push("<copyright>Copyright " + d.getFullYear() + " " + config.options.txtUserName.htmlEncode() + "</copyright>");
	s.push("<pubDate>" + d.toGMTString() + "</pubDate>");
	s.push("<lastBuildDate>" + d.toGMTString() + "</lastBuildDate>");
	s.push("<docs>http://blogs.law.harvard.edu/tech/rss</docs>");
	s.push("<generator>TiddlyWiki " + formatVersion() + "</generator>");
	// The body
	var tiddlers = store.getTiddlers("modified","excludeLists");
	var i,n = config.numRssItems > tiddlers.length ? 0 : tiddlers.length-config.numRssItems;
	for(i=tiddlers.length-1; i>=n; i--) {
		s.push("<item>\n" + tiddlerToRssItem(tiddlers[i],u) + "\n</item>");
	}
	// And footer
	s.push("</channel>");
	s.push("</rss>");
	// Save it all
	return s.join("\n");
}

//--
//-- Filesystem code
//--

function convertUTF8ToUnicode(u)
{
	return config.browser.isOpera || !window.netscape ? manualConvertUTF8ToUnicode(u) : mozConvertUTF8ToUnicode(u);
}

function manualConvertUTF8ToUnicode(utf)
{
	var uni = utf;
	var src = 0;
	var dst = 0;
	var b1, b2, b3;
	var c;
	while(src < utf.length) {
		b1 = utf.charCodeAt(src++);
		if(b1 < 0x80) {
			dst++;
		} else if(b1 < 0xE0) {
			b2 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0x1F) << 6) | (b2 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		} else {
			b2 = utf.charCodeAt(src++);
			b3 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0xF) << 12) | ((b2 & 0x3F) << 6) | (b3 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		}
	}
	return uni;
}

function mozConvertUTF8ToUnicode(u)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUTF8ToUnicode(u);
	} // fallback
	var s = converter.ConvertToUnicode(u);
	var fin = converter.Finish();
	return fin.length > 0 ? s+fin : s;
}

function convertUnicodeToFileFormat(s)
{
	return config.browser.isOpera || !window.netscape ? (config.browser.isIE ? convertUnicodeToHtmlEntities(s) : s) : mozConvertUnicodeToUTF8(s);
}

function convertUnicodeToHtmlEntities(s)
{
	var re = /[^\u0000-\u007F]/g;
	return s.replace(re,function($0) {return "&#" + $0.charCodeAt(0).toString() + ";";});
}

function convertUnicodeToUTF8(s)
{
// return convertUnicodeToFileFormat to allow plugin migration
	return convertUnicodeToFileFormat(s);
}

function manualConvertUnicodeToUTF8(s)
{
	return unescape(encodeURIComponent(s));
}

function mozConvertUnicodeToUTF8(s)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUnicodeToUTF8(s);
	} // fallback
	var u = converter.ConvertFromUnicode(s);
	var fin = converter.Finish();
	return fin.length > 0 ? u + fin : u;
}

function convertUriToUTF8(uri,charSet)
{
	if(window.netscape == undefined || charSet == undefined || charSet == "")
		return uri;
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/utf8converterservice;1"].getService(Components.interfaces.nsIUTF8ConverterService);
	} catch(ex) {
		return uri;
	}
	return converter.convertURISpecToUTF8(uri,charSet);
}

function copyFile(dest,source)
{
	return config.browser.isIE ? ieCopyFile(dest,source) : false;
}

function saveFile(fileUrl,content)
{
	var r = mozillaSaveFile(fileUrl,content);
	if(!r)
		r = ieSaveFile(fileUrl,content);
	if(!r)
		r = javaSaveFile(fileUrl,content);
	return r;
}

function loadFile(fileUrl)
{
	var r = mozillaLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = ieLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = javaLoadFile(fileUrl);
	return r;
}

function ieCreatePath(path)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
	} catch(ex) {
		return null;
	}

	var pos = path.lastIndexOf("\\");
	if(pos==-1)
		pos = path.lastIndexOf("/");
	if(pos!=-1)
		path = path.substring(0,pos+1);

	var scan = [path];
	var parent = fso.GetParentFolderName(path);
	while(parent && !fso.FolderExists(parent)) {
		scan.push(parent);
		parent = fso.GetParentFolderName(parent);
	}

	for(i=scan.length-1;i>=0;i--) {
		if(!fso.FolderExists(scan[i])) {
			fso.CreateFolder(scan[i]);
		}
	}
	return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function ieSaveFile(filePath,content)
{
	ieCreatePath(filePath);
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
	} catch(ex) {
		return null;
	}
	var file = fso.OpenTextFile(filePath,2,-1,0);
	file.Write(content);
	file.Close();
	return true;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function ieLoadFile(filePath)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		var file = fso.OpenTextFile(filePath,1);
		var content = file.ReadAll();
		file.Close();
	} catch(ex) {
		return null;
	}
	return content;
}

function ieCopyFile(dest,source)
{
	ieCreatePath(dest);
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		fso.GetFile(source).Copy(dest);
	} catch(ex) {
		return false;
	}
	return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function mozillaSaveFile(filePath,content)
{
	if(window.Components) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if(!file.exists())
				file.create(0,0x01B4);// 0x01B4 = 0664
			var out = Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
			out.init(file,0x22,0x04,null);
			out.write(content,content.length);
			out.flush();
			out.close();
			return true;
		} catch(ex) {
			return false;
		}
	}
	return null;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function mozillaLoadFile(filePath)
{
	if(window.Components) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if(!file.exists())
				return null;
			var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
			inputStream.init(file,0x01,0x04,null);
			var sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);
			sInputStream.init(inputStream);
			var contents = sInputStream.read(sInputStream.available());
			sInputStream.close();
			inputStream.close();
			return contents;
		} catch(ex) {
			return false;
		}
	}
	return null;
}

function javaUrlToFilename(url)
{
	var f = "//localhost";
	if(url.indexOf(f) == 0)
		return url.substring(f.length);
	var i = url.indexOf(":");
	return i > 0 ? url.substring(i-1) : url;
}

function javaSaveFile(filePath,content)
{
	try {
		if(document.applets["TiddlySaver"])
			return document.applets["TiddlySaver"].saveFile(javaUrlToFilename(filePath),"UTF-8",content);
	} catch(ex) {
	}
	try {
		var s = new java.io.PrintStream(new java.io.FileOutputStream(javaUrlToFilename(filePath)));
		s.print(content);
		s.close();
	} catch(ex2) {
		return null;
	}
	return true;
}

function javaLoadFile(filePath)
{
	try {
		if(document.applets["TiddlySaver"])
			return String(document.applets["TiddlySaver"].loadFile(javaUrlToFilename(filePath),"UTF-8"));
	} catch(ex) {
	}
	var content = [];
	try {
		var r = new java.io.BufferedReader(new java.io.FileReader(javaUrlToFilename(filePath)));
		var line;
		while((line = r.readLine()) != null)
			content.push(String(line));
		r.close();
	} catch(ex2) {
		return null;
	}
	return content.join("\n");
}

//--
//-- Server adaptor base class
//--

function AdaptorBase()
{
	this.host = null;
	this.store = null;
	return this;
}

AdaptorBase.prototype.close = function()
{
	return true;
};

AdaptorBase.prototype.fullHostName = function(host)
{
	if(!host)
		return '';
	host = host.trim();
	if(!host.match(/:\/\//))
		host = 'http://' + host;
	if(host.substr(host.length-1) == '/')
		host = host.substr(0,host.length-1);
	return host;
};

AdaptorBase.minHostName = function(host)
{
	return host;
};

AdaptorBase.prototype.setContext = function(context,userParams,callback)
{
	if(!context) context = {};
	context.userParams = userParams;
	if(callback) context.callback = callback;
	context.adaptor = this;
	if(!context.host)
		context.host = this.host;
	context.host = this.fullHostName(context.host);
	if(!context.workspace)
		context.workspace = this.workspace;
	return context;
};

// Open the specified host
AdaptorBase.prototype.openHost = function(host,context,userParams,callback)
{
	this.host = host;
	context = this.setContext(context,userParams,callback);
	context.status = true;
	if(callback)
		window.setTimeout(function() {context.callback(context,userParams);},10);
	return true;
};

// Open the specified workspace
AdaptorBase.prototype.openWorkspace = function(workspace,context,userParams,callback)
{
	this.workspace = workspace;
	context = this.setContext(context,userParams,callback);
	context.status = true;
	if(callback)
		window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

//--
//-- Server adaptor for talking to static TiddlyWiki files
//--

function FileAdaptor()
{
}

FileAdaptor.prototype = new AdaptorBase();

FileAdaptor.serverType = 'file';
FileAdaptor.serverLabel = 'TiddlyWiki';

FileAdaptor.loadTiddlyWikiSuccess = function(context,jqXHR)
{
	context.status = true;
	context.adaptor.store = new TiddlyWiki();
	if(!context.adaptor.store.importTiddlyWiki(jqXHR.responseText)) {
		context.statusText = config.messages.invalidFileError.format([context.host]);
		context.status = false;
	}
	context.complete(context,context.userParams);
};

FileAdaptor.loadTiddlyWikiError = function(context,jqXHR)
{
	context.status = false;
	context.statusText = jqXHR.message;
	context.complete(context,context.userParams);
};

// Get the list of workspaces on a given server
FileAdaptor.prototype.getWorkspaceList = function(context,userParams,callback)
{
	context = this.setContext(context,userParams,callback);
	context.workspaces = [{title:"(default)"}];
	context.status = true;
	if(callback)
		window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

// Gets the list of tiddlers within a given workspace
FileAdaptor.prototype.getTiddlerList = function(context,userParams,callback,filter)
{
	context = this.setContext(context,userParams,callback);
	if(!context.filter)
		context.filter = filter;
	context.complete = FileAdaptor.getTiddlerListComplete;
	if(this.store) {
		return context.complete(context,context.userParams);
	}
	var options = {
		type:"GET",
		url:context.host,
		processData:false,
		success:function(data,textStatus,jqXHR) {
			FileAdaptor.loadTiddlyWikiSuccess(context,jqXHR);
		},
		error:function(jqXHR,textStatus,errorThrown) {
			FileAdaptor.loadTiddlyWikiError(context,jqXHR);
		}
	};
	return ajaxReq(options);
};

FileAdaptor.getTiddlerListComplete = function(context,userParams)
{
	if(context.status) {
		if(context.filter) {
			context.tiddlers = context.adaptor.store.filterTiddlers(context.filter);
		} else {
			context.tiddlers = [];
			context.adaptor.store.forEachTiddler(function(title,tiddler) {context.tiddlers.push(tiddler);});
		}
		var i;
		for(i=0; i<context.tiddlers.length; i++) {
			context.tiddlers[i].fields['server.type'] = FileAdaptor.serverType;
			context.tiddlers[i].fields['server.host'] = AdaptorBase.minHostName(context.host);
			context.tiddlers[i].fields['server.page.revision'] = context.tiddlers[i].modified.convertToYYYYMMDDHHMM();
		}
		context.status = true;
	}
	if(context.callback) {
		window.setTimeout(function() {context.callback(context,userParams);},10);
	}
	return true;
};

FileAdaptor.prototype.generateTiddlerInfo = function(tiddler)
{
	var info = {};
	info.uri = tiddler.fields['server.host'] + "#" + tiddler.title;
	return info;
};

// Retrieve a tiddler from a given workspace on a given server
FileAdaptor.prototype.getTiddler = function(title,context,userParams,callback)
{
	context = this.setContext(context,userParams,callback);
	context.title = title;
	context.complete = FileAdaptor.getTiddlerComplete;
	if(context.adaptor.store) {
		return context.complete(context,context.userParams);
	}
	var options = {
		type:"GET",
		url:context.host,
		processData:false,
		success:function(data,textStatus,jqXHR) {
			FileAdaptor.loadTiddlyWikiSuccess(context,jqXHR);
		},
		error:function(jqXHR,textStatus,errorThrown) {
			FileAdaptor.loadTiddlyWikiError(context,jqXHR);
		}
	};
	return ajaxReq(options);
};

FileAdaptor.getTiddlerComplete = function(context,userParams)
{
	var t = context.adaptor.store.fetchTiddler(context.title);
	if(t) {
		t.fields['server.type'] = FileAdaptor.serverType;
		t.fields['server.host'] = AdaptorBase.minHostName(context.host);
		t.fields['server.page.revision'] = t.modified.convertToYYYYMMDDHHMM();
		context.tiddler = t;
		context.status = true;
	} else { //# tiddler does not exist in document
		context.status = false;
	}
	if(context.allowSynchronous) {
		context.isSynchronous = true;
		context.callback(context,userParams);
	} else {
		window.setTimeout(function() {context.callback(context,userParams);},10);
	}
	return true;
};

FileAdaptor.prototype.close = function()
{
	this.store = null;
};

config.adaptors[FileAdaptor.serverType] = FileAdaptor;

config.defaultAdaptor = FileAdaptor.serverType;

//--
//-- HTTP request code
//--

function ajaxReq(args)
{
	if(window.Components && window.netscape && window.netscape.security && document.location.protocol.indexOf("http") == -1)
		window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
	return jQuery.ajax(args);
}

function httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache)
{
	var httpSuccess = function(xhr) {
		try {
			// IE error sometimes returns 1223 when it should be 204 so treat it as success, see #1450
			return (!xhr.status && location.protocol === "file:") ||
				(xhr.status >= 200 && xhr.status < 300) ||
				xhr.status === 304 || xhr.status === 1223;
		} catch(e) {}
		return false;
	};

	var options = {
		type:type,
		url:url,
		processData:false,
		data:data,
		cache:!!allowCache,
		beforeSend: function(xhr) {
			var i;
			for(i in headers)
				xhr.setRequestHeader(i,headers[i]);
			xhr.setRequestHeader("X-Requested-With", "TiddlyWiki " + formatVersion());
		}
	};

	if(callback) {
		options.complete = function(xhr,textStatus) {
			if(httpSuccess(xhr))
				callback(true,params,xhr.responseText,url,xhr);
			else
				callback(false,params,null,url,xhr);
		};
	}
	if(contentType)
		options.contentType = contentType;
	if(username)
		options.username = username;
	if(password)
		options.password = password;
	if(window.Components && window.netscape && window.netscape.security && document.location.protocol.indexOf("http") == -1)
		window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
	return jQuery.ajax(options);
}
//--
//-- TiddlyWiki-specific utility functions
//--

// Returns TiddlyWiki version string
function formatVersion(v)
{
	v = v || version;
	return v.major + "." + v.minor + "." + v.revision +
		(v.alpha ? " (alpha " + v.alpha + ")" : "") +
		(v.beta ? " (beta " + v.beta + ")" : "");
}

function compareVersions(v1,v2)
{
	var x1,x2,i,a = ["major","minor","revision"];
	for(i = 0; i<a.length; i++) {
		x1 = v1[a[i]] || 0;
		x2 = v2[a[i]] || 0;
		if(x1<x2)
			return 1;
		if(x1>x2)
			return -1;
	}
	x1 = v1.beta || 9999;
	x2 = v2.beta || 9999;
	if(x1<x2)
		return 1;
	return x1 > x2 ? -1 : 0;
}

function merge(dst,src,preserveExisting)
{
	var i;
	for(i in src) {
		if(!preserveExisting || dst[i] === undefined)
			dst[i] = src[i];
	}
	return dst;
}

// Resolve the target object of an event
function resolveTarget(e)
{
	var obj;
	if(e.target)
		obj = e.target;
	else if(e.srcElement)
		obj = e.srcElement;
	if(obj.nodeType == 3) // defeat Safari bug
		obj = obj.parentNode;
	return obj;
}

// Returns a string containing the description of an exception, optionally prepended by a message
function exceptionText(e,message)
{
	var s = e.description || e.toString();
	return message ? "%0:\n%1".format([message,s]) : s;
}

// Displays an alert of an exception description with optional message
function showException(e,message)
{
	alert(exceptionText(e,message));
}

function alertAndThrow(m)
{
	alert(m);
	throw(m);
}

function glyph(name)
{
	var g = config.glyphs;
	var b = g.currBrowser;
	if(b == null) {
		b = 0;
		while(b < g.browsers.length-1 && !g.browsers[b]())
			b++;
		g.currBrowser = b;
	}
	if(!g.codes[name])
		return "";
	return g.codes[name][b];
}

function createTiddlyText(parent,text)
{
	return parent.appendChild(document.createTextNode(text));
}

function createTiddlyCheckbox(parent,caption,checked,onChange)
{
	var cb = document.createElement("input");
	cb.setAttribute("type","checkbox");
	cb.onclick = onChange;
	parent.appendChild(cb);
	cb.checked = checked;
	cb.className = "chkOptionInput";
	if(caption)
		wikify(caption,parent);
	return cb;
}

function createTiddlyElement(parent,element,id,className,text,attribs)
{
	var n,e = document.createElement(element);
	if(className != null)
		e.className = className;
	if(id != null)
		e.setAttribute("id",id);
	if(text != null)
		e.appendChild(document.createTextNode(text));
	if(attribs) {
		for(n in attribs) {
			e.setAttribute(n,attribs[n]);
		}
	}
	if(parent != null)
		parent.appendChild(e);
	return e;
}

function createTiddlyButton(parent,text,tooltip,action,className,id,accessKey,attribs)
{
	var i,btn = document.createElement("a");
	btn.setAttribute("href","javascript:;");
	if(action) {
		btn.onclick = action;
	}
	if(tooltip)
		btn.setAttribute("title",tooltip);
	if(text)
		btn.appendChild(document.createTextNode(text));
	btn.className = className || "button";
	if(id)
		btn.id = id;
	if(attribs) {
		for(i in attribs) {
			btn.setAttribute(i,attribs[i]);
		}
	}
	if(parent)
		parent.appendChild(btn);
	if(accessKey)
		btn.setAttribute("accessKey",accessKey);
	return btn;
}

function createExternalLink(place,url,label)
{
	var link = document.createElement("a");
	link.className = "externalLink";
	link.href = url;
	var f = config.messages.externalLinkTooltip;
	link.title = f ? f.format([url]) : url;
	if(config.options.chkOpenInNewWindow)
		link.target = "_blank";
	place.appendChild(link);
	if(label)
		createTiddlyText(link, label);
	return link;
}

function getTiddlyLinkInfo(title,currClasses)
{
	var classes = currClasses ? currClasses.split(" ") : [];
	classes.pushUnique("tiddlyLink");
	var tiddler = store.fetchTiddler(title);
	var subTitle;
	if(tiddler) {
		subTitle = tiddler.getSubtitle();
		classes.pushUnique("tiddlyLinkExisting");
		classes.remove("tiddlyLinkNonExisting");
		classes.remove("shadow");
	} else {
	    var f;
		classes.remove("tiddlyLinkExisting");
		classes.pushUnique("tiddlyLinkNonExisting");
		if(store.isShadowTiddler(title)) {
			f = config.messages.shadowedTiddlerToolTip;
			classes.pushUnique("shadow");
		} else {
			f = config.messages.undefinedTiddlerToolTip;
			classes.remove("shadow");
		}
		subTitle = f ? f.format([title]) : "";
	}
	if(typeof config.annotations[title]=="string")
		subTitle = config.annotations[title];
	return {classes: classes.join(" "),subTitle: subTitle};
}

// Event handler for clicking on a tiddly link
function onClickTiddlerLink(ev)
{
	var e = ev || window.event;
	var target = resolveTarget(e);
	var link = target;
	var title = null;
	var fields = null;
	var noToggle = null;
	do {
		title = link.getAttribute("tiddlyLink");
		fields = link.getAttribute("tiddlyFields");
		noToggle = link.getAttribute("noToggle");
		link = link.parentNode;
	} while(title == null && link != null);
	if(!store.isShadowTiddler(title)) {
		var f = fields ? fields.decodeHashMap() : {};
		fields = String.encodeHashMap(merge(f,config.defaultCustomFields,true));
	}
	if(title) {
		var toggling = e.metaKey || e.ctrlKey;
		if(config.options.chkToggleLinks)
			toggling = !toggling;
		if(noToggle)
			toggling = false;
		if(store.getTiddler(title))
			fields = null;
		story.displayTiddler(target,title,null,true,null,fields,toggling);
	}
	clearMessage();
	return false;
}

function createTiddlyLink(place,title,includeText,className,isStatic,linkedFromTiddler,noToggle)
{
	var text = includeText ? title : null;
	var i = getTiddlyLinkInfo(title,className);
	var btn = isStatic ? createExternalLink(place,store.getTiddlerText("SiteUrl",null) + "#" + title) : createTiddlyButton(place,text,i.subTitle,onClickTiddlerLink,i.classes);
	if(isStatic)
		btn.className += ' ' + className;
	btn.setAttribute("refresh","link");
	btn.setAttribute("tiddlyLink",title);
	if(noToggle)
		btn.setAttribute("noToggle","true");
	if(linkedFromTiddler) {
		var fields = linkedFromTiddler.getInheritedFields();
		if(fields)
			btn.setAttribute("tiddlyFields",fields);
	}
	return btn;
}

function refreshTiddlyLink(e,title)
{
	var i = getTiddlyLinkInfo(title,e.className);
	e.className = i.classes;
	e.title = i.subTitle;
}

function createTiddlyDropDown(place,onchange,options,defaultValue)
{
	var sel = createTiddlyElement(place,"select");
	sel.onchange = onchange;
	var t;
	for(t=0; t<options.length; t++) {
		var e = createTiddlyElement(sel,"option",null,null,options[t].caption);
		e.value = options[t].name;
		if(options[t].name == defaultValue)
			e.selected = true;
	}
	return sel;
}

//--
//-- TiddlyWiki-specific popup utility functions
//--

// Event handler for 'open all' on a tiddler popup
function onClickTagOpenAll(ev)
{
	var tiddlers = store.getTaggedTiddlers(this.getAttribute("tag"));
	var sortby = this.getAttribute("sortby");
	if(sortby&&sortby.length) {
		store.sortTiddlers(tiddlers,sortby);
	}
	story.displayTiddlers(this,tiddlers);
	return false;
}

// Event handler for clicking on a tiddler tag
function onClickTag(ev)
{
	var e = ev || window.event;
	var popup = Popup.create(this);
	jQuery(popup).addClass("taggedTiddlerList");
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(popup && tag) {
		var tagged = tag.indexOf("[")==-1 ? store.getTaggedTiddlers(tag) : store.filterTiddlers(tag);
		var sortby = this.getAttribute("sortby");
		if(sortby&&sortby.length) {
			store.sortTiddlers(tagged,sortby);
		}
		var titles = [];
		var r;
		for(r=0;r<tagged.length;r++) {
			if(tagged[r].title != title)
				titles.push(tagged[r].title);
		}
		var lingo = config.views.wikified.tag;
		if(titles.length > 0) {
			var openAll = createTiddlyButton(createTiddlyElement(popup,"li"),lingo.openAllText.format([tag]),lingo.openAllTooltip,onClickTagOpenAll);
			openAll.setAttribute("tag",tag);
			openAll.setAttribute("sortby",sortby);
			createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
			for(r=0; r<titles.length; r++) {
				createTiddlyLink(createTiddlyElement(popup,"li"),titles[r],true);
			}
		} else {
			createTiddlyElement(popup,"li",null,"disabled",lingo.popupNone.format([tag]));
		}
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var h = createTiddlyLink(createTiddlyElement(popup,"li"),tag,false);
		createTiddlyText(h,lingo.openTag.format([tag]));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

// Create a button for a tag with a popup listing all the tiddlers that it tags
function createTagButton(place,tag,excludeTiddler,title,tooltip)
{
	var btn = createTiddlyButton(place,title||tag,(tooltip||config.views.wikified.tag.tooltip).format([tag]),onClickTag);
	btn.setAttribute("tag",tag);
	if(excludeTiddler)
		btn.setAttribute("tiddler",excludeTiddler);
	return btn;
}

function onClickTiddlyPopup(ev)
{
	var e = ev || window.event;
	var tiddler = this.tiddler;
	if(tiddler.text) {
		var popup = Popup.create(this,"div","popupTiddler");
		wikify(tiddler.text,popup,null,tiddler);
		Popup.show();
	}
	if(e) e.cancelBubble = true;
	if(e && e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyPopup(place,caption,tooltip,tiddler)
{
	if(tiddler.text) {
		createTiddlyLink(place,caption,true);
		var btn = createTiddlyButton(place,glyph("downArrow"),tooltip,onClickTiddlyPopup,"tiddlerPopupButton");
		btn.tiddler = tiddler;
	} else {
		createTiddlyText(place,caption);
	}
}

function onClickError(ev)
{
	var e = ev || window.event;
	var popup = Popup.create(this);
	var lines = this.getAttribute("errorText").split("\n");
	var t;
	for(t=0; t<lines.length; t++)
		createTiddlyElement(popup,"li",null,null,lines[t]);
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyError(place,title,text)
{
	var btn = createTiddlyButton(place,title,null,onClickError,"errorButton");
	if(text) btn.setAttribute("errorText",text);
}
//-
//- Animation engine
//-

function Animator()
{
	this.running = 0; // Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled
	this.timerID = 0; // ID of the timer used for animating
	this.animations = []; // List of animations in progress
	return this;
}

// Start animation engine
Animator.prototype.startAnimating = function() //# Variable number of arguments
{
	var t;
	for(t=0; t<arguments.length; t++)
		this.animations.push(arguments[t]);
	if(this.running == 0) {
		var me = this;
		this.timerID = window.setInterval(function() {me.doAnimate(me);},10);
	}
	this.running += arguments.length;
};

// Perform an animation engine tick, calling each of the known animation modules
Animator.prototype.doAnimate = function(me)
{
	var a = 0;
	while(a < me.animations.length) {
		var animation = me.animations[a];
		if(animation.tick()) {
			a++;
		} else {
			me.animations.splice(a,1);
			if(--me.running == 0)
				window.clearInterval(me.timerID);
		}
	}
};

Animator.slowInSlowOut = function(progress)
{
	return(1-((Math.cos(progress * Math.PI)+1)/2));
};

//--
//-- Morpher animation
//--

// Animate a set of properties of an element
function Morpher(element,duration,properties,callback)
{
	this.element = element;
	this.duration = duration;
	this.properties = properties;
	this.startTime = new Date();
	this.endTime = Number(this.startTime) + duration;
	this.callback = callback;
	this.tick();
	return this;
}

Morpher.prototype.assignStyle = function(element,style,value)
{
	switch(style) {
	case "-tw-vertScroll":
		window.scrollTo(findScrollX(),value);
		break;
	case "-tw-horizScroll":
		window.scrollTo(value,findScrollY());
		break;
	default:
		element.style[style] = value;
		break;
	}
};

Morpher.prototype.stop = function()
{
	var t;
	for(t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.atEnd !== undefined) {
			this.assignStyle(this.element,p.style,p.atEnd);
		}
	}
	if(this.callback)
		this.callback(this.element,this.properties);
};

Morpher.prototype.tick = function()
{
	var currTime = Number(new Date());
	var t,progress = Animator.slowInSlowOut(Math.min(1,(currTime-this.startTime)/this.duration));
	for(t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.start !== undefined && p.end !== undefined) {
			var template = p.template || "%0";
			switch(p.format) {
			case undefined:
			case "style":
				var v = p.start + (p.end-p.start) * progress;
				this.assignStyle(this.element,p.style,template.format([v]));
				break;
			case "color":
				break;
			}
		}
	}
	if(currTime >= this.endTime) {
		this.stop();
		return false;
	}
	return true;
};

//--
//-- Zoomer animation
//--

function Zoomer(text,startElement,targetElement,unused)
{
	var e = createTiddlyElement(document.body,"div",null,"zoomer");
	createTiddlyElement(e,"div",null,null,text);
	var winWidth = findWindowWidth();
	var winHeight = findWindowHeight();
	var p = [
		{style: 'left', start: findPosX(startElement), end: findPosX(targetElement), template: '%0px'},
		{style: 'top', start: findPosY(startElement), end: findPosY(targetElement), template: '%0px'},
		{style: 'width', start: Math.min(startElement.scrollWidth,winWidth), end: Math.min(targetElement.scrollWidth,winWidth), template: '%0px', atEnd: 'auto'},
		{style: 'height', start: Math.min(startElement.scrollHeight,winHeight), end: Math.min(targetElement.scrollHeight,winHeight), template: '%0px', atEnd: 'auto'},
		{style: 'fontSize', start: 8, end: 24, template: '%0pt'}
	];
	var c = function(element,properties) {jQuery(element).remove();};
	return new Morpher(e,config.animDuration,p,c);
}

//--
//-- Scroller animation
//--

function Scroller(targetElement)
{
	var p = [{style: '-tw-vertScroll', start: findScrollY(), end: ensureVisible(targetElement)}];
	return new Morpher(targetElement,config.animDuration,p);
}

//--
//-- Slider animation
//--

// deleteMode - "none", "all" [delete target element and it's children], [only] "children" [but not the target element]
function Slider(element,opening,unused,deleteMode)
{
	element.style.overflow = 'hidden';
	if(opening)
		element.style.height = '0px'; // Resolves a Firefox flashing bug
	element.style.display = 'block';
	var height = element.scrollHeight;
	var p = [];
	var c = null;
	if(opening) {
		p.push({style: 'height', start: 0, end: height, template: '%0px', atEnd: 'auto'});
		p.push({style: 'opacity', start: 0, end: 1, template: '%0'});
		p.push({style: 'filter', start: 0, end: 100, template: 'alpha(opacity:%0)'});
	} else {
		p.push({style: 'height', start: height, end: 0, template: '%0px'});
		p.push({style: 'display', atEnd: 'none'});
		p.push({style: 'opacity', start: 1, end: 0, template: '%0'});
		p.push({style: 'filter', start: 100, end: 0, template: 'alpha(opacity:%0)'});
		switch(deleteMode) {
		case "all":
			c = function(element,properties) {jQuery(element).remove();};
			break;
		case "children":
			c = function(element,properties) {jQuery(element).empty();};
			break;
		}
	}
	return new Morpher(element,config.animDuration,p,c);
}

//--
//-- Popup menu
//--

var Popup = {
	stack: [] // Array of objects with members root: and popup:
	};

Popup.create = function(root,elem,className)
{
	var stackPosition = this.find(root,"popup");
	Popup.remove(stackPosition+1);
	var popup = createTiddlyElement(document.body,elem || "ol","popup",className || "popup");
	popup.stackPosition = stackPosition;
	Popup.stack.push({root: root, popup: popup});
	return popup;
};

Popup.onDocumentClick = function(ev)
{
	var e = ev || window.event;
	if(e.eventPhase == undefined)
		Popup.remove();
	else if(e.eventPhase == Event.BUBBLING_PHASE || e.eventPhase == Event.AT_TARGET)
		Popup.remove();
	return true;
};

Popup.show = function(valign,halign,offset)
{
	var curr = Popup.stack[Popup.stack.length-1];
	this.place(curr.root,curr.popup,valign,halign,offset);
	jQuery(curr.root).addClass("highlight");
	if(config.options.chkAnimate && anim && typeof Scroller == "function")
		anim.startAnimating(new Scroller(curr.popup));
	else
		window.scrollTo(0,ensureVisible(curr.popup));
};

Popup.place = function(root,popup,valign,halign,offset)
{
	if(!offset)
		offset = {x:0,y:0};
	if(popup.stackPosition >= 0 && !valign && !halign) {
		offset.x = offset.x + root.offsetWidth;
	} else {
		offset.x = (halign == "right") ? offset.x + root.offsetWidth : offset.x;
		offset.y = (valign == "top") ? offset.y : offset.y + root.offsetHeight;
	}
	var rootLeft = findPosX(root);
	var rootTop = findPosY(root);
	var popupLeft = rootLeft + offset.x;
	var popupTop = rootTop + offset.y;
	var winWidth = findWindowWidth();
	if(popup.offsetWidth > winWidth*0.75)
		popup.style.width = winWidth*0.75 + "px";
	var popupWidth = popup.offsetWidth;
	var scrollWidth = winWidth - document.body.offsetWidth;
	if(popupLeft + popupWidth > winWidth - scrollWidth - 1) {
		if(halign == "right")
			popupLeft = popupLeft - root.offsetWidth - popupWidth;
		else
			popupLeft = winWidth - popupWidth - scrollWidth - 1;
	}
	popup.style.left = popupLeft + "px";
	popup.style.top = popupTop + "px";
	popup.style.display = "block";
};

Popup.find = function(e)
{
	var t,pos = -1;
	for(t=this.stack.length-1; t>=0; t--) {
		if(isDescendant(e,this.stack[t].popup))
			pos = t;
	}
	return pos;
};

Popup.remove = function(pos)
{
	if(!pos) pos = 0;
	if(Popup.stack.length > pos) {
		Popup.removeFrom(pos);
	}
};

Popup.removeFrom = function(from)
{
	var t;
	for(t=Popup.stack.length-1; t>=from; t--) {
		var p = Popup.stack[t];
		jQuery(p.root).removeClass("highlight");
		jQuery(p.popup).remove();
	}
	Popup.stack = Popup.stack.slice(0,from);
};

//--
//-- Wizard support
//--

function Wizard(elem)
{
	if(elem) {
		this.formElem = findRelated(elem,"wizard","className");
		this.bodyElem = findRelated(this.formElem.firstChild,"wizardBody","className","nextSibling");
		this.footElem = findRelated(this.formElem.firstChild,"wizardFooter","className","nextSibling");
	} else {
		this.formElem = null;
		this.bodyElem = null;
		this.footElem = null;
	}
}

Wizard.prototype.setValue = function(name,value)
{
	jQuery(this.formElem).data(name, value);
};

Wizard.prototype.getValue = function(name)
{
	return this.formElem ? jQuery(this.formElem).data(name) : null;
};

Wizard.prototype.createWizard = function(place,title)
{
	this.formElem = createTiddlyElement(place,"form",null,"wizard");
	createTiddlyElement(this.formElem,"h1",null,null,title);
	this.bodyElem = createTiddlyElement(this.formElem,"div",null,"wizardBody");
	this.footElem = createTiddlyElement(this.formElem,"div",null,"wizardFooter");
	return this.formElem;
};

Wizard.prototype.clear = function()
{
	jQuery(this.bodyElem).empty();
};

Wizard.prototype.setButtons = function(buttonInfo,status)
{
	jQuery(this.footElem).empty();
	var t;
	for(t=0; t<buttonInfo.length; t++) {
		createTiddlyButton(this.footElem,buttonInfo[t].caption,buttonInfo[t].tooltip,buttonInfo[t].onClick);
		insertSpacer(this.footElem);
		}
	if(typeof status == "string") {
		createTiddlyElement(this.footElem,"span",null,"status",status);
	}
};

Wizard.prototype.addStep = function(stepTitle,html)
{
	jQuery(this.bodyElem).empty();
	var w = createTiddlyElement(this.bodyElem,"div");
	createTiddlyElement(w,"h2",null,null,stepTitle);
	var step = createTiddlyElement(w,"div",null,"wizardStep");
	step.innerHTML = html;
	applyHtmlMacros(step,tiddler);
};

Wizard.prototype.getElement = function(name)
{
	return this.formElem.elements[name];
};

//--
//-- ListView gadget
//--

var ListView = {};

// Create a listview
ListView.create = function(place,listObject,listTemplate,callback,className)
{
	var table = createTiddlyElement(place,"table",null,className || "listView twtable");
	var thead = createTiddlyElement(table,"thead");
	var t,r = createTiddlyElement(thead,"tr");
	for(t=0; t<listTemplate.columns.length; t++) {
		var columnTemplate = listTemplate.columns[t];
		var c = createTiddlyElement(r,"th");
		var colType = ListView.columnTypes[columnTemplate.type];
		if(colType && colType.createHeader) {
			colType.createHeader(c,columnTemplate,t);
			if(columnTemplate.className)
				jQuery(c).addClass(columnTemplate.className);
		}
	}
	var rc,tbody = createTiddlyElement(table,"tbody");
	for(rc=0; rc<listObject.length; rc++) {
		var rowObject = listObject[rc];
		r = createTiddlyElement(tbody,"tr");
		for(c=0; c<listTemplate.rowClasses.length; c++) {
			if(rowObject[listTemplate.rowClasses[c].field])
				jQuery(r).addClass(listTemplate.rowClasses[c].className);
		}
		rowObject.rowElement = r;
		rowObject.colElements = {};
		var cc;
		for(cc=0; cc<listTemplate.columns.length; cc++) {
			c = createTiddlyElement(r,"td");
			columnTemplate = listTemplate.columns[cc];
			var field = columnTemplate.field;
			colType = ListView.columnTypes[columnTemplate.type];
			if(colType && colType.createItem) {
				colType.createItem(c,rowObject,field,columnTemplate,cc,rc);
				if(columnTemplate.className)
					jQuery(c).addClass(columnTemplate.className);
			}
			rowObject.colElements[field] = c;
		}
	}
	if(callback && listTemplate.actions)
		createTiddlyDropDown(place,ListView.getCommandHandler(callback),listTemplate.actions);
	if(callback && listTemplate.buttons) {
		for(t=0; t<listTemplate.buttons.length; t++) {
			var a = listTemplate.buttons[t];
			if(a && a.name != "")
				createTiddlyButton(place,a.caption,null,ListView.getCommandHandler(callback,a.name,a.allowEmptySelection));
		}
	}
	return table;
};

ListView.getCommandHandler = function(callback,name,allowEmptySelection)
{
	return function(e) {
		var view = findRelated(this,"TABLE",null,"previousSibling");
		var tiddlers = [];
		ListView.forEachSelector(view,function(e,rowName) {
					if(e.checked)
						tiddlers.push(rowName);
					});
		if(tiddlers.length == 0 && !allowEmptySelection) {
			alert(config.messages.nothingSelected);
		} else {
			if(this.nodeName.toLowerCase() == "select") {
				callback(view,this.value,tiddlers);
				this.selectedIndex = 0;
			} else {
				callback(view,name,tiddlers);
			}
		}
	};
};

// Invoke a callback for each selector checkbox in the listview
ListView.forEachSelector = function(view,callback)
{
	var checkboxes = view.getElementsByTagName("input");
	var t,hadOne = false;
	for(t=0; t<checkboxes.length; t++) {
		var cb = checkboxes[t];
		if(cb.getAttribute("type") == "checkbox") {
			var rn = cb.getAttribute("rowName");
			if(rn) {
				callback(cb,rn);
				hadOne = true;
			}
		}
	}
	return hadOne;
};

ListView.getSelectedRows = function(view)
{
	var rowNames = [];
	ListView.forEachSelector(view,function(e,rowName) {
				if(e.checked)
					rowNames.push(rowName);
				});
	return rowNames;
};

ListView.columnTypes = {};

ListView.columnTypes.String = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyText(place,columnTemplate.title);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v);
		}
};

ListView.columnTypes.WikiText = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				wikify(v,place,null,null);
		}
};

ListView.columnTypes.Tiddler = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined && v.title)
				createTiddlyPopup(place,v.title,config.messages.listView.tiddlerTooltip,v);
		}
};

ListView.columnTypes.Size = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var msg = config.messages.sizeTemplates;
			var v = listObject[field];
			if(v != undefined) {
				var t = 0;
				while(t<msg.length-1 && v<msg[t].unit)
					t++;
				createTiddlyText(place,msg[t].template.format([Math.round(v/msg[t].unit)]));
			}
		}
};

ListView.columnTypes.Link = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			var c = columnTemplate.text;
			if(v != undefined)
				createExternalLink(place,v,c || v);
		}
};

ListView.columnTypes.Date = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v.formatString(columnTemplate.dateFormat));
		}
};

ListView.columnTypes.StringList = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				var t;
				for(t=0; t<v.length; t++) {
					createTiddlyText(place,v[t]);
					createTiddlyElement(place,"br");
				}
			}
		}
};

ListView.columnTypes.Selector = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyCheckbox(place,null,false,this.onHeaderChange);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],null);
			e.setAttribute("rowName",listObject[columnTemplate.rowName]);
		},
	onHeaderChange: function(e)
		{
			var state = this.checked;
			var view = findRelated(this,"TABLE");
			if(!view)
				return;
			ListView.forEachSelector(view,function(e,rowName) {
								e.checked = state;
							});
		}
};

ListView.columnTypes.Tags = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var tags = listObject[field];
			createTiddlyText(place,String.encodeTiddlyLinkList(tags));
		}
};

ListView.columnTypes.Boolean = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			if(listObject[field] == true)
				createTiddlyText(place,columnTemplate.trueText);
			if(listObject[field] == false)
				createTiddlyText(place,columnTemplate.falseText);
		}
};

ListView.columnTypes.TagCheckbox = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],this.onChange);
			e.setAttribute("tiddler",listObject.title);
			e.setAttribute("tag",columnTemplate.tag);
		},
	onChange : function(e)
		{
			var tag = this.getAttribute("tag");
			var tiddler = this.getAttribute("tiddler");
			store.setTiddlerTag(tiddler,this.checked,tag);
		}
};

ListView.columnTypes.TiddlerLink = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				var link = createTiddlyLink(place,listObject[columnTemplate.tiddlerLink],false,null);
				createTiddlyText(link,listObject[field]);
			}
		}
};

//--
//-- Augmented methods for the JavaScript Array() object
//--

// Add indexOf function if browser does not support it
if(!Array.indexOf) {
Array.prototype.indexOf = function(item,from)
{
	if(!from)
		from = 0;
	var i;
	for(i=from; i<this.length; i++) {
		if(this[i] === item)
			return i;
	}
	return -1;
};}

// Find an entry in a given field of the members of an array
Array.prototype.findByField = function(field,value)
{
	var t;
	for(t=0; t<this.length; t++) {
		if(this[t][field] === value)
			return t;
	}
	return null;
};

// Return whether an entry exists in an array
Array.prototype.contains = function(item)
{
	return this.indexOf(item) != -1;
};

// Adds, removes or toggles a particular value within an array
//  value - value to add
//  mode - +1 to add value, -1 to remove value, 0 to toggle it
Array.prototype.setItem = function(value,mode)
{
	var p = this.indexOf(value);
	if(mode == 0)
		mode = (p == -1) ? +1 : -1;
	if(mode == +1) {
		if(p == -1)
			this.push(value);
	} else if(mode == -1) {
		if(p != -1)
			this.splice(p,1);
	}
};

// Return whether one of a list of values exists in an array
Array.prototype.containsAny = function(items)
{
	var i;
	for(i=0; i<items.length; i++) {
		if(this.indexOf(items[i]) != -1)
			return true;
	}
	return false;
};

// Return whether all of a list of values exists in an array
Array.prototype.containsAll = function(items)
{
	var i;
	for(i = 0; i<items.length; i++) {
		if(this.indexOf(items[i]) == -1)
			return false;
	}
	return true;
};

// Push a new value into an array only if it is not already present in the array. If the optional unique parameter is false, it reverts to a normal push
Array.prototype.pushUnique = function(item,unique)
{
	if(unique === false) {
		this.push(item);
	} else {
		if(this.indexOf(item) == -1)
			this.push(item);
	}
};

Array.prototype.remove = function(item)
{
	var p = this.indexOf(item);
	if(p != -1)
		this.splice(p,1);
};

if(!Array.prototype.map) {
Array.prototype.map = function(fn,thisObj)
{
	var scope = thisObj || window;
	var i,j,a = [];
	for(i=0, j=this.length; i < j; ++i) {
		a.push(fn.call(scope,this[i],i,this));
	}
	return a;
};}

//--
//-- Augmented methods for the JavaScript String() object
//--

// Get characters from the right end of a string
String.prototype.right = function(n)
{
	return n < this.length ? this.slice(this.length-n) : this;
};

// Trim whitespace from both ends of a string
String.prototype.trim = function()
{
	return this.replace(/^\s*|\s*$/g,"");
};

// Convert a string from a CSS style property name to a JavaScript style name ("background-color" -> "backgroundColor")
String.prototype.unDash = function()
{
	var t,s = this.split("-");
	if(s.length > 1) {
		for(t=1; t<s.length; t++)
			s[t] = s[t].substr(0,1).toUpperCase() + s[t].substr(1);
	}
	return s.join("");
};

// Substitute substrings from an array into a format string that includes '%1'-type specifiers
String.prototype.format = function(s)
{
	var substrings = s && s.constructor == Array ? s : arguments;
	var subRegExp = /(?:%(\d+))/mg;
	var currPos = 0;
	var match,r = [];
	do {
		match = subRegExp.exec(this);
		if(match && match[1]) {
			if(match.index > currPos)
				r.push(this.substring(currPos,match.index));
			r.push(substrings[parseInt(match[1],10)]);
			currPos = subRegExp.lastIndex;
		}
	} while(match);
	if(currPos < this.length)
		r.push(this.substring(currPos,this.length));
	return r.join("");
};

// Escape any special RegExp characters with that character preceded by a backslash
String.prototype.escapeRegExp = function()
{
	var s = "\\^$*+?()=!|,{}[].";
	var t,c = this;
	for(t=0; t<s.length; t++)
		c = c.replace(new RegExp("\\" + s.substr(t,1),"g"),"\\" + s.substr(t,1));
	return c;
};

// Convert "\" to "\s", newlines to "\n" (and remove carriage returns)
String.prototype.escapeLineBreaks = function()
{
	return this.replace(/\\/mg,"\\s").replace(/\n/mg,"\\n").replace(/\r/mg,"");
};

// Convert "\n" to newlines, "\b" to " ", "\s" to "\" (and remove carriage returns)
String.prototype.unescapeLineBreaks = function()
{
	return this.replace(/\\n/mg,"\n").replace(/\\b/mg," ").replace(/\\s/mg,"\\").replace(/\r/mg,"");
};

// Convert & to "&amp;", < to "&lt;", > to "&gt;" and " to "&quot;"
String.prototype.htmlEncode = function()
{
	return this.replace(/&/mg,"&amp;").replace(/</mg,"&lt;").replace(/>/mg,"&gt;").replace(/\"/mg,"&quot;");
};

// Convert "&amp;" to &, "&lt;" to <, "&gt;" to > and "&quot;" to "
String.prototype.htmlDecode = function()
{
	return this.replace(/&lt;/mg,"<").replace(/&gt;/mg,">").replace(/&quot;/mg,"\"").replace(/&amp;/mg,"&");
};

// Parse a space-separated string of name:value parameters
// The result is an array of objects:
//   result[0] = object with a member for each parameter name, value of that member being an array of values
//   result[1..n] = one object for each parameter, with 'name' and 'value' members
String.prototype.parseParams = function(defaultName,defaultValue,allowEval,noNames,cascadeDefaults)
{
	var parseToken = function(match,p) {
		var n;
		if(match[p]) // Double quoted
			n = match[p];
		else if(match[p+1]) // Single quoted
			n = match[p+1];
		else if(match[p+2]) // Double-square-bracket quoted
			n = match[p+2];
		else if(match[p+3]) // Double-brace quoted
			try {
				n = match[p+3];
				if(allowEval && config.evaluateMacroParameters != "none") {
					if(config.evaluateMacroParameters == "restricted") {
						if(window.restrictedEval) {
							n = window.restrictedEval(n);
						}
					} else {
						n = window.eval(n);
					}
				}
			} catch(ex) {
				throw "Unable to evaluate {{" + match[p+3] + "}}: " + exceptionText(ex);
			}
		else if(match[p+4]) // Unquoted
			n = match[p+4];
		else if(match[p+5]) // empty quote
			n = "";
		return n;
	};
	var r = [{}];
	var dblQuote = "(?:\"((?:(?:\\\\\")|[^\"])+)\")";
	var sngQuote = "(?:'((?:(?:\\\\\')|[^'])+)')";
	var dblSquare = "(?:\\[\\[((?:\\s|\\S)*?)\\]\\])";
	var dblBrace = "(?:\\{\\{((?:\\s|\\S)*?)\\}\\})";
	var unQuoted = noNames ? "([^\"'\\s]\\S*)" : "([^\"':\\s][^\\s:]*)";
	var emptyQuote = "((?:\"\")|(?:''))";
	var skipSpace = "(?:\\s*)";
	var token = "(?:" + dblQuote + "|" + sngQuote + "|" + dblSquare + "|" + dblBrace + "|" + unQuoted + "|" + emptyQuote + ")";
	var re = noNames ? new RegExp(token,"mg") : new RegExp(skipSpace + token + skipSpace + "(?:(\\:)" + skipSpace + token + ")?","mg");
	var match;
	do {
		match = re.exec(this);
		if(match) {
			var n = parseToken(match,1);
			if(noNames) {
				r.push({name:"",value:n});
			} else {
				var v = parseToken(match,8);
				if(v == null && defaultName) {
					v = n;
					n = defaultName;
				} else if(v == null && defaultValue) {
					v = defaultValue;
				}
				r.push({name:n,value:v});
				if(cascadeDefaults) {
					defaultName = n;
					defaultValue = v;
				}
			}
		}
	} while(match);
	// Summarise parameters into first element
	var t;
	for(t=1; t<r.length; t++) {
		if(r[0][r[t].name])
			r[0][r[t].name].push(r[t].value);
		else
			r[0][r[t].name] = [r[t].value];
	}
	return r;
};

// Process a string list of macro parameters into an array. Parameters can be quoted with "", '',
// [[]], {{ }} or left unquoted (and therefore space-separated). Double-braces {{}} results in
// an *evaluated* parameter: e.g. {{config.options.txtUserName}} results in the current user's name.
String.prototype.readMacroParams = function(notAllowEval)
{
	var p = this.parseParams("list",null,!notAllowEval,true);
	var t,n = [];
	for(t=1; t<p.length; t++)
		n.push(p[t].value);
	return n;
};

// Process a string list of unique tiddler names into an array. Tiddler names that have spaces in them must be [[bracketed]]
String.prototype.readBracketedList = function(unique)
{
	var p = this.parseParams("list",null,false,true);
	var t,n = [];
	for(t=1; t<p.length; t++) {
		if(p[t].value)
			n.pushUnique(p[t].value,unique);
	}
	return n;
};

// Returns array with start and end index of chunk between given start and end marker, or undefined.
String.prototype.getChunkRange = function(start,end)
{
	var s = this.indexOf(start);
	if(s != -1) {
		s += start.length;
		var e = this.indexOf(end,s);
		if(e != -1)
			return [s,e];
	}
};

// Replace a chunk of a string given start and end markers
String.prototype.replaceChunk = function(start,end,sub)
{
	var r = this.getChunkRange(start,end);
	return r ? this.substring(0,r[0]) + sub + this.substring(r[1]) : this;
};

// Returns a chunk of a string between start and end markers, or undefined
String.prototype.getChunk = function(start,end)
{
	var r = this.getChunkRange(start,end);
	if(r)
		return this.substring(r[0],r[1]);
};


// Static method to bracket a string with double square brackets if it contains a space
String.encodeTiddlyLink = function(title)
{
	return title.indexOf(" ") == -1 ? title : "[[" + title + "]]";
};

// Static method to encodeTiddlyLink for every item in an array and join them with spaces
String.encodeTiddlyLinkList = function(list)
{
	if(list) {
		var t,results = [];
		for(t=0; t<list.length; t++)
			results.push(String.encodeTiddlyLink(list[t]));
		return results.join(" ");
	} else {
		return "";
	}
};

// Convert a string as a sequence of name:"value" pairs into a hashmap
String.prototype.decodeHashMap = function()
{
	var fields = this.parseParams("anon","",false);
	var t,r = {};
	for(t=1; t<fields.length; t++)
		r[fields[t].name] = fields[t].value;
	return r;
};

// Static method to encode a hashmap into a name:"value"... string
String.encodeHashMap = function(hashmap)
{
	var t,r = [];
	for(t in hashmap)
		r.push(t + ':"' + hashmap[t] + '"');
	return r.join(" ");
};

// Static method to left-pad a string with 0s to a certain width
String.zeroPad = function(n,d)
{
	var s = n.toString();
	if(s.length < d)
		s = "000000000000000000000000000".substr(0,d-s.length) + s;
	return s;
};

String.prototype.startsWith = function(prefix)
{
	return !prefix || this.substring(0,prefix.length) == prefix;
};

// Returns the first value of the given named parameter.
function getParam(params,name,defaultValue)
{
	if(!params)
		return defaultValue;
	var p = params[0][name];
	return p ? p[0] : defaultValue;
}

// Returns the first value of the given boolean named parameter.
function getFlag(params,name,defaultValue)
{
	return !!getParam(params,name,defaultValue);
}

//--
//-- Augmented methods for the JavaScript Date() object
//--

// Substitute date components into a string
Date.prototype.formatString = function(template)
{
	var t = template.replace(/0hh12/g,String.zeroPad(this.getHours12(),2));
	t = t.replace(/hh12/g,this.getHours12());
	t = t.replace(/0hh/g,String.zeroPad(this.getHours(),2));
	t = t.replace(/hh/g,this.getHours());
	t = t.replace(/mmm/g,config.messages.dates.shortMonths[this.getMonth()]);
	t = t.replace(/0mm/g,String.zeroPad(this.getMinutes(),2));
	t = t.replace(/mm/g,this.getMinutes());
	t = t.replace(/0ss/g,String.zeroPad(this.getSeconds(),2));
	t = t.replace(/ss/g,this.getSeconds());
	t = t.replace(/[ap]m/g,this.getAmPm().toLowerCase());
	t = t.replace(/[AP]M/g,this.getAmPm().toUpperCase());
	t = t.replace(/wYYYY/g,this.getYearForWeekNo());
	t = t.replace(/wYY/g,String.zeroPad(this.getYearForWeekNo()-2000,2));
	t = t.replace(/YYYY/g,this.getFullYear());
	t = t.replace(/YY/g,String.zeroPad(this.getFullYear()-2000,2));
	t = t.replace(/MMM/g,config.messages.dates.months[this.getMonth()]);
	t = t.replace(/0MM/g,String.zeroPad(this.getMonth()+1,2));
	t = t.replace(/MM/g,this.getMonth()+1);
	t = t.replace(/0WW/g,String.zeroPad(this.getWeek(),2));
	t = t.replace(/WW/g,this.getWeek());
	t = t.replace(/DDD/g,config.messages.dates.days[this.getDay()]);
	t = t.replace(/ddd/g,config.messages.dates.shortDays[this.getDay()]);
	t = t.replace(/0DD/g,String.zeroPad(this.getDate(),2));
	t = t.replace(/DDth/g,this.getDate()+this.daySuffix());
	t = t.replace(/DD/g,this.getDate());
	var tz = this.getTimezoneOffset();
	var atz = Math.abs(tz);
	t = t.replace(/TZD/g,(tz < 0 ? '+' : '-') + String.zeroPad(Math.floor(atz / 60),2) + ':' + String.zeroPad(atz % 60,2));
	t = t.replace(/\\/g,"");
	return t;
};

Date.prototype.getWeek = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week to calculate weekNo
	var n = Math.floor((dt.getTime()-new Date(dt.getFullYear(),0,1)+3600000)/86400000);
	return Math.floor(n/7)+1;
};

Date.prototype.getYearForWeekNo = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week
	return dt.getFullYear();
};

Date.prototype.getHours12 = function()
{
	var h = this.getHours();
	return h > 12 ? h-12 : ( h > 0 ? h : 12 );
};

Date.prototype.getAmPm = function()
{
	return this.getHours() >= 12 ? config.messages.dates.pm : config.messages.dates.am;
};

Date.prototype.daySuffix = function()
{
	return config.messages.dates.daySuffixes[this.getDate()-1];
};

// Convert a date to local YYYYMMDDHHMM string format
Date.prototype.convertToLocalYYYYMMDDHHMM = function()
{
	return this.getFullYear() + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2);
};

// Convert a date to UTC YYYYMMDDHHMM string format
Date.prototype.convertToYYYYMMDDHHMM = function()
{
	return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2);
};

// Convert a date to UTC YYYYMMDD.HHMMSSMMM string format
Date.prototype.convertToYYYYMMDDHHMMSSMMM = function()
{
	return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + "." + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2) + String.zeroPad(this.getUTCSeconds(),2) + String.zeroPad(this.getUTCMilliseconds(),3) +"0";
};

// Static method to create a date from a UTC YYYYMMDDHHMM format string
Date.convertFromYYYYMMDDHHMM = function(d)
{
	d = d?d.replace(/[^0-9]/g, ""):"";
	return Date.convertFromYYYYMMDDHHMMSSMMM(d.substr(0,12));
};

// Static method to create a date from a UTC YYYYMMDDHHMMSS format string
Date.convertFromYYYYMMDDHHMMSS = function(d)
{
	d = d?d.replace(/[^0-9]/g, ""):"";
	return Date.convertFromYYYYMMDDHHMMSSMMM(d.substr(0,14));
};

// Static method to create a date from a UTC YYYYMMDDHHMMSSMMM format string
Date.convertFromYYYYMMDDHHMMSSMMM = function(d)
{
	d = d ? d.replace(/[^0-9]/g, "") : "";
	return new Date(Date.UTC(parseInt(d.substr(0,4),10),
			parseInt(d.substr(4,2),10)-1,
			parseInt(d.substr(6,2),10),
			parseInt(d.substr(8,2)||"00",10),
			parseInt(d.substr(10,2)||"00",10),
			parseInt(d.substr(12,2)||"00",10),
			parseInt(d.substr(14,3)||"000",10)));
};

//--
//-- RGB colour object
//--

// Construct an RGB colour object from a '#rrggbb', '#rgb' or 'rgb(n,n,n)' string or from separate r,g,b values
function RGB(r,g,b)
{
	this.r = 0;
	this.g = 0;
	this.b = 0;
	if(typeof r == "string") {
		if(r.substr(0,1) == "#") {
			if(r.length == 7) {
				this.r = parseInt(r.substr(1,2),16)/255;
				this.g = parseInt(r.substr(3,2),16)/255;
				this.b = parseInt(r.substr(5,2),16)/255;
			} else {
				this.r = parseInt(r.substr(1,1),16)/15;
				this.g = parseInt(r.substr(2,1),16)/15;
				this.b = parseInt(r.substr(3,1),16)/15;
			}
		} else {
			var rgbPattern = /rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/;
			var c = r.match(rgbPattern);
			if(c) {
				this.r = parseInt(c[1],10)/255;
				this.g = parseInt(c[2],10)/255;
				this.b = parseInt(c[3],10)/255;
			}
		}
	} else {
		this.r = r;
		this.g = g;
		this.b = b;
	}
	return this;
}

// Mixes this colour with another in a specified proportion
// c = other colour to mix
// f = 0..1 where 0 is this colour and 1 is the new colour
// Returns an RGB object
RGB.prototype.mix = function(c,f)
{
	return new RGB(this.r + (c.r-this.r) * f,this.g + (c.g-this.g) * f,this.b + (c.b-this.b) * f);
};

// Return an rgb colour as a #rrggbb format hex string
RGB.prototype.toString = function()
{
	var clamp = function(x,min,max) {
		return x < min ? min : (x > max ? max : x);
	};
	return "#" +
			("0" + Math.floor(clamp(this.r,0,1) * 255).toString(16)).right(2) +
			("0" + Math.floor(clamp(this.g,0,1) * 255).toString(16)).right(2) +
			("0" + Math.floor(clamp(this.b,0,1) * 255).toString(16)).right(2);
};

//--
//-- DOM utilities - many derived from www.quirksmode.org
//--

function drawGradient(place,horiz,locolors,hicolors)
{
	if(!hicolors)
		hicolors = locolors;
	var t;
	for(t=0; t<= 100; t+=2) {
		var bar = document.createElement("div");
		place.appendChild(bar);
		bar.style.position = "absolute";
		bar.style.left = horiz ? t + "%" : 0;
		bar.style.top = horiz ? 0 : t + "%";
		bar.style.width = horiz ? (101-t) + "%" : "100%";
		bar.style.height = horiz ? "100%" : (101-t) + "%";
		bar.style.zIndex = -1;
		var p = t/100*(locolors.length-1);
		var hc = hicolors[Math.floor(p)];
		if(typeof hc == "string")
			hc = new RGB(hc);
		var lc = locolors[Math.ceil(p)];
		if(typeof lc == "string")
			lc = new RGB(lc);
		bar.style.backgroundColor = hc.mix(lc,p-Math.floor(p)).toString();
	}
}

function addEvent(obj,type,fn)
{
	if(obj.attachEvent) {
		obj["e"+type+fn] = fn;
		obj[type+fn] = function(){obj["e"+type+fn](window.event);};
		obj.attachEvent("on"+type,obj[type+fn]);
	} else {
		obj.addEventListener(type,fn,false);
	}
}

function removeEvent(obj,type,fn)
{
	if(obj.detachEvent) {
		obj.detachEvent("on"+type,obj[type+fn]);
		obj[type+fn] = null;
	} else {
		obj.removeEventListener(type,fn,false);
	}
}

// Find the closest relative with a given property value (property defaults to tagName, relative defaults to parentNode)
function findRelated(e,value,name,relative)
{
	name = name || "tagName";
	relative = relative || "parentNode";
	if(name == "className") {
		while(e && !jQuery(e).hasClass(value)) {
			e = e[relative];
		}
	} else {
		while(e && e[name] != value) {
			e = e[relative];
		}
	}
	return e;
}

// Get the scroll position for window.scrollTo necessary to scroll a given element into view
function ensureVisible(e)
{
	var posTop = findPosY(e);
	var posBot = posTop + e.offsetHeight;
	var winTop = findScrollY();
	var winHeight = findWindowHeight();
	var winBot = winTop + winHeight;
	if(posTop < winTop) {
		return posTop;
	} else if(posBot > winBot) {
		if(e.offsetHeight < winHeight)
			return posTop - (winHeight - e.offsetHeight);
		else
			return posTop;
	} else {
		return winTop;
	}
}

// Get the current width of the display window
function findWindowWidth()
{
	return window.innerWidth || document.documentElement.clientWidth;
}

// Get the current height of the display window
function findWindowHeight()
{
	return window.innerHeight || document.documentElement.clientHeight;
}

// Get the current horizontal page scroll position
function findScrollX()
{
	return window.scrollX || document.documentElement.scrollLeft;
}

// Get the current vertical page scroll position
function findScrollY()
{
	return window.scrollY || document.documentElement.scrollTop;
}

function findPosX(obj)
{
	var curleft = 0;
	while(obj.offsetParent) {
		curleft += obj.offsetLeft;
		obj = obj.offsetParent;
	}
	return curleft;
}

function findPosY(obj)
{
	var curtop = 0;
	while(obj.offsetParent) {
		curtop += obj.offsetTop;
		obj = obj.offsetParent;
	}
	return curtop;
}

// Blur a particular element
function blurElement(e)
{
	if(e && e.focus && e.blur) {
		e.focus();
		e.blur();
	}
}

// Create a non-breaking space
function insertSpacer(place)
{
	var e = document.createTextNode(String.fromCharCode(160));
	if(place)
		place.appendChild(e);
	return e;
}

// Replace the current selection of a textarea or text input and scroll it into view
function replaceSelection(e,text)
{
	if(e.setSelectionRange) {
		var oldpos = e.selectionStart;
		var isRange = e.selectionEnd > e.selectionStart;
		e.value = e.value.substr(0,e.selectionStart) + text + e.value.substr(e.selectionEnd);
		e.setSelectionRange(isRange ? oldpos : oldpos + text.length,oldpos + text.length);
		var linecount = e.value.split("\n").length;
		var thisline = e.value.substr(0,e.selectionStart).split("\n").length-1;
		e.scrollTop = Math.floor((thisline - e.rows / 2) * e.scrollHeight / linecount);
	} else if(document.selection) {
		var range = document.selection.createRange();
		if(range.parentElement() == e) {
			var isCollapsed = range.text == "";
			range.text = text;
			if(!isCollapsed) {
				range.moveStart("character", -text.length);
				range.select();
			}
		}
	}
}

// Set the caret position in a text area
function setCaretPosition(e,pos)
{
	if(e.selectionStart || e.selectionStart == '0') {
		e.selectionStart = pos;
		e.selectionEnd = pos;
		e.focus();
	} else if(document.selection) {
		// IE support
		e.focus ();
		var sel = document.selection.createRange();
		sel.moveStart('character', -e.value.length);
		sel.moveStart('character',pos);
		sel.moveEnd('character',0);
		sel.select();
	}
}

// Returns the text of the given (text) node, possibly merging subsequent text nodes
function getNodeText(e)
{
	var t = "";
	while(e && e.nodeName == "#text") {
		t += e.nodeValue;
		e = e.nextSibling;
	}
	return t;
}

// Returns true if the element e has a given ancestor element
function isDescendant(e,ancestor)
{
	while(e) {
		if(e === ancestor)
			return true;
		e = e.parentNode;
	}
	return false;
}


// deprecate the following...

// Prevent an event from bubbling
function stopEvent(e)
{
	var ev = e || window.event;
	ev.cancelBubble = true;
	if(ev.stopPropagation) ev.stopPropagation();
	return false;
}

// Remove any event handlers or non-primitve custom attributes
function scrubNode(e)
{
	if(!config.browser.isIE)
		return;
	var att = e.attributes;
	if(att) {
		var t;
		for(t=0; t<att.length; t++) {
			var n = att[t].name;
			if(n !== "style" && (typeof e[n] === "function" || (typeof e[n] === "object" && e[n] != null))) {
				try {
					e[n] = null;
				} catch(ex) {
				}
			}
		}
	}
	var c = e.firstChild;
	while(c) {
		scrubNode(c);
		c = c.nextSibling;
	}
}

function setStylesheet(s,id,doc)
{
	jQuery.twStylesheet(s,{id:id,doc:doc});
}

function removeStyleSheet(id)
{
	jQuery.twStylesheet.remove({id:id});
}

//--
//-- LoaderBase and SaverBase
//--

function LoaderBase() {}

LoaderBase.prototype.loadTiddler = function(store,node,tiddlers)
{
	var title = this.getTitle(store,node);
	if(safeMode && store.isShadowTiddler(title))
		return;
	if(title) {
		var tiddler = store.createTiddler(title);
		this.internalizeTiddler(store,tiddler,title,node);
		tiddlers.push(tiddler);
	}
};

LoaderBase.prototype.loadTiddlers = function(store,nodes)
{
	var t,tiddlers = [];
	for(t = 0; t < nodes.length; t++) {
		try {
			this.loadTiddler(store,nodes[t],tiddlers);
		} catch(ex) {
			showException(ex,config.messages.tiddlerLoadError.format([this.getTitle(store,nodes[t])]));
		}
	}
	return tiddlers;
};

function SaverBase() {}

SaverBase.prototype.externalize = function(store)
{
	var results = [];
	var t,tiddlers = store.getTiddlers("title");
	for(t = 0; t < tiddlers.length; t++) {
		if(!tiddlers[t].doNotSave())
			results.push(this.externalizeTiddler(store, tiddlers[t]));
	}
	return results.join("\n");
};

//--
//-- TW21Loader (inherits from LoaderBase)
//--

function TW21Loader() {}

TW21Loader.prototype = new LoaderBase();

TW21Loader.prototype.getTitle = function(store,node)
{
	var title = null;
	if(node.getAttribute) {
		title = node.getAttribute("title");
		if(!title)
			title = node.getAttribute("tiddler");
	}
	if(!title && node.id) {
		var lenPrefix = store.idPrefix.length;
		if(node.id.substr(0,lenPrefix) == store.idPrefix)
			title = node.id.substr(lenPrefix);
	}
	return title;
};

TW21Loader.prototype.internalizeTiddler = function(store,tiddler,title,node)
{
	var e = node.firstChild;
	var text = null;
	if(node.getAttribute("tiddler")) {
		text = getNodeText(e).unescapeLineBreaks();
	} else {
		while(e.nodeName!="PRE" && e.nodeName!="pre") {
			e = e.nextSibling;
		}
		text = e.innerHTML.replace(/\r/mg,"").htmlDecode();
	}
	var creator = node.getAttribute("creator");
	var modifier = node.getAttribute("modifier");
	var c = node.getAttribute("created");
	var m = node.getAttribute("modified");
	var created = c ? Date.convertFromYYYYMMDDHHMMSS(c) : version.date;
	var modified = m ? Date.convertFromYYYYMMDDHHMMSS(m) : created;
	var tags = node.getAttribute("tags");
	var fields = {};
	var i,attrs = node.attributes;
	for(i = attrs.length-1; i >= 0; i--) {
		var name = attrs[i].name;
		if(attrs[i].specified && !TiddlyWiki.isStandardField(name)) {
			fields[name] = attrs[i].value.unescapeLineBreaks();
		}
	}
	tiddler.assign(title,text,modifier,modified,tags,created,fields,creator);
	return tiddler;
};

//--
//-- TW21Saver (inherits from SaverBase)
//--

function TW21Saver() {}

TW21Saver.prototype = new SaverBase();

TW21Saver.prototype.externalizeTiddler = function(store,tiddler)
{
	try {
		var extendedAttributes = "";
		var usePre = config.options.chkUsePreForStorage;
		store.forEachField(tiddler,
			function(tiddler,fieldName,value) {
				// don't store stuff from the temp namespace
				if(typeof value != "string")
					value = "";
				if(!fieldName.match(/^temp\./))
					extendedAttributes += ' %0="%1"'.format([fieldName,value.escapeLineBreaks().htmlEncode()]);
			},true);
		var created = tiddler.created;
		var modified = tiddler.modified;
		var attributes = tiddler.creator ? ' creator="' + tiddler.creator.htmlEncode() + '"' : "";
		attributes += tiddler.modifier ? ' modifier="' + tiddler.modifier.htmlEncode() + '"' : "";
		attributes += (usePre && created == version.date) ? "" :' created="' + created.convertToYYYYMMDDHHMM() + '"';
		attributes += (usePre && modified == created) ? "" : ' modified="' + modified.convertToYYYYMMDDHHMM() +'"';
		var tags = tiddler.getTags();
		if(!usePre || tags)
			attributes += ' tags="' + tags.htmlEncode() + '"';
		return ('<div %0="%1"%2%3>%4</'+'div>').format([
				usePre ? "title" : "tiddler",
				tiddler.title.htmlEncode(),
				attributes,
				extendedAttributes,
				usePre ? "\n<pre>" + tiddler.text.htmlEncode() + "</pre>\n" : tiddler.text.escapeLineBreaks().htmlEncode()
			]);
	} catch (ex) {
		throw exceptionText(ex,config.messages.tiddlerSaveError.format([tiddler.title]));
	}
};

//]]>
</script>
<script id="jsdeprecatedArea" type="text/javascript">
//<![CDATA[
//--
//-- Deprecated Crypto functions and associated conversion routines.
//-- Use the jQuery.encoding functions directly instead.
//--

// Crypto 'namespace'
function Crypto() {}

// Convert a string to an array of big-endian 32-bit words
Crypto.strToBe32s = function(str)
{
	return jQuery.encoding.strToBe32s(str);
};

// Convert an array of big-endian 32-bit words to a string
Crypto.be32sToStr = function(be)
{
	return jQuery.encoding.be32sToStr(be);
};

// Convert an array of big-endian 32-bit words to a hex string
Crypto.be32sToHex = function(be)
{
	return jQuery.encoding.be32sToHex(be);
};

// Return, in hex, the SHA-1 hash of a string
Crypto.hexSha1Str = function(str)
{
	return jQuery.encoding.digests.hexSha1Str(str);
};

// Return the SHA-1 hash of a string
Crypto.sha1Str = function(str)
{
	return jQuery.encoding.digests.sha1Str(str);
};

// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
Crypto.sha1 = function(x,blen)
{
	return jQuery.encoding.digests.sha1(x,blen);
};

//--
//-- Deprecated code
//--

// @Deprecated: Use createElementAndWikify and this.termRegExp instead
config.formatterHelpers.charFormatHelper = function(w)
{
	w.subWikify(createTiddlyElement(w.output,this.element),this.terminator);
};

// @Deprecated: Use enclosedTextHelper and this.lookaheadRegExp instead
config.formatterHelpers.monospacedByLineHelper = function(w)
{
	var lookaheadRegExp = new RegExp(this.lookahead,"mg");
	lookaheadRegExp.lastIndex = w.matchStart;
	var lookaheadMatch = lookaheadRegExp.exec(w.source);
	if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
		var text = lookaheadMatch[1];
		if(config.browser.isIE)
			text = text.replace(/\n/g,"\r");
		createTiddlyElement(w.output,"pre",null,null,text);
		w.nextMatch = lookaheadRegExp.lastIndex;
	}
};

// @Deprecated: Use <br> or <br /> instead of <<br>>
config.macros.br = {};
config.macros.br.handler = function(place)
{
	createTiddlyElement(place,"br");
};

// Find an entry in an array. Returns the array index or null
// @Deprecated: Use indexOf instead
Array.prototype.find = function(item)
{
	var i = this.indexOf(item);
	return i == -1 ? null : i;
};

// Load a tiddler from an HTML DIV. The caller should make sure to later call Tiddler.changed()
// @Deprecated: Use store.getLoader().internalizeTiddler instead
Tiddler.prototype.loadFromDiv = function(divRef,title)
{
	return store.getLoader().internalizeTiddler(store,this,title,divRef);
};

// Format the text for storage in an HTML DIV
// @Deprecated Use store.getSaver().externalizeTiddler instead.
Tiddler.prototype.saveToDiv = function()
{
	return store.getSaver().externalizeTiddler(store,this);
};

// @Deprecated: Use store.allTiddlersAsHtml() instead
function allTiddlersAsHtml()
{
	return store.allTiddlersAsHtml();
}

// @Deprecated: Use refreshPageTemplate instead
function applyPageTemplate(title)
{
	refreshPageTemplate(title);
}

// @Deprecated: Use story.displayTiddlers instead
function displayTiddlers(srcElement,titles,template,unused1,unused2,animate,unused3)
{
	story.displayTiddlers(srcElement,titles,template,animate);
}

// @Deprecated: Use story.displayTiddler instead
function displayTiddler(srcElement,title,template,unused1,unused2,animate,unused3)
{
	story.displayTiddler(srcElement,title,template,animate);
}

// @Deprecated: Use functions on right hand side directly instead
var createTiddlerPopup = Popup.create;
var scrollToTiddlerPopup = Popup.show;
var hideTiddlerPopup = Popup.remove;

// @Deprecated: Use right hand side directly instead
var regexpBackSlashEn = new RegExp("\\\\n","mg");
var regexpBackSlash = new RegExp("\\\\","mg");
var regexpBackSlashEss = new RegExp("\\\\s","mg");
var regexpNewLine = new RegExp("\n","mg");
var regexpCarriageReturn = new RegExp("\r","mg");

//--
//-- Deprecated FileAdaptor functions
//--

FileAdaptor.loadTiddlyWikiCallback = function(status,context,responseText,url,xhr)
{
	context.status = status;
	if(!status) {
		context.statusText = "Error reading file";
	} else {
		context.adaptor.store = new TiddlyWiki();
		if(!context.adaptor.store.importTiddlyWiki(responseText)) {
			context.statusText = config.messages.invalidFileError.format([url]);
			context.status = false;
		}
	}
	context.complete(context,context.userParams);
};

//--
//-- Deprecated HTTP request code
//-- Use the jQuery ajax functions directly instead
//--

function loadRemoteFile(url,callback,params)
{
	return httpReq("GET",url,callback,params);
}

function doHttp(type,url,data,contentType,username,password,callback,params,headers,allowCache)
{
	return httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache);
}

//--
//-- Deprecated String functions
//--

// @Deprecated: no direct replacement, since not used in core code
String.prototype.toJSONString = function()
{
	// Convert a string to it's JSON representation by encoding control characters, double quotes and backslash. See json.org
	var m = {
		'\b': '\\b',
		'\f': '\\f',
		'\n': '\\n',
		'\r': '\\r',
		'\t': '\\t',
		'"' : '\\"',
		'\\': '\\\\'
		};
	var replaceFn = function(a,b) {
		var c = m[b];
		if(c)
			return c;
		c = b.charCodeAt();
		return '\\u00' + Math.floor(c / 16).toString(16) + (c % 16).toString(16);
		};
	if(/["\\\x00-\x1f]/.test(this))
		return '"' + this.replace(/([\x00-\x1f\\"])/g,replaceFn) + '"';
	return '"' + this + '"';
};

//--
//-- Deprecated Tiddler code
//--

// @Deprecated: Use tiddlerToRssItem(tiddler,uri) instead
Tiddler.prototype.toRssItem = function(uri)
{
	return tiddlerToRssItem(this,uri);
};

// @Deprecated: Use "<item>\n" + tiddlerToRssItem(tiddler,uri)  + "\n</item>" instead
Tiddler.prototype.saveToRss = function(uri)
{
	return "<item>\n" + tiddlerToRssItem(this,uri) + "\n</item>";
};

// @Deprecated: Use jQuery.encoding.digests.hexSha1Str instead
Tiddler.prototype.generateFingerprint = function()
{
	return "0x" + Crypto.hexSha1Str(this.text);
};

//--
//-- Deprecated Number functions
//--

// @Deprecated: no direct replacement, since not used in core code
// Clamp a number to a range
Number.prototype.clamp = function(min,max)
{
	var c = this;
	if(c < min)
		c = min;
	if(c > max)
		c = max;
	return Number(c);
};

//--
//-- Deprecated utility functions
//-- Use the jQuery functions directly instead
//--

// Remove all children of a node
function removeChildren(e)
{
	jQuery(e).empty();
}

// Remove a node and all it's children
function removeNode(e)
{
	jQuery(e).remove();
}

// Return the content of an element as plain text with no formatting
function getPlainText(e)
{
	return jQuery(e).text();
}

function addClass(e,className)
{
	jQuery(e).addClass(className);
}

function removeClass(e,className)
{
	jQuery(e).removeClass(className);
}

function hasClass(e,className)
{
	return jQuery(e).hasClass(className);
}

//--
//-- Deprecated Wikifier code
//--

function wikifyPlain(title,theStore,limit)
{
	if(!theStore)
		theStore = store;
	if(theStore.tiddlerExists(title) || theStore.isShadowTiddler(title)) {
		return wikifyPlainText(theStore.getTiddlerText(title),limit,tiddler);
	} else {
		return "";
	}
}

//]]>
</script>
<script id="jslibArea" type="text/javascript">
//<![CDATA[
/*!
 * jQuery JavaScript Library v1.6.2
 * http://jquery.com/
 *
 * Copyright 2011, John Resig
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 * Copyright 2011, The Dojo Foundation
 * Released under the MIT, BSD, and GPL Licenses.
 *
 * Date: Thu Jun 30 14:16:56 2011 -0400
 */
(function(a,b){function cv(a){return f.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}function cs(a){if(!cg[a]){var b=c.body,d=f("<"+a+">").appendTo(b),e=d.css("display");d.remove();if(e==="none"||e===""){ch||(ch=c.createElement("iframe"),ch.frameBorder=ch.width=ch.height=0),b.appendChild(ch);if(!ci||!ch.createElement)ci=(ch.contentWindow||ch.contentDocument).document,ci.write((c.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>"),ci.close();d=ci.createElement(a),ci.body.appendChild(d),e=f.css(d,"display"),b.removeChild(ch)}cg[a]=e}return cg[a]}function cr(a,b){var c={};f.each(cm.concat.apply([],cm.slice(0,b)),function(){c[this]=a});return c}function cq(){cn=b}function cp(){setTimeout(cq,0);return cn=f.now()}function cf(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function ce(){try{return new a.XMLHttpRequest}catch(b){}}function b$(a,c){a.dataFilter&&(c=a.dataFilter(c,a.dataType));var d=a.dataTypes,e={},g,h,i=d.length,j,k=d[0],l,m,n,o,p;for(g=1;g<i;g++){if(g===1)for(h in a.converters)typeof h=="string"&&(e[h.toLowerCase()]=a.converters[h]);l=k,k=d[g];if(k==="*")k=l;else if(l!=="*"&&l!==k){m=l+" "+k,n=e[m]||e["* "+k];if(!n){p=b;for(o in e){j=o.split(" ");if(j[0]===l||j[0]==="*"){p=e[j[1]+" "+k];if(p){o=e[o],o===!0?n=p:p===!0&&(n=o);break}}}}!n&&!p&&f.error("No conversion from "+m.replace(" "," to ")),n!==!0&&(c=n?n(c):p(o(c)))}}return c}function bZ(a,c,d){var e=a.contents,f=a.dataTypes,g=a.responseFields,h,i,j,k;for(i in g)i in d&&(c[g[i]]=d[i]);while(f[0]==="*")f.shift(),h===b&&(h=a.mimeType||c.getResponseHeader("content-type"));if(h)for(i in e)if(e[i]&&e[i].test(h)){f.unshift(i);break}if(f[0]in d)j=f[0];else{for(i in d){if(!f[0]||a.converters[i+" "+f[0]]){j=i;break}k||(k=i)}j=j||k}if(j){j!==f[0]&&f.unshift(j);return d[j]}}function bY(a,b,c,d){if(f.isArray(b))f.each(b,function(b,e){c||bC.test(a)?d(a,e):bY(a+"["+(typeof e=="object"||f.isArray(e)?b:"")+"]",e,c,d)});else if(!c&&b!=null&&typeof b=="object")for(var e in b)bY(a+"["+e+"]",b[e],c,d);else d(a,b)}function bX(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h=a[f],i=0,j=h?h.length:0,k=a===bR,l;for(;i<j&&(k||!l);i++)l=h[i](c,d,e),typeof l=="string"&&(!k||g[l]?l=b:(c.dataTypes.unshift(l),l=bX(a,c,d,e,l,g)));(k||!l)&&!g["*"]&&(l=bX(a,c,d,e,"*",g));return l}function bW(a){return function(b,c){typeof b!="string"&&(c=b,b="*");if(f.isFunction(c)){var d=b.toLowerCase().split(bN),e=0,g=d.length,h,i,j;for(;e<g;e++)h=d[e],j=/^\+/.test(h),j&&(h=h.substr(1)||"*"),i=a[h]=a[h]||[],i[j?"unshift":"push"](c)}}}function bA(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=b==="width"?bv:bw;if(d>0){c!=="border"&&f.each(e,function(){c||(d-=parseFloat(f.css(a,"padding"+this))||0),c==="margin"?d+=parseFloat(f.css(a,c+this))||0:d-=parseFloat(f.css(a,"border"+this+"Width"))||0});return d+"px"}d=bx(a,b,b);if(d<0||d==null)d=a.style[b]||0;d=parseFloat(d)||0,c&&f.each(e,function(){d+=parseFloat(f.css(a,"padding"+this))||0,c!=="padding"&&(d+=parseFloat(f.css(a,"border"+this+"Width"))||0),c==="margin"&&(d+=parseFloat(f.css(a,c+this))||0)});return d+"px"}function bm(a,b){b.src?f.ajax({url:b.src,async:!1,dataType:"script"}):f.globalEval((b.text||b.textContent||b.innerHTML||"").replace(be,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)}function bl(a){f.nodeName(a,"input")?bk(a):"getElementsByTagName"in a&&f.grep(a.getElementsByTagName("input"),bk)}function bk(a){if(a.type==="checkbox"||a.type==="radio")a.defaultChecked=a.checked}function bj(a){return"getElementsByTagName"in a?a.getElementsByTagName("*"):"querySelectorAll"in a?a.querySelectorAll("*"):[]}function bi(a,b){var c;if(b.nodeType===1){b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase();if(c==="object")b.outerHTML=a.outerHTML;else if(c!=="input"||a.type!=="checkbox"&&a.type!=="radio"){if(c==="option")b.selected=a.defaultSelected;else if(c==="input"||c==="textarea")b.defaultValue=a.defaultValue}else a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value);b.removeAttribute(f.expando)}}function bh(a,b){if(b.nodeType===1&&!!f.hasData(a)){var c=f.expando,d=f.data(a),e=f.data(b,d);if(d=d[c]){var g=d.events;e=e[c]=f.extend({},d);if(g){delete e.handle,e.events={};for(var h in g)for(var i=0,j=g[h].length;i<j;i++)f.event.add(b,h+(g[h][i].namespace?".":"")+g[h][i].namespace,g[h][i],g[h][i].data)}}}}function bg(a,b){return f.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function W(a,b,c){b=b||0;if(f.isFunction(b))return f.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return f.grep(a,function(a,d){return a===b===c});if(typeof b=="string"){var d=f.grep(a,function(a){return a.nodeType===1});if(R.test(b))return f.filter(b,d,!c);b=f.filter(b,d)}return f.grep(a,function(a,d){return f.inArray(a,b)>=0===c})}function V(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function N(a,b){return(a&&a!=="*"?a+".":"")+b.replace(z,"`").replace(A,"&")}function M(a){var b,c,d,e,g,h,i,j,k,l,m,n,o,p=[],q=[],r=f._data(this,"events");if(!(a.liveFired===this||!r||!r.live||a.target.disabled||a.button&&a.type==="click")){a.namespace&&(n=new RegExp("(^|\\.)"+a.namespace.split(".").join("\\.(?:.*\\.)?")+"(\\.|$)")),a.liveFired=this;var s=r.live.slice(0);for(i=0;i<s.length;i++)g=s[i],g.origType.replace(x,"")===a.type?q.push(g.selector):s.splice(i--,1);e=f(a.target).closest(q,a.currentTarget);for(j=0,k=e.length;j<k;j++){m=e[j];for(i=0;i<s.length;i++){g=s[i];if(m.selector===g.selector&&(!n||n.test(g.namespace))&&!m.elem.disabled){h=m.elem,d=null;if(g.preType==="mouseenter"||g.preType==="mouseleave")a.type=g.preType,d=f(a.relatedTarget).closest(g.selector)[0],d&&f.contains(h,d)&&(d=h);(!d||d!==h)&&p.push({elem:h,handleObj:g,level:m.level})}}}for(j=0,k=p.length;j<k;j++){e=p[j];if(c&&e.level>c)break;a.currentTarget=e.elem,a.data=e.handleObj.data,a.handleObj=e.handleObj,o=e.handleObj.origHandler.apply(e.elem,arguments);if(o===!1||a.isPropagationStopped()){c=e.level,o===!1&&(b=!1);if(a.isImmediatePropagationStopped())break}}return b}}function K(a,c,d){var e=f.extend({},d[0]);e.type=a,e.originalEvent={},e.liveFired=b,f.event.handle.call(c,e),e.isDefaultPrevented()&&d[0].preventDefault()}function E(){return!0}function D(){return!1}function m(a,c,d){var e=c+"defer",g=c+"queue",h=c+"mark",i=f.data(a,e,b,!0);i&&(d==="queue"||!f.data(a,g,b,!0))&&(d==="mark"||!f.data(a,h,b,!0))&&setTimeout(function(){!f.data(a,g,b,!0)&&!f.data(a,h,b,!0)&&(f.removeData(a,e,!0),i.resolve())},0)}function l(a){for(var b in a)if(b!=="toJSON")return!1;return!0}function k(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(j,"$1-$2").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:f.isNaN(d)?i.test(d)?f.parseJSON(d):d:parseFloat(d)}catch(g){}f.data(a,c,d)}else d=b}return d}var c=a.document,d=a.navigator,e=a.location,f=function(){function J(){if(!e.isReady){try{c.documentElement.doScroll("left")}catch(a){setTimeout(J,1);return}e.ready()}}var e=function(a,b){return new e.fn.init(a,b,h)},f=a.jQuery,g=a.$,h,i=/^(?:[^<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,j=/\S/,k=/^\s+/,l=/\s+$/,m=/\d/,n=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,o=/^[\],:{}\s]*$/,p=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,q=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,r=/(?:^|:|,)(?:\s*\[)+/g,s=/(webkit)[ \/]([\w.]+)/,t=/(opera)(?:.*version)?[ \/]([\w.]+)/,u=/(msie) ([\w.]+)/,v=/(mozilla)(?:.*? rv:([\w.]+))?/,w=/-([a-z])/ig,x=function(a,b){return b.toUpperCase()},y=d.userAgent,z,A,B,C=Object.prototype.toString,D=Object.prototype.hasOwnProperty,E=Array.prototype.push,F=Array.prototype.slice,G=String.prototype.trim,H=Array.prototype.indexOf,I={};e.fn=e.prototype={constructor:e,init:function(a,d,f){var g,h,j,k;if(!a)return this;if(a.nodeType){this.context=this[0]=a,this.length=1;return this}if(a==="body"&&!d&&c.body){this.context=c,this[0]=c.body,this.selector=a,this.length=1;return this}if(typeof a=="string"){a.charAt(0)!=="<"||a.charAt(a.length-1)!==">"||a.length<3?g=i.exec(a):g=[null,a,null];if(g&&(g[1]||!d)){if(g[1]){d=d instanceof e?d[0]:d,k=d?d.ownerDocument||d:c,j=n.exec(a),j?e.isPlainObject(d)?(a=[c.createElement(j[1])],e.fn.attr.call(a,d,!0)):a=[k.createElement(j[1])]:(j=e.buildFragment([g[1]],[k]),a=(j.cacheable?e.clone(j.fragment):j.fragment).childNodes);return e.merge(this,a)}h=c.getElementById(g[2]);if(h&&h.parentNode){if(h.id!==g[2])return f.find(a);this.length=1,this[0]=h}this.context=c,this.selector=a;return this}return!d||d.jquery?(d||f).find(a):this.constructor(d).find(a)}if(e.isFunction(a))return f.ready(a);a.selector!==b&&(this.selector=a.selector,this.context=a.context);return e.makeArray(a,this)},selector:"",jquery:"1.6.2",length:0,size:function(){return this.length},toArray:function(){return F.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=this.constructor();e.isArray(a)?E.apply(d,a):e.merge(d,a),d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")");return d},each:function(a,b){return e.each(this,a,b)},ready:function(a){e.bindReady(),A.done(a);return this},eq:function(a){return a===-1?this.slice(a):this.slice(a,+a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(F.apply(this,arguments),"slice",F.call(arguments).join(","))},map:function(a){return this.pushStack(e.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:E,sort:[].sort,splice:[].splice},e.fn.init.prototype=e.fn,e.extend=e.fn.extend=function(){var a,c,d,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;typeof i=="boolean"&&(l=i,i=arguments[1]||{},j=2),typeof i!="object"&&!e.isFunction(i)&&(i={}),k===j&&(i=this,--j);for(;j<k;j++)if((a=arguments[j])!=null)for(c in a){d=i[c],f=a[c];if(i===f)continue;l&&f&&(e.isPlainObject(f)||(g=e.isArray(f)))?(g?(g=!1,h=d&&e.isArray(d)?d:[]):h=d&&e.isPlainObject(d)?d:{},i[c]=e.extend(l,h,f)):f!==b&&(i[c]=f)}return i},e.extend({noConflict:function(b){a.$===e&&(a.$=g),b&&a.jQuery===e&&(a.jQuery=f);return e},isReady:!1,readyWait:1,holdReady:function(a){a?e.readyWait++:e.ready(!0)},ready:function(a){if(a===!0&&!--e.readyWait||a!==!0&&!e.isReady){if(!c.body)return setTimeout(e.ready,1);e.isReady=!0;if(a!==!0&&--e.readyWait>0)return;A.resolveWith(c,[e]),e.fn.trigger&&e(c).trigger("ready").unbind("ready")}},bindReady:function(){if(!A){A=e._Deferred();if(c.readyState==="complete")return setTimeout(e.ready,1);if(c.addEventListener)c.addEventListener("DOMContentLoaded",B,!1),a.addEventListener("load",e.ready,!1);else if(c.attachEvent){c.attachEvent("onreadystatechange",B),a.attachEvent("onload",e.ready);var b=!1;try{b=a.frameElement==null}catch(d){}c.documentElement.doScroll&&b&&J()}}},isFunction:function(a){return e.type(a)==="function"},isArray:Array.isArray||function(a){return e.type(a)==="array"},isWindow:function(a){return a&&typeof a=="object"&&"setInterval"in a},isNaN:function(a){return a==null||!m.test(a)||isNaN(a)},type:function(a){return a==null?String(a):I[C.call(a)]||"object"},isPlainObject:function(a){if(!a||e.type(a)!=="object"||a.nodeType||e.isWindow(a))return!1;if(a.constructor&&!D.call(a,"constructor")&&!D.call(a.constructor.prototype,"isPrototypeOf"))return!1;var c;for(c in a);return c===b||D.call(a,c)},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw a},parseJSON:function(b){if(typeof b!="string"||!b)return null;b=e.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(o.test(b.replace(p,"@").replace(q,"]").replace(r,"")))return(new Function("return "+b))();e.error("Invalid JSON: "+b)},parseXML:function(b,c,d){a.DOMParser?(d=new DOMParser,c=d.parseFromString(b,"text/xml")):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b)),d=c.documentElement,(!d||!d.nodeName||d.nodeName==="parsererror")&&e.error("Invalid XML: "+b);return c},noop:function(){},globalEval:function(b){b&&j.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(w,x)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,d){var f,g=0,h=a.length,i=h===b||e.isFunction(a);if(d){if(i){for(f in a)if(c.apply(a[f],d)===!1)break}else for(;g<h;)if(c.apply(a[g++],d)===!1)break}else if(i){for(f in a)if(c.call(a[f],f,a[f])===!1)break}else for(;g<h;)if(c.call(a[g],g,a[g++])===!1)break;return a},trim:G?function(a){return a==null?"":G.call(a)}:function(a){return a==null?"":(a+"").replace(k,"").replace(l,"")},makeArray:function(a,b){var c=b||[];if(a!=null){var d=e.type(a);a.length==null||d==="string"||d==="function"||d==="regexp"||e.isWindow(a)?E.call(c,a):e.merge(c,a)}return c},inArray:function(a,b){if(H)return H.call(b,a);for(var c=0,d=b.length;c<d;c++)if(b[c]===a)return c;return-1},merge:function(a,c){var d=a.length,e=0;if(typeof c.length=="number")for(var f=c.length;e<f;e++)a[d++]=c[e];else while(c[e]!==b)a[d++]=c[e++];a.length=d;return a},grep:function(a,b,c){var d=[],e;c=!!c;for(var f=0,g=a.length;f<g;f++)e=!!b(a[f],f),c!==e&&d.push(a[f]);return d},map:function(a,c,d){var f,g,h=[],i=0,j=a.length,k=a instanceof e||j!==b&&typeof j=="number"&&(j>0&&a[0]&&a[j-1]||j===0||e.isArray(a));if(k)for(;i<j;i++)f=c(a[i],i,d),f!=null&&(h[h.length]=f);else for(g in a)f=c(a[g],g,d),f!=null&&(h[h.length]=f);return h.concat.apply([],h)},guid:1,proxy:function(a,c){if(typeof c=="string"){var d=a[c];c=a,a=d}if(!e.isFunction(a))return b;var f=F.call(arguments,2),g=function(){return a.apply(c,f.concat(F.call(arguments)))};g.guid=a.guid=a.guid||g.guid||e.guid++;return g},access:function(a,c,d,f,g,h){var i=a.length;if(typeof c=="object"){for(var j in c)e.access(a,j,c[j],f,g,d);return a}if(d!==b){f=!h&&f&&e.isFunction(d);for(var k=0;k<i;k++)g(a[k],c,f?d.call(a[k],k,g(a[k],c)):d,h);return a}return i?g(a[0],c):b},now:function(){return(new Date).getTime()},uaMatch:function(a){a=a.toLowerCase();var b=s.exec(a)||t.exec(a)||u.exec(a)||a.indexOf("compatible")<0&&v.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}e.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(d,f){f&&f instanceof e&&!(f instanceof a)&&(f=a(f));return e.fn.init.call(this,d,f,b)},a.fn.init.prototype=a.fn;var b=a(c);return a},browser:{}}),e.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){I["[object "+b+"]"]=b.toLowerCase()}),z=e.uaMatch(y),z.browser&&(e.browser[z.browser]=!0,e.browser.version=z.version),e.browser.webkit&&(e.browser.safari=!0),j.test(" ")&&(k=/^[\s\xA0]+/,l=/[\s\xA0]+$/),h=e(c),c.addEventListener?B=function(){c.removeEventListener("DOMContentLoaded",B,!1),e.ready()}:c.attachEvent&&(B=function(){c.readyState==="complete"&&(c.detachEvent("onreadystatechange",B),e.ready())});return e}(),g="done fail isResolved isRejected promise then always pipe".split(" "),h=[].slice;f.extend({_Deferred:function(){var a=[],b,c,d,e={done:function(){if(!d){var c=arguments,g,h,i,j,k;b&&(k=b,b=0);for(g=0,h=c.length;g<h;g++)i=c[g],j=f.type(i),j==="array"?e.done.apply(e,i):j==="function"&&a.push(i);k&&e.resolveWith(k[0],k[1])}return this},resolveWith:function(e,f){if(!d&&!b&&!c){f=f||[],c=1;try{while(a[0])a.shift().apply(e,f)}finally{b=[e,f],c=0}}return this},resolve:function(){e.resolveWith(this,arguments);return this},isResolved:function(){return!!c||!!b},cancel:function(){d=1,a=[];return this}};return e},Deferred:function(a){var b=f._Deferred(),c=f._Deferred(),d;f.extend(b,{then:function(a,c){b.done(a).fail(c);return this},always:function(){return b.done.apply(b,arguments).fail.apply(this,arguments)},fail:c.done,rejectWith:c.resolveWith,reject:c.resolve,isRejected:c.isResolved,pipe:function(a,c){return f.Deferred(function(d){f.each({done:[a,"resolve"],fail:[c,"reject"]},function(a,c){var e=c[0],g=c[1],h;f.isFunction(e)?b[a](function(){h=e.apply(this,arguments),h&&f.isFunction(h.promise)?h.promise().then(d.resolve,d.reject):d[g](h)}):b[a](d[g])})}).promise()},promise:function(a){if(a==null){if(d)return d;d=a={}}var c=g.length;while(c--)a[g[c]]=b[g[c]];return a}}),b.done(c.cancel).fail(b.cancel),delete b.cancel,a&&a.call(b,b);return b},when:function(a){function i(a){return function(c){b[a]=arguments.length>1?h.call(arguments,0):c,--e||g.resolveWith(g,h.call(b,0))}}var b=arguments,c=0,d=b.length,e=d,g=d<=1&&a&&f.isFunction(a.promise)?a:f.Deferred();if(d>1){for(;c<d;c++)b[c]&&f.isFunction(b[c].promise)?b[c].promise().then(i(c),g.reject):--e;e||g.resolveWith(g,b)}else g!==a&&g.resolveWith(g,d?[a]:[]);return g.promise()}}),f.support=function(){var a=c.createElement("div"),b=c.documentElement,d,e,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;a.setAttribute("className","t"),a.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",d=a.getElementsByTagName("*"),e=a.getElementsByTagName("a")[0];if(!d||!d.length||!e)return{};g=c.createElement("select"),h=g.appendChild(c.createElement("option")),i=a.getElementsByTagName("input")[0],k={leadingWhitespace:a.firstChild.nodeType===3,tbody:!a.getElementsByTagName("tbody").length,htmlSerialize:!!a.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:e.getAttribute("href")==="/a",opacity:/^0.55$/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:i.value==="on",optSelected:h.selected,getSetAttribute:a.className!=="t",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},i.checked=!0,k.noCloneChecked=i.cloneNode(!0).checked,g.disabled=!0,k.optDisabled=!h.disabled;try{delete a.test}catch(v){k.deleteExpando=!1}!a.addEventListener&&a.attachEvent&&a.fireEvent&&(a.attachEvent("onclick",function(){k.noCloneEvent=!1}),a.cloneNode(!0).fireEvent("onclick")),i=c.createElement("input"),i.value="t",i.setAttribute("type","radio"),k.radioValue=i.value==="t",i.setAttribute("checked","checked"),a.appendChild(i),l=c.createDocumentFragment(),l.appendChild(a.firstChild),k.checkClone=l.cloneNode(!0).cloneNode(!0).lastChild.checked,a.innerHTML="",a.style.width=a.style.paddingLeft="1px",m=c.getElementsByTagName("body")[0],o=c.createElement(m?"div":"body"),p={visibility:"hidden",width:0,height:0,border:0,margin:0},m&&f.extend(p,{position:"absolute",left:-1e3,top:-1e3});for(t in p)o.style[t]=p[t];o.appendChild(a),n=m||b,n.insertBefore(o,n.firstChild),k.appendChecked=i.checked,k.boxModel=a.offsetWidth===2,"zoom"in a.style&&(a.style.display="inline",a.style.zoom=1,k.inlineBlockNeedsLayout=a.offsetWidth===2,a.style.display="",a.innerHTML="<div style='width:4px;'></div>",k.shrinkWrapBlocks=a.offsetWidth!==2),a.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",q=a.getElementsByTagName("td"),u=q[0].offsetHeight===0,q[0].style.display="",q[1].style.display="none",k.reliableHiddenOffsets=u&&q[0].offsetHeight===0,a.innerHTML="",c.defaultView&&c.defaultView.getComputedStyle&&(j=c.createElement("div"),j.style.width="0",j.style.marginRight="0",a.appendChild(j),k.reliableMarginRight=(parseInt((c.defaultView.getComputedStyle(j,null)||{marginRight:0}).marginRight,10)||0)===0),o.innerHTML="",n.removeChild(o);if(a.attachEvent)for(t in{submit:1,change:1,focusin:1})s="on"+t,u=s in a,u||(a.setAttribute(s,"return;"),u=typeof a[s]=="function"),k[t+"Bubbles"]=u;o=l=g=h=m=j=a=i=null;return k}(),f.boxModel=f.support.boxModel;var i=/^(?:\{.*\}|\[.*\])$/,j=/([a-z])([A-Z])/g;f.extend({cache:{},uuid:0,expando:"jQuery"+(f.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){a=a.nodeType?f.cache[a[f.expando]]:a[f.expando];return!!a&&!l(a)},data:function(a,c,d,e){if(!!f.acceptData(a)){var g=f.expando,h=typeof c=="string",i,j=a.nodeType,k=j?f.cache:a,l=j?a[f.expando]:a[f.expando]&&f.expando;if((!l||e&&l&&!k[l][g])&&h&&d===b)return;l||(j?a[f.expando]=l=++f.uuid:l=f.expando),k[l]||(k[l]={},j||(k[l].toJSON=f.noop));if(typeof c=="object"||typeof c=="function")e?k[l][g]=f.extend(k[l][g],c):k[l]=f.extend(k[l],c);i=k[l],e&&(i[g]||(i[g]={}),i=i[g]),d!==b&&(i[f.camelCase(c)]=d);if(c==="events"&&!i[c])return i[g]&&i[g].events;return h?i[f.camelCase(c)]||i[c]:i}},removeData:function(b,c,d){if(!!f.acceptData(b)){var e=f.expando,g=b.nodeType,h=g?f.cache:b,i=g?b[f.expando]:f.expando;if(!h[i])return;if(c){var j=d?h[i][e]:h[i];if(j){delete j[c];if(!l(j))return}}if(d){delete h[i][e];if(!l(h[i]))return}var k=h[i][e];f.support.deleteExpando||h!=a?delete h[i]:h[i]=null,k?(h[i]={},g||(h[i].toJSON=f.noop),h[i][e]=k):g&&(f.support.deleteExpando?delete b[f.expando]:b.removeAttribute?b.removeAttribute(f.expando):b[f.expando]=null)}},_data:function(a,b,c){return f.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=f.noData[a.nodeName.toLowerCase()];if(b)return b!==!0&&a.getAttribute("classid")===b}return!0}}),f.fn.extend({data:function(a,c){var d=null;if(typeof a=="undefined"){if(this.length){d=f.data(this[0]);if(this[0].nodeType===1){var e=this[0].attributes,g;for(var h=0,i=e.length;h<i;h++)g=e[h].name,g.indexOf("data-")===0&&(g=f.camelCase(g.substring(5)),k(this[0],g,d[g]))}}return d}if(typeof a=="object")return this.each(function(){f.data(this,a)});var j=a.split(".");j[1]=j[1]?"."+j[1]:"";if(c===b){d=this.triggerHandler("getData"+j[1]+"!",[j[0]]),d===b&&this.length&&(d=f.data(this[0],a),d=k(this[0],a,d));return d===b&&j[1]?this.data(j[0]):d}return this.each(function(){var b=f(this),d=[j[0],c];b.triggerHandler("setData"+j[1]+"!",d),f.data(this,a,c),b.triggerHandler("changeData"+j[1]+"!",d)})},removeData:function(a){return this.each(function(){f.removeData(this,a)})}}),f.extend({_mark:function(a,c){a&&(c=(c||"fx")+"mark",f.data(a,c,(f.data(a,c,b,!0)||0)+1,!0))},_unmark:function(a,c,d){a!==!0&&(d=c,c=a,a=!1);if(c){d=d||"fx";var e=d+"mark",g=a?0:(f.data(c,e,b,!0)||1)-1;g?f.data(c,e,g,!0):(f.removeData(c,e,!0),m(c,d,"mark"))}},queue:function(a,c,d){if(a){c=(c||"fx")+"queue";var e=f.data(a,c,b,!0);d&&(!e||f.isArray(d)?e=f.data(a,c,f.makeArray(d),!0):e.push(d));return e||[]}},dequeue:function(a,b){b=b||"fx";var c=f.queue(a,b),d=c.shift(),e;d==="inprogress"&&(d=c.shift()),d&&(b==="fx"&&c.unshift("inprogress"),d.call(a,function(){f.dequeue(a,b)})),c.length||(f.removeData(a,b+"queue",!0),m(a,b,"queue"))}}),f.fn.extend({queue:function(a,c){typeof a!="string"&&(c=a,a="fx");if(c===b)return f.queue(this[0],a);return this.each(function(){var b=f.queue(this,a,c);a==="fx"&&b[0]!=="inprogress"&&f.dequeue(this,a)})},dequeue:function(a){return this.each(function(){f.dequeue(this,a)})},delay:function(a,b){a=f.fx?f.fx.speeds[a]||a:a,b=b||"fx";return this.queue(b,function(){var c=this;setTimeout(function(){f.dequeue(c,b)},a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){function m(){--h||d.resolveWith(e,[e])}typeof a!="string"&&(c=a,a=b),a=a||"fx";var d=f.Deferred(),e=this,g=e.length,h=1,i=a+"defer",j=a+"queue",k=a+"mark",l;while(g--)if(l=f.data(e[g],i,b,!0)||(f.data(e[g],j,b,!0)||f.data(e[g],k,b,!0))&&f.data(e[g],i,f._Deferred(),!0))h++,l.done(m);m();return d.promise()}});var n=/[\n\t\r]/g,o=/\s+/,p=/\r/g,q=/^(?:button|input)$/i,r=/^(?:button|input|object|select|textarea)$/i,s=/^a(?:rea)?$/i,t=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,u=/\:|^on/,v,w;f.fn.extend({attr:function(a,b){return f.access(this,a,b,!0,f.attr)},removeAttr:function(a){return this.each(function(){f.removeAttr(this,a)})},prop:function(a,b){return f.access(this,a,b,!0,f.prop)},removeProp:function(a){a=f.propFix[a]||a;return this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,g,h,i;if(f.isFunction(a))return this.each(function(b){f(this).addClass(a.call(this,b,this.className))});if(a&&typeof a=="string"){b=a.split(o);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1)if(!e.className&&b.length===1)e.className=a;else{g=" "+e.className+" ";for(h=0,i=b.length;h<i;h++)~g.indexOf(" "+b[h]+" ")||(g+=b[h]+" ");e.className=f.trim(g)}}}return this},removeClass:function(a){var c,d,e,g,h,i,j;if(f.isFunction(a))return this.each(function(b){f(this).removeClass(a.call(this,b,this.className))});if(a&&typeof a=="string"||a===b){c=(a||"").split(o);for(d=0,e=this.length;d<e;d++){g=this[d];if(g.nodeType===1&&g.className)if(a){h=(" "+g.className+" ").replace(n," ");for(i=0,j=c.length;i<j;i++)h=h.replace(" "+c[i]+" "," ");g.className=f.trim(h)}else g.className=""}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";if(f.isFunction(a))return this.each(function(c){f(this).toggleClass(a.call(this,c,this.className,b),b)});return this.each(function(){if(c==="string"){var e,g=0,h=f(this),i=b,j=a.split(o);while(e=j[g++])i=d?i:!h.hasClass(e),h[i?"addClass":"removeClass"](e)}else if(c==="undefined"||c==="boolean")this.className&&f._data(this,"__className__",this.className),this.className=this.className||a===!1?"":f._data(this,"__className__")||""})},hasClass:function(a){var b=" "+a+" ";for(var c=0,d=this.length;c<d;c++)if((" "+this[c].className+" ").replace(n," ").indexOf(b)>-1)return!0;return!1},val:function(a){var c,d,e=this[0];if(!arguments.length){if(e){c=f.valHooks[e.nodeName.toLowerCase()]||f.valHooks[e.type];if(c&&"get"in c&&(d=c.get(e,"value"))!==b)return d;d=e.value;return typeof d=="string"?d.replace(p,""):d==null?"":d}return b}var g=f.isFunction(a);return this.each(function(d){var e=f(this),h;if(this.nodeType===1){g?h=a.call(this,d,e.val()):h=a,h==null?h="":typeof h=="number"?h+="":f.isArray(h)&&(h=f.map(h,function(a){return a==null?"":a+""})),c=f.valHooks[this.nodeName.toLowerCase()]||f.valHooks[this.type];if(!c||!("set"in c)||c.set(this,h,"value")===b)this.value=h}})}}),f.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c=a.selectedIndex,d=[],e=a.options,g=a.type==="select-one";if(c<0)return null;for(var h=g?c:0,i=g?c+1:e.length;h<i;h++){var j=e[h];if(j.selected&&(f.support.optDisabled?!j.disabled:j.getAttribute("disabled")===null)&&(!j.parentNode.disabled||!f.nodeName(j.parentNode,"optgroup"))){b=f(j).val();if(g)return b;d.push(b)}}if(g&&!d.length&&e.length)return f(e[c]).val();return d},set:function(a,b){var c=f.makeArray(b);f(a).find("option").each(function(){this.selected=f.inArray(f(this).val(),c)>=0}),c.length||(a.selectedIndex=-1);return c}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attrFix:{tabindex:"tabIndex"},attr:function(a,c,d,e){var g=a.nodeType;if(!a||g===3||g===8||g===2)return b;if(e&&c in f.attrFn)return f(a)[c](d);if(!("getAttribute"in a))return f.prop(a,c,d);var h,i,j=g!==1||!f.isXMLDoc(a);j&&(c=f.attrFix[c]||c,i=f.attrHooks[c],i||(t.test(c)?i=w:v&&c!=="className"&&(f.nodeName(a,"form")||u.test(c))&&(i=v)));if(d!==b){if(d===null){f.removeAttr(a,c);return b}if(i&&"set"in i&&j&&(h=i.set(a,d,c))!==b)return h;a.setAttribute(c,""+d);return d}if(i&&"get"in i&&j&&(h=i.get(a,c))!==null)return h;h=a.getAttribute(c);return h===null?b:h},removeAttr:function(a,b){var c;a.nodeType===1&&(b=f.attrFix[b]||b,f.support.getSetAttribute?a.removeAttribute(b):(f.attr(a,b,""),a.removeAttributeNode(a.getAttributeNode(b))),t.test(b)&&(c=f.propFix[b]||b)in a&&(a[c]=!1))},attrHooks:{type:{set:function(a,b){if(q.test(a.nodeName)&&a.parentNode)f.error("type property can't be changed");else if(!f.support.radioValue&&b==="radio"&&f.nodeName(a,"input")){var c=a.value;a.setAttribute("type",b),c&&(a.value=c);return b}}},tabIndex:{get:function(a){var c=a.getAttributeNode("tabIndex");return c&&c.specified?parseInt(c.value,10):r.test(a.nodeName)||s.test(a.nodeName)&&a.href?0:b}},value:{get:function(a,b){if(v&&f.nodeName(a,"button"))return v.get(a,b);return b in a?a.value:null},set:function(a,b,c){if(v&&f.nodeName(a,"button"))return v.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e=a.nodeType;if(!a||e===3||e===8||e===2)return b;var g,h,i=e!==1||!f.isXMLDoc(a);i&&(c=f.propFix[c]||c,h=f.propHooks[c]);return d!==b?h&&"set"in h&&(g=h.set(a,d,c))!==b?g:a[c]=d:h&&"get"in h&&(g=h.get(a,c))!==b?g:a[c]},propHooks:{}}),w={get:function(a,c){return f.prop(a,c)?c.toLowerCase():b},set:function(a,b,c){var d;b===!1?f.removeAttr(a,c):(d=f.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase()));return c}},f.support.getSetAttribute||(f.attrFix=f.propFix,v=f.attrHooks.name=f.attrHooks.title=f.valHooks.button={get:function(a,c){var d;d=a.getAttributeNode(c);return d&&d.nodeValue!==""?d.nodeValue:b},set:function(a,b,c){var d=a.getAttributeNode(c);if(d){d.nodeValue=b;return b}}},f.each(["width","height"],function(a,b){f.attrHooks[b]=f.extend(f.attrHooks[b],{set:function(a,c){if(c===""){a.setAttribute(b,"auto");return c}}})})),f.support.hrefNormalized||f.each(["href","src","width","height"],function(a,c){f.attrHooks[c]=f.extend(f.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),f.support.style||(f.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=""+b}}),f.support.optSelected||(f.propHooks.selected=f.extend(f.propHooks.selected,{get:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex)}})),f.support.checkOn||f.each(["radio","checkbox"],function(){f.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),f.each(["radio","checkbox"],function(){f.valHooks[this]=f.extend(f.valHooks[this],{set:function(a,b){if(f.isArray(b))return a.checked=f.inArray(f(a).val(),b)>=0}})});var x=/\.(.*)$/,y=/^(?:textarea|input|select)$/i,z=/\./g,A=/ /g,B=/[^\w\s.|`]/g,C=function(a){return a.replace(B,"\\$&")};f.event={add:function(a,c,d,e){if(a.nodeType!==3&&a.nodeType!==8){if(d===!1)d=D;else if(!d)return;var g,h;d.handler&&(g=d,d=g.handler),d.guid||(d.guid=f.guid++);var i=f._data(a);if(!i)return;var j=i.events,k=i.handle;j||(i.events=j={}),k||(i.handle=k=function(a){return typeof f!="undefined"&&(!a||f.event.triggered!==a.type)?f.event.handle.apply(k.elem,arguments):b}),k.elem=a,c=c.split(" ");var l,m=0,n;while(l=c[m++]){h=g?f.extend({},g):{handler:d,data:e},l.indexOf(".")>-1?(n=l.split("."),l=n.shift(),h.namespace=n.slice(0).sort().join(".")):(n=[],h.namespace=""),h.type=l,h.guid||(h.guid=d.guid);var o=j[l],p=f.event.special[l]||{};if(!o){o=j[l]=[];if(!p.setup||p.setup.call(a,e,n,k)===!1)a.addEventListener?a.addEventListener(l,k,!1):a.attachEvent&&a.attachEvent("on"+l,k)}p.add&&(p.add.call(a,h),h.handler.guid||(h.handler.guid=d.guid)),o.push(h),f.event.global[l]=!0}a=null}},global:{},remove:function(a,c,d,e){if(a.nodeType!==3&&a.nodeType!==8){d===!1&&(d=D);var g,h,i,j,k=0,l,m,n,o,p,q,r,s=f.hasData(a)&&f._data(a),t=s&&s.events;if(!s||!t)return;c&&c.type&&(d=c.handler,c=c.type);if(!c||typeof c=="string"&&c.charAt(0)==="."){c=c||"";for(h in t)f.event.remove(a,h+c);return}c=c.split(" ");while(h=c[k++]){r=h,q=null,l=h.indexOf(".")<0,m=[],l||(m=h.split("."),h=m.shift(),n=new RegExp("(^|\\.)"+f.map(m.slice(0).sort(),C).join("\\.(?:.*\\.)?")+"(\\.|$)")),p=t[h];if(!p)continue;if(!d){for(j=0;j<p.length;j++){q=p[j];if(l||n.test(q.namespace))f.event.remove(a,r,q.handler,j),p.splice(j--,1)}continue}o=f.event.special[h]||{};for(j=e||0;j<p.length;j++){q=p[j];if(d.guid===q.guid){if(l||n.test(q.namespace))e==null&&p.splice(j--,1),o.remove&&o.remove.call(a,q);if(e!=null)break}}if(p.length===0||e!=null&&p.length===1)(!o.teardown||o.teardown.call(a,m)===!1)&&f.removeEvent(a,h,s.handle),g=null,delete t[h]}if(f.isEmptyObject(t)){var u=s.handle;u&&(u.elem=null),delete s.events,delete s.handle,f.isEmptyObject(s)&&f.removeData(a,b,!0)}}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,g){var h=c.type||c,i=[],j;h.indexOf("!")>=0&&(h=h.slice(0,-1),j=!0),h.indexOf(".")>=0&&(i=h.split("."),h=i.
shift(),i.sort());if(!!e&&!f.event.customEvent[h]||!!f.event.global[h]){c=typeof c=="object"?c[f.expando]?c:new f.Event(h,c):new f.Event(h),c.type=h,c.exclusive=j,c.namespace=i.join("."),c.namespace_re=new RegExp("(^|\\.)"+i.join("\\.(?:.*\\.)?")+"(\\.|$)");if(g||!e)c.preventDefault(),c.stopPropagation();if(!e){f.each(f.cache,function(){var a=f.expando,b=this[a];b&&b.events&&b.events[h]&&f.event.trigger(c,d,b.handle.elem)});return}if(e.nodeType===3||e.nodeType===8)return;c.result=b,c.target=e,d=d!=null?f.makeArray(d):[],d.unshift(c);var k=e,l=h.indexOf(":")<0?"on"+h:"";do{var m=f._data(k,"handle");c.currentTarget=k,m&&m.apply(k,d),l&&f.acceptData(k)&&k[l]&&k[l].apply(k,d)===!1&&(c.result=!1,c.preventDefault()),k=k.parentNode||k.ownerDocument||k===c.target.ownerDocument&&a}while(k&&!c.isPropagationStopped());if(!c.isDefaultPrevented()){var n,o=f.event.special[h]||{};if((!o._default||o._default.call(e.ownerDocument,c)===!1)&&(h!=="click"||!f.nodeName(e,"a"))&&f.acceptData(e)){try{l&&e[h]&&(n=e[l],n&&(e[l]=null),f.event.triggered=h,e[h]())}catch(p){}n&&(e[l]=n),f.event.triggered=b}}return c.result}},handle:function(c){c=f.event.fix(c||a.event);var d=((f._data(this,"events")||{})[c.type]||[]).slice(0),e=!c.exclusive&&!c.namespace,g=Array.prototype.slice.call(arguments,0);g[0]=c,c.currentTarget=this;for(var h=0,i=d.length;h<i;h++){var j=d[h];if(e||c.namespace_re.test(j.namespace)){c.handler=j.handler,c.data=j.data,c.handleObj=j;var k=j.handler.apply(this,g);k!==b&&(c.result=k,k===!1&&(c.preventDefault(),c.stopPropagation()));if(c.isImmediatePropagationStopped())break}}return c.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(a){if(a[f.expando])return a;var d=a;a=f.Event(d);for(var e=this.props.length,g;e;)g=this.props[--e],a[g]=d[g];a.target||(a.target=a.srcElement||c),a.target.nodeType===3&&(a.target=a.target.parentNode),!a.relatedTarget&&a.fromElement&&(a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement);if(a.pageX==null&&a.clientX!=null){var h=a.target.ownerDocument||c,i=h.documentElement,j=h.body;a.pageX=a.clientX+(i&&i.scrollLeft||j&&j.scrollLeft||0)-(i&&i.clientLeft||j&&j.clientLeft||0),a.pageY=a.clientY+(i&&i.scrollTop||j&&j.scrollTop||0)-(i&&i.clientTop||j&&j.clientTop||0)}a.which==null&&(a.charCode!=null||a.keyCode!=null)&&(a.which=a.charCode!=null?a.charCode:a.keyCode),!a.metaKey&&a.ctrlKey&&(a.metaKey=a.ctrlKey),!a.which&&a.button!==b&&(a.which=a.button&1?1:a.button&2?3:a.button&4?2:0);return a},guid:1e8,proxy:f.proxy,special:{ready:{setup:f.bindReady,teardown:f.noop},live:{add:function(a){f.event.add(this,N(a.origType,a.selector),f.extend({},a,{handler:M,guid:a.handler.guid}))},remove:function(a){f.event.remove(this,N(a.origType,a.selector),a)}},beforeunload:{setup:function(a,b,c){f.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}}},f.removeEvent=c.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)},f.Event=function(a,b){if(!this.preventDefault)return new f.Event(a,b);a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?E:D):this.type=a,b&&f.extend(this,b),this.timeStamp=f.now(),this[f.expando]=!0},f.Event.prototype={preventDefault:function(){this.isDefaultPrevented=E;var a=this.originalEvent;!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=E;var a=this.originalEvent;!a||(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=E,this.stopPropagation()},isDefaultPrevented:D,isPropagationStopped:D,isImmediatePropagationStopped:D};var F=function(a){var b=a.relatedTarget,c=!1,d=a.type;a.type=a.data,b!==this&&(b&&(c=f.contains(this,b)),c||(f.event.handle.apply(this,arguments),a.type=d))},G=function(a){a.type=a.data,f.event.handle.apply(this,arguments)};f.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){f.event.special[a]={setup:function(c){f.event.add(this,b,c&&c.selector?G:F,a)},teardown:function(a){f.event.remove(this,b,a&&a.selector?G:F)}}}),f.support.submitBubbles||(f.event.special.submit={setup:function(a,b){if(!f.nodeName(this,"form"))f.event.add(this,"click.specialSubmit",function(a){var b=a.target,c=b.type;(c==="submit"||c==="image")&&f(b).closest("form").length&&K("submit",this,arguments)}),f.event.add(this,"keypress.specialSubmit",function(a){var b=a.target,c=b.type;(c==="text"||c==="password")&&f(b).closest("form").length&&a.keyCode===13&&K("submit",this,arguments)});else return!1},teardown:function(a){f.event.remove(this,".specialSubmit")}});if(!f.support.changeBubbles){var H,I=function(a){var b=a.type,c=a.value;b==="radio"||b==="checkbox"?c=a.checked:b==="select-multiple"?c=a.selectedIndex>-1?f.map(a.options,function(a){return a.selected}).join("-"):"":f.nodeName(a,"select")&&(c=a.selectedIndex);return c},J=function(c){var d=c.target,e,g;if(!!y.test(d.nodeName)&&!d.readOnly){e=f._data(d,"_change_data"),g=I(d),(c.type!=="focusout"||d.type!=="radio")&&f._data(d,"_change_data",g);if(e===b||g===e)return;if(e!=null||g)c.type="change",c.liveFired=b,f.event.trigger(c,arguments[1],d)}};f.event.special.change={filters:{focusout:J,beforedeactivate:J,click:function(a){var b=a.target,c=f.nodeName(b,"input")?b.type:"";(c==="radio"||c==="checkbox"||f.nodeName(b,"select"))&&J.call(this,a)},keydown:function(a){var b=a.target,c=f.nodeName(b,"input")?b.type:"";(a.keyCode===13&&!f.nodeName(b,"textarea")||a.keyCode===32&&(c==="checkbox"||c==="radio")||c==="select-multiple")&&J.call(this,a)},beforeactivate:function(a){var b=a.target;f._data(b,"_change_data",I(b))}},setup:function(a,b){if(this.type==="file")return!1;for(var c in H)f.event.add(this,c+".specialChange",H[c]);return y.test(this.nodeName)},teardown:function(a){f.event.remove(this,".specialChange");return y.test(this.nodeName)}},H=f.event.special.change.filters,H.focus=H.beforeactivate}f.support.focusinBubbles||f.each({focus:"focusin",blur:"focusout"},function(a,b){function e(a){var c=f.event.fix(a);c.type=b,c.originalEvent={},f.event.trigger(c,null,c.target),c.isDefaultPrevented()&&a.preventDefault()}var d=0;f.event.special[b]={setup:function(){d++===0&&c.addEventListener(a,e,!0)},teardown:function(){--d===0&&c.removeEventListener(a,e,!0)}}}),f.each(["bind","one"],function(a,c){f.fn[c]=function(a,d,e){var g;if(typeof a=="object"){for(var h in a)this[c](h,d,a[h],e);return this}if(arguments.length===2||d===!1)e=d,d=b;c==="one"?(g=function(a){f(this).unbind(a,g);return e.apply(this,arguments)},g.guid=e.guid||f.guid++):g=e;if(a==="unload"&&c!=="one")this.one(a,d,e);else for(var i=0,j=this.length;i<j;i++)f.event.add(this[i],a,g,d);return this}}),f.fn.extend({unbind:function(a,b){if(typeof a=="object"&&!a.preventDefault)for(var c in a)this.unbind(c,a[c]);else for(var d=0,e=this.length;d<e;d++)f.event.remove(this[d],a,b);return this},delegate:function(a,b,c,d){return this.live(b,c,d,a)},undelegate:function(a,b,c){return arguments.length===0?this.unbind("live"):this.die(b,null,c,a)},trigger:function(a,b){return this.each(function(){f.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return f.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||f.guid++,d=0,e=function(c){var e=(f.data(this,"lastToggle"+a.guid)||0)%d;f.data(this,"lastToggle"+a.guid,e+1),c.preventDefault();return b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});var L={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};f.each(["live","die"],function(a,c){f.fn[c]=function(a,d,e,g){var h,i=0,j,k,l,m=g||this.selector,n=g?this:f(this.context);if(typeof a=="object"&&!a.preventDefault){for(var o in a)n[c](o,d,a[o],m);return this}if(c==="die"&&!a&&g&&g.charAt(0)==="."){n.unbind(g);return this}if(d===!1||f.isFunction(d))e=d||D,d=b;a=(a||"").split(" ");while((h=a[i++])!=null){j=x.exec(h),k="",j&&(k=j[0],h=h.replace(x,""));if(h==="hover"){a.push("mouseenter"+k,"mouseleave"+k);continue}l=h,L[h]?(a.push(L[h]+k),h=h+k):h=(L[h]||h)+k;if(c==="live")for(var p=0,q=n.length;p<q;p++)f.event.add(n[p],"live."+N(h,m),{data:d,selector:m,handler:e,origType:h,origHandler:e,preType:l});else n.unbind("live."+N(h,m),e)}return this}}),f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error".split(" "),function(a,b){f.fn[b]=function(a,c){c==null&&(c=a,a=null);return arguments.length>0?this.bind(b,a,c):this.trigger(b)},f.attrFn&&(f.attrFn[b]=!0)}),function(){function u(a,b,c,d,e,f){for(var g=0,h=d.length;g<h;g++){var i=d[g];if(i){var j=!1;i=i[a];while(i){if(i.sizcache===c){j=d[i.sizset];break}if(i.nodeType===1){f||(i.sizcache=c,i.sizset=g);if(typeof b!="string"){if(i===b){j=!0;break}}else if(k.filter(b,[i]).length>0){j=i;break}}i=i[a]}d[g]=j}}}function t(a,b,c,d,e,f){for(var g=0,h=d.length;g<h;g++){var i=d[g];if(i){var j=!1;i=i[a];while(i){if(i.sizcache===c){j=d[i.sizset];break}i.nodeType===1&&!f&&(i.sizcache=c,i.sizset=g);if(i.nodeName.toLowerCase()===b){j=i;break}i=i[a]}d[g]=j}}}var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,d=0,e=Object.prototype.toString,g=!1,h=!0,i=/\\/g,j=/\W/;[0,0].sort(function(){h=!1;return 0});var k=function(b,d,f,g){f=f||[],d=d||c;var h=d;if(d.nodeType!==1&&d.nodeType!==9)return[];if(!b||typeof b!="string")return f;var i,j,n,o,q,r,s,t,u=!0,w=k.isXML(d),x=[],y=b;do{a.exec(""),i=a.exec(y);if(i){y=i[3],x.push(i[1]);if(i[2]){o=i[3];break}}}while(i);if(x.length>1&&m.exec(b))if(x.length===2&&l.relative[x[0]])j=v(x[0]+x[1],d);else{j=l.relative[x[0]]?[d]:k(x.shift(),d);while(x.length)b=x.shift(),l.relative[b]&&(b+=x.shift()),j=v(b,j)}else{!g&&x.length>1&&d.nodeType===9&&!w&&l.match.ID.test(x[0])&&!l.match.ID.test(x[x.length-1])&&(q=k.find(x.shift(),d,w),d=q.expr?k.filter(q.expr,q.set)[0]:q.set[0]);if(d){q=g?{expr:x.pop(),set:p(g)}:k.find(x.pop(),x.length===1&&(x[0]==="~"||x[0]==="+")&&d.parentNode?d.parentNode:d,w),j=q.expr?k.filter(q.expr,q.set):q.set,x.length>0?n=p(j):u=!1;while(x.length)r=x.pop(),s=r,l.relative[r]?s=x.pop():r="",s==null&&(s=d),l.relative[r](n,s,w)}else n=x=[]}n||(n=j),n||k.error(r||b);if(e.call(n)==="[object Array]")if(!u)f.push.apply(f,n);else if(d&&d.nodeType===1)for(t=0;n[t]!=null;t++)n[t]&&(n[t]===!0||n[t].nodeType===1&&k.contains(d,n[t]))&&f.push(j[t]);else for(t=0;n[t]!=null;t++)n[t]&&n[t].nodeType===1&&f.push(j[t]);else p(n,f);o&&(k(o,h,f,g),k.uniqueSort(f));return f};k.uniqueSort=function(a){if(r){g=h,a.sort(r);if(g)for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1)}return a},k.matches=function(a,b){return k(a,null,null,b)},k.matchesSelector=function(a,b){return k(b,null,null,[a]).length>0},k.find=function(a,b,c){var d;if(!a)return[];for(var e=0,f=l.order.length;e<f;e++){var g,h=l.order[e];if(g=l.leftMatch[h].exec(a)){var j=g[1];g.splice(1,1);if(j.substr(j.length-1)!=="\\"){g[1]=(g[1]||"").replace(i,""),d=l.find[h](g,b,c);if(d!=null){a=a.replace(l.match[h],"");break}}}}d||(d=typeof b.getElementsByTagName!="undefined"?b.getElementsByTagName("*"):[]);return{set:d,expr:a}},k.filter=function(a,c,d,e){var f,g,h=a,i=[],j=c,m=c&&c[0]&&k.isXML(c[0]);while(a&&c.length){for(var n in l.filter)if((f=l.leftMatch[n].exec(a))!=null&&f[2]){var o,p,q=l.filter[n],r=f[1];g=!1,f.splice(1,1);if(r.substr(r.length-1)==="\\")continue;j===i&&(i=[]);if(l.preFilter[n]){f=l.preFilter[n](f,j,d,i,e,m);if(!f)g=o=!0;else if(f===!0)continue}if(f)for(var s=0;(p=j[s])!=null;s++)if(p){o=q(p,f,s,j);var t=e^!!o;d&&o!=null?t?g=!0:j[s]=!1:t&&(i.push(p),g=!0)}if(o!==b){d||(j=i),a=a.replace(l.match[n],"");if(!g)return[];break}}if(a===h)if(g==null)k.error(a);else break;h=a}return j},k.error=function(a){throw"Syntax error, unrecognized expression: "+a};var l=k.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!j.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++)if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1);a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}e&&k.filter(b,a,!0)},">":function(a,b){var c,d=typeof b=="string",e=0,f=a.length;if(d&&!j.test(b)){b=b.toLowerCase();for(;e<f;e++){c=a[e];if(c){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++)c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b);d&&k.filter(b,a,!0)}},"":function(a,b,c){var e,f=d++,g=u;typeof b=="string"&&!j.test(b)&&(b=b.toLowerCase(),e=b,g=t),g("parentNode",b,f,a,e,c)},"~":function(a,b,c){var e,f=d++,g=u;typeof b=="string"&&!j.test(b)&&(b=b.toLowerCase(),e=b,g=t),g("previousSibling",b,f,a,e,c)}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return c.length===0?null:c}},TAG:function(a,b){if(typeof b.getElementsByTagName!="undefined")return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(i,"")+" ";if(f)return a;for(var g=0,h;(h=b[g])!=null;g++)h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1));return!1},ID:function(a){return a[1].replace(i,"")},TAG:function(a,b){return a[1].replace(i,"").toLowerCase()},CHILD:function(a){if(a[1]==="nth"){a[2]||k.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0}else a[2]&&k.error(a[0]);a[0]=d++;return a},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(i,"");!f&&l.attrMap[g]&&(a[1]=l.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(i,""),a[2]==="~="&&(a[4]=" "+a[4]+" ");return a},PSEUDO:function(b,c,d,e,f){if(b[1]==="not")if((a.exec(b[3])||"").length>1||/^\w/.test(b[3]))b[3]=k(b[3],null,null,c);else{var g=k.filter(b[3],c,d,!0^f);d||e.push.apply(e,g);return!1}else if(l.match.POS.test(b[0])||l.match.CHILD.test(b[0]))return!0;return b},POS:function(a){a.unshift(!0);return a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){a.parentNode&&a.parentNode.selectedIndex;return a.selected===!0},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!k(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return a.nodeName.toLowerCase()==="input"&&"text"===c&&(b===c||b===null)},radio:function(a){return a.nodeName.toLowerCase()==="input"&&"radio"===a.type},checkbox:function(a){return a.nodeName.toLowerCase()==="input"&&"checkbox"===a.type},file:function(a){return a.nodeName.toLowerCase()==="input"&&"file"===a.type},password:function(a){return a.nodeName.toLowerCase()==="input"&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"submit"===a.type},image:function(a){return a.nodeName.toLowerCase()==="input"&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&"button"===a.type||b==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=l.filters[e];if(f)return f(a,c,b,d);if(e==="contains")return(a.textContent||a.innerText||k.getText([a])||"").indexOf(b[3])>=0;if(e==="not"){var g=b[3];for(var h=0,i=g.length;h<i;h++)if(g[h]===a)return!1;return!0}k.error(e)},CHILD:function(a,b){var c=b[1],d=a;switch(c){case"only":case"first":while(d=d.previousSibling)if(d.nodeType===1)return!1;if(c==="first")return!0;d=a;case"last":while(d=d.nextSibling)if(d.nodeType===1)return!1;return!0;case"nth":var e=b[2],f=b[3];if(e===1&&f===0)return!0;var g=b[0],h=a.parentNode;if(h&&(h.sizcache!==g||!a.nodeIndex)){var i=0;for(d=h.firstChild;d;d=d.nextSibling)d.nodeType===1&&(d.nodeIndex=++i);h.sizcache=g}var j=a.nodeIndex-f;return e===0?j===0:j%e===0&&j/e>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=l.attrHandle[c]?l.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=l.setFilters[e];if(f)return f(a,c,b,d)}}},m=l.match.POS,n=function(a,b){return"\\"+(b-0+1)};for(var o in l.match)l.match[o]=new RegExp(l.match[o].source+/(?![^\[]*\])(?![^\(]*\))/.source),l.leftMatch[o]=new RegExp(/(^(?:.|\r|\n)*?)/.source+l.match[o].source.replace(/\\(\d+)/g,n));var p=function(a,b){a=Array.prototype.slice.call(a,0);if(b){b.push.apply(b,a);return b}return a};try{Array.prototype.slice.call(c.documentElement.childNodes,0)[0].nodeType}catch(q){p=function(a,b){var c=0,d=b||[];if(e.call(a)==="[object Array]")Array.prototype.push.apply(d,a);else if(typeof a.length=="number")for(var f=a.length;c<f;c++)d.push(a[c]);else for(;a[c];c++)d.push(a[c]);return d}}var r,s;c.documentElement.compareDocumentPosition?r=function(a,b){if(a===b){g=!0;return 0}if(!a.compareDocumentPosition||!b.compareDocumentPosition)return a.compareDocumentPosition?-1:1;return a.compareDocumentPosition(b)&4?-1:1}:(r=function(a,b){if(a===b){g=!0;return 0}if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],h=a.parentNode,i=b.parentNode,j=h;if(h===i)return s(a,b);if(!h)return-1;if(!i)return 1;while(j)e.unshift(j),j=j.parentNode;j=i;while(j)f.unshift(j),j=j.parentNode;c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++)if(e[k]!==f[k])return s(e[k],f[k]);return k===c?s(a,f[k],-1):s(e[k],b,1)},s=function(a,b,c){if(a===b)return c;var d=a.nextSibling;while(d){if(d===b)return-1;d=d.nextSibling}return 1}),k.getText=function(a){var b="",c;for(var d=0;a[d];d++)c=a[d],c.nodeType===3||c.nodeType===4?b+=c.nodeValue:c.nodeType!==8&&(b+=k.getText(c.childNodes));return b},function(){var a=c.createElement("div"),d="script"+(new Date).getTime(),e=c.documentElement;a.innerHTML="<a name='"+d+"'/>",e.insertBefore(a,e.firstChild),c.getElementById(d)&&(l.find.ID=function(a,c,d){if(typeof c.getElementById!="undefined"&&!d){var e=c.getElementById(a[1]);return e?e.id===a[1]||typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id").nodeValue===a[1]?[e]:b:[]}},l.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}),e.removeChild(a),e=a=null}(),function(){var a=c.createElement("div");a.appendChild(c.createComment("")),a.getElementsByTagName("*").length>0&&(l.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++)c[e].nodeType===1&&d.push(c[e]);c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(l.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),c.querySelectorAll&&function(){var a=k,b=c.createElement("div"),d="__sizzle__";b.innerHTML="<p class='TEST'></p>";if(!b.querySelectorAll||b.querySelectorAll(".TEST").length!==0){k=function(b,e,f,g){e=e||c;if(!g&&!k.isXML(e)){var h=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(h&&(e.nodeType===1||e.nodeType===9)){if(h[1])return p(e.getElementsByTagName(b),f);if(h[2]&&l.find.CLASS&&e.getElementsByClassName)return p(e.getElementsByClassName(h[2]),f)}if(e.nodeType===9){if(b==="body"&&e.body)return p([e.body],f);if(h&&h[3]){var i=e.getElementById(h[3]);if(!i||!i.parentNode)return p([],f);if(i.id===h[3])return p([i],f)}try{return p(e.querySelectorAll(b),f)}catch(j){}}else if(e.nodeType===1&&e.nodeName.toLowerCase()!=="object"){var m=e,n=e.getAttribute("id"),o=n||d,q=e.parentNode,r=/^\s*[+~]/.test(b);n?o=o.replace(/'/g,"\\$&"):e.setAttribute("id",o),r&&q&&(e=e.parentNode);try{if(!r||q)return p(e.querySelectorAll("[id='"+o+"'] "+b),f)}catch(s){}finally{n||m.removeAttribute("id")}}}return a(b,e,f,g)};for(var e in a)k[e]=a[e];b=null}}(),function(){var a=c.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var d=!b.call(c.createElement("div"),"div"),e=!1;try{b.call(c.documentElement,"[test!='']:sizzle")}catch(f){e=!0}k.matchesSelector=function(a,c){c=c.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!k.isXML(a))try{if(e||!l.match.PSEUDO.test(c)&&!/!=/.test(c)){var f=b.call(a,c);if(f||!d||a.document&&a.document.nodeType!==11)return f}}catch(g){}return k(c,null,null,[a]).length>0}}}(),function(){var a=c.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(!!a.getElementsByClassName&&a.getElementsByClassName("e").length!==0){a.lastChild.className="e";if(a.getElementsByClassName("e").length===1)return;l.order.splice(1,0,"CLASS"),l.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c)return b.getElementsByClassName(a[1])},a=null}}(),c.documentElement.contains?k.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:c.documentElement.compareDocumentPosition?k.contains=function(a,b){return!!(a.compareDocumentPosition(b)&16)}:k.contains=function(){return!1},k.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var v=function(a,b){var c,d=[],e="",f=b.nodeType?[b]:b;while(c=l.match.PSEUDO.exec(a))e+=c[0],a=a.replace(l.match.PSEUDO,"");a=l.relative[a]?a+"*":a;for(var g=0,h=f.length;g<h;g++)k(a,f[g],d);return k.filter(e,d)};f.find=k,f.expr=k.selectors,f.expr[":"]=f.expr.filters,f.unique=k.uniqueSort,f.text=k.getText,f.isXMLDoc=k.isXML,f.contains=k.contains}();var O=/Until$/,P=/^(?:parents|prevUntil|prevAll)/,Q=/,/,R=/^.[^:#\[\.,]*$/,S=Array.prototype.slice,T=f.expr.match.POS,U={children:!0,contents:!0,next:!0,prev:!0};f.fn.extend({find:function(a){var b=this,c,d;if(typeof a!="string")return f(a).filter(function(){for(c=0,d=b.length;c<d;c++)if(f.contains(b[c],this))return!0});var e=this.pushStack("","find",a),g,h,i;for(c=0,d=this.length;c<d;c++){g=e.length,f.find(a,this[c],e);if(c>0)for(h=g;h<e.length;h++)for(i=0;i<g;i++)if(e[i]===e[h]){e.splice(h--,1);break}}return e},has:function(a){var b=f(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++)if(f.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(W(this,a,!1),"not",a)},filter:function(a){return this.pushStack(W(this,a,!0),"filter",a)},is:function(a){return!!a&&(typeof a=="string"?f.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c=[],d,e,g=this[0];if(f.isArray(a)){var h,i,j={},k=1;if(g&&a.length){for(d=0,e=a.length;d<e;d++)i=a[d],j[i]||(j[i]=T.test(i)?f(i,b||this.context):i);while(g&&g.ownerDocument&&g!==b){for(i in j)h=j[i],(h.jquery?h.index(g)>-1:f(g).is(h))&&c.push({selector:i,elem:g,level:k});g=g.parentNode,k++}}return c}var l=T.test(a)||typeof a!="string"?f(a,b||this.context):0;for(d=0,e=this.length;d<e;d++){g=this[d];while(g){if(l?l.index(g)>-1:f.find.matchesSelector(g,a)){c.push(g);break}g=g.parentNode;if(!g||!g.ownerDocument||g===b||g.nodeType===11)break}}c=c.length>1?f.unique(c):c;return this.pushStack(c,"closest",a)},index:function(a){if(!a||typeof a=="string")return f.inArray(this[0],a?f(a):this.parent().children());return f.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var c=typeof a=="string"?f(a,b):f.makeArray(a&&a.nodeType?[a]:a),d=f.merge(this.get(),c);return this.pushStack(V(c[0])||V(d[0])?d:f.unique(d))},andSelf:function(){return this.add(this.prevObject)}}),f.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return f.dir(a,"parentNode")},parentsUntil:function(a,b,c){return f.dir(a,"parentNode",c)},next:function(a){return f.nth(a,2,"nextSibling")},prev:function(a){return f.nth(a,2,"previousSibling")},nextAll:function(a){return f.dir(a,"nextSibling")},prevAll:function(a){return f.dir(a,"previousSibling")},nextUntil:function(a,b,c){return f.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return f.dir(a,"previousSibling",c)},siblings:function(a){return f.sibling(a.parentNode.firstChild,a)},children:function(a){return f.sibling(a.firstChild)},contents:function(a){return f.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:f.makeArray(a.childNodes)}},function(a,b){f.fn[a]=function(c,d){var e=f.map(this,b,c),g=S.call(arguments);O.test(a)||(d=c),d&&typeof d=="string"&&(e=f.filter(d,e)),e=this.length>1&&!U[a]?f.unique(e):e,(this.length>1||Q.test(d))&&P.test(a)&&(e=e.reverse());return this.pushStack(e,a,g.join(","))}}),f.extend({filter:function(a,b,c){c&&(a=":not("+a+")");return b.length===1?f.find.matchesSelector(b[0],a)?[b[0]]:[]:f.find.matches(a,b)},dir:function(a,c,d){var e=[],g=a[c];while(g&&g.nodeType!==9&&(d===b||g.nodeType!==1||!f(g).is(d)))g.nodeType===1&&e.push(g),g=g[c];return e},nth:function(a,b,c,d){b=b||1;var e=0;for(;a;a=a[c])if(a.nodeType===1&&++e===b)break;return a},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling)a.nodeType===1&&a!==b&&c.push(a);return c}});var X=/ jQuery\d+="(?:\d+|null)"/g,Y=/^\s+/,Z=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,$=/<([\w:]+)/,_=/<tbody/i,ba=/<|&#?\w+;/,bb=/<(?:script|object|embed|option|style)/i,bc=/checked\s*(?:[^=]|=\s*.checked.)/i,bd=/\/(java|ecma)script/i,be=/^\s*<!(?:\[CDATA\[|\-\-)/,bf={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};bf.optgroup=bf.option,bf.tbody=bf.tfoot=bf.colgroup=bf.caption=bf.thead,bf.th=bf.td,f.support.htmlSerialize||(bf._default=[1,"div<div>","</div>"]),f.fn.extend({text:function(a){if(f.isFunction(a))return this.each(function(b){var c=f(this);c.text(a.call(this,b,c.text()))});if(typeof a!="object"&&a!==b)return this.empty().append((this[0]&&this[0].ownerDocument||c).createTextNode(a));return f.text(this)},wrapAll:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapAll(a.call(this,b))});if(this[0]){var b=f(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapInner(a.call(this,b))});return this.each(function(){var b=f(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){return this.each(function(){f(this).wrapAll(a)})},unwrap:function(){return this.parent().each(function(){f.nodeName(this,"body")||f(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=f(arguments[0]);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,f(arguments[0]).toArray());return a}},remove:function(a,b){for(var c=0,d;(d=this[c])!=null;c++)if(!a||f.filter(a,[d]).length)!b&&d.nodeType===1&&(f.cleanData(d.getElementsByTagName("*")),f.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d);return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++){b.nodeType===1&&f.cleanData(b.getElementsByTagName("*"));while(b.firstChild)b.removeChild(b.firstChild)}return this},clone:function(a,b){a=a==null?!1:a,b=b==null?a:b;return this.map(function(){return f.clone(this,a,b)})},html:function(a){if(a===b)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(X,""):null;if(typeof a=="string"&&!bb.test(a)&&(f.support.leadingWhitespace||!Y.test(a))&&!bf[($.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Z,"<$1></$2>");try{for(var c=0,d=this.length;c<d;c++)this[c].nodeType===1&&(f.cleanData(this[c].getElementsByTagName("*")),this[c].innerHTML=a)}catch(e){this.empty().append(a)}}else f.isFunction(a)?this.each(function(b){var c=f(this);c.html(a.call(this,b,c.html()))}):this.empty().append(a);return this},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(f.isFunction(a))return this.each(function(b){var c=f(this),d=c.html();c.replaceWith(a.call(this,b,d))});typeof a!="string"&&(a=f(a).detach());return this.each(function(){var b=this.nextSibling,c=this.parentNode;f(this).remove(),b?f(b).before(a):f(c).append(a)})}return this.length?this.pushStack(f(f.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var e,g,h,i,j=a[0],k=[];if(!f.support.checkClone&&arguments.length===3&&typeof j=="string"&&bc.test(j))return this.each(function(){f(this).domManip(a,c,d,!0)});if(f.isFunction(j))return this.each(function(e){var g=f(this);a[0]=j.call(this,e,c?g.html():b),g.domManip(a,c,d)});if(this[0]){i=j&&j.parentNode,f.support.parentNode&&i&&i.nodeType===11&&i.childNodes.length===this.length?e={fragment:i}:e=f.buildFragment(a,this,k),h=e.fragment,h.childNodes.length===1?g=h=h.firstChild:g=h.firstChild;if(g){c=c&&f.nodeName(g,"tr");for(var l=0,m=this.length,n=m-1;l<m;l++)d.call(c?bg(this[l],g):this[l],e.cacheable||m>1&&l<n?f.clone(h,!0,!0):h)}k.length&&f.each(k,bm)}return this}}),f.buildFragment=function(a,b,d){var e,g,h,i;b&&b[0]&&(i=b[0].ownerDocument||b[0]),i.createDocumentFragment||(i=c),a.length===1&&typeof a[0]=="string"&&a[0].length<512&&i===c&&a[0].charAt(0)==="<"&&!bb.test(a[0])&&(f.support.checkClone||!bc.test(a[0]))&&(g=!0,h=f.fragments[a[0]],h&&h!==1&&(e=h)),e||(e=i.createDocumentFragment(),f.clean(a,i,e,d)),g&&(f.fragments[a[0]]=h?e:1);return{fragment:e,cacheable:g}},f.fragments={},f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){f.fn[a]=function(c){var d=[],e=f(c),g=this.length===1&&this[0].parentNode;if(g&&g.nodeType===11&&g.childNodes.length===1&&e.length===1){e[b](this[0]);return this}for(var h=0,i=e.length;h<i;h++){var j=(h>0?this.clone(!0):this).get();f(e[h])[b](j),d=d.concat(j
)}return this.pushStack(d,a,e.selector)}}),f.extend({clone:function(a,b,c){var d=a.cloneNode(!0),e,g,h;if((!f.support.noCloneEvent||!f.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!f.isXMLDoc(a)){bi(a,d),e=bj(a),g=bj(d);for(h=0;e[h];++h)bi(e[h],g[h])}if(b){bh(a,d);if(c){e=bj(a),g=bj(d);for(h=0;e[h];++h)bh(e[h],g[h])}}e=g=null;return d},clean:function(a,b,d,e){var g;b=b||c,typeof b.createElement=="undefined"&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||c);var h=[],i;for(var j=0,k;(k=a[j])!=null;j++){typeof k=="number"&&(k+="");if(!k)continue;if(typeof k=="string")if(!ba.test(k))k=b.createTextNode(k);else{k=k.replace(Z,"<$1></$2>");var l=($.exec(k)||["",""])[1].toLowerCase(),m=bf[l]||bf._default,n=m[0],o=b.createElement("div");o.innerHTML=m[1]+k+m[2];while(n--)o=o.lastChild;if(!f.support.tbody){var p=_.test(k),q=l==="table"&&!p?o.firstChild&&o.firstChild.childNodes:m[1]==="<table>"&&!p?o.childNodes:[];for(i=q.length-1;i>=0;--i)f.nodeName(q[i],"tbody")&&!q[i].childNodes.length&&q[i].parentNode.removeChild(q[i])}!f.support.leadingWhitespace&&Y.test(k)&&o.insertBefore(b.createTextNode(Y.exec(k)[0]),o.firstChild),k=o.childNodes}var r;if(!f.support.appendChecked)if(k[0]&&typeof (r=k.length)=="number")for(i=0;i<r;i++)bl(k[i]);else bl(k);k.nodeType?h.push(k):h=f.merge(h,k)}if(d){g=function(a){return!a.type||bd.test(a.type)};for(j=0;h[j];j++)if(e&&f.nodeName(h[j],"script")&&(!h[j].type||h[j].type.toLowerCase()==="text/javascript"))e.push(h[j].parentNode?h[j].parentNode.removeChild(h[j]):h[j]);else{if(h[j].nodeType===1){var s=f.grep(h[j].getElementsByTagName("script"),g);h.splice.apply(h,[j+1,0].concat(s))}d.appendChild(h[j])}}return h},cleanData:function(a){var b,c,d=f.cache,e=f.expando,g=f.event.special,h=f.support.deleteExpando;for(var i=0,j;(j=a[i])!=null;i++){if(j.nodeName&&f.noData[j.nodeName.toLowerCase()])continue;c=j[f.expando];if(c){b=d[c]&&d[c][e];if(b&&b.events){for(var k in b.events)g[k]?f.event.remove(j,k):f.removeEvent(j,k,b.handle);b.handle&&(b.handle.elem=null)}h?delete j[f.expando]:j.removeAttribute&&j.removeAttribute(f.expando),delete d[c]}}}});var bn=/alpha\([^)]*\)/i,bo=/opacity=([^)]*)/,bp=/([A-Z]|^ms)/g,bq=/^-?\d+(?:px)?$/i,br=/^-?\d/,bs=/^[+\-]=/,bt=/[^+\-\.\de]+/g,bu={position:"absolute",visibility:"hidden",display:"block"},bv=["Left","Right"],bw=["Top","Bottom"],bx,by,bz;f.fn.css=function(a,c){if(arguments.length===2&&c===b)return this;return f.access(this,a,c,!0,function(a,c,d){return d!==b?f.style(a,c,d):f.css(a,c)})},f.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=bx(a,"opacity","opacity");return c===""?"1":c}return a.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":f.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!!a&&a.nodeType!==3&&a.nodeType!==8&&!!a.style){var g,h,i=f.camelCase(c),j=a.style,k=f.cssHooks[i];c=f.cssProps[i]||i;if(d===b){if(k&&"get"in k&&(g=k.get(a,!1,e))!==b)return g;return j[c]}h=typeof d;if(h==="number"&&isNaN(d)||d==null)return;h==="string"&&bs.test(d)&&(d=+d.replace(bt,"")+parseFloat(f.css(a,c)),h="number"),h==="number"&&!f.cssNumber[i]&&(d+="px");if(!k||!("set"in k)||(d=k.set(a,d))!==b)try{j[c]=d}catch(l){}}},css:function(a,c,d){var e,g;c=f.camelCase(c),g=f.cssHooks[c],c=f.cssProps[c]||c,c==="cssFloat"&&(c="float");if(g&&"get"in g&&(e=g.get(a,!0,d))!==b)return e;if(bx)return bx(a,c)},swap:function(a,b,c){var d={};for(var e in b)d[e]=a.style[e],a.style[e]=b[e];c.call(a);for(e in b)a.style[e]=d[e]}}),f.curCSS=f.css,f.each(["height","width"],function(a,b){f.cssHooks[b]={get:function(a,c,d){var e;if(c){if(a.offsetWidth!==0)return bA(a,b,d);f.swap(a,bu,function(){e=bA(a,b,d)});return e}},set:function(a,b){if(!bq.test(b))return b;b=parseFloat(b);if(b>=0)return b+"px"}}}),f.support.opacity||(f.cssHooks.opacity={get:function(a,b){return bo.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle;c.zoom=1;var e=f.isNaN(b)?"":"alpha(opacity="+b*100+")",g=d&&d.filter||c.filter||"";c.filter=bn.test(g)?g.replace(bn,e):g+" "+e}}),f(function(){f.support.reliableMarginRight||(f.cssHooks.marginRight={get:function(a,b){var c;f.swap(a,{display:"inline-block"},function(){b?c=bx(a,"margin-right","marginRight"):c=a.style.marginRight});return c}})}),c.defaultView&&c.defaultView.getComputedStyle&&(by=function(a,c){var d,e,g;c=c.replace(bp,"-$1").toLowerCase();if(!(e=a.ownerDocument.defaultView))return b;if(g=e.getComputedStyle(a,null))d=g.getPropertyValue(c),d===""&&!f.contains(a.ownerDocument.documentElement,a)&&(d=f.style(a,c));return d}),c.documentElement.currentStyle&&(bz=function(a,b){var c,d=a.currentStyle&&a.currentStyle[b],e=a.runtimeStyle&&a.runtimeStyle[b],f=a.style;!bq.test(d)&&br.test(d)&&(c=f.left,e&&(a.runtimeStyle.left=a.currentStyle.left),f.left=b==="fontSize"?"1em":d||0,d=f.pixelLeft+"px",f.left=c,e&&(a.runtimeStyle.left=e));return d===""?"auto":d}),bx=by||bz,f.expr&&f.expr.filters&&(f.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;return b===0&&c===0||!f.support.reliableHiddenOffsets&&(a.style.display||f.css(a,"display"))==="none"},f.expr.filters.visible=function(a){return!f.expr.filters.hidden(a)});var bB=/%20/g,bC=/\[\]$/,bD=/\r?\n/g,bE=/#.*$/,bF=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,bG=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,bH=/^(?:about|app|app\-storage|.+\-extension|file|widget):$/,bI=/^(?:GET|HEAD)$/,bJ=/^\/\//,bK=/\?/,bL=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bM=/^(?:select|textarea)/i,bN=/\s+/,bO=/([?&])_=[^&]*/,bP=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,bQ=f.fn.load,bR={},bS={},bT,bU;try{bT=e.href}catch(bV){bT=c.createElement("a"),bT.href="",bT=bT.href}bU=bP.exec(bT.toLowerCase())||[],f.fn.extend({load:function(a,c,d){if(typeof a!="string"&&bQ)return bQ.apply(this,arguments);if(!this.length)return this;var e=a.indexOf(" ");if(e>=0){var g=a.slice(e,a.length);a=a.slice(0,e)}var h="GET";c&&(f.isFunction(c)?(d=c,c=b):typeof c=="object"&&(c=f.param(c,f.ajaxSettings.traditional),h="POST"));var i=this;f.ajax({url:a,type:h,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText,a.isResolved()&&(a.done(function(a){c=a}),i.html(g?f("<div>").append(c.replace(bL,"")).find(g):c)),d&&i.each(d,[c,b,a])}});return this},serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?f.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||bM.test(this.nodeName)||bG.test(this.type))}).map(function(a,b){var c=f(this).val();return c==null?null:f.isArray(c)?f.map(c,function(a,c){return{name:b.name,value:a.replace(bD,"\r\n")}}):{name:b.name,value:c.replace(bD,"\r\n")}}).get()}}),f.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){f.fn[b]=function(a){return this.bind(b,a)}}),f.each(["get","post"],function(a,c){f[c]=function(a,d,e,g){f.isFunction(d)&&(g=g||e,e=d,d=b);return f.ajax({type:c,url:a,data:d,success:e,dataType:g})}}),f.extend({getScript:function(a,c){return f.get(a,b,c,"script")},getJSON:function(a,b,c){return f.get(a,b,c,"json")},ajaxSetup:function(a,b){b?f.extend(!0,a,f.ajaxSettings,b):(b=a,a=f.extend(!0,f.ajaxSettings,b));for(var c in{context:1,url:1})c in b?a[c]=b[c]:c in f.ajaxSettings&&(a[c]=f.ajaxSettings[c]);return a},ajaxSettings:{url:bT,isLocal:bH.test(bU[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":f.parseJSON,"text xml":f.parseXML}},ajaxPrefilter:bW(bR),ajaxTransport:bW(bS),ajax:function(a,c){function w(a,c,l,m){if(s!==2){s=2,q&&clearTimeout(q),p=b,n=m||"",v.readyState=a?4:0;var o,r,u,w=l?bZ(d,v,l):b,x,y;if(a>=200&&a<300||a===304){if(d.ifModified){if(x=v.getResponseHeader("Last-Modified"))f.lastModified[k]=x;if(y=v.getResponseHeader("Etag"))f.etag[k]=y}if(a===304)c="notmodified",o=!0;else try{r=b$(d,w),c="success",o=!0}catch(z){c="parsererror",u=z}}else{u=c;if(!c||a)c="error",a<0&&(a=0)}v.status=a,v.statusText=c,o?h.resolveWith(e,[r,c,v]):h.rejectWith(e,[v,c,u]),v.statusCode(j),j=b,t&&g.trigger("ajax"+(o?"Success":"Error"),[v,d,o?r:u]),i.resolveWith(e,[v,c]),t&&(g.trigger("ajaxComplete",[v,d]),--f.active||f.event.trigger("ajaxStop"))}}typeof a=="object"&&(c=a,a=b),c=c||{};var d=f.ajaxSetup({},c),e=d.context||d,g=e!==d&&(e.nodeType||e instanceof f)?f(e):f.event,h=f.Deferred(),i=f._Deferred(),j=d.statusCode||{},k,l={},m={},n,o,p,q,r,s=0,t,u,v={readyState:0,setRequestHeader:function(a,b){if(!s){var c=a.toLowerCase();a=m[c]=m[c]||a,l[a]=b}return this},getAllResponseHeaders:function(){return s===2?n:null},getResponseHeader:function(a){var c;if(s===2){if(!o){o={};while(c=bF.exec(n))o[c[1].toLowerCase()]=c[2]}c=o[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){s||(d.mimeType=a);return this},abort:function(a){a=a||"abort",p&&p.abort(a),w(0,a);return this}};h.promise(v),v.success=v.done,v.error=v.fail,v.complete=i.done,v.statusCode=function(a){if(a){var b;if(s<2)for(b in a)j[b]=[j[b],a[b]];else b=a[v.status],v.then(b,b)}return this},d.url=((a||d.url)+"").replace(bE,"").replace(bJ,bU[1]+"//"),d.dataTypes=f.trim(d.dataType||"*").toLowerCase().split(bN),d.crossDomain==null&&(r=bP.exec(d.url.toLowerCase()),d.crossDomain=!(!r||r[1]==bU[1]&&r[2]==bU[2]&&(r[3]||(r[1]==="http:"?80:443))==(bU[3]||(bU[1]==="http:"?80:443)))),d.data&&d.processData&&typeof d.data!="string"&&(d.data=f.param(d.data,d.traditional)),bX(bR,d,c,v);if(s===2)return!1;t=d.global,d.type=d.type.toUpperCase(),d.hasContent=!bI.test(d.type),t&&f.active++===0&&f.event.trigger("ajaxStart");if(!d.hasContent){d.data&&(d.url+=(bK.test(d.url)?"&":"?")+d.data),k=d.url;if(d.cache===!1){var x=f.now(),y=d.url.replace(bO,"$1_="+x);d.url=y+(y===d.url?(bK.test(d.url)?"&":"?")+"_="+x:"")}}(d.data&&d.hasContent&&d.contentType!==!1||c.contentType)&&v.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(k=k||d.url,f.lastModified[k]&&v.setRequestHeader("If-Modified-Since",f.lastModified[k]),f.etag[k]&&v.setRequestHeader("If-None-Match",f.etag[k])),v.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+(d.dataTypes[0]!=="*"?", */*; q=0.01":""):d.accepts["*"]);for(u in d.headers)v.setRequestHeader(u,d.headers[u]);if(d.beforeSend&&(d.beforeSend.call(e,v,d)===!1||s===2)){v.abort();return!1}for(u in{success:1,error:1,complete:1})v[u](d[u]);p=bX(bS,d,c,v);if(!p)w(-1,"No Transport");else{v.readyState=1,t&&g.trigger("ajaxSend",[v,d]),d.async&&d.timeout>0&&(q=setTimeout(function(){v.abort("timeout")},d.timeout));try{s=1,p.send(l,w)}catch(z){status<2?w(-1,z):f.error(z)}}return v},param:function(a,c){var d=[],e=function(a,b){b=f.isFunction(b)?b():b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=f.ajaxSettings.traditional);if(f.isArray(a)||a.jquery&&!f.isPlainObject(a))f.each(a,function(){e(this.name,this.value)});else for(var g in a)bY(g,a[g],c,e);return d.join("&").replace(bB,"+")}}),f.extend({active:0,lastModified:{},etag:{}});var b_=f.now(),ca=/(\=)\?(&|$)|\?\?/i;f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return f.expando+"_"+b_++}}),f.ajaxPrefilter("json jsonp",function(b,c,d){var e=b.contentType==="application/x-www-form-urlencoded"&&typeof b.data=="string";if(b.dataTypes[0]==="jsonp"||b.jsonp!==!1&&(ca.test(b.url)||e&&ca.test(b.data))){var g,h=b.jsonpCallback=f.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,i=a[h],j=b.url,k=b.data,l="$1"+h+"$2";b.jsonp!==!1&&(j=j.replace(ca,l),b.url===j&&(e&&(k=k.replace(ca,l)),b.data===k&&(j+=(/\?/.test(j)?"&":"?")+b.jsonp+"="+h))),b.url=j,b.data=k,a[h]=function(a){g=[a]},d.always(function(){a[h]=i,g&&f.isFunction(i)&&a[h](g[0])}),b.converters["script json"]=function(){g||f.error(h+" was not called");return g[0]},b.dataTypes[0]="json";return"script"}}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){f.globalEval(a);return a}}}),f.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),f.ajaxTransport("script",function(a){if(a.crossDomain){var d,e=c.head||c.getElementsByTagName("head")[0]||c.documentElement;return{send:function(f,g){d=c.createElement("script"),d.async="async",a.scriptCharset&&(d.charset=a.scriptCharset),d.src=a.url,d.onload=d.onreadystatechange=function(a,c){if(c||!d.readyState||/loaded|complete/.test(d.readyState))d.onload=d.onreadystatechange=null,e&&d.parentNode&&e.removeChild(d),d=b,c||g(200,"success")},e.insertBefore(d,e.firstChild)},abort:function(){d&&d.onload(0,1)}}}});var cb=a.ActiveXObject?function(){for(var a in cd)cd[a](0,1)}:!1,cc=0,cd;f.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&ce()||cf()}:ce,function(a){f.extend(f.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}(f.ajaxSettings.xhr()),f.support.ajax&&f.ajaxTransport(function(c){if(!c.crossDomain||f.support.cors){var d;return{send:function(e,g){var h=c.xhr(),i,j;c.username?h.open(c.type,c.url,c.async,c.username,c.password):h.open(c.type,c.url,c.async);if(c.xhrFields)for(j in c.xhrFields)h[j]=c.xhrFields[j];c.mimeType&&h.overrideMimeType&&h.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(j in e)h.setRequestHeader(j,e[j])}catch(k){}h.send(c.hasContent&&c.data||null),d=function(a,e){var j,k,l,m,n;try{if(d&&(e||h.readyState===4)){d=b,i&&(h.onreadystatechange=f.noop,cb&&delete cd[i]);if(e)h.readyState!==4&&h.abort();else{j=h.status,l=h.getAllResponseHeaders(),m={},n=h.responseXML,n&&n.documentElement&&(m.xml=n),m.text=h.responseText;try{k=h.statusText}catch(o){k=""}!j&&c.isLocal&&!c.crossDomain?j=m.text?200:404:j===1223&&(j=204)}}}catch(p){e||g(-1,p)}m&&g(j,k,m,l)},!c.async||h.readyState===4?d():(i=++cc,cb&&(cd||(cd={},f(a).unload(cb)),cd[i]=d),h.onreadystatechange=d)},abort:function(){d&&d(0,1)}}}});var cg={},ch,ci,cj=/^(?:toggle|show|hide)$/,ck=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,cl,cm=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],cn,co=a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame;f.fn.extend({show:function(a,b,c){var d,e;if(a||a===0)return this.animate(cr("show",3),a,b,c);for(var g=0,h=this.length;g<h;g++)d=this[g],d.style&&(e=d.style.display,!f._data(d,"olddisplay")&&e==="none"&&(e=d.style.display=""),e===""&&f.css(d,"display")==="none"&&f._data(d,"olddisplay",cs(d.nodeName)));for(g=0;g<h;g++){d=this[g];if(d.style){e=d.style.display;if(e===""||e==="none")d.style.display=f._data(d,"olddisplay")||""}}return this},hide:function(a,b,c){if(a||a===0)return this.animate(cr("hide",3),a,b,c);for(var d=0,e=this.length;d<e;d++)if(this[d].style){var g=f.css(this[d],"display");g!=="none"&&!f._data(this[d],"olddisplay")&&f._data(this[d],"olddisplay",g)}for(d=0;d<e;d++)this[d].style&&(this[d].style.display="none");return this},_toggle:f.fn.toggle,toggle:function(a,b,c){var d=typeof a=="boolean";f.isFunction(a)&&f.isFunction(b)?this._toggle.apply(this,arguments):a==null||d?this.each(function(){var b=d?a:f(this).is(":hidden");f(this)[b?"show":"hide"]()}):this.animate(cr("toggle",3),a,b,c);return this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=f.speed(b,c,d);if(f.isEmptyObject(a))return this.each(e.complete,[!1]);a=f.extend({},a);return this[e.queue===!1?"each":"queue"](function(){e.queue===!1&&f._mark(this);var b=f.extend({},e),c=this.nodeType===1,d=c&&f(this).is(":hidden"),g,h,i,j,k,l,m,n,o;b.animatedProperties={};for(i in a){g=f.camelCase(i),i!==g&&(a[g]=a[i],delete a[i]),h=a[g],f.isArray(h)?(b.animatedProperties[g]=h[1],h=a[g]=h[0]):b.animatedProperties[g]=b.specialEasing&&b.specialEasing[g]||b.easing||"swing";if(h==="hide"&&d||h==="show"&&!d)return b.complete.call(this);c&&(g==="height"||g==="width")&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],f.css(this,"display")==="inline"&&f.css(this,"float")==="none"&&(f.support.inlineBlockNeedsLayout?(j=cs(this.nodeName),j==="inline"?this.style.display="inline-block":(this.style.display="inline",this.style.zoom=1)):this.style.display="inline-block"))}b.overflow!=null&&(this.style.overflow="hidden");for(i in a)k=new f.fx(this,b,i),h=a[i],cj.test(h)?k[h==="toggle"?d?"show":"hide":h]():(l=ck.exec(h),m=k.cur(),l?(n=parseFloat(l[2]),o=l[3]||(f.cssNumber[i]?"":"px"),o!=="px"&&(f.style(this,i,(n||1)+o),m=(n||1)/k.cur()*m,f.style(this,i,m+o)),l[1]&&(n=(l[1]==="-="?-1:1)*n+m),k.custom(m,n,o)):k.custom(m,h,""));return!0})},stop:function(a,b){a&&this.queue([]),this.each(function(){var a=f.timers,c=a.length;b||f._unmark(!0,this);while(c--)a[c].elem===this&&(b&&a[c](!0),a.splice(c,1))}),b||this.dequeue();return this}}),f.each({slideDown:cr("show",1),slideUp:cr("hide",1),slideToggle:cr("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){f.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),f.extend({speed:function(a,b,c){var d=a&&typeof a=="object"?f.extend({},a):{complete:c||!c&&b||f.isFunction(a)&&a,duration:a,easing:c&&b||b&&!f.isFunction(b)&&b};d.duration=f.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in f.fx.speeds?f.fx.speeds[d.duration]:f.fx.speeds._default,d.old=d.complete,d.complete=function(a){f.isFunction(d.old)&&d.old.call(this),d.queue!==!1?f.dequeue(this):a!==!1&&f._unmark(this)};return d},easing:{linear:function(a,b,c,d){return c+d*a},swing:function(a,b,c,d){return(-Math.cos(a*Math.PI)/2+.5)*d+c}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig=b.orig||{}}}),f.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(f.fx.step[this.prop]||f.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];var a,b=f.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?!b||b==="auto"?0:b:a},custom:function(a,b,c){function h(a){return d.step(a)}var d=this,e=f.fx,g;this.startTime=cn||cp(),this.start=a,this.end=b,this.unit=c||this.unit||(f.cssNumber[this.prop]?"":"px"),this.now=this.start,this.pos=this.state=0,h.elem=this.elem,h()&&f.timers.push(h)&&!cl&&(co?(cl=!0,g=function(){cl&&(co(g),e.tick())},co(g)):cl=setInterval(e.tick,e.interval))},show:function(){this.options.orig[this.prop]=f.style(this.elem,this.prop),this.options.show=!0,this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),f(this.elem).show()},hide:function(){this.options.orig[this.prop]=f.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(a){var b=cn||cp(),c=!0,d=this.elem,e=this.options,g,h;if(a||b>=e.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),e.animatedProperties[this.prop]=!0;for(g in e.animatedProperties)e.animatedProperties[g]!==!0&&(c=!1);if(c){e.overflow!=null&&!f.support.shrinkWrapBlocks&&f.each(["","X","Y"],function(a,b){d.style["overflow"+b]=e.overflow[a]}),e.hide&&f(d).hide();if(e.hide||e.show)for(var i in e.animatedProperties)f.style(d,i,e.orig[i]);e.complete.call(d)}return!1}e.duration==Infinity?this.now=b:(h=b-this.startTime,this.state=h/e.duration,this.pos=f.easing[e.animatedProperties[this.prop]](this.state,h,0,1,e.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update();return!0}},f.extend(f.fx,{tick:function(){for(var a=f.timers,b=0;b<a.length;++b)a[b]()||a.splice(b--,1);a.length||f.fx.stop()},interval:13,stop:function(){clearInterval(cl),cl=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){f.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&a.elem.style[a.prop]!=null?a.elem.style[a.prop]=(a.prop==="width"||a.prop==="height"?Math.max(0,a.now):a.now)+a.unit:a.elem[a.prop]=a.now}}}),f.expr&&f.expr.filters&&(f.expr.filters.animated=function(a){return f.grep(f.timers,function(b){return a===b.elem}).length});var ct=/^t(?:able|d|h)$/i,cu=/^(?:body|html)$/i;"getBoundingClientRect"in c.documentElement?f.fn.offset=function(a){var b=this[0],c;if(a)return this.each(function(b){f.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return f.offset.bodyOffset(b);try{c=b.getBoundingClientRect()}catch(d){}var e=b.ownerDocument,g=e.documentElement;if(!c||!f.contains(g,b))return c?{top:c.top,left:c.left}:{top:0,left:0};var h=e.body,i=cv(e),j=g.clientTop||h.clientTop||0,k=g.clientLeft||h.clientLeft||0,l=i.pageYOffset||f.support.boxModel&&g.scrollTop||h.scrollTop,m=i.pageXOffset||f.support.boxModel&&g.scrollLeft||h.scrollLeft,n=c.top+l-j,o=c.left+m-k;return{top:n,left:o}}:f.fn.offset=function(a){var b=this[0];if(a)return this.each(function(b){f.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return f.offset.bodyOffset(b);f.offset.initialize();var c,d=b.offsetParent,e=b,g=b.ownerDocument,h=g.documentElement,i=g.body,j=g.defaultView,k=j?j.getComputedStyle(b,null):b.currentStyle,l=b.offsetTop,m=b.offsetLeft;while((b=b.parentNode)&&b!==i&&b!==h){if(f.offset.supportsFixedPosition&&k.position==="fixed")break;c=j?j.getComputedStyle(b,null):b.currentStyle,l-=b.scrollTop,m-=b.scrollLeft,b===d&&(l+=b.offsetTop,m+=b.offsetLeft,f.offset.doesNotAddBorder&&(!f.offset.doesAddBorderForTableAndCells||!ct.test(b.nodeName))&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),e=d,d=b.offsetParent),f.offset.subtractsBorderForOverflowNotVisible&&c.overflow!=="visible"&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),k=c}if(k.position==="relative"||k.position==="static")l+=i.offsetTop,m+=i.offsetLeft;f.offset.supportsFixedPosition&&k.position==="fixed"&&(l+=Math.max(h.scrollTop,i.scrollTop),m+=Math.max(h.scrollLeft,i.scrollLeft));return{top:l,left:m}},f.offset={initialize:function(){var a=c.body,b=c.createElement("div"),d,e,g,h,i=parseFloat(f.css(a,"marginTop"))||0,j="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>";f.extend(b.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"}),b.innerHTML=j,a.insertBefore(b,a.firstChild),d=b.firstChild,e=d.firstChild,h=d.nextSibling.firstChild.firstChild,this.doesNotAddBorder=e.offsetTop!==5,this.doesAddBorderForTableAndCells=h.offsetTop===5,e.style.position="fixed",e.style.top="20px",this.supportsFixedPosition=e.offsetTop===20||e.offsetTop===15,e.style.position=e.style.top="",d.style.overflow="hidden",d.style.position="relative",this.subtractsBorderForOverflowNotVisible=e.offsetTop===-5,this.doesNotIncludeMarginInBodyOffset=a.offsetTop!==i,a.removeChild(b),f.offset.initialize=f.noop},bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;f.offset.initialize(),f.offset.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(f.css(a,"marginTop"))||0,c+=parseFloat(f.css(a,"marginLeft"))||0);return{top:b,left:c}},setOffset:function(a,b,c){var d=f.css(a,"position");d==="static"&&(a.style.position="relative");var e=f(a),g=e.offset(),h=f.css(a,"top"),i=f.css(a,"left"),j=(d==="absolute"||d==="fixed")&&f.inArray("auto",[h,i])>-1,k={},l={},m,n;j?(l=e.position(),m=l.top,n=l.left):(m=parseFloat(h)||0,n=parseFloat(i)||0),f.isFunction(b)&&(b=b.call(a,c,g)),b.top!=null&&(k.top=b.top-g.top+m),b.left!=null&&(k.left=b.left-g.left+n),"using"in b?b.using.call(a,k):e.css(k)}},f.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),c=this.offset(),d=cu.test(b[0].nodeName)?{top:0,left:0}:b.offset();c.top-=parseFloat(f.css(a,"marginTop"))||0,c.left-=parseFloat(f.css(a,"marginLeft"))||0,d.top+=parseFloat(f.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(f.css(b[0],"borderLeftWidth"))||0;return{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||c.body;while(a&&!cu.test(a.nodeName)&&f.css(a,"position")==="static")a=a.offsetParent;return a})}}),f.each(["Left","Top"],function(a,c){var d="scroll"+c;f.fn[d]=function(c){var e,g;if(c===b){e=this[0];if(!e)return null;g=cv(e);return g?"pageXOffset"in g?g[a?"pageYOffset":"pageXOffset"]:f.support.boxModel&&g.document.documentElement[d]||g.document.body[d]:e[d]}return this.each(function(){g=cv(this),g?g.scrollTo(a?f(g).scrollLeft():c,a?c:f(g).scrollTop()):this[d]=c})}}),f.each(["Height","Width"],function(a,c){var d=c.toLowerCase();f.fn["inner"+c]=function(){var a=this[0];return a&&a.style?parseFloat(f.css(a,d,"padding")):null},f.fn["outer"+c]=function(a){var b=this[0];return b&&b.style?parseFloat(f.css(b,d,a?"margin":"border")):null},f.fn[d]=function(a){var e=this[0];if(!e)return a==null?null:this;if(f.isFunction(a))return this.each(function(b){var c=f(this);c[d](a.call(this,b,c[d]()))});if(f.isWindow(e)){var g=e.document.documentElement["client"+c];return e.document.compatMode==="CSS1Compat"&&g||e.document.body["client"+c]||g}if(e.nodeType===9)return Math.max(e.documentElement["client"+c],e.body["scroll"+c],e.documentElement["scroll"+c],e.body["offset"+c],e.documentElement["offset"+c]);if(a===b){var h=f.css(e,d),i=parseFloat(h);return f.isNaN(i)?h:i}return this.css(d,typeof a=="string"?a:a+"px")}}),a.jQuery=a.$=f})(window);
//]]>
</script>
<script id="jqueryArea" type="text/javascript">
//<![CDATA[
/*
jQuery.encoding.digests.sha1.js

SHA-1 digest and associated utility functions

Copyright (c) UnaMesa Association 2009

Dual licensed under the MIT and GPL licenses:
  http://www.opensource.org/licenses/mit-license.php
  http://www.gnu.org/licenses/gpl.html
*/

(function($) {

if(!$.encoding)
	$.encoding = {};
	$.extend($.encoding,{
		strToBe32s: function(str) {
			// Convert a string to an array of big-endian 32-bit words
			var be=[];
			var len=Math.floor(str.length/4);
			var i, j;
			for(i=0, j=0; i<len; i++, j+=4) {
				be[i]=((str.charCodeAt(j)&0xff) << 24)|((str.charCodeAt(j+1)&0xff) << 16)|((str.charCodeAt(j+2)&0xff) << 8)|(str.charCodeAt(j+3)&0xff);
			}
			while(j<str.length) {
				be[j>>2] |= (str.charCodeAt(j)&0xff)<<(24-(j*8)%32);
				j++;
			}
			return be;
		},
		be32sToStr: function(be) {
			// Convert an array of big-endian 32-bit words to a string
			var str='';
			for(var i=0;i<be.length*32;i+=8) {
				str += String.fromCharCode((be[i>>5]>>>(24-i%32)) & 0xff);
			}
			return str;
		},
		be32sToHex: function(be) {
			// Convert an array of big-endian 32-bit words to a hex string
			var hex='0123456789ABCDEF';
			var str='';
			for(var i=0;i<be.length*4;i++) {
				str += hex.charAt((be[i>>2]>>((3-i%4)*8+4))&0xF) + hex.charAt((be[i>>2]>>((3-i%4)*8))&0xF);
			}
			return str;
		}
	});
})(jQuery);


(function($) {

if(!$.encoding.digests)
	$.encoding.digests = {};
	$.extend($.encoding.digests,{
		hexSha1Str: function(str) {
			// Return, in hex, the SHA-1 hash of a string
			return $.encoding.be32sToHex($.encoding.digests.sha1Str(str));
		},
		sha1Str: function(str) {
			// Return the SHA-1 hash of a string
			return sha1($.encoding.strToBe32s(str),str.length);
		},
		sha1: function(x,blen) {
			// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
			return sha1($.encoding.strToBe32s(str),str.length);
		}
	});

	// Private functions.
	function sha1(x,blen) {
		// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
		function add32(a,b) {
			// Add 32-bit integers, wrapping at 32 bits
			// Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
			var lsw=(a&0xFFFF)+(b&0xFFFF);
			var msw=(a>>16)+(b>>16)+(lsw>>16);
			return (msw<<16)|(lsw&0xFFFF);
		}
		function AA(a,b,c,d,e) {
			// Cryptographic round helper function. Add five 32-bit integers, wrapping at 32 bits, second parameter is rotated left 5 bits before the addition
			// Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
			b=(b>>>27)|(b<<5);
			var lsw=(a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF)+(e&0xFFFF);
			var msw=(a>>16)+(b>>16)+(c>>16)+(d>>16)+(e>>16)+(lsw>>16);
			return (msw<<16)|(lsw&0xFFFF);
		}
		function RR(w,j) {
			// Cryptographic round helper function.
			var n=w[j-3]^w[j-8]^w[j-14]^w[j-16];
			return (n>>>31)|(n<<1);
		}

		var len=blen*8;
		x[len>>5] |= 0x80 << (24-len%32);
		x[((len+64>>9)<<4)+15]=len;
		var w=new Array(80);

		var k1=0x5A827999;
		var k2=0x6ED9EBA1;
		var k3=0x8F1BBCDC;
		var k4=0xCA62C1D6;

		var h0=0x67452301;
		var h1=0xEFCDAB89;
		var h2=0x98BADCFE;
		var h3=0x10325476;
		var h4=0xC3D2E1F0;

		for(var i=0;i<x.length;i+=16) {
			var j=0;
			var t;
			var a=h0;
			var b=h1;
			var c=h2;
			var d=h3;
			var e=h4;
			while(j<16) {
				w[j]=x[i+j];
				t=AA(e,a,d^(b&(c^d)),w[j],k1);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<20) {
				w[j]=RR(w,j);
				t=AA(e,a,d^(b&(c^d)),w[j],k1);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<40) {
				w[j]=RR(w,j);
				t=AA(e,a,b^c^d,w[j],k2);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<60) {
				w[j]=RR(w,j);
				t=AA(e,a,(b&c)|(d&(b|c)),w[j],k3);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<80) {
				w[j]=RR(w,j);
				t=AA(e,a,b^c^d,w[j],k4);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			h0=add32(h0,a);
			h1=add32(h1,b);
			h2=add32(h2,c);
			h3=add32(h3,d);
			h4=add32(h4,e);
		}
		return [h0,h1,h2,h3,h4];
	}
})(jQuery);
/*
jQuery.twStylesheet.js

jQuery plugin to dynamically insert CSS rules into a document

Usage:
  jQuery.twStylesheet applies style definitions
  jQuery.twStylesheet.remove neutralizes style definitions

Copyright (c) UnaMesa Association 2009

Triple licensed under the BSD, MIT and GPL licenses:
  http://www.opensource.org/licenses/bsd-license.php
  http://www.opensource.org/licenses/mit-license.php
  http://www.gnu.org/licenses/gpl.html
*/

(function($) {

var defaultId = "customStyleSheet"; // XXX: rename to dynamicStyleSheet?

// Add or replace a style sheet
// css argument is a string of CSS rule sets
// options.id is an optional name identifying the style sheet
// options.doc is an optional document reference
// N.B.: Uses DOM methods instead of jQuery to ensure cross-browser comaptibility.
$.twStylesheet = function(css, options) {
	options = options || {};
	var id = options.id || defaultId;
	var doc = options.doc || document;
	var el = doc.getElementById(id);
	if(doc.createStyleSheet) { // IE-specific handling
		if(el) {
			el.parentNode.removeChild(el);
		}
		doc.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd",
			'&nbsp;<style id="' + id + '" type="text/css">' + css + '</style>'); // fails without &nbsp;
	} else { // modern browsers
		if(el) {
			el.replaceChild(doc.createTextNode(css), el.firstChild);
		} else {
			el = doc.createElement("style");
			el.type = "text/css";
			el.id = id;
			el.appendChild(doc.createTextNode(css));
			doc.getElementsByTagName("head")[0].appendChild(el);
		}
	}
};

// Remove existing style sheet
// options.id is an optional name identifying the style sheet
// options.doc is an optional document reference
$.twStylesheet.remove = function(options) {
	options = options || {};
	var id = options.id || defaultId;
	var doc = options.doc || document;
	var el = doc.getElementById(id);
	if(el) {
		el.parentNode.removeChild(el);
	}
};

})(jQuery);
//]]>
</script>
<script type="text/javascript">
//<![CDATA[
if(useJavaSaver)
	document.write("<applet style='position:absolute;left:-1px' name='TiddlySaver' code='TiddlySaver.class' archive='TiddlySaver.jar' width='1' height='1'></applet>");
//]]>
</script>
<!--POST-SCRIPT-START-->

<!--POST-SCRIPT-END-->
</body>
</html>
